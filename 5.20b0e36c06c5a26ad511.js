(self.webpackJsonp=self.webpackJsonp||[]).push([[5],{11:function(e,t,n){"use strict";n.r(t);var r=n(75),i=n(22),o=n(30),a=n(76),u=n(8),c=n(18),s={power:1,chroma:.5,onset:1},l=96;function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class h{constructor(e,t){this.dbMin=e,this.dbMax=t}}d(h,"octave",e=>Math.floor(e/12)),d(h,"chroma",e=>e%12),d(h,"f",e=>{var t=h.octave(e),n=h.chroma(e);return 16.35*2**t*Math.pow(2,1/12)**n});var f=n(70),v=n.n(f),p=n(14);function b(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}var y=function(){var e,t=(e=function*(e){e instanceof Error?u.error(e):u.error(Object(p.a)(e))},function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){b(o,r,i,a,u,"next",e)}function u(e){b(o,r,i,a,u,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}();function w(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class m{constructor(e,t,n){this.ctx=e,g(this,"close",()=>this.ctx.close());var r=new AudioWorkletNode(e,"power",{numberOfInputs:l,channelCountMode:"explicit",channelCount:1});r.port.onmessage=e=>n.next(e.data),r.onprocessorerror=e=>{y(e),c.a.mic.value=!1},r.connect(e.destination),c.a.allowedDbs.stream.subscribe(t=>{var{newValue:[n,i]}=t;r.parameters.get("dbMin").setValueAtTime(n,e.currentTime),r.parameters.get("dbMax").setValueAtTime(i,e.currentTime)});for(var i=0;i<l;i++){var o=h.f(i),a=new BiquadFilterNode(e,{type:"bandpass",frequency:o,Q:l/o});t.connect(a).connect(r,0,i)}}}function x(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}g(m,"create",function(){var e,t=(e=function*(e,t){var n=new AudioContext;yield n.audioWorklet.addModule(v.a);var r=new MediaStreamAudioSourceNode(n,{mediaStream:e});return new m(n,r,t)},function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){w(o,r,i,a,u,"next",e)}function u(e){w(o,r,i,a,u,"throw",e)}a(void 0)}))});return function(e,n){return t.apply(this,arguments)}}());var O,A=Object(u.getLogger)("Audio"),j=new a.a(s),M=j.asObservable();c.a.mic.stream.subscribe(function(){var e,t=(e=function*(e){var{newValue:t,event:n}=e;if(t){A.info("getting user media");var r=yield navigator.mediaDevices.getUserMedia({audio:!0});A.info("starting new audio graph"),O=yield m.create(r,j)}else A.info("closing audio graph"),O&&(yield O.close()),j.next(s)},function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){x(o,r,i,a,u,"next",e)}function u(e){x(o,r,i,a,u,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}());var k=n(43),P=n(13),D=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return P.a(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return P.a(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(n(19).a)),I=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),q=new(function(e){function t(n,r){void 0===r&&(r=I.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return P.a(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(I))(D),S=n(41);function T(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}Math.floor(512);var V,C=(e,t)=>{var{power:n,chroma:r,onset:i}=t;return{pipe:c.a.pipe.value,theta:c.a.theta.value,h:c.a.h.value,v:c.a.v.value,t:e,power:n,chroma:r,onset:i}},E=new a.a(C(0,s)),L=E.asObservable(),N=0;M.subscribe(e=>V=e,y);var _,B,F;(_=1e3/60,void 0===_&&(_=0),void 0===B&&(B=q),F=_,(Object(S.a)(F)||!(F-parseFloat(F)+1>=0)||_<0)&&(_=0),B&&"function"==typeof B.schedule||(B=q),new k.a((function(e){return e.add(B.schedule(T,_,{subscriber:e,counter:0,period:_})),e}))).subscribe(()=>{c.a.animate.value&&E.next(C(N++/60,V))},y);var J=n(2);function W(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function Q(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){W(o,r,i,a,u,"next",e)}function u(e){W(o,r,i,a,u,"throw",e)}a(void 0)}))}}n.d(t,"dataStream",(function(){return G}));var U=Object(u.getLogger)("Data");U.setDefaultLevel("info");var z=new r.a,G=z.asObservable(),H=function(){var e=Q((function*(){console.info("starting web worker data source"),yield Object(o.c)();return{getData:e=>Object(o.b)(e).then(i.a.fromBuffer)}}));return function(){return e.apply(this,arguments)}}();Q((function*(){var e,{getData:t}=yield H(),n=0;L.subscribe(function(){var r=Q((function*(r){if(!e){Object(J.a)("params",r),U.debug("requesting data with params",r),Date.now()-n>=1e3&&(U.debug("sending request for data with params ".concat(Object(p.a)(r))),n=Date.now()),e=t(r);try{z.next(yield e)}catch(e){y(e)}finally{e=null}}}));return function(e){return r.apply(this,arguments)}}(),e=>y(e))}))()},70:function(e,t,n){e.exports=n.p+"feba2ad1a1d6c8ee9647.worklet.js"}}]);
//# sourceMappingURL=5.20b0e36c06c5a26ad511.js.map