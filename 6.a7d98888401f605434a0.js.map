{"version":3,"sources":["webpack:///./src/web/renderer.ts"],"names":["renderer","constructor","width","window","innerWidth","height","innerHeight","aspect","this","setSize","camera","PerspectiveCamera","position","z","render","scene","d","color","points","geometry","assert","equal","length","nans","reduce","p","i","isNaN","push","console","warn","setAttribute","BufferAttribute","computeBoundingSphere","s","boundingSphere","Math","min","center","radius","requestAnimationFrame","WebGLRenderer","onresize","Points","BufferGeometry","PointsMaterial","vertexColors","VertexColors","size","Scene","add","domElement"],"mappings":"yRA8FO,IAAMA,EAAW,IAjFxB,MAOEC,cAAc,4GAFF,GAEE,iBAoBI,KAChB,IAEMC,EAAQC,OAAOC,WACfC,EAASF,OAAOG,YAChBC,EAASL,EAAQG,EAGvBG,KAAKR,SAASS,QAAQP,EAAOG,GAC7BG,KAAKE,OAAS,IAAIC,IAHN,IAG6BJ,EAR5B,IACL,KAQRC,KAAKE,OAAOE,SAASC,EAAIL,KAAKK,IA9BlB,gBAqCL,KACPL,KAAKR,SAASc,OAAON,KAAKO,MAAOP,KAAKE,UAtC1B,gBAyCJ,IAAiC,IAAjC,EAAEM,EAAF,SAAKJ,EAAL,MAAeK,GAAkB,GACnC,OAAEC,GAAWV,KACbW,EAAWD,EAAOC,SACxBC,IAAOC,MAAMT,EAASU,OAASN,EAAG,GAClCI,IAAOC,MAAMJ,EAAMK,OAAS,EAAG,GAE/B,IAAMC,EAAOX,EAASY,OAAO,CAACD,EAAME,EAAGC,KACjCC,MAAMF,KACRb,EAASc,GAAK,EACdH,EAAKK,KAAKF,IAELH,GACN,IACCA,EAAKD,QACPO,QAAQC,KAAR,4BACuBP,EAAKD,OAD5B,2CACqEC,EADrE,wBACyFX,EADzF,MAIFO,EAASY,aAAa,WAAY,IAAIC,IAAgBpB,EAAUI,IAChEG,EAASY,aAAa,QAAS,IAAIC,IAAgBf,EAAO,IAE1D,IAAIJ,EAAI,EACR,GAAIG,EAAI,EAAG,CACTG,EAASc,wBACT,IAAMC,EAAIf,EAASgB,eACnBtB,EAAIuB,KAAKC,IAAI,EAAGH,EAAEI,OAAOzB,EAAIqB,EAAEK,OAAS,GAE1C/B,KAAKE,OAAOE,SAASC,EAAIL,KAAKK,EAAIA,EAElC2B,sBAAsBhC,KAAKM,UArE3BN,KAAKR,SAAW,IAAIyC,IACpBjC,KAAKC,UACLN,OAAOuC,SAAW,KAChBlC,KAAKC,UACL+B,sBAAsBhC,KAAKM,SAG7BN,KAAKU,OAAS,IAAIyB,IAChB,IAAIC,IACJ,IAAIC,IAAe,CACjBC,aAAcC,IACdC,KAAM,QAIVxC,KAAKO,MAAQ,IAAIkC,IACjBzC,KAAKO,MAAMmC,IAAI1C,KAAKU,QAgBtB,iBACE,OAAOV,KAAKR,SAASmD","file":"6.a7d98888401f605434a0.js","sourcesContent":["import {\n  PerspectiveCamera,\n  BufferGeometry,\n  BufferAttribute,\n  Points,\n  PointsMaterial,\n  WebGLRenderer,\n  VertexColors,\n  Scene,\n} from 'three';\nimport { Data } from '../core/data';\nimport assert from 'assert';\n\nclass Renderer {\n  private renderer: WebGLRenderer;\n  private scene: Scene;\n  private camera: PerspectiveCamera;\n  private points: Points;\n  private z = 5;\n\n  constructor() {\n    this.renderer = new WebGLRenderer();\n    this.setSize();\n    window.onresize = () => {\n      this.setSize();\n      requestAnimationFrame(this.render);\n    };\n\n    this.points = new Points(\n      new BufferGeometry(),\n      new PointsMaterial({\n        vertexColors: VertexColors,\n        size: 0.001,\n      }),\n    );\n\n    this.scene = new Scene();\n    this.scene.add(this.points);\n  }\n\n  private setSize = () => {\n    const near = 0.01,\n      far = 1000;\n    const width = window.innerWidth;\n    const height = window.innerHeight;\n    const aspect = width / height;\n    const fov = 100;\n\n    this.renderer.setSize(width, height);\n    this.camera = new PerspectiveCamera(fov, aspect, near, far);\n    this.camera.position.z = this.z;\n  };\n\n  get domElement() {\n    return this.renderer.domElement;\n  }\n\n  render = () => {\n    this.renderer.render(this.scene, this.camera);\n  };\n\n  update = ({ d, position, color }: Data) => {\n    const { points } = this;\n    const geometry = points.geometry as BufferGeometry;\n    assert.equal(position.length % d, 0);\n    assert.equal(color.length % 3, 0);\n\n    const nans = position.reduce((nans, p, i) => {\n      if (isNaN(p)) {\n        position[i] = 0;\n        nans.push(i);\n      }\n      return nans;\n    }, []);\n    if (nans.length)\n      console.warn(\n        `position contains ${nans.length} NaNs at the following indices [${nans}], position=[${position}]`,\n      );\n\n    geometry.setAttribute('position', new BufferAttribute(position, d));\n    geometry.setAttribute('color', new BufferAttribute(color, 3));\n\n    let z = 5;\n    if (d > 2) {\n      geometry.computeBoundingSphere();\n      const s = geometry.boundingSphere;\n      z = Math.min(5, s.center.z + s.radius + 1);\n    }\n    this.camera.position.z = this.z = z;\n\n    requestAnimationFrame(this.render);\n  };\n}\n\nexport const renderer = new Renderer();\n"],"sourceRoot":""}