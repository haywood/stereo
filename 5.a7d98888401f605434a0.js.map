{"version":3,"sources":["webpack:///./src/web/audio/constants.ts","webpack:///./src/web/audio/spectrum.ts","webpack:///./src/web/error.ts","webpack:///./src/web/audio/graph.ts","webpack:///./src/web/audio/index.ts","webpack:///./node_modules/rxjs/_esm5/internal/OuterSubscriber.js","webpack:///./node_modules/rxjs/_esm5/internal/InnerSubscriber.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeToArray.js","webpack:///./node_modules/rxjs/_esm5/internal/symbol/iterator.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeTo.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeToObservable.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isArrayLike.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isPromise.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeToPromise.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeToIterable.js","webpack:///./node_modules/rxjs/_esm5/internal/util/subscribeToResult.js","webpack:///./node_modules/rxjs/_esm5/internal/observable/fromArray.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduled/scheduleArray.js","webpack:///./node_modules/rxjs/_esm5/internal/observable/combineLatest.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduler/AsyncAction.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduler/Action.js","webpack:///./node_modules/rxjs/_esm5/internal/Scheduler.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduler/async.js","webpack:///./node_modules/rxjs/_esm5/internal/scheduler/AsyncScheduler.js","webpack:///./node_modules/rxjs/_esm5/internal/observable/interval.js","webpack:///./src/web/constants.ts","webpack:///./src/web/params.ts","webpack:///./node_modules/rxjs/_esm5/internal/util/isNumeric.js","webpack:///./node_modules/rxjs/_esm5/internal/util/isScheduler.js","webpack:///./src/web/data.ts","webpack:///./src/web/audio/power.worklet.ts"],"names":["AUDIO_PLACEHOLDER","power","chroma","tempo","onset","binCount","octaveCount","Spectrum","constructor","dbMin","dbMax","k","Math","floor","octave","pow","error","err","Error","log","pp","AudioGraph","ctx","source","subject","this","close","AudioWorkletNode","numberOfInputs","channelCountMode","channelCount","port","onmessage","msg","inputs","mic","value","next","data","onprocessorerror","connect","destination","allowedDbs","stream","subscribe","newValue","min","max","parameters","get","setValueAtTime","currentTime","f","filter","BiquadFilterNode","type","frequency","Q","mediaStream","AudioContext","audioWorklet","addModule","processorUrl","MediaStreamAudioSourceNode","graph","logger","getLogger","BehaviorSubject","audioStream","asObservable","event","info","navigator","mediaDevices","getUserMedia","audio","create","_super","OuterSubscriber","apply","arguments","prototype","notifyNext","outerValue","innerValue","outerIndex","innerIndex","innerSub","notifyError","notifyComplete","complete","Subscriber","InnerSubscriber","parent","_this","call","index","_next","_error","unsubscribe","_complete","subscribeToArray","array","subscriber","i","len","length","closed","getSymbolIterator","Symbol","iterator","subscribeTo","result","obj","obs","TypeError","x","then","isPromise","promise","hostReportError","iterable","item","done","return","add","isObject","subscribeToResult","outerSubscriber","Observable","fromArray","input","scheduler","sub","Subscription","schedule","scheduleArray","NONE","CombineLatestOperator","resultSelector","CombineLatestSubscriber","active","values","observables","observable","push","toRespond","unused","oldVal","_tryResultSelector","slice","AsyncAction","work","pending","state","delay","id","recycleAsyncId","requestAsyncId","setInterval","flush","bind","clearInterval","execute","_execute","errored","errorValue","undefined","e","_unsubscribe","actions","indexOf","splice","Action","Scheduler","SchedulerAction","now","Date","AsyncScheduler","delegate","scheduled","action","shift","dispatch","counter","period","fftSize","val","params","t","pipe","theta","h","v","paramsStream","count","_i","pop","isArray","lift","combineLatest","parseFloat","animate","setDefaultLevel","Subject","dataStream","webWorkerSource","console","startPool","getData","runPipeline","Data","fromBuffer","inFlight","logged","debug","module","exports"],"mappings":"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","file":"5.a7d98888401f605434a0.js","sourcesContent":["import { Audio } from './types';\n\n/**\n * This defines the placeholder used for power and chroma when audio is not enabled.\n */\nexport const AUDIO_PLACEHOLDER: Audio = {\n  power: 1,\n  chroma: 0,\n  tempo: 0.5,\n  onset: 1,\n};\n\nexport const chromaCount = 12;\nexport const octaveMin = 0;\nexport const octaveMax = 8;\nexport const octaveCount = octaveMax - octaveMin;\nexport const quantumSize = 128;\nexport const binCount = octaveCount * chromaCount;\n","import { chromaCount } from './constants';\n\nexport class Spectrum {\n  constructor(public dbMin: number, public dbMax: number) {}\n\n  static octave = (k: number) => Math.floor(k / chromaCount);\n\n  static chroma = (k: number) => k % chromaCount;\n\n  static f = (k: number): number => {\n    const octave = Spectrum.octave(k);\n    const chroma = Spectrum.chroma(k);\n    const c0 = 16.35; // c0 per https://pages.mtu.edu/~suits/notefreqs.html\n\n    return c0 * 2 ** octave * Math.pow(2, 1 / chromaCount) ** chroma;\n  };\n}\n","import { pp } from '../core/pp';\nimport * as log from 'loglevel';\n\nexport const error = async (err: any) => {\n  if (err instanceof Error) {\n    log.error(err);\n  } else {\n    log.error(pp(err));\n  }\n};\n","import { Subject } from 'rxjs';\nimport { Audio } from './types';\nimport { Spectrum } from './spectrum';\nimport { binCount, AUDIO_PLACEHOLDER } from './constants';\nimport processorUrl from './power.worklet';\nimport { error } from '../error';\nimport { inputs } from '../inputs';\n\nexport class AudioGraph {\n  static create = async (mediaStream: MediaStream, subject: Subject<Audio>) => {\n    const ctx = new AudioContext();\n    await ctx.audioWorklet.addModule(processorUrl);\n    const source = new MediaStreamAudioSourceNode(ctx, { mediaStream });\n    return new AudioGraph(ctx, source, subject);\n  };\n\n  constructor(\n    private readonly ctx: AudioContext,\n    source: AudioNode,\n    subject: Subject<Audio>,\n  ) {\n    const power = new AudioWorkletNode(ctx, 'power', {\n      numberOfInputs: binCount,\n      channelCountMode: 'explicit',\n      channelCount: 1,\n    });\n    power.port.onmessage = msg => {\n      if (inputs.mic.value) {\n        subject.next(msg.data as Audio);\n      } else {\n        subject.next(AUDIO_PLACEHOLDER);\n      }\n    };\n\n    power.onprocessorerror = err => {\n      error(err);\n      // processor dies after an error, so close the graph\n      inputs.mic.value = false;\n    };\n\n    power.connect(ctx.destination);\n\n    inputs.allowedDbs.stream.subscribe(({ newValue: [min, max] }) => {\n      power.parameters.get('dbMin').setValueAtTime(min, ctx.currentTime);\n      power.parameters.get('dbMax').setValueAtTime(max, ctx.currentTime);\n    });\n\n    for (let k = 0; k < binCount; k++) {\n      const f = Spectrum.f(k);\n      const filter = new BiquadFilterNode(ctx, {\n        type: 'bandpass',\n        frequency: f,\n        Q: f / 2,\n      });\n      source.connect(filter).connect(power, 0, k);\n    }\n  }\n\n  close = () => this.ctx.close();\n}\n","import { BehaviorSubject, interval, Observable } from 'rxjs';\nimport { getLogger } from 'loglevel';\nimport { inputs } from '../inputs';\nimport { Audio } from './types';\nimport { AUDIO_PLACEHOLDER } from './constants';\nimport { AudioGraph } from './graph';\n\nconst logger = getLogger('Audio');\n\nconst subject = new BehaviorSubject<Audio>(AUDIO_PLACEHOLDER);\nexport const audioStream = subject.asObservable();\nlet graph: AudioGraph;\n\ninputs.mic.stream.subscribe(async ({ newValue, event }) => {\n  if (newValue) {\n    logger.info('getting user media');\n    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n    logger.info('starting new audio graph');\n    graph = await AudioGraph.create(stream, subject);\n  } else {\n    logger.info('closing audio graph');\n    if (graph) await graph.close();\n    subject.next(AUDIO_PLACEHOLDER);\n  }\n});\n","/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscriber } from './Subscriber';\nvar OuterSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(OuterSubscriber, _super);\n    function OuterSubscriber() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    OuterSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {\n        this.destination.next(innerValue);\n    };\n    OuterSubscriber.prototype.notifyError = function (error, innerSub) {\n        this.destination.error(error);\n    };\n    OuterSubscriber.prototype.notifyComplete = function (innerSub) {\n        this.destination.complete();\n    };\n    return OuterSubscriber;\n}(Subscriber));\nexport { OuterSubscriber };\n//# sourceMappingURL=OuterSubscriber.js.map\n","/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscriber } from './Subscriber';\nvar InnerSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(InnerSubscriber, _super);\n    function InnerSubscriber(parent, outerValue, outerIndex) {\n        var _this = _super.call(this) || this;\n        _this.parent = parent;\n        _this.outerValue = outerValue;\n        _this.outerIndex = outerIndex;\n        _this.index = 0;\n        return _this;\n    }\n    InnerSubscriber.prototype._next = function (value) {\n        this.parent.notifyNext(this.outerValue, value, this.outerIndex, this.index++, this);\n    };\n    InnerSubscriber.prototype._error = function (error) {\n        this.parent.notifyError(error, this);\n        this.unsubscribe();\n    };\n    InnerSubscriber.prototype._complete = function () {\n        this.parent.notifyComplete(this);\n        this.unsubscribe();\n    };\n    return InnerSubscriber;\n}(Subscriber));\nexport { InnerSubscriber };\n//# sourceMappingURL=InnerSubscriber.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport var subscribeToArray = function (array) {\n    return function (subscriber) {\n        for (var i = 0, len = array.length; i < len && !subscriber.closed; i++) {\n            subscriber.next(array[i]);\n        }\n        subscriber.complete();\n    };\n};\n//# sourceMappingURL=subscribeToArray.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function getSymbolIterator() {\n    if (typeof Symbol !== 'function' || !Symbol.iterator) {\n        return '@@iterator';\n    }\n    return Symbol.iterator;\n}\nexport var iterator = /*@__PURE__*/ getSymbolIterator();\nexport var $$iterator = iterator;\n//# sourceMappingURL=iterator.js.map\n","/** PURE_IMPORTS_START _subscribeToArray,_subscribeToPromise,_subscribeToIterable,_subscribeToObservable,_isArrayLike,_isPromise,_isObject,_symbol_iterator,_symbol_observable PURE_IMPORTS_END */\nimport { subscribeToArray } from './subscribeToArray';\nimport { subscribeToPromise } from './subscribeToPromise';\nimport { subscribeToIterable } from './subscribeToIterable';\nimport { subscribeToObservable } from './subscribeToObservable';\nimport { isArrayLike } from './isArrayLike';\nimport { isPromise } from './isPromise';\nimport { isObject } from './isObject';\nimport { iterator as Symbol_iterator } from '../symbol/iterator';\nimport { observable as Symbol_observable } from '../symbol/observable';\nexport var subscribeTo = function (result) {\n    if (!!result && typeof result[Symbol_observable] === 'function') {\n        return subscribeToObservable(result);\n    }\n    else if (isArrayLike(result)) {\n        return subscribeToArray(result);\n    }\n    else if (isPromise(result)) {\n        return subscribeToPromise(result);\n    }\n    else if (!!result && typeof result[Symbol_iterator] === 'function') {\n        return subscribeToIterable(result);\n    }\n    else {\n        var value = isObject(result) ? 'an invalid object' : \"'\" + result + \"'\";\n        var msg = \"You provided \" + value + \" where a stream was expected.\"\n            + ' You can provide an Observable, Promise, Array, or Iterable.';\n        throw new TypeError(msg);\n    }\n};\n//# sourceMappingURL=subscribeTo.js.map\n","/** PURE_IMPORTS_START _symbol_observable PURE_IMPORTS_END */\nimport { observable as Symbol_observable } from '../symbol/observable';\nexport var subscribeToObservable = function (obj) {\n    return function (subscriber) {\n        var obs = obj[Symbol_observable]();\n        if (typeof obs.subscribe !== 'function') {\n            throw new TypeError('Provided object does not correctly implement Symbol.observable');\n        }\n        else {\n            return obs.subscribe(subscriber);\n        }\n    };\n};\n//# sourceMappingURL=subscribeToObservable.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport var isArrayLike = (function (x) { return x && typeof x.length === 'number' && typeof x !== 'function'; });\n//# sourceMappingURL=isArrayLike.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function isPromise(value) {\n    return !!value && typeof value.subscribe !== 'function' && typeof value.then === 'function';\n}\n//# sourceMappingURL=isPromise.js.map\n","/** PURE_IMPORTS_START _hostReportError PURE_IMPORTS_END */\nimport { hostReportError } from './hostReportError';\nexport var subscribeToPromise = function (promise) {\n    return function (subscriber) {\n        promise.then(function (value) {\n            if (!subscriber.closed) {\n                subscriber.next(value);\n                subscriber.complete();\n            }\n        }, function (err) { return subscriber.error(err); })\n            .then(null, hostReportError);\n        return subscriber;\n    };\n};\n//# sourceMappingURL=subscribeToPromise.js.map\n","/** PURE_IMPORTS_START _symbol_iterator PURE_IMPORTS_END */\nimport { iterator as Symbol_iterator } from '../symbol/iterator';\nexport var subscribeToIterable = function (iterable) {\n    return function (subscriber) {\n        var iterator = iterable[Symbol_iterator]();\n        do {\n            var item = iterator.next();\n            if (item.done) {\n                subscriber.complete();\n                break;\n            }\n            subscriber.next(item.value);\n            if (subscriber.closed) {\n                break;\n            }\n        } while (true);\n        if (typeof iterator.return === 'function') {\n            subscriber.add(function () {\n                if (iterator.return) {\n                    iterator.return();\n                }\n            });\n        }\n        return subscriber;\n    };\n};\n//# sourceMappingURL=subscribeToIterable.js.map\n","/** PURE_IMPORTS_START _InnerSubscriber,_subscribeTo,_Observable PURE_IMPORTS_END */\nimport { InnerSubscriber } from '../InnerSubscriber';\nimport { subscribeTo } from './subscribeTo';\nimport { Observable } from '../Observable';\nexport function subscribeToResult(outerSubscriber, result, outerValue, outerIndex, destination) {\n    if (destination === void 0) {\n        destination = new InnerSubscriber(outerSubscriber, outerValue, outerIndex);\n    }\n    if (destination.closed) {\n        return undefined;\n    }\n    if (result instanceof Observable) {\n        return result.subscribe(destination);\n    }\n    return subscribeTo(result)(destination);\n}\n//# sourceMappingURL=subscribeToResult.js.map\n","/** PURE_IMPORTS_START _Observable,_util_subscribeToArray,_scheduled_scheduleArray PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { subscribeToArray } from '../util/subscribeToArray';\nimport { scheduleArray } from '../scheduled/scheduleArray';\nexport function fromArray(input, scheduler) {\n    if (!scheduler) {\n        return new Observable(subscribeToArray(input));\n    }\n    else {\n        return scheduleArray(input, scheduler);\n    }\n}\n//# sourceMappingURL=fromArray.js.map\n","/** PURE_IMPORTS_START _Observable,_Subscription PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { Subscription } from '../Subscription';\nexport function scheduleArray(input, scheduler) {\n    return new Observable(function (subscriber) {\n        var sub = new Subscription();\n        var i = 0;\n        sub.add(scheduler.schedule(function () {\n            if (i === input.length) {\n                subscriber.complete();\n                return;\n            }\n            subscriber.next(input[i++]);\n            if (!subscriber.closed) {\n                sub.add(this.schedule());\n            }\n        }));\n        return sub;\n    });\n}\n//# sourceMappingURL=scheduleArray.js.map\n","/** PURE_IMPORTS_START tslib,_util_isScheduler,_util_isArray,_OuterSubscriber,_util_subscribeToResult,_fromArray PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { isScheduler } from '../util/isScheduler';\nimport { isArray } from '../util/isArray';\nimport { OuterSubscriber } from '../OuterSubscriber';\nimport { subscribeToResult } from '../util/subscribeToResult';\nimport { fromArray } from './fromArray';\nvar NONE = {};\nexport function combineLatest() {\n    var observables = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        observables[_i] = arguments[_i];\n    }\n    var resultSelector = null;\n    var scheduler = null;\n    if (isScheduler(observables[observables.length - 1])) {\n        scheduler = observables.pop();\n    }\n    if (typeof observables[observables.length - 1] === 'function') {\n        resultSelector = observables.pop();\n    }\n    if (observables.length === 1 && isArray(observables[0])) {\n        observables = observables[0];\n    }\n    return fromArray(observables, scheduler).lift(new CombineLatestOperator(resultSelector));\n}\nvar CombineLatestOperator = /*@__PURE__*/ (function () {\n    function CombineLatestOperator(resultSelector) {\n        this.resultSelector = resultSelector;\n    }\n    CombineLatestOperator.prototype.call = function (subscriber, source) {\n        return source.subscribe(new CombineLatestSubscriber(subscriber, this.resultSelector));\n    };\n    return CombineLatestOperator;\n}());\nexport { CombineLatestOperator };\nvar CombineLatestSubscriber = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(CombineLatestSubscriber, _super);\n    function CombineLatestSubscriber(destination, resultSelector) {\n        var _this = _super.call(this, destination) || this;\n        _this.resultSelector = resultSelector;\n        _this.active = 0;\n        _this.values = [];\n        _this.observables = [];\n        return _this;\n    }\n    CombineLatestSubscriber.prototype._next = function (observable) {\n        this.values.push(NONE);\n        this.observables.push(observable);\n    };\n    CombineLatestSubscriber.prototype._complete = function () {\n        var observables = this.observables;\n        var len = observables.length;\n        if (len === 0) {\n            this.destination.complete();\n        }\n        else {\n            this.active = len;\n            this.toRespond = len;\n            for (var i = 0; i < len; i++) {\n                var observable = observables[i];\n                this.add(subscribeToResult(this, observable, observable, i));\n            }\n        }\n    };\n    CombineLatestSubscriber.prototype.notifyComplete = function (unused) {\n        if ((this.active -= 1) === 0) {\n            this.destination.complete();\n        }\n    };\n    CombineLatestSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {\n        var values = this.values;\n        var oldVal = values[outerIndex];\n        var toRespond = !this.toRespond\n            ? 0\n            : oldVal === NONE ? --this.toRespond : this.toRespond;\n        values[outerIndex] = innerValue;\n        if (toRespond === 0) {\n            if (this.resultSelector) {\n                this._tryResultSelector(values);\n            }\n            else {\n                this.destination.next(values.slice());\n            }\n        }\n    };\n    CombineLatestSubscriber.prototype._tryResultSelector = function (values) {\n        var result;\n        try {\n            result = this.resultSelector.apply(this, values);\n        }\n        catch (err) {\n            this.destination.error(err);\n            return;\n        }\n        this.destination.next(result);\n    };\n    return CombineLatestSubscriber;\n}(OuterSubscriber));\nexport { CombineLatestSubscriber };\n//# sourceMappingURL=combineLatest.js.map\n","/** PURE_IMPORTS_START tslib,_Action PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Action } from './Action';\nvar AsyncAction = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(AsyncAction, _super);\n    function AsyncAction(scheduler, work) {\n        var _this = _super.call(this, scheduler, work) || this;\n        _this.scheduler = scheduler;\n        _this.work = work;\n        _this.pending = false;\n        return _this;\n    }\n    AsyncAction.prototype.schedule = function (state, delay) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        if (this.closed) {\n            return this;\n        }\n        this.state = state;\n        var id = this.id;\n        var scheduler = this.scheduler;\n        if (id != null) {\n            this.id = this.recycleAsyncId(scheduler, id, delay);\n        }\n        this.pending = true;\n        this.delay = delay;\n        this.id = this.id || this.requestAsyncId(scheduler, this.id, delay);\n        return this;\n    };\n    AsyncAction.prototype.requestAsyncId = function (scheduler, id, delay) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        return setInterval(scheduler.flush.bind(scheduler, this), delay);\n    };\n    AsyncAction.prototype.recycleAsyncId = function (scheduler, id, delay) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        if (delay !== null && this.delay === delay && this.pending === false) {\n            return id;\n        }\n        clearInterval(id);\n        return undefined;\n    };\n    AsyncAction.prototype.execute = function (state, delay) {\n        if (this.closed) {\n            return new Error('executing a cancelled action');\n        }\n        this.pending = false;\n        var error = this._execute(state, delay);\n        if (error) {\n            return error;\n        }\n        else if (this.pending === false && this.id != null) {\n            this.id = this.recycleAsyncId(this.scheduler, this.id, null);\n        }\n    };\n    AsyncAction.prototype._execute = function (state, delay) {\n        var errored = false;\n        var errorValue = undefined;\n        try {\n            this.work(state);\n        }\n        catch (e) {\n            errored = true;\n            errorValue = !!e && e || new Error(e);\n        }\n        if (errored) {\n            this.unsubscribe();\n            return errorValue;\n        }\n    };\n    AsyncAction.prototype._unsubscribe = function () {\n        var id = this.id;\n        var scheduler = this.scheduler;\n        var actions = scheduler.actions;\n        var index = actions.indexOf(this);\n        this.work = null;\n        this.state = null;\n        this.pending = false;\n        this.scheduler = null;\n        if (index !== -1) {\n            actions.splice(index, 1);\n        }\n        if (id != null) {\n            this.id = this.recycleAsyncId(scheduler, id, null);\n        }\n        this.delay = null;\n    };\n    return AsyncAction;\n}(Action));\nexport { AsyncAction };\n//# sourceMappingURL=AsyncAction.js.map\n","/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscription } from '../Subscription';\nvar Action = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(Action, _super);\n    function Action(scheduler, work) {\n        return _super.call(this) || this;\n    }\n    Action.prototype.schedule = function (state, delay) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        return this;\n    };\n    return Action;\n}(Subscription));\nexport { Action };\n//# sourceMappingURL=Action.js.map\n","var Scheduler = /*@__PURE__*/ (function () {\n    function Scheduler(SchedulerAction, now) {\n        if (now === void 0) {\n            now = Scheduler.now;\n        }\n        this.SchedulerAction = SchedulerAction;\n        this.now = now;\n    }\n    Scheduler.prototype.schedule = function (work, delay, state) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        return new this.SchedulerAction(this, work).schedule(state, delay);\n    };\n    Scheduler.now = function () { return Date.now(); };\n    return Scheduler;\n}());\nexport { Scheduler };\n//# sourceMappingURL=Scheduler.js.map\n","/** PURE_IMPORTS_START _AsyncAction,_AsyncScheduler PURE_IMPORTS_END */\nimport { AsyncAction } from './AsyncAction';\nimport { AsyncScheduler } from './AsyncScheduler';\nexport var async = /*@__PURE__*/ new AsyncScheduler(AsyncAction);\n//# sourceMappingURL=async.js.map\n","/** PURE_IMPORTS_START tslib,_Scheduler PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Scheduler } from '../Scheduler';\nvar AsyncScheduler = /*@__PURE__*/ (function (_super) {\n    tslib_1.__extends(AsyncScheduler, _super);\n    function AsyncScheduler(SchedulerAction, now) {\n        if (now === void 0) {\n            now = Scheduler.now;\n        }\n        var _this = _super.call(this, SchedulerAction, function () {\n            if (AsyncScheduler.delegate && AsyncScheduler.delegate !== _this) {\n                return AsyncScheduler.delegate.now();\n            }\n            else {\n                return now();\n            }\n        }) || this;\n        _this.actions = [];\n        _this.active = false;\n        _this.scheduled = undefined;\n        return _this;\n    }\n    AsyncScheduler.prototype.schedule = function (work, delay, state) {\n        if (delay === void 0) {\n            delay = 0;\n        }\n        if (AsyncScheduler.delegate && AsyncScheduler.delegate !== this) {\n            return AsyncScheduler.delegate.schedule(work, delay, state);\n        }\n        else {\n            return _super.prototype.schedule.call(this, work, delay, state);\n        }\n    };\n    AsyncScheduler.prototype.flush = function (action) {\n        var actions = this.actions;\n        if (this.active) {\n            actions.push(action);\n            return;\n        }\n        var error;\n        this.active = true;\n        do {\n            if (error = action.execute(action.state, action.delay)) {\n                break;\n            }\n        } while (action = actions.shift());\n        this.active = false;\n        if (error) {\n            while (action = actions.shift()) {\n                action.unsubscribe();\n            }\n            throw error;\n        }\n    };\n    return AsyncScheduler;\n}(Scheduler));\nexport { AsyncScheduler };\n//# sourceMappingURL=AsyncScheduler.js.map\n","/** PURE_IMPORTS_START _Observable,_scheduler_async,_util_isNumeric PURE_IMPORTS_END */\nimport { Observable } from '../Observable';\nimport { async } from '../scheduler/async';\nimport { isNumeric } from '../util/isNumeric';\nexport function interval(period, scheduler) {\n    if (period === void 0) {\n        period = 0;\n    }\n    if (scheduler === void 0) {\n        scheduler = async;\n    }\n    if (!isNumeric(period) || period < 0) {\n        period = 0;\n    }\n    if (!scheduler || typeof scheduler.schedule !== 'function') {\n        scheduler = async;\n    }\n    return new Observable(function (subscriber) {\n        subscriber.add(scheduler.schedule(dispatch, period, { subscriber: subscriber, counter: 0, period: period }));\n        return subscriber;\n    });\n}\nfunction dispatch(state) {\n    var subscriber = state.subscriber, counter = state.counter, period = state.period;\n    subscriber.next(counter);\n    this.schedule({ subscriber: subscriber, counter: counter + 1, period: period }, period);\n}\n//# sourceMappingURL=interval.js.map\n","// TODO make these inputs :D\nexport const fps = 60;\nexport const dataSampleRate = fps / 1000;\nexport const audioSampleRate = 2 * dataSampleRate;\nexport const fftSize = 1024;\nexport const psdSize = Math.floor(fftSize / 2) + 1;\n","import { audioStream } from './audio';\nimport { Params } from '../core/pipe/types';\nimport { interval, BehaviorSubject, combineLatest } from 'rxjs';\nimport { inputs } from './inputs';\nimport { fps } from './constants';\nimport { Audio } from './audio/types';\nimport { error } from './error';\nimport { AUDIO_PLACEHOLDER } from './audio/constants';\n\nconst params = (t: number, audio: Audio) => {\n  return {\n    pipe: inputs.pipe.value,\n    theta: inputs.theta.value,\n    h: inputs.h.value,\n    v: inputs.v.value,\n    t,\n    ...audio,\n  };\n};\n\nconst subject = new BehaviorSubject<Params>(params(0, AUDIO_PLACEHOLDER));\nexport const paramsStream = subject.asObservable();\nlet count = 0;\n\nconst maybeEmit = ([audio]: [Audio, number]) => {\n  if (inputs.animate.value) {\n    subject.next(params(count++ / fps, audio));\n  }\n};\n\ncombineLatest(audioStream, interval(1000 / fps)).subscribe(maybeEmit, error);\n","/** PURE_IMPORTS_START _isArray PURE_IMPORTS_END */\nimport { isArray } from './isArray';\nexport function isNumeric(val) {\n    return !isArray(val) && (val - parseFloat(val) + 1) >= 0;\n}\n//# sourceMappingURL=isNumeric.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function isScheduler(value) {\n    return value && typeof value.schedule === 'function';\n}\n//# sourceMappingURL=isScheduler.js.map\n","import { Observable, timer, Subject, interval, EMPTY } from 'rxjs';\nimport { retryWhen, delayWhen, repeatWhen, tap } from 'rxjs/operators';\nimport { Data } from '../core/data';\nimport { Params } from '../core/pipe/types';\nimport { startPool, runPipeline } from '../core/pipe/pool';\nimport * as params from './params';\nimport { getLogger } from 'loglevel';\nimport { pp } from '../core/pp';\nimport { error } from './error';\nimport debug from './debug';\n\nconst logger = getLogger('Data');\nlogger.setDefaultLevel('info');\nconst subject = new Subject<Data>();\n\nexport const dataStream = subject.asObservable();\n\ntype Source = {\n  getData(params: Params): Promise<Data>;\n};\n\nconst webWorkerSource = async (): Promise<Source> => {\n  console.info('starting web worker data source');\n  await startPool();\n\n  const getData = (params: Params) => runPipeline(params).then(Data.fromBuffer);\n\n  return { getData };\n};\n\n(async () => {\n  const { getData } = await webWorkerSource();\n  let inFlight: Promise<Data> | null;\n  let logged = 0;\n\n  params.paramsStream.subscribe(\n    async params => {\n      if (inFlight) return;\n      debug('params', params);\n      logger.debug('requesting data with params', params);\n      if (Date.now() - logged >= 1000) {\n        logger.debug(`sending request for data with params ${pp(params)}`);\n        logged = Date.now();\n      }\n      // TODO i feel like there's a more rx-y way to do this\n      inFlight = getData(params);\n      try {\n        subject.next(await inFlight);\n      } catch (err) {\n        error(err);\n      } finally {\n        inFlight = null;\n      }\n    },\n    err => error(err),\n  );\n})();\n","module.exports = __webpack_public_path__ + \"ee535caaa9d379b9b466.worklet.js\";"],"sourceRoot":""}