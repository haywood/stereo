parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {function C(a){return a&&a.__esModule?{d:a.default}:{d:a}}var Uc=this;var Vc={};var jg={};function wm(r){for(;r;){var e=r,o=e.closed,t=e.destination,$=e.isStopped;if(o||$)return!1;r=t&&t instanceof db?t:null}return!0}var xm=function(t,e){return(xm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function $(t,e){function r(){this.constructor=t}xm(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var ym=function(){return ym=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},ym.apply(this,arguments)};function Oi(t){return this instanceof Oi?(this.v=t,this):new Oi(t)}function kg(n){return"function"==typeof n}var zm=!1,sa={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&new Error().stack;zm=e},get useDeprecatedSynchronousErrorHandling(){return zm}};function Vb(r){setTimeout(function(){throw r},0)}var ke={closed:!0,next:function(r){},error:function(r){if(sa.useDeprecatedSynchronousErrorHandling)throw r;Vb(r)},complete:function(){}};var lg=function(){return Array.isArray||function(r){return r&&"number"==typeof r.length}}();function Pi(r){return null!==r&&"object"==typeof r}var Am=function(){function r(r){return Error.call(this),this.message=r?r.length+" errors occurred during unsubscription:\n"+r.map(function(r,o){return o+1+") "+r.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=r,this}return r.prototype=Object.create(Error.prototype),r}(),le=Am;var tb=function(){function r(r){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,r&&(this._unsubscribe=r)}var i;return r.prototype.unsubscribe=function(){var i;if(!this.closed){var t=this._parentOrParents,s=this._unsubscribe,n=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof r)t.remove(this);else if(null!==t)for(var e=0;e<t.length;++e){t[e].remove(this)}if(kg(s))try{s.call(this)}catch(c){i=c instanceof le?Qi(c.errors):[c]}if(lg(n)){e=-1;for(var o=n.length;++e<o;){var u=n[e];if(Pi(u))try{u.unsubscribe()}catch(c){i=i||[],c instanceof le?i=i.concat(Qi(c.errors)):i.push(c)}}}if(i)throw new le(i)}},r.prototype.add=function(i){var t=i;if(!i)return r.EMPTY;switch(typeof i){case"function":t=new r(i);case"object":if(t===this||t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof r)){var s=t;(t=new r)._subscriptions=[s]}break;default:throw new Error("unrecognized teardown "+i+" added to Subscription.");}var n=t._parentOrParents;if(null===n)t._parentOrParents=this;else if(n instanceof r){if(n===this)return t;t._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return t;n.push(this)}var e=this._subscriptions;return null===e?this._subscriptions=[t]:e.push(t),t},r.prototype.remove=function(r){var i=this._subscriptions;if(i){var t=i.indexOf(r);-1!==t&&i.splice(t,1)}},r.EMPTY=((i=new r).closed=!0,i),r}();function Qi(r){return r.reduce(function(r,i){return r.concat(i instanceof le?i.errors:i)},[])}var me=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}();var db=function(r){function t(e,i,o){var s=r.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=ke;break;case 1:if(!e){s.destination=ke;break}if("object"==typeof e){e instanceof t?(s.syncErrorThrowable=e.syncErrorThrowable,s.destination=e,e.add(s)):(s.syncErrorThrowable=!0,s.destination=new Ri(s,e));break}default:s.syncErrorThrowable=!0,s.destination=new Ri(s,e,i,o);}return s}return $(t,r),t.prototype[me]=function(){return this},t.create=function(r,e,i){var o=new t(r,e,i);return o.syncErrorThrowable=!1,o},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this))},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){this.destination.error(r),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var r=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=r,this},t}(tb);var Ri=function(r){function t(t,e,i,o){var s,n=r.call(this)||this;n._parentSubscriber=t;var c=n;return kg(e)?s=e:e&&(s=e.next,i=e.error,o=e.complete,e!==ke&&(c=Object.create(e),kg(c.unsubscribe)&&n.add(c.unsubscribe.bind(c)),c.unsubscribe=n.unsubscribe.bind(n))),n._context=c,n._next=s,n._error=i,n._complete=o,n}return $(t,r),t.prototype.next=function(r){if(!this.isStopped&&this._next){var t=this._parentSubscriber;sa.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,r)&&this.unsubscribe():this.__tryOrUnsub(this._next,r)}},t.prototype.error=function(r){if(!this.isStopped){var t=this._parentSubscriber,e=sa.useDeprecatedSynchronousErrorHandling;if(this._error)e&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,r),this.unsubscribe()):(this.__tryOrUnsub(this._error,r),this.unsubscribe());else if(t.syncErrorThrowable)e?(t.syncErrorValue=r,t.syncErrorThrown=!0):Vb(r),this.unsubscribe();else{if(this.unsubscribe(),e)throw r;Vb(r)}}},t.prototype.complete=function(){var r=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var e=function(){return r._complete.call(r._context)};sa.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(r,t){try{r.call(this._context,t)}catch(e){if(this.unsubscribe(),sa.useDeprecatedSynchronousErrorHandling)throw e;Vb(e)}},t.prototype.__tryOrSetError=function(r,t,e){if(!sa.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,e)}catch(i){return sa.useDeprecatedSynchronousErrorHandling?(r.syncErrorValue=i,r.syncErrorThrown=!0,!0):(Vb(i),!0)}return!1},t.prototype._unsubscribe=function(){var r=this._parentSubscriber;this._context=null,this._parentSubscriber=null,r.unsubscribe()},t}(db);function Bm(r,e,$){if(r){if(r instanceof db)return r;if(r[me])return r[me]()}return r||e||$?new db(r,e,$):new db(ke)}var mg=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function Cm(r){return r?1===r.length?r[0]:function(e){return r.reduce(function(r,e){return e(r)},e)}:Dm}function Dm(){}var Wb=function(){function r(r){this._isScalar=!1,r&&(this._subscribe=r)}return r.prototype.lift=function(e){var o=new r;return o.source=this,o.operator=e,o},r.prototype.subscribe=function(r,e,o){var t=this.operator,n=Bm(r,e,o);if(t?n.add(t.call(n,this.source)):n.add(this.source||sa.useDeprecatedSynchronousErrorHandling&&!n.syncErrorThrowable?this._subscribe(n):this._trySubscribe(n)),sa.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable&&(n.syncErrorThrowable=!1,n.syncErrorThrown))throw n.syncErrorValue;return n},r.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(e){sa.useDeprecatedSynchronousErrorHandling&&(r.syncErrorThrown=!0,r.syncErrorValue=e),wm(r)?r.error(e):console.warn(e)}},r.prototype.forEach=function(r,e){var o=this;return new(e=Si(e))(function(e,t){var n;n=o.subscribe(function(e){try{r(e)}catch(o){t(o),n&&n.unsubscribe()}},t,e)})},r.prototype._subscribe=function(r){var e=this.source;return e&&e.subscribe(r)},r.prototype[mg]=function(){return this},r.prototype.pipe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return 0===r.length?this:Cm(r)(this)},r.prototype.toPromise=function(r){var e=this;return new(r=Si(r))(function(r,o){var t;e.subscribe(function(r){return t=r},function(r){return o(r)},function(){return r(t)})})},r.create=function(e){return new r(e)},r}();function Si(r){if(r||(r=sa.Promise||Promise),!r)throw new Error("no Promise impl found");return r}var Em=function(){function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return r.prototype=Object.create(Error.prototype),r}(),Xb=Em;var Fm=function(t){function e(e,i){var r=t.call(this)||this;return r.subject=e,r.subscriber=i,r.closed=!1,r}return $(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var i=e.indexOf(this.subscriber);-1!==i&&e.splice(i,1)}}},e}(tb);var Gm=function(r){function t(t){var e=r.call(this,t)||this;return e.destination=t,e}return $(t,r),t}(db);var Wc=function(r){function t(){var t=r.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return $(t,r),t.prototype[me]=function(){return new Gm(this)},t.prototype.lift=function(r){var t=new Ti(this,this);return t.operator=r,t},t.prototype.next=function(r){if(this.closed)throw new Xb;if(!this.isStopped)for(var t=this.observers,e=t.length,o=t.slice(),i=0;i<e;i++)o[i].next(r)},t.prototype.error=function(r){if(this.closed)throw new Xb;this.hasError=!0,this.thrownError=r,this.isStopped=!0;for(var t=this.observers,e=t.length,o=t.slice(),i=0;i<e;i++)o[i].error(r);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Xb;this.isStopped=!0;for(var r=this.observers,t=r.length,e=r.slice(),o=0;o<t;o++)e[o].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new Xb;return r.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(r){if(this.closed)throw new Xb;return this.hasError?(r.error(this.thrownError),tb.EMPTY):this.isStopped?(r.complete(),tb.EMPTY):(this.observers.push(r),new Fm(this,r))},t.prototype.asObservable=function(){var r=new Wb;return r.source=this,r},t.create=function(r,t){return new Ti(r,t)},t}(Wb);var Ti=function(r){function t(t,e){var o=r.call(this)||this;return o.destination=t,o.source=e,o}return $(t,r),t.prototype.next=function(r){var t=this.destination;t&&t.next&&t.next(r)},t.prototype.error=function(r){var t=this.destination;t&&t.error&&this.destination.error(r)},t.prototype.complete=function(){var r=this.destination;r&&r.complete&&this.destination.complete()},t.prototype._subscribe=function(r){return this.source?this.source.subscribe(r):tb.EMPTY},t}(Wc);var Ui=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return $(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return r&&!r.closed&&t.next(this._value),r},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Xb;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Wc);var Hm=function(r){function t(t,i){return r.call(this)||this}return $(t,r),t.prototype.schedule=function(r,t){return void 0===t&&(t=0),this},t}(tb);var Im=function(t){function i(i,e){var n=t.call(this,i,e)||this;return n.scheduler=i,n.work=e,n.pending=!1,n}return $(i,t),i.prototype.schedule=function(t,i){if(void 0===i&&(i=0),this.closed)return this;this.state=t;var e=this.id,n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,i)),this.pending=!0,this.delay=i,this.id=this.id||this.requestAsyncId(n,this.id,i),this},i.prototype.requestAsyncId=function(t,i,e){return void 0===e&&(e=0),setInterval(t.flush.bind(t,this),e)},i.prototype.recycleAsyncId=function(t,i,e){if(void 0===e&&(e=0),null!==e&&this.delay===e&&!1===this.pending)return i;clearInterval(i)},i.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var e=this._execute(t,i);if(e)return e;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},i.prototype._execute=function(t,i){var e=!1,n=void 0;try{this.work(t)}catch(s){e=!0,n=!!s&&s||new Error(s)}if(e)return this.unsubscribe(),n},i.prototype._unsubscribe=function(){var t=this.id,i=this.scheduler,e=i.actions,n=e.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&e.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(i,t,null)),this.delay=null},i}(Hm);var Vi=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}();var Jm=function(e){function t(r,i){void 0===i&&(i=Vi.now);var h=e.call(this,r,function(){return t.delegate&&t.delegate!==h?t.delegate.now():i()})||this;return h.actions=[],h.active=!1,h.scheduled=void 0,h}return $(t,e),t.prototype.schedule=function(r,i,h){return void 0===i&&(i=0),t.delegate&&t.delegate!==this?t.delegate.schedule(r,i,h):e.prototype.schedule.call(this,r,i,h)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var r;this.active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}},t}(Vi);function Km(e){return e&&"function"==typeof e.schedule}function Lm(r,e){return e?Mm(r,e):new Wb(Wi(r))}var Wi=function(r){return function(e){for(var o=0,t=r.length;o<t&&!e.closed;o++)e.next(r[o]);e.complete()}};function Mm(e,r){return new Wb(function($){var t=new tb,c=0;return t.add(r.schedule(function(){c!==e.length?($.next(e[c++]),$.closed||t.add(this.schedule())):$.complete()})),t})}var Xi=new Jm(Im);var Nm=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return $(r,t),r.prototype.notifyNext=function(t,r,e,i,o){this.destination.next(r)},r.prototype.notifyError=function(t,r){this.destination.error(t)},r.prototype.notifyComplete=function(t){this.destination.complete()},r}(db);function Om(e,r,$,s,b){if(void 0===b&&(b=new Pm(e,$,s)),!b.closed)return r instanceof Wb?r.subscribe(b):Wm(r)(b)}var Pm=function(r){function t(t,e,i){var n=r.call(this)||this;return n.parent=t,n.outerValue=e,n.outerIndex=i,n.index=0,n}return $(t,r),t.prototype._next=function(r){this.parent.notifyNext(this.outerValue,r,this.outerIndex,this.index++,this)},t.prototype._error=function(r){this.parent.notifyError(r,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(db);var Qm=function(r){return function(e){return r.then(function(r){e.closed||(e.next(r),e.complete())},function(r){return e.error(r)}).then(null,Vb),e}};function Rm(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var Yi=Rm();var Sm=function(r){return function(e){for(var t=r[Yi]();;){var o=t.next();if(o.done){e.complete();break}if(e.next(o.value),e.closed)break}return"function"==typeof t.return&&e.add(function(){t.return&&t.return()}),e}};var Tm=function(e){return function(r){var b=e[mg]();if("function"!=typeof b.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return b.subscribe(r)}};var Um=function(r){return r&&"number"==typeof r.length&&"function"!=typeof r};function Vm(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var Wm=function(r){if(r&&"function"==typeof r[mg])return Tm(r);if(Um(r))return Wi(r);if(Vm(r))return Qm(r);if(r&&"function"==typeof r[Yi])return Sm(r);var e=Pi(r)?"an invalid object":"'"+r+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};var Zi={};function Xm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=null,o=null;return Km(t[t.length-1])&&(o=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&lg(t[0])&&(t=t[0]),Lm(t,o).lift(new Ym(r))}var Ym=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Zm(t,this.resultSelector))},t}();var Zm=function(t){function e(e,r){var o=t.call(this,e)||this;return o.resultSelector=r,o.active=0,o.values=[],o.observables=[],o}return $(e,t),e.prototype._next=function(t){this.values.push(Zi),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var o=t[r];this.add(Om(this,o,o,r))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,r,o,i){var s=this.values,c=s[r],$=this.toRespond?c===Zi?--this.toRespond:this.toRespond:0;s[r]=e,0===$&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(r){return void this.destination.error(r)}this.destination.next(e)},e}(Nm);function $m(r,e){return void 0===r&&(r=0),void 0===e&&(e=Xi),(!an(r)||r<0)&&(r=0),e&&"function"==typeof e.schedule||(e=Xi),new Wb(function($){return $.add(e.schedule(_m,r,{subscriber:$,counter:0,period:r})),$})}function _m(r){var e=r.subscriber,$=r.counter,i=r.period;e.next($),this.schedule({subscriber:e,counter:$+1,period:i},i)}function an(r){return!lg(r)&&r-parseFloat(r)+1>=0}var ng=(e,$)=>{window._debug=Object.assign(Object.assign({},window._debug),{[e]:$})};const $i=(p,$=2)=>JSON.stringify(p,null,$);const Xc=r=>{r instanceof Error?console.error(r):console.error($i(r))};var og={};function W(r){switch(r.kind){case"pipe":return bn(r);case"step":return cn(r);case"arith":return dn(r);case"number":return en(r);case"fn":return fn(r);case"access":return gn(r);case"id":return hn(r);case"paren":return`(${W(r.scalar)})`;}}function bn(r){return[W(r.n),r.d0,...r.steps.map(W)].join("\n  =>")}function cn(r){return`${r.type}(${r.args.map(W).join(", ")})`}function dn(r){const[$,n]=r.operands;return null==n?`-${W($)}`:`${W($)} ${r.op} ${W(n)}`}function en(r){return r.value.toString()}function fn(r){return`${r.name}(${r.args.map(W).join(", ")})`}function gn(r){return`${r.id}[${W(r.index)}]`}function hn(r){return r.id}var _i={};function jn(r,t){function n(){this.constructor=r}n.prototype=t.prototype,r.prototype=new n}function ub(r,t,n,e){this.message=r,this.expected=t,this.found=n,this.location=e,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,ub)}function kn(r,t){t=void 0!==t?t:{};var n,e={},u={pipe:gt,scalar:vt},a=gt,o=function(r,t,n){return{kind:"pipe",n:r,d0:t,steps:n}},c=it("positive integer"),s=function(t){return(t=parseInt(t))<=0&&function(t,n){throw n=void 0!==n?n:lt(tt,rt),ht([it(t)],r.substring(tt,rt),n)}("a positive integer"),t},i=function(r,t){return[r,...t]},f=function(r){return[r]},l=it("cube"),p="cube",h=ct("cube",!0),g=function(r,t){return Ft(r,t,1)},b=it("lattice"),v="lattice",d=ct("lattice",!0),$=it("sphere"),A="sphere",x=ct("sphere",!0),C=it("spiral"),y="spiral",m=ct("spiral",!0),w=function(r,t){return Ft(r,t,1,1/0)},E=it("torus"),k="torus",I=ct("torus",!0),q=function(r,t){return Ft(r,t,0,1/0)},J=it("fucked_up_torus"),S="fucked_up_torus",L=ct("fucked_up_torus",!0),F=function(r,t){return Ft(r,t,2)},_=it("rotate"),z="r",R=ct("r",!0),Z=function(r){return Ft("rotate",r,3,5)},M="rotate",T=ct("rotate",!0),j=it("stereo"),U="stereo",B=ct("stereo",!0),D=function(r){return[r]},G=it("scalar"),H="+",K=ct("+",!1),N="-",O=ct("-",!1),P=function(r,t,n){return _t(t,r,n)},Q="*",V=ct("*",!1),W="/",X=ct("/",!1),Y=function(r,t){return _t("*",r,t)},rr="**",tr=ct("**",!1),nr="^",er=ct("^",!1),ur=it("term"),ar=function(r,t){return _t(r,t)},or=function(r,t){return{kind:"fn",name:r.toLowerCase(),args:t}},cr=function(r,t){return{kind:"access",id:r,index:t}},sr=".",ir=ct(".",!1),fr=function(r){return{kind:"paren",scalar:r}},lr=function(r){return{kind:"id",id:r.toLowerCase()}},pr=function(r){return r},hr=it("number"),gr=function(r){return{kind:"number",value:parseFloat(r)}},br=function(r){return{kind:"number",value:parseInt(r)}},vr=it("identifier"),dr=/^[a-zA-Z]/,$r=st([["a","z"],["A","Z"]],!1,!1),Ar=/^[a-zA-Z0-9]/,xr=st([["a","z"],["A","Z"],["0","9"]],!1,!1),Cr=function(r){return r},yr=it("float"),mr=/^[+\-]/,wr=st(["+","-"],!1,!1),Er=/^[0-9]/,kr=st([["0","9"]],!1,!1),Ir=/^[eE]/,qr=st(["e","E"],!1,!1),Jr=it("integer"),Sr=it("unsigned integer"),Lr=(it("arithmetic operator"),it("lparen")),Fr="(",_r=ct("(",!1),zr=it("rparen"),Rr=")",Zr=ct(")",!1),Mr=it("lbrack"),Tr="[",jr=ct("[",!1),Ur=it("rbrack"),Br="]",Dr=ct("]",!1),Gr=it("comma"),Hr=",",Kr=ct(",",!1),Nr=it("connector"),Or="->",Pr=ct("->",!1),Qr="=>",Vr=ct("=>",!1),Wr=it("whitespace"),Xr=/^[ \t\n\r]/,Yr=st([" ","\t","\n","\r"],!1,!1),rt=0,tt=0,nt=[{line:1,column:1}],et=0,ut=[],at=0;if("startRule"in t){if(!(t.startRule in u))throw new Error("Can't start parsing from rule \""+t.startRule+"\".");a=u[t.startRule]}function ot(r,t){throw function(r,t){return new ub(r,null,null,t)}(r,t=void 0!==t?t:lt(tt,rt))}function ct(r,t){return{type:"literal",text:r,ignoreCase:t}}function st(r,t,n){return{type:"class",parts:r,inverted:t,ignoreCase:n}}function it(r){return{type:"other",description:r}}function ft(t){var n,e=nt[t];if(e)return e;for(n=t-1;!nt[n];)n--;for(e={line:(e=nt[n]).line,column:e.column};n<t;)10===r.charCodeAt(n)?(e.line++,e.column=1):e.column++,n++;return nt[t]=e,e}function lt(r,t){var n=ft(r),e=ft(t);return{start:{offset:r,line:n.line,column:n.column},end:{offset:t,line:e.line,column:e.column}}}function pt(r){rt<et||(rt>et&&(et=rt,ut=[]),ut.push(r))}function ht(r,t,n){return new ub(ub.buildMessage(r,t),r,t,n)}function gt(){var r,t,n,u;return r=rt,Lt()!==e&&(t=vt())!==e&&St()!==e&&(n=function(){var r,t;at++,r=rt,(t=Et())!==e&&(tt=r,t=s(t));at--,(r=t)===e&&(t=e,0===at&&pt(c));return r}())!==e&&St()!==e&&(u=function r(){var t,n,u;t=rt;n=bt();n!==e&&St()!==e&&(u=r())!==e?(tt=t,n=i(n,u),t=n):(rt=t,t=e);t===e&&(t=rt,(n=bt())!==e&&(tt=t,n=f(n)),t=n);return t}())!==e&&Lt()!==e?(tt=r,r=o(t,n,u)):(rt=r,r=e),r}function bt(){var t;return(t=function(){var t,n,u;at++,t=rt,n=rt,r.substr(rt,4).toLowerCase()===p?(u=r.substr(rt,4),rt+=4):(u=e,0===at&&pt(h));n=u!==e?r.substring(n,rt):u;n!==e&&(u=Ct())!==e?(tt=t,n=g(n,u),t=n):(rt=t,t=e);at--,t===e&&(n=e,0===at&&pt(l));return t}())===e&&(t=function(){var t,n,u;at++,t=rt,n=rt,r.substr(rt,7).toLowerCase()===v?(u=r.substr(rt,7),rt+=7):(u=e,0===at&&pt(d));n=u!==e?r.substring(n,rt):u;n!==e&&(u=Ct())!==e?(tt=t,n=g(n,u),t=n):(rt=t,t=e);at--,t===e&&(n=e,0===at&&pt(b));return t}())===e&&(t=function(){var t,n,u;at++,t=rt,n=rt,r.substr(rt,6).toLowerCase()===A?(u=r.substr(rt,6),rt+=6):(u=e,0===at&&pt(x));n=u!==e?r.substring(n,rt):u;n!==e&&(u=Ct())!==e?(tt=t,n=g(n,u),t=n):(rt=t,t=e);at--,t===e&&(n=e,0===at&&pt($));return t}())===e&&(t=function(){var t,n,u;at++,t=rt,n=rt,r.substr(rt,6).toLowerCase()===y?(u=r.substr(rt,6),rt+=6):(u=e,0===at&&pt(m));n=u!==e?r.substring(n,rt):u;n!==e&&(u=Ct())!==e?(tt=t,n=w(n,u),t=n):(rt=t,t=e);at--,t===e&&(n=e,0===at&&pt(C));return t}())===e&&(t=function(){var t,n,u;at++,t=rt,n=rt,r.substr(rt,5).toLowerCase()===k?(u=r.substr(rt,5),rt+=5):(u=e,0===at&&pt(I));n=u!==e?r.substring(n,rt):u;n!==e&&(u=Ct())!==e?(tt=t,n=q(n,u),t=n):(rt=t,t=e);at--,t===e&&(n=e,0===at&&pt(E));return t}())===e&&(t=function(){var t,n,u;at++,t=rt,n=rt,r.substr(rt,15).toLowerCase()===S?(u=r.substr(rt,15),rt+=15):(u=e,0===at&&pt(L));n=u!==e?r.substring(n,rt):u;n!==e&&(u=Ct())!==e?(tt=t,n=F(n,u),t=n):(rt=t,t=e);at--,t===e&&(n=e,0===at&&pt(J));return t}())===e&&(t=function(){var t,n,u;at++,t=rt,r.substr(rt,1).toLowerCase()===z?(n=r.charAt(rt),rt++):(n=e,0===at&&pt(R));n!==e&&(u=Ct())!==e?(tt=t,n=Z(u),t=n):(rt=t,t=e);t===e&&(t=rt,r.substr(rt,6).toLowerCase()===M?(n=r.substr(rt,6),rt+=6):(n=e,0===at&&pt(T)),n!==e&&(u=Ct())!==e?(tt=t,n=Z(u),t=n):(rt=t,t=e));at--,t===e&&(n=e,0===at&&pt(_));return t}())===e&&(t=function(){var t,n,u;at++,t=rt,n=rt,r.substr(rt,6).toLowerCase()===U?(u=r.substr(rt,6),rt+=6):(u=e,0===at&&pt(B));n=u!==e?r.substring(n,rt):u;n!==e&&(u=Ct())!==e?(tt=t,n=g(n,u),t=n):(rt=t,t=e);at--,t===e&&(n=e,0===at&&pt(j));return t}()),t}function vt(){var t;return at++,t=function t(){var n,u,a,o;n=rt;u=dt();u!==e&&Lt()!==e?(43===r.charCodeAt(rt)?(a=H,rt++):(a=e,0===at&&pt(K)),a===e&&(45===r.charCodeAt(rt)?(a=N,rt++):(a=e,0===at&&pt(O))),a!==e&&Lt()!==e&&(o=t())!==e?(tt=n,u=P(u,a,o),n=u):(rt=n,n=e)):(rt=n,n=e);n===e&&(n=dt());return n}(),at--,t===e&&(e,0===at&&pt(G)),t}function dt(){var t,n,u,a,o;return t=rt,(n=$t())!==e&&(u=Lt())!==e?(42===r.charCodeAt(rt)?(a=Q,rt++):(a=e,0===at&&pt(V)),a===e&&(47===r.charCodeAt(rt)?(a=W,rt++):(a=e,0===at&&pt(X))),a!==e&&Lt()!==e&&(o=dt())!==e?(tt=t,t=n=P(n,a,o)):(rt=t,t=e)):(rt=t,t=e),t===e&&(t=rt,(n=yt())!==e&&(u=xt())!==e?(tt=t,t=n=Y(n,u)):(rt=t,t=e),t===e&&(t=rt,(n=yt())!==e&&(u=It())!==e&&(a=vt())!==e&&qt()!==e?(tt=t,t=n=Y(n,a)):(rt=t,t=e),t===e&&(t=$t()))),t}function $t(){var t,n,u,a;return t=rt,(n=At())!==e&&Lt()!==e?(r.substr(rt,2)===rr?(u=rr,rt+=2):(u=e,0===at&&pt(tr)),u===e&&(94===r.charCodeAt(rt)?(u=nr,rt++):(u=e,0===at&&pt(er))),u!==e&&Lt()!==e&&(a=$t())!==e?(tt=t,t=n=P(n,u,a)):(rt=t,t=e)):(rt=t,t=e),t===e&&(t=At()),t}function At(){var t,n,u,a,o;return at++,t=rt,45===r.charCodeAt(rt)?(n=N,rt++):(n=e,0===at&&pt(O)),n!==e&&(u=At())!==e?(tt=t,t=n=ar(n,u)):(rt=t,t=e),t===e&&(t=yt())===e&&(t=rt,(n=mt())!==e&&(u=Ct())!==e?(tt=t,t=n=or(n,u)):(rt=t,t=e),t===e&&(t=rt,(n=mt())!==e&&(u=function(){var t,n,u,a;at++,t=rt,(n=Lt())!==e?(91===r.charCodeAt(rt)?(u=Tr,rt++):(u=e,0===at&&pt(jr)),u!==e&&(a=Lt())!==e?t=n=[n,u,a]:(rt=t,t=e)):(rt=t,t=e);at--,t===e&&(n=e,0===at&&pt(Mr));return t}())!==e&&(a=vt())!==e&&function(){var t,n,u,a;at++,t=rt,(n=Lt())!==e?(93===r.charCodeAt(rt)?(u=Br,rt++):(u=e,0===at&&pt(Dr)),u!==e&&(a=Lt())!==e?t=n=[n,u,a]:(rt=t,t=e)):(rt=t,t=e);at--,t===e&&(n=e,0===at&&pt(Ur));return t}()!==e?(tt=t,t=n=cr(n,a)):(rt=t,t=e),t===e&&(t=rt,(n=mt())!==e&&(u=Lt())!==e?(46===r.charCodeAt(rt)?(a=sr,rt++):(a=e,0===at&&pt(ir)),a!==e&&Lt()!==e&&(o=xt())!==e?(tt=t,t=n=cr(n,o)):(rt=t,t=e)):(rt=t,t=e),t===e&&(t=xt())===e&&(t=rt,(n=It())!==e&&(u=vt())!==e&&(a=qt())!==e?(tt=t,t=n=fr(u)):(rt=t,t=e))))),at--,t===e&&(n=e,0===at&&pt(ur)),t}function xt(){var r,t;return r=rt,(t=mt())!==e&&(tt=r,t=lr(t)),r=t}function Ct(){var r,t;return r=rt,It()!==e&&(t=function r(){var t,n,u;t=rt;n=vt();n!==e&&Jt()!==e&&(u=r())!==e?(tt=t,n=i(n,u),t=n):(rt=t,t=e);t===e&&(t=rt,(n=vt())!==e&&(tt=t,n=D(n)),t=n);return t}())!==e&&qt()!==e?(tt=r,r=pr(t)):(rt=r,r=e),r}function yt(){var t,n;return at++,t=rt,Lt()!==e&&(n=function(){var t,n,u,a,o,c,s;at++,t=rt,n=rt,mr.test(r.charAt(rt))?(u=r.charAt(rt),rt++):(u=e,0===at&&pt(wr));u===e&&(u=null);u!==e?(Er.test(r.charAt(rt))?(a=r.charAt(rt),rt++):(a=e,0===at&&pt(kr)),a!==e&&(o=kt())!==e?(Ir.test(r.charAt(rt))?(c=r.charAt(rt),rt++):(c=e,0===at&&pt(qr)),c!==e&&(s=wt())!==e?n=u=[u,a,o,c,s]:(rt=n,n=e)):(rt=n,n=e)):(rt=n,n=e);t=n!==e?r.substring(t,rt):n;t===e&&(t=rt,n=rt,(u=wt())===e&&(u=null),u!==e&&(a=kt())!==e?n=u=[u,a]:(rt=n,n=e),t=n!==e?r.substring(t,rt):n);at--,t===e&&(n=e,0===at&&pt(yr));return t}())!==e&&Lt()!==e?(tt=t,t=gr(n)):(rt=t,t=e),t===e&&(t=rt,Lt()!==e&&(n=wt())!==e&&Lt()!==e?(tt=t,t=br(n)):(rt=t,t=e)),at--,t===e&&(e,0===at&&pt(hr)),t}function mt(){var t,n,u,a,o,c;if(at++,t=rt,Lt()!==e){if(n=rt,u=rt,dr.test(r.charAt(rt))?(a=r.charAt(rt),rt++):(a=e,0===at&&pt($r)),a!==e){for(o=[],Ar.test(r.charAt(rt))?(c=r.charAt(rt),rt++):(c=e,0===at&&pt(xr));c!==e;)o.push(c),Ar.test(r.charAt(rt))?(c=r.charAt(rt),rt++):(c=e,0===at&&pt(xr));o!==e?u=a=[a,o]:(rt=u,u=e)}else rt=u,u=e;(n=u!==e?r.substring(n,rt):u)!==e&&(u=Lt())!==e?(tt=t,t=Cr(n)):(rt=t,t=e)}else rt=t,t=e;return at--,t===e&&(e,0===at&&pt(vr)),t}function wt(){var t,n,u,a;return at++,t=rt,n=rt,mr.test(r.charAt(rt))?(u=r.charAt(rt),rt++):(u=e,0===at&&pt(wr)),u===e&&(u=null),u!==e&&(a=Et())!==e?n=u=[u,a]:(rt=n,n=e),t=n!==e?r.substring(t,rt):n,at--,t===e&&(n=e,0===at&&pt(Jr)),t}function Et(){var t,n,u;if(at++,t=rt,n=[],Er.test(r.charAt(rt))?(u=r.charAt(rt),rt++):(u=e,0===at&&pt(kr)),u!==e)for(;u!==e;)n.push(u),Er.test(r.charAt(rt))?(u=r.charAt(rt),rt++):(u=e,0===at&&pt(kr));else n=e;return t=n!==e?r.substring(t,rt):n,at--,t===e&&(n=e,0===at&&pt(Sr)),t}function kt(){var t,n,u,a;return t=rt,n=rt,46===r.charCodeAt(rt)?(u=sr,rt++):(u=e,0===at&&pt(ir)),u!==e&&(a=Et())!==e?n=u=[u,a]:(rt=n,n=e),t=n!==e?r.substring(t,rt):n}function It(){var t,n,u,a;return at++,t=rt,(n=Lt())!==e?(40===r.charCodeAt(rt)?(u=Fr,rt++):(u=e,0===at&&pt(_r)),u!==e&&(a=Lt())!==e?t=n=[n,u,a]:(rt=t,t=e)):(rt=t,t=e),at--,t===e&&(n=e,0===at&&pt(Lr)),t}function qt(){var t,n,u,a;return at++,t=rt,(n=Lt())!==e?(41===r.charCodeAt(rt)?(u=Rr,rt++):(u=e,0===at&&pt(Zr)),u!==e&&(a=Lt())!==e?t=n=[n,u,a]:(rt=t,t=e)):(rt=t,t=e),at--,t===e&&(n=e,0===at&&pt(zr)),t}function Jt(){var t,n,u,a;return at++,t=rt,(n=Lt())!==e?(44===r.charCodeAt(rt)?(u=Hr,rt++):(u=e,0===at&&pt(Kr)),u!==e&&(a=Lt())!==e?t=n=[n,u,a]:(rt=t,t=e)):(rt=t,t=e),at--,t===e&&(n=e,0===at&&pt(Gr)),t}function St(){var t,n,u,a;return at++,t=rt,(n=Lt())!==e?(u=rt,r.substr(rt,2)===Or?(a=Or,rt+=2):(a=e,0===at&&pt(Pr)),a===e&&(a=function(){var t,n,u;at++,t=rt,n=[],Xr.test(r.charAt(rt))?(u=r.charAt(rt),rt++):(u=e,0===at&&pt(Yr));if(u!==e)for(;u!==e;)n.push(u),Xr.test(r.charAt(rt))?(u=r.charAt(rt),rt++):(u=e,0===at&&pt(Yr));else n=e;t=n!==e?r.substring(t,rt):n;at--,t===e&&(n=e,0===at&&pt(Wr));return t}())===e&&(r.substr(rt,2)===Qr?(a=Qr,rt+=2):(a=e,0===at&&pt(Vr))),(u=a!==e?r.substring(u,rt):a)!==e&&(a=Lt())!==e?t=n=[n,u,a]:(rt=t,t=e)):(rt=t,t=e),at--,t===e&&(n=e,0===at&&pt(Nr)),t}function Lt(){var t,n;for(at++,t=[],Xr.test(r.charAt(rt))?(n=r.charAt(rt),rt++):(n=e,0===at&&pt(Yr));n!==e;)t.push(n),Xr.test(r.charAt(rt))?(n=r.charAt(rt),rt++):(n=e,0===at&&pt(Yr));return at--,t===e&&(n=e,0===at&&pt(Wr)),t}function Ft(r,t,n,e=n){return t.length<n?ot(`expected ${r} to have at least ${n} argument${1==n?"":"s"}, but found ${t.length} instead`):t.length>e&&ot(`expected ${r} to have at most ${e} argument${1==e?"":"s"}, but found ${t.length} instead`),{kind:"step",type:r,args:t}}function _t(r,...t){return{kind:"arith",op:r,operands:t}}if((n=a())!==e&&rt===r.length)return n;throw n!==e&&rt<r.length&&pt({type:"end"}),ht(ut,et<r.length?r.charAt(et):null,et<r.length?lt(et,et+1):lt(et,et))}jn(ub,Error),ub.buildMessage=function(r,t){var n={literal:function(r){return"\""+u(r.text)+"\""},class:function(r){var t,n="";for(t=0;t<r.parts.length;t++)n+=r.parts[t]instanceof Array?a(r.parts[t][0])+"-"+a(r.parts[t][1]):a(r.parts[t]);return"["+(r.inverted?"^":"")+n+"]"},any:function(r){return"any character"},end:function(r){return"end of input"},other:function(r){return r.description}};function e(r){return r.charCodeAt(0).toString(16).toUpperCase()}function u(r){return r.replace(/\\/g,"\\\\").replace(/"/g,"\\\"").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(r){return"\\x0"+e(r)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(r){return"\\x"+e(r)})}function a(r){return r.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(r){return"\\x0"+e(r)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(r){return"\\x"+e(r)})}return"Expected "+function(r){var t,e,u,a=new Array(r.length);for(t=0;t<r.length;t++)a[t]=(u=r[t],n[u.type](u));if(a.sort(),a.length>0){for(t=1,e=1;t<a.length;t++)a[t-1]!==a[t]&&(a[e]=a[t],e++);a.length=e}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1];}}(r)+" but "+function(r){return r?"\""+u(r)+"\"":"end of input"}(t)+" found."},_i={SyntaxError:ub,parse:kn};class ne{}var a=C(_i);var a=C(_i);ne.parsePipe=r=>$qJIb$$interop$default.d.parse(r),ne.parseScalar=r=>$qJIb$$interop$default.d.parse(r,{startRule:"scalar"});class ln{constructor(){this.compilePipe=r=>ne.parsePipe(r),this.compileScalar=r=>ne.parseScalar(r)}compile(r,e){switch(e){default:return this.compilePipe(r);case"scalar":return this.compileScalar(r);}}}var Yb={};var ta={};const pg=Symbol("Comlink.proxy"),aj=Symbol("Comlink.endpoint"),qg=Symbol("Comlink.releaseProxy"),rg=new WeakSet,sg=new Map([["proxy",{canHandle:e=>e&&e[pg],serialize(e){const{port1:r,port2:t}=new MessageChannel;return tg(e,r),[t,[t]]},deserialize:e=>(e.start(),ug(e))}],["throw",{canHandle:e=>rg.has(e),serialize(e){const r=e instanceof Error;let t=e;return r&&(t={isError:r,message:e.message,stack:e.stack}),[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error,e);throw e}}]]);function tg(e,r=self){r.addEventListener("message",function t($){if(!$||!$.data)return;const{id:a,type:n,path:o}=Object.assign({path:[]},$.data),s=($.data.argumentList||[]).map(vb);let p;try{const r=o.slice(0,-1).reduce((e,r)=>e[r],e),t=o.reduce((e,r)=>e[r],e);switch(n){case 0:p=t;break;case 1:r[o.slice(-1)[0]]=vb($.data.value),p=!0;break;case 2:p=t.apply(r,s);break;case 3:p=fj(new t(...s));break;case 4:{const{port1:r,port2:t}=new MessageChannel;tg(e,t),p=ej(r,[r])}break;case 5:p=void 0;}}catch(i){p=i,rg.add(i)}Promise.resolve(p).catch(e=>(rg.add(e),e)).then(e=>{const[$,o]=wg(e);r.postMessage(Object.assign(Object.assign({},$),{id:a}),o),5===n&&(r.removeEventListener("message",t),bj(r))})}),r.start&&r.start()}function mn(e){return"MessagePort"===e.constructor.name}function bj(e){mn(e)&&e.close()}function ug(e,r){return vg(e,[],r)}function oe(e){if(e)throw new Error("Proxy has been released and is not useable")}function vg(e,r=[],t=function(){}){let $=!1;const a=new Proxy(t,{get(t,n){if(oe($),n===qg)return()=>Zb(e,{type:5,path:r.map(e=>e.toString())}).then(()=>{bj(e),$=!0});if("then"===n){if(0===r.length)return{then:()=>a};const t=Zb(e,{type:0,path:r.map(e=>e.toString())}).then(vb);return t.then.bind(t)}return vg(e,[...r,n])},set(t,a,n){oe($);const[o,s]=wg(n);return Zb(e,{type:1,path:[...r,a].map(e=>e.toString()),value:o},s).then(vb)},apply(t,a,n){oe($);const o=r[r.length-1];if(o===aj)return Zb(e,{type:4}).then(vb);if("bind"===o)return vg(e,r.slice(0,-1));const[s,p]=cj(n);return Zb(e,{type:2,path:r.map(e=>e.toString()),argumentList:s},p).then(vb)},construct(t,a){oe($);const[n,o]=cj(a);return Zb(e,{type:3,path:r.map(e=>e.toString()),argumentList:n},o).then(vb)}});return a}function nn(e){return Array.prototype.concat.apply([],e)}function cj(e){const r=e.map(wg);return[r.map(e=>e[0]),nn(r.map(e=>e[1]))]}const dj=new WeakMap;function ej(e,r){return dj.set(e,r),e}function fj(e){return Object.assign(e,{[pg]:!0})}function on(e,r=self,t="*"){return{postMessage:(r,$)=>e.postMessage(r,t,$),addEventListener:r.addEventListener.bind(r),removeEventListener:r.removeEventListener.bind(r)}}function wg(e){for(const[r,t]of sg)if(t.canHandle(e)){const[$,a]=t.serialize(e);return[{type:3,name:r,value:$},a]}return[{type:0,value:e},dj.get(e)||[]]}function vb(e){switch(e.type){case 3:return sg.get(e.name).deserialize(e.value);case 0:return e.value;}}function Zb(e,r,t){return new Promise($=>{const a=pn();e.addEventListener("message",function r(t){t.data&&t.data.id&&t.data.id===a&&(e.removeEventListener("message",r),$(t.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:a},r),t)})}function pn(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}ta.wrap=ug,ta.windowEndpoint=on,ta.transferHandlers=sg,ta.transfer=ej,ta.releaseProxy=qg,ta.proxyMarker=pg,ta.proxy=fj,ta.expose=tg,ta.createEndpoint=aj;var xg={};function yg(e,r,s){if(!e)throw{message:s(),scope:r}}var qn={},gj=Object.getOwnPropertySymbols,rn=Object.prototype.hasOwnProperty,sn=Object.prototype.propertyIsEnumerable;function tn(r){if(null==r)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}function un(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de","5"===Object.getOwnPropertyNames(r)[0])return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(r){return e[r]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(r){n[r]=r}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(o){return!1}}qn=un()?Object.assign:function(r,e){for(var t,n,o=tn(r),a=1;a<arguments.length;a++){for(var $ in t=Object(arguments[a]))rn.call(t,$)&&(o[$]=t[$]);if(gj){n=gj(t);for(var s=0;s<n.length;s++)sn.call(t,n[s])&&(o[n[s]]=t[n[s]])}}return o};var vn={};vn=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8};var hj={};hj="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};var $b,_b,pe={},e=pe={};function zg(){throw new Error("setTimeout has not been defined")}function Ag(){throw new Error("clearTimeout has not been defined")}function ij($){if($b===setTimeout)return setTimeout($,0);if(($b===zg||!$b)&&setTimeout)return $b=setTimeout,setTimeout($,0);try{return $b($,0)}catch(e){try{return $b.call(null,$,0)}catch(e){return $b.call(this,$,0)}}}function wn($){if(_b===clearTimeout)return clearTimeout($);if((_b===Ag||!_b)&&clearTimeout)return _b=clearTimeout,clearTimeout($);try{return _b($)}catch(e){try{return _b.call(null,$)}catch(e){return _b.call(this,$)}}}!function(){try{$b="function"==typeof setTimeout?setTimeout:zg}catch($){$b=zg}try{_b="function"==typeof clearTimeout?clearTimeout:Ag}catch($){_b=Ag}}();var Yc,wb=[],Bg=!1,jj=-1;function xn(){Bg&&Yc&&(Bg=!1,Yc.length?wb=Yc.concat(wb):jj=-1,wb.length&&kj())}function kj(){if(!Bg){var $=ij(xn);Bg=!0;for(var e=wb.length;e;){for(Yc=wb,wb=[];++jj<e;)Yc&&Yc[jj].run();jj=-1,e=wb.length}Yc=null,Bg=!1,wn($)}}function lj($,e){this.fun=$,this.array=e}function Oa(){}e.nextTick=function($){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];wb.push(new lj($,e)),1!==wb.length||Bg||ij(kj)},lj.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.env={},e.argv=[],e.version="",e.versions={},e.on=Oa,e.addListener=Oa,e.once=Oa,e.off=Oa,e.removeListener=Oa,e.removeAllListeners=Oa,e.emit=Oa,e.prependListener=Oa,e.prependOnceListener=Oa,e.listeners=function($){return[]},e.binding=function($){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function($){throw new Error("process.chdir is not supported")},e.umask=function(){return 0};var t={},yn=/%[sdj%]/g,Cg=function(r){if(!te(r)){for(var $=[],e=0;e<arguments.length;e++)$.push(eb(arguments[e]));return $.join(" ")}e=1;for(var t=arguments,n=t.length,i=String(r).replace(yn,function(r){if("%%"===r)return"%";if(e>=n)return r;switch(r){case"%s":return String(t[e++]);case"%d":return Number(t[e++]);case"%j":try{return JSON.stringify(t[e++])}catch($){return"[Circular]"}default:return r;}}),o=t[e];e<n;o=t[++e])se(o)||!ac(o)?i+=" "+o:i+=" "+eb(o);return i};t.format=Cg;var mj=function(r,$){if(Pa(Uc.process))return function(){return mj(r,$).apply(this,arguments)};if(!0===pe.noDeprecation)return r;var e=!1;return function(){if(!e){if(pe.throwDeprecation)throw new Error($);pe.traceDeprecation?console.trace($):console.error($),e=!0}return r.apply(this,arguments)}};t.deprecate=mj;var nj,qe={},zn=function(r){if(Pa(nj)&&(nj=""),r=r.toUpperCase(),!qe[r])if(new RegExp("\\b"+r+"\\b","i").test(nj)){var $=pe.pid;qe[r]=function(){var e=Cg.apply(t,arguments);console.error("%s %d: %s",r,$,e)}}else qe[r]=function(){};return qe[r]};function eb(r,$){var e={seen:[],stylize:Bn};return arguments.length>=3&&(e.depth=arguments[2]),arguments.length>=4&&(e.colors=arguments[3]),Gg($)?e.showHidden=$:$&&rj(e,$),Pa(e.showHidden)&&(e.showHidden=!1),Pa(e.depth)&&(e.depth=2),Pa(e.colors)&&(e.colors=!1),Pa(e.customInspect)&&(e.customInspect=!0),e.colors&&(e.stylize=An),re(e,r,e.depth)}t.debuglog=zn;var Dg=eb;function An(r,$){var e=eb.styles[$];return e?"\x1B["+eb.colors[e][0]+"m"+r+"\x1B["+eb.colors[e][1]+"m":r}function Bn(r,$){return r}function Cn(r){var $={};return r.forEach(function(r,e){$[r]=!0}),$}function re(r,$,e){if(r.customInspect&&$&&we($.inspect)&&$.inspect!==Dg&&(!$.constructor||$.constructor.prototype!==$)){var t=$.inspect(e,r);return te(t)||(t=re(r,t,e)),t}var n=Dn(r,$);if(n)return n;var i=Object.keys($),o=Cn(i);if(r.showHidden&&(i=Object.getOwnPropertyNames($)),ve($)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return Eg($);if(0===i.length){if(we($)){var a=$.name?": "+$.name:"";return r.stylize("[Function"+a+"]","special")}if(ue($))return r.stylize(RegExp.prototype.toString.call($),"regexp");if(Ig($))return r.stylize(Date.prototype.toString.call($),"date");if(ve($))return Eg($)}var s,z="",p=!1,D=["{","}"];(oj($)&&(p=!0,D=["[","]"]),we($))&&(z=" [Function"+($.name?": "+$.name:"")+"]");return ue($)&&(z=" "+RegExp.prototype.toString.call($)),Ig($)&&(z=" "+Date.prototype.toUTCString.call($)),ve($)&&(z=" "+Eg($)),0!==i.length||p&&0!=$.length?e<0?ue($)?r.stylize(RegExp.prototype.toString.call($),"regexp"):r.stylize("[Object]","special"):(r.seen.push($),s=p?En(r,$,e,o,i):i.map(function(t){return Fg(r,$,e,o,t,p)}),r.seen.pop(),Fn(s,z,D)):D[0]+z+D[1]}function Dn(r,$){if(Pa($))return r.stylize("undefined","undefined");if(te($)){var e="'"+JSON.stringify($).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,"\"")+"'";return r.stylize(e,"string")}return pj($)?r.stylize(""+$,"number"):Gg($)?r.stylize(""+$,"boolean"):se($)?r.stylize("null","null"):void 0}function Eg(r){return"["+Error.prototype.toString.call(r)+"]"}function En(r,$,e,t,n){for(var i=[],o=0,a=$.length;o<a;++o)sj($,String(o))?i.push(Fg(r,$,e,t,String(o),!0)):i.push("");return n.forEach(function(n){n.match(/^\d+$/)||i.push(Fg(r,$,e,t,n,!0))}),i}function Fg(r,$,e,t,n,i){var o,a,s;if((s=Object.getOwnPropertyDescriptor($,n)||{value:$[n]}).get?a=s.set?r.stylize("[Getter/Setter]","special"):r.stylize("[Getter]","special"):s.set&&(a=r.stylize("[Setter]","special")),sj(t,n)||(o="["+n+"]"),a||(r.seen.indexOf(s.value)<0?(a=se(e)?re(r,s.value,null):re(r,s.value,e-1)).indexOf("\n")>-1&&(a=i?a.split("\n").map(function(r){return"  "+r}).join("\n").substr(2):"\n"+a.split("\n").map(function(r){return"   "+r}).join("\n")):a=r.stylize("[Circular]","special")),Pa(o)){if(i&&n.match(/^\d+$/))return a;(o=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=r.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,"\"").replace(/(^"|"$)/g,"'"),o=r.stylize(o,"string"))}return o+": "+a}function Fn(r,$,e){return r.reduce(function(r,$){return 0,$.indexOf("\n")>=0&&0,r+$.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?e[0]+(""===$?"":$+"\n ")+" "+r.join(",\n  ")+" "+e[1]:e[0]+$+" "+r.join(", ")+" "+e[1]}function oj(r){return Array.isArray(r)}t.inspect=Dg,eb.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},eb.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var Gn=oj;function Gg(r){return"boolean"==typeof r}t.isArray=Gn;var Hn=Gg;function se(r){return null===r}t.isBoolean=Hn;var In=se;function Jn(r){return null==r}t.isNull=In;var Kn=Jn;function pj(r){return"number"==typeof r}t.isNullOrUndefined=Kn;var Ln=pj;function te(r){return"string"==typeof r}t.isNumber=Ln;var Mn=te;function Nn(r){return"symbol"==typeof r}t.isString=Mn;var On=Nn;function Pa(r){return void 0===r}t.isSymbol=On;var Pn=Pa;function ue(r){return ac(r)&&"[object RegExp]"===Mg(r)}t.isUndefined=Pn;var Hg=ue;function ac(r){return"object"==typeof r&&null!==r}t.isRegExp=Hg;var Qn=ac;function Ig(r){return ac(r)&&"[object Date]"===Mg(r)}t.isObject=Qn;var Jg=Ig;function ve(r){return ac(r)&&("[object Error]"===Mg(r)||r instanceof Error)}t.isDate=Jg;var qj=ve;function we(r){return"function"==typeof r}t.isError=qj;var Kg=we;function Rn(r){return null===r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||"symbol"==typeof r||void 0===r}t.isFunction=Kg;var Lg=Rn;t.isPrimitive=Lg;function Mg(r){return Object.prototype.toString.call(r)}function Ng(r){return r<10?"0"+r.toString(10):r.toString(10)}t.isBuffer=vn;var Sn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Tn(){var r=new Date,$=[Ng(r.getHours()),Ng(r.getMinutes()),Ng(r.getSeconds())].join(":");return[r.getDate(),Sn[r.getMonth()],$].join(" ")}var Un=function(){console.log("%s - %s",Tn(),Cg.apply(t,arguments))};t.log=Un;t.inherits=hj;var rj=function(r,$){if(!$||!ac($))return r;for(var e=Object.keys($),t=e.length;t--;)r[e[t]]=$[e[t]];return r};function sj(r,$){return Object.prototype.hasOwnProperty.call(r,$)}t._extend=rj;var H={};function tj(r,$){if(r===$)return 0;for(var t=r.length,e=$.length,a=0,i=Math.min(t,e);a<i;++a)if(r[a]!==$[a]){t=r[a],e=$[a];break}return t<e?-1:e<t?1:0}function Zc(r){return Uc.Buffer&&"function"==typeof Uc.Buffer.isBuffer?Uc.Buffer.isBuffer(r):!(null==r||!r._isBuffer)}var Vn=Object.prototype.hasOwnProperty,uj=Array.prototype.slice,vj="foo"===function(){}.name;function wj(r){return Object.prototype.toString.call(r)}function xj(r){return!Zc(r)&&"function"==typeof Uc.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(r):!!r&&(r instanceof DataView||!!(r.buffer&&r.buffer instanceof ArrayBuffer)))}var h=H=Bj,Wn=/\s*function\s+([^\(\s]*)\s*/;function yj(r){if(Kg(r)){if(vj)return r.name;var $=r.toString().match(Wn);return $&&$[1]}}function zj(r,$){return"string"==typeof r?r.length<$?r:r.slice(0,$):r}function Aj(r){if(vj||!Kg(r))return Dg(r);var $=yj(r);return"[Function"+($?": "+$:"")+"]"}function Xn(r){return zj(Aj(r.actual),128)+" "+r.operator+" "+zj(Aj(r.expected),128)}function X(r,$,t,e,a){throw new h.AssertionError({message:t,actual:r,expected:$,operator:e,stackStartFunction:a})}function Bj(r,$){r||X(r,!0,$,"==",h.ok)}function bc(r,$,t,e){if(r===$)return!0;if(Zc(r)&&Zc($))return 0===tj(r,$);if(Jg(r)&&Jg($))return r.getTime()===$.getTime();if(Hg(r)&&Hg($))return r.source===$.source&&r.global===$.global&&r.multiline===$.multiline&&r.lastIndex===$.lastIndex&&r.ignoreCase===$.ignoreCase;if(null!==r&&"object"==typeof r||null!==$&&"object"==typeof $){if(xj(r)&&xj($)&&wj(r)===wj($)&&!(r instanceof Float32Array||r instanceof Float64Array))return 0===tj(new Uint8Array(r.buffer),new Uint8Array($.buffer));if(Zc(r)!==Zc($))return!1;var a=(e=e||{actual:[],expected:[]}).actual.indexOf(r);return-1!==a&&a===e.expected.indexOf($)||(e.actual.push(r),e.expected.push($),Yn(r,$,t,e))}return t?r===$:r==$}function Cj(r){return"[object Arguments]"==Object.prototype.toString.call(r)}function Yn(r,$,t,e){if(null==r||null==$)return!1;if(Lg(r)||Lg($))return r===$;if(t&&Object.getPrototypeOf(r)!==Object.getPrototypeOf($))return!1;var a=Cj(r),i=Cj($);if(a&&!i||!a&&i)return!1;if(a)return bc(r=uj.call(r),$=uj.call($),t);var n,s,u=Hj(r),o=Hj($);if(u.length!==o.length)return!1;for(u.sort(),o.sort(),s=u.length-1;s>=0;s--)if(u[s]!==o[s])return!1;for(s=u.length-1;s>=0;s--)if(!bc(r[n=u[s]],$[n],t,e))return!1;return!0}function Dj(r,$,t){bc(r,$,!0)&&X(r,$,t,"notDeepStrictEqual",Dj)}function Ej(r,$){if(!r||!$)return!1;if("[object RegExp]"==Object.prototype.toString.call($))return $.test(r);try{if(r instanceof $)return!0}catch(t){}return!Error.isPrototypeOf($)&&!0===$.call({},r)}function Zn(r){var $;try{r()}catch(t){$=t}return $}function Fj(r,$,t,e){var a;if("function"!=typeof $)throw new TypeError("\"block\" argument must be a function");"string"==typeof t&&(e=t,t=null),a=Zn($),e=(t&&t.name?" ("+t.name+").":".")+(e?" "+e:"."),r&&!a&&X(a,t,"Missing expected exception"+e);var i="string"==typeof e,n=!r&&a&&!t;if((!r&&qj(a)&&i&&Ej(a,t)||n)&&X(a,t,"Got unwanted exception"+e),r&&a&&t&&!Ej(a,t)||!r&&a)throw a}function Gj(r,$){r||X(r,!0,$,"==",Gj)}h.AssertionError=function(r){this.name="AssertionError",this.actual=r.actual,this.expected=r.expected,this.operator=r.operator,r.message?(this.message=r.message,this.generatedMessage=!1):(this.message=Xn(this),this.generatedMessage=!0);var $=r.stackStartFunction||X;if(Error.captureStackTrace)Error.captureStackTrace(this,$);else{var t=new Error;if(t.stack){var e=t.stack,a=yj($),i=e.indexOf("\n"+a);if(i>=0){var n=e.indexOf("\n",i+1);e=e.substring(n+1)}this.stack=e}}},hj(h.AssertionError,Error),h.fail=X,h.ok=Bj,h.equal=function(r,$,t){r!=$&&X(r,$,t,"==",h.equal)},h.notEqual=function(r,$,t){r==$&&X(r,$,t,"!=",h.notEqual)},h.deepEqual=function(r,$,t){bc(r,$,!1)||X(r,$,t,"deepEqual",h.deepEqual)},h.deepStrictEqual=function(r,$,t){bc(r,$,!0)||X(r,$,t,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function(r,$,t){bc(r,$,!1)&&X(r,$,t,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=Dj,h.strictEqual=function(r,$,t){r!==$&&X(r,$,t,"===",h.strictEqual)},h.notStrictEqual=function(r,$,t){r===$&&X(r,$,t,"!==",h.notStrictEqual)},h.throws=function(r,$,t){Fj(!0,r,$,t)},h.doesNotThrow=function(r,$,t){Fj(!1,r,$,t)},h.ifError=function(r){if(r)throw r},h.strict=qn(Gj,h,{equal:h.strictEqual,deepEqual:h.deepStrictEqual,notEqual:h.notStrictEqual,notDeepEqual:h.notDeepStrictEqual}),h.strict.strict=h.strict;var Hj=Object.keys||function(r){var $=[];for(var t in r)Vn.call(r,t)&&$.push(t);return $};var Og={};const Pg=Math.pow(2,32)-1;Og.inf=Pg;class xe{constructor(t){var $VCAb$$interop$default=C(H);this.fns=t,this.sample=function*(t,s,e){const{fns:n,d:r}=this,[i,...o]=n;if(0==n.length)return[];for(const a of i.sample(t,s,e))this.x.set(a),o.length?$YDUe$export$CompositeFn.apply(o,this.x,this.y):this.y.set(a),yield this.y.subarray(0,r)},this.fn=(t,s=new Float32Array(this.d))=>{const{fns:e,domain:n,d:r}=this;var $VCAb$$interop$default=C(H);return $VCAb$$interop$default.d.equal(t.length,n),$VCAb$$interop$default.d.equal(s.length,r),this.x.set(t),$YDUe$export$CompositeFn.apply(e,this.x,this.y),s.set(this.y.subarray(0,r)),s},$VCAb$$interop$default.d(t.length,"fns cannot be empty");const s=Math.max(this.domainMax,this.dMax);this.x=new Float32Array(s),this.y=new Float32Array(s)}get first(){return this.fns[0]}get last(){return this.fns[this.fns.length-1]}get domain(){return this.first.domain}get d(){return this.last.d}get domainMax(){return this.fns.reduce((t,s)=>Math.max(s.domain,t),0)}get dMax(){return this.fns.reduce((t,s)=>Math.max(s.d,t),0)}}xe.apply=(t,s,e)=>{var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d.equal(s.length,e.length);for(const n of t){n.fn(s.subarray(0,n.domain),e.subarray(0,n.d));for(let t=0;t<e.length;t++)isFinite(e[t])||(e[t]=Math.sign(e[t])*Pg),isNaN(e[t])&&(e[t]=0);s.set(e)}},xe.Builder=class{constructor(){this.fns=[],this.add=t=>{const{fns:s,last:e}=this;if(e&&t.domain!==e.d)throw new Error(`Cannot add ${t} to composite, because its domain is not ${e.d}`);return s.push(t),this},this.build=()=>new xe(this.fns)}get d(){return this.last.d}get last(){return this.fns[this.fns.length-1]}};class Qg{constructor(t,e,r){var $VCAb$$interop$default=C(H);this.d=t,this.a=e,this.b=r,this.fn=(t,e=new Float32Array(this.d))=>{const{domain:r,d:a,a:o,b:s}=this;var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d.equal(t.length,r),$VCAb$$interop$default.d.equal(e.length,a);for(let $=0;$<a;$++)e[$]=o[$]+t[$]*(s[$]-o[$]);return e},this.sample=function*(t,e,r){const{d:a,fn:o}=this,s=Math.round(Math.pow(t,1/a)),$=new Float32Array(a);for(let u=e;u<r;u++){for(let t=0;t<a;t++){const e=a-t-1,r=Math.round(u/Math.pow(s,e));$[t]=r%s/(s-1)}yield o($)}},$VCAb$$interop$default.d.equal(e.length,t),$VCAb$$interop$default.d.equal(r.length,t),this.domain=t}}Qg.nPerLevel=(t,e)=>Math.round(Math.pow(e,1/t));class xb{constructor(t,e){this.d=t,this.l=e,this.fn=(t,e)=>this.interval.fn(t,e),this.interval=new Qg(t,new Array(t).fill(-e/2),new Array(t).fill(e/2)),this.sample=this.interval.sample}get domain(){return this.d}}class $n{constructor(t,e){this.d=t,this.l=e,this.fn=(t,e=new Float32Array(this.d))=>{const{domain:r,d:s,l:a}=this;var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d.equal(t.length,r),$VCAb$$interop$default.d.equal(e.length,s);for(let o=0;o<s;o++)e[o]=a*(t[o]-.5);return e},this.sample=function*(t,e,r){const{d:s}=this,a=1/s/2,o=Math.round(t*a),n=Math.round(e*a),i=Math.round((r-e)*a);let l=0;for(let $=0;$<s;$++)for(const e of[1,-1]){const r=n+Math.min(i,t-l);yield*this.sampleFace($,e,o,n,r),l+=r-n}},this.sampleFace=function*(t,e,r,s,a){const{d:o,l:n}=this,i=new xb(o-1,n),l=n/2;for(const $ of i.sample(r,s,a)){const r=new Float32Array(o);r.set($.subarray(0,t)),r.set($.subarray(t),t+1),r[t]=e*l,yield r}}}get domain(){return this.d}}class Ij{static from(r,t,e=new Float32Array(t.length+1)){var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d.equal(e.length,t.length+1),e[0]=r;for(let $=1;$<e.length;$++){const r=Math.sin(t[$-1]),a=Math.cos(t[$-1]);e[$]=e[0]*r,e[0]*=a}return e}}class ye{constructor(t,r){this.d=t,this.r=r,this.sample=function*(t,r,e){const $=new xb(this.domain,2*Math.PI);for(const s of $.sample(t,r,e))yield this.fn(s)},this.fn=(t,r=new Float32Array(this.d))=>{const{d:e,r:$}=this;var $VCAb$$interop$default=C(H);return $VCAb$$interop$default.d.equal(t.length,e-1),$VCAb$$interop$default.d.equal(r.length,e),Ij.from($,t,r)}}get domain(){return this.d-1}}class _n{constructor(e,t,r){this.d=e,this.r=t,this.t=r,this.sample=function*(e,t,r){const s=new xb(this.domain,2*Math.PI);for(const $ of s.sample(e,t,r))yield this.fn($)},this.fn=(e,t=new Float32Array(this.d))=>{const{domain:r,d:s,sphere:$,circle:i}=this;var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d.equal(e.length,r),$VCAb$$interop$default.d.equal(t.length,s),$.fn(e,t);const a=i.fn(e.subarray(s-2));return t[0]+=a[0],t[s-1]+=a[1],t},this.sphere=new ye(e,r),this.circle=new ye(2,t)}get domain(){return this.d-1}}class Jj{constructor(t,s,e,r,i=Math.cos,a=Math.sin){this.d=t,this.theta=s,this.d0=e,this.d1=r,this.f0=i,this.f1=a,this.sample=function*(t,s,e){const r=new xb(this.domain,2);for(const i of r.sample(t,s,e))yield this.fn(i)},this.fn=(t,s=new Float32Array(this.d))=>{const{d:e,d0:r,d1:i,r0:a,r1:$}=this;var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d.equal(t.length,e),$VCAb$$interop$default.d.equal(s.length,e),s.set(t);const h=t[r],o=t[i];return s[r]=h*a-o*$,s[i]=h*$+o*a,s},this.r0=i(s),this.r1=a(s)}get domain(){return this.d}}class ao{constructor(t,e,i){var $VCAb$$interop$default=C(H);this.d=t,this.theta=e,this.a=i,this.sample=function*(t,e,i){const r=new Qg(this.domain,new Array(this.domain).fill(0),new Array(this.domain).fill(1));for(const a of r.sample(t,e,i))yield this.fn(a)},this.fn=(t,e=new Float32Array(this.d))=>{const{domain:i,d:r,theta:a,a:s}=this;var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d.equal(t.length,i),$VCAb$$interop$default.d.equal(e.length,r);const $=t.map(t=>t*a);Ij.from(1,$,e),e[0]*=s[0]*$[0];for(let o=1;o<r;o++)e[o]*=s[o]*$[o-1];return e},$VCAb$$interop$default.d.equal(i.length,t,`spiral: Expected a to be of dimension ${t}, but was ${i.length}`)}get domain(){return this.d-1}}class Rg{constructor(t,e){this.from=t,this.to=e,this.sample=function*(t,e,r){const a=new xb(this.domain,2);for(const o of a.sample(t,e,r))yield this.fn(o)},this.fn=(t,e=new Float32Array(this.to))=>{let{from:r,to:a,fromTemp:o,toTemp:$}=this;var $VCAb$$interop$default=C(H);if($VCAb$$interop$default.d.equal(t.length,r),$VCAb$$interop$default.d.equal(e.length,a),r===a)return e.set(t),e;for(o.set(t);r<a;)$LUcK$export$default.up(o.subarray(0,r),$.subarray(0,++r)),o.set($);for(;r>a;)$LUcK$export$default.down(o.subarray(0,r),$.subarray(0,--r)),o.set($);return e.set($.subarray(0,a)),e},this.fromTemp=new Float32Array(Math.max(t,e)),this.toTemp=new Float32Array(Math.max(t,e))}get domain(){return this.from}get d(){return this.to}}Rg.up=(t,e)=>{var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d.equal(e.length,t.length+1);const r=bo(t),a=r+1;e[0]=(r-1)/a;for(let o=1;o<=t.length;o++)e[o]=2*t[o-1]/a},Rg.down=(t,e)=>{var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d.equal(e.length,t.length-1);for(let r=0;r<e.length;r++)e[r]=t[r+1]/(1-t[0])};const bo=t=>{let e=0;for(let r=0;r<t.length;r++)e+=t[r]*t[r];return e};class co{constructor(t,r){var $VCAb$$interop$default=C(H);this.d=t,this.r=r,this.sample=function*(t,r,e){const $=new xb(this.domain,2*Math.PI);for(const s of $.sample(t,r,e))yield this.fn(s)},this.fn=(t,r=new Float32Array(this.d))=>{const{d:e,domain:$,r:s}=this;new ye(2,s[0]).fn(t.subarray(0,1),r.subarray(0,2));for(let a=1;a<$;a++){r[0]+=s[a],new Jj(e,t[a],a-1,a+1).fn(r,r)}return r},$VCAb$$interop$default.d(t>2,`torus: expected d = ${t} > 2`),$VCAb$$interop$default.d(r.length==this.domain,`torus: expected r.length = ${r.length} == ${this.domain}`)}get domain(){return this.d-1}}class Kj{constructor(e){this.scope=e,this.resolvePipe=e=>{const[r,...s]=e.steps,t=this.resolve(e.n,"number");this.expect(t>0,"n","be positive",`was ${t}`);const a=new xe.Builder().add(this.resolveStep(e.d0,r));for(let i=0;i<s.length;i++){const e=s[i],r=a.d,t=go[e.type](r);a.add(this.resolveStep(t,e))}return{n:t,fn:a.build()}},this.resolveStep=(e,{type:r,args:s})=>fo[r](e,...s.map(e=>this.resolve(e))),this.resolveFn=({name:e,args:r})=>{const s=Math[e],t=typeof s;return this.expect("function"===t,e,"resolve to a function",`was ${t}`),s(...r.map(e=>this.resolve(e)))},this.resolveAccess=({id:e,index:r})=>{const s=this.scope[e];return this.assert(s,()=>`failed to resolve access target ${e}`),"id"===r.kind&&r.id in s?s[r.id]:s[this.resolve(r)]},this.resolveId=e=>{let r;if(e in this.scope)r=this.scope[e];else if(e in Math)r=Math[e];else{const s=e.toUpperCase();s in Math&&(r=Math[s])}return this.assert(r,()=>`failed to resolve id ${e}`),r},this.resolveArith=({op:e,operands:r})=>{const[s,t]=r.map(e=>this.resolve(e,"number"));return eo[e](s,t)},this.isNodeDynamic=e=>{switch(e.kind){case"fn":return e.args.some(this.isNodeDynamic);case"id":return"number"==typeof this.resolve(e);case"arith":return e.operands.some(this.isNodeDynamic);default:return!1;}}}resolve(e,r){let s;switch(e.kind){case"pipe":s=this.resolvePipe(e);break;case"arith":s=this.resolveArith(e);break;case"number":s=e.value;break;case"fn":s=this.resolveFn(e);break;case"access":s=this.resolveAccess(e);break;case"id":s=this.resolveId(e.id);break;case"paren":s=this.resolve(e.scalar);}if(r){const t=typeof s;this.expect(t===r,e,`be a ${r}`,`was ${t}`)}return"number"===r&&this.expect(!isNaN(s),e,"be a number","was NaN"),s}assert(e,r){yg(e,this.scope,r)}expect(e,r,s,t){this.assert(e,()=>`Expected ${$i(r,0)} to ${s}, but ${t}`)}}xg.Resolver=Kj;const eo={"+":(e,r)=>e+r,"-":(e,r)=>null==r?-e:e-r,"*":(e,r)=>e*r,"/":(e,r)=>e/r,"**":(e,r)=>Math.pow(e,r),"^":(e,r)=>Math.pow(e,r)},fo={cube:(e,r)=>new $n(e,r),lattice:(e,r)=>new xb(e,r),sphere:(e,r)=>new ye(e,r),spiral:(e,r,...s)=>new ao(e,r,s),torus:(e,...r)=>new co(e,new Float32Array(r)),fucked_up_torus:(e,r,s)=>new _n(e,r,s),rotate:(e,r,s,t,a=Math.cos,i=Math.sin)=>(yg(0<=s&&s<e,null,()=>`rotate: Expected 0 <= d0 = ${s} < d = ${e}`),yg(0<=t&&t<e,null,()=>`rotate: Expected 0 <= d1 = ${t} < d = ${e}`),new Jj(e,r,s,t,a,i)),stereo:(e,r)=>new Rg(e,r)},go={cube:e=>e,lattice:e=>e,sphere:e=>e+1,spiral:e=>e+1,torus:e=>e+1,fucked_up_torus:e=>e+1,rotate:e=>e,r:e=>e,stereo:e=>e};var Sg=Yb&&Yb.__awaiter||function(o,e,r,$){return new(r||(r=Promise))(function(t,n){function i(o){try{s($.next(o))}catch(e){n(e)}}function a(o){try{s($.throw(o))}catch(e){n(e)}}function s(o){var e;o.done?t(o.value):(e=o.value,e instanceof r?e:new r(function(o){o(e)})).then(i,a)}s(($=$.apply(o,e||[])).next())})};const ze=navigator.hardwareConcurrency||2;Yb.poolSize=ze;const Ae=new Array(ze),Lj=()=>Sg(void 0,void 0,void 0,function*(){for(let o=0;o<Ae.length;o++)Ae[o]=ug(new Worker("worker.584785f3.js"))});Yb.startPool=Lj;const ho=()=>Sg(void 0,void 0,void 0,function*(){Ae.forEach(o=>o[qg]())});Yb.stopPool=ho;const Mj=o=>Sg(void 0,void 0,void 0,function*(){const e=new Kj(o.scope).resolve(o.pipe.n,"number"),r=e<2e3?1:ze,$=Math.round(e/r),t=[];for(let s=0;s<r;s++){const r=s*$,n={offset:r,size:Math.min($,e-r)},i=Ae[s].iterate(o,n).then(({d:o,position:e,color:$})=>({d:o,position:e,color:$,offset:r}));t.push(i)}const n=yield Promise.all(t),[{d:i}]=n,a={d:i,position:new Float32Array(i*e),color:new Float32Array(3*e)};return n.forEach(({d:o,position:e,color:r,offset:$})=>{a.position.set(e,o*$),a.color.set(r,3*$)}),a});Yb.runPipeline=Mj;var yb={};void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t});var io="111",jo=0,Nj=1,ko=2,Oj=1,lo=2,$c=3,_c=0,ga=1,Be=2,Pj=1,Qj=0,mo=1,cc=2,ad=0,bd=1,Rj=2,Sj=3,Tj=4,no=5,dc=100,oo=101,po=102,qo=200,ro=201,so=202,to=203,Uj=204,Vj=205,uo=206,vo=207,wo=208,xo=209,yo=210,zo=0,Ao=1,Bo=2,Tg=3,Co=4,Do=5,Eo=6,Fo=7,Ce=0,Go=1,Ho=2,De=0,Wj=1,Io=2,Jo=3,Ko=4,Lo=5,Ug=300,Vg=301,Wg=302,Xj=303,Xg=304,Yj=305,Yg=306,Zg=307,Ee=1e3,Y=1001,Fe=1002,Q=1003,$g=1004,_g=1005,N=1006,Zj=1007,Ge=1008,ah=1009,Mo=1010,No=1011,He=1012,Oo=1013,$j=1014,cd=1015,bh=1016,Po=1017,Qo=1018,Ro=1019,Ie=1020,So=1021,zb=1022,Qa=1023,To=1024,Uo=1025,ec=1026,dd=1027,Vo=1028,_j=33776,ak=33777,bk=33778,ck=33779,dk=35840,ek=35841,fk=35842,gk=35843,Wo=36196,Xo=37808,Yo=37809,Zo=37810,$o=37811,_o=37812,ap=37813,bp=37814,cp=37815,dp=37816,ep=37817,fp=37818,gp=37819,hp=37820,ip=37821,jp=2200,kp=2201,lp=2202,Je=2300,Ke=2301,ch=2302,fc=2400,gc=2401,Le=2402,Me=0,mp=1,np=2,Ne=3e3,op=3001,hk=3007,pp=3002,qp=3003,rp=3004,sp=3005,tp=3006,up=3200,vp=3201,ed=0,wp=1,dh=7680,xp=519,Oe=35044,fd=35048;function Aa(){}Object.assign(Aa.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),i=0,o=r.length;i<o;i++)r[i].call(this,e)}}}});for(var K=[],gd=0;gd<256;gd++)K[gd]=(gd<16?"0":"")+gd.toString(16);var ea={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(K[255&e]+K[e>>8&255]+K[e>>16&255]+K[e>>24&255]+"-"+K[255&t]+K[t>>8&255]+"-"+K[t>>16&15|64]+K[t>>24&255]+"-"+K[63&r|128]+K[r>>8&255]+"-"+K[r>>16&255]+K[r>>24&255]+K[255&i]+K[i>>8&255]+K[i>>16&255]+K[i>>24&255]).toUpperCase()},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,i,o){return i+(e-t)*(o-i)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*ea.DEG2RAD},radToDeg:function(e){return e*ea.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function ba(e,t){this.x=e||0,this.y=t||0}function S(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==i?i:1}Object.defineProperties(ba.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(ba.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),i=Math.sin(t),o=this.x-e.x,n=this.y-e.y;return this.x=o*r-n*i+e.x,this.y=o*i+n*r+e.y,this}}),Object.assign(S,{slerp:function(e,t,r,i){return r.copy(e).slerp(t,i)},slerpFlat:function(e,t,r,i,o,n,a){var s=r[i+0],$=r[i+1],d=r[i+2],p=r[i+3],c=o[n+0],l=o[n+1],h=o[n+2],u=o[n+3];if(p!==u||s!==c||$!==l||d!==h){var f=1-a,m=s*c+$*l+d*h+p*u,v=m>=0?1:-1,x=1-m*m;if(x>Number.EPSILON){var R=Math.sqrt(x),g=Math.atan2(R,m*v);f=Math.sin(f*g)/R,a=Math.sin(a*g)/R}var q=a*v;if(s=s*f+c*q,$=$*f+l*q,d=d*f+h*q,p=p*f+u*q,f===1-a){var y=1/Math.sqrt(s*s+$*$+d*d+p*p);s*=y,$*=y,d*=y,p*=y}}e[t]=s,e[t+1]=$,e[t+2]=d,e[t+3]=p}}),Object.defineProperties(S.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(S.prototype,{isQuaternion:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,i=e._y,o=e._z,n=e.order,a=Math.cos,s=Math.sin,$=a(r/2),d=a(i/2),p=a(o/2),c=s(r/2),l=s(i/2),h=s(o/2);return"XYZ"===n?(this._x=c*d*p+$*l*h,this._y=$*l*p-c*d*h,this._z=$*d*h+c*l*p,this._w=$*d*p-c*l*h):"YXZ"===n?(this._x=c*d*p+$*l*h,this._y=$*l*p-c*d*h,this._z=$*d*h-c*l*p,this._w=$*d*p+c*l*h):"ZXY"===n?(this._x=c*d*p-$*l*h,this._y=$*l*p+c*d*h,this._z=$*d*h+c*l*p,this._w=$*d*p-c*l*h):"ZYX"===n?(this._x=c*d*p-$*l*h,this._y=$*l*p+c*d*h,this._z=$*d*h-c*l*p,this._w=$*d*p+c*l*h):"YZX"===n?(this._x=c*d*p+$*l*h,this._y=$*l*p+c*d*h,this._z=$*d*h-c*l*p,this._w=$*d*p-c*l*h):"XZY"===n&&(this._x=c*d*p-$*l*h,this._y=$*l*p-c*d*h,this._z=$*d*h+c*l*p,this._w=$*d*p+c*l*h),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],o=r[4],n=r[8],a=r[1],s=r[5],$=r[9],d=r[2],p=r[6],c=r[10],l=i+s+c;return l>0?(t=.5/Math.sqrt(l+1),this._w=.25/t,this._x=(p-$)*t,this._y=(n-d)*t,this._z=(a-o)*t):i>s&&i>c?(t=2*Math.sqrt(1+i-s-c),this._w=(p-$)/t,this._x=.25*t,this._y=(o+a)/t,this._z=(n+d)/t):s>c?(t=2*Math.sqrt(1+s-i-c),this._w=(n-d)/t,this._x=(o+a)/t,this._y=.25*t,this._z=($+p)/t):(t=2*Math.sqrt(1+c-i-s),this._w=(a-o)/t,this._x=(n+d)/t,this._y=($+p)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var r=e.dot(t)+1;return r<1e-6?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(ea.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;var i=Math.min(1,t/r);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,o=e._z,n=e._w,a=t._x,s=t._y,$=t._z,d=t._w;return this._x=r*d+n*a+i*$-o*s,this._y=i*d+n*s+o*a-r*$,this._z=o*d+n*$+r*s-i*a,this._w=n*d-r*a-i*s-o*$,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,i=this._y,o=this._z,n=this._w,a=n*e._w+r*e._x+i*e._y+o*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=n,this._x=r,this._y=i,this._z=o,this;var s=1-a*a;if(s<=Number.EPSILON){var $=1-t;return this._w=$*n+t*this._w,this._x=$*r+t*this._x,this._y=$*i+t*this._y,this._z=$*o+t*this._z,this.normalize(),this._onChangeCallback(),this}var d=Math.sqrt(s),p=Math.atan2(d,a),c=Math.sin((1-t)*p)/d,l=Math.sin(t*p)/d;return this._w=n*c+this._w*l,this._x=r*c+this._x*l,this._y=i*c+this._y*l,this._z=o*c+this._z*l,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var eh=new aa,ik=new S;function aa(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}Object.assign(aa.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ik.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(ik.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*i,this.y=o[1]*t+o[4]*r+o[7]*i,this.z=o[2]*t+o[5]*r+o[8]*i,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,o=e.elements,n=1/(o[3]*t+o[7]*r+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*i+o[12])*n,this.y=(o[1]*t+o[5]*r+o[9]*i+o[13])*n,this.z=(o[2]*t+o[6]*r+o[10]*i+o[14])*n,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,o=e.x,n=e.y,a=e.z,s=e.w,$=s*t+n*i-a*r,d=s*r+a*t-o*i,p=s*i+o*r-n*t,c=-o*t-n*r-a*i;return this.x=$*s+c*-o+d*-a-p*-n,this.y=d*s+c*-n+p*-o-$*-a,this.z=p*s+c*-a+$*-n-d*-o,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i,this.y=o[1]*t+o[5]*r+o[9]*i,this.z=o[2]*t+o[6]*r+o[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,i=e.y,o=e.z,n=t.x,a=t.y,s=t.z;return this.x=i*s-o*a,this.y=o*n-r*s,this.z=r*a-i*n,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(e){return eh.copy(this).projectOnVector(e),this.sub(eh)},reflect:function(e){return this.sub(eh.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());0===t&&console.error("THREE.Vector3: angleTo() can't handle zero length vectors.");var r=this.dot(e)/t;return Math.acos(ea.clamp(r,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var hd,Ab=new aa;function L(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(L.prototype,{isMatrix3:!0,set:function(e,t,r,i,o,n,a,s,$){var d=this.elements;return d[0]=e,d[1]=i,d[2]=a,d[3]=t,d[4]=o,d[5]=s,d[6]=r,d[7]=n,d[8]=$,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(e){for(var t=0,r=e.count;t<r;t++)Ab.x=e.getX(t),Ab.y=e.getY(t),Ab.z=e.getZ(t),Ab.applyMatrix3(this),e.setXYZ(t,Ab.x,Ab.y,Ab.z);return e},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,o=this.elements,n=r[0],a=r[3],s=r[6],$=r[1],d=r[4],p=r[7],c=r[2],l=r[5],h=r[8],u=i[0],f=i[3],m=i[6],v=i[1],x=i[4],R=i[7],g=i[2],q=i[5],y=i[8];return o[0]=n*u+a*v+s*g,o[3]=n*f+a*x+s*q,o[6]=n*m+a*R+s*y,o[1]=$*u+d*v+p*g,o[4]=$*f+d*x+p*q,o[7]=$*m+d*R+p*y,o[2]=c*u+l*v+h*g,o[5]=c*f+l*x+h*q,o[8]=c*m+l*R+h*y,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],n=e[4],a=e[5],s=e[6],$=e[7],d=e[8];return t*n*d-t*a*$-r*o*d+r*a*s+i*o*$-i*n*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,i=this.elements,o=r[0],n=r[1],a=r[2],s=r[3],$=r[4],d=r[5],p=r[6],c=r[7],l=r[8],h=l*$-d*c,u=d*p-l*s,f=c*s-$*p,m=o*h+n*u+a*f;if(0===m){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var x=1/m;return i[0]=h*x,i[1]=(a*c-l*n)*x,i[2]=(d*n-a*$)*x,i[3]=u*x,i[4]=(l*o-a*p)*x,i[5]=(a*s-d*o)*x,i[6]=f*x,i[7]=(n*p-c*o)*x,i[8]=($*o-n*s)*x,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,i,o,n,a){var s=Math.cos(o),$=Math.sin(o);this.set(r*s,r*$,-r*(s*n+$*a)+n+e,-i*$,i*s,-i*(-$*n+s*a)+a+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=this.elements,o=i[0],n=i[3],a=i[6],s=i[1],$=i[4],d=i[7];return i[0]=t*o+r*s,i[3]=t*n+r*$,i[6]=t*a+r*d,i[1]=-r*o+t*s,i[4]=-r*n+t*$,i[7]=-r*a+t*d,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var Bb={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===hd&&(hd=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),hd.width=e.width,hd.height=e.height;var r=hd.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=hd}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},yp=0;function m(e,t,r,i,o,n,a,s,$,d){Object.defineProperty(this,"id",{value:yp++}),this.uuid=ea.generateUUID(),this.name="",this.image=void 0!==e?e:m.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:m.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:Y,this.wrapT=void 0!==i?i:Y,this.magFilter=void 0!==o?o:N,this.minFilter=void 0!==n?n:Ge,this.anisotropy=void 0!==$?$:1,this.format=void 0!==a?a:Qa,this.type=void 0!==s?s:ah,this.offset=new ba(0,0),this.repeat=new ba(1,1),this.center=new ba(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new L,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==d?d:Ne,this.version=0,this.onUpdate=null}function fa(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1}function Z(e,t,r){this.width=e,this.height=t,this.scissor=new fa(0,0,e,t),this.scissorTest=!1,this.viewport=new fa(0,0,e,t),r=r||{},this.texture=new m(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:N,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function jk(e,t,r){Z.call(this,e,t,r),this.samples=4}m.DEFAULT_IMAGE=void 0,m.DEFAULT_MAPPING=Ug,m.prototype=Object.assign(Object.create(Aa.prototype),{constructor:m,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=ea.generateUUID()),!t&&void 0===e.images[i.uuid]){var o;if(Array.isArray(i)){o=[];for(var n=0,a=i.length;n<a;n++)o.push(Bb.getDataURL(i[n]))}else o=Bb.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:o}}r.image=i.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==Ug)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ee:e.x=e.x-Math.floor(e.x);break;case Y:e.x=e.x<0?0:1;break;case Fe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);}if(e.y<0||e.y>1)switch(this.wrapT){case Ee:e.y=e.y-Math.floor(e.y);break;case Y:e.y=e.y<0?0:1;break;case Fe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(m.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(fa.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(fa.prototype,{isVector4:!0,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,o=this.w,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i+n[12]*o,this.y=n[1]*t+n[5]*r+n[9]*i+n[13]*o,this.z=n[2]*t+n[6]*r+n[10]*i+n[14]*o,this.w=n[3]*t+n[7]*r+n[11]*i+n[15]*o,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,o,n=e.elements,a=n[0],s=n[4],$=n[8],d=n[1],p=n[5],c=n[9],l=n[2],h=n[6],u=n[10];if(Math.abs(s-d)<.01&&Math.abs($-l)<.01&&Math.abs(c-h)<.01){if(Math.abs(s+d)<.1&&Math.abs($+l)<.1&&Math.abs(c+h)<.1&&Math.abs(a+p+u-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var f=(a+1)/2,m=(p+1)/2,v=(u+1)/2,x=(s+d)/4,R=($+l)/4,g=(c+h)/4;return f>m&&f>v?f<.01?(r=0,i=.707106781,o=.707106781):(i=x/(r=Math.sqrt(f)),o=R/r):m>v?m<.01?(r=.707106781,i=0,o=.707106781):(r=x/(i=Math.sqrt(m)),o=g/i):v<.01?(r=.707106781,i=.707106781,o=0):(r=R/(o=Math.sqrt(v)),i=g/o),this.set(r,i,o,t),this}var q=Math.sqrt((h-c)*(h-c)+($-l)*($-l)+(d-s)*(d-s));return Math.abs(q)<.001&&(q=1),this.x=(h-c)/q,this.y=($-l)/q,this.z=(d-s)/q,this.w=Math.acos((a+p+u-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Z.prototype=Object.assign(Object.create(Aa.prototype),{constructor:Z,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),jk.prototype=Object.assign(Object.create(Z.prototype),{constructor:jk,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Z.prototype.copy.call(this,e),this.samples=e.samples,this}});var _=new aa,ua=new da,zp=new aa(0,0,0),Ap=new aa(1,1,1),fb=new aa,Pe=new aa,ha=new aa;function da(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(da.prototype,{isMatrix4:!0,set:function(e,t,r,i,o,n,a,s,$,d,p,c,l,h,u,f){var m=this.elements;return m[0]=e,m[4]=t,m[8]=r,m[12]=i,m[1]=o,m[5]=n,m[9]=a,m[13]=s,m[2]=$,m[6]=d,m[10]=p,m[14]=c,m[3]=l,m[7]=h,m[11]=u,m[15]=f,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new da().fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,r=e.elements,i=1/_.setFromMatrixColumn(e,0).length(),o=1/_.setFromMatrixColumn(e,1).length(),n=1/_.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=0,t[8]=r[8]*n,t[9]=r[9]*n,t[10]=r[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,i=e.y,o=e.z,n=Math.cos(r),a=Math.sin(r),s=Math.cos(i),$=Math.sin(i),d=Math.cos(o),p=Math.sin(o);if("XYZ"===e.order){var c=n*d,l=n*p,h=a*d,u=a*p;t[0]=s*d,t[4]=-s*p,t[8]=$,t[1]=l+h*$,t[5]=c-u*$,t[9]=-a*s,t[2]=u-c*$,t[6]=h+l*$,t[10]=n*s}else if("YXZ"===e.order){var f=s*d,m=s*p,v=$*d,x=$*p;t[0]=f+x*a,t[4]=v*a-m,t[8]=n*$,t[1]=n*p,t[5]=n*d,t[9]=-a,t[2]=m*a-v,t[6]=x+f*a,t[10]=n*s}else if("ZXY"===e.order){f=s*d,m=s*p,v=$*d,x=$*p;t[0]=f-x*a,t[4]=-n*p,t[8]=v+m*a,t[1]=m+v*a,t[5]=n*d,t[9]=x-f*a,t[2]=-n*$,t[6]=a,t[10]=n*s}else if("ZYX"===e.order){c=n*d,l=n*p,h=a*d,u=a*p;t[0]=s*d,t[4]=h*$-l,t[8]=c*$+u,t[1]=s*p,t[5]=u*$+c,t[9]=l*$-h,t[2]=-$,t[6]=a*s,t[10]=n*s}else if("YZX"===e.order){var R=n*s,g=n*$,q=a*s,y=a*$;t[0]=s*d,t[4]=y-R*p,t[8]=q*p+g,t[1]=p,t[5]=n*d,t[9]=-a*d,t[2]=-$*d,t[6]=g*p+q,t[10]=R-y*p}else if("XZY"===e.order){R=n*s,g=n*$,q=a*s,y=a*$;t[0]=s*d,t[4]=-p,t[8]=$*d,t[1]=R*p+y,t[5]=n*d,t[9]=g*p-q,t[2]=q*p-g,t[6]=a*d,t[10]=y*p+R}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(zp,e,Ap)},lookAt:function(e,t,r){var i=this.elements;return ha.subVectors(e,t),0===ha.lengthSq()&&(ha.z=1),ha.normalize(),fb.crossVectors(r,ha),0===fb.lengthSq()&&(1===Math.abs(r.z)?ha.x+=1e-4:ha.z+=1e-4,ha.normalize(),fb.crossVectors(r,ha)),fb.normalize(),Pe.crossVectors(ha,fb),i[0]=fb.x,i[4]=Pe.x,i[8]=ha.x,i[1]=fb.y,i[5]=Pe.y,i[9]=ha.y,i[2]=fb.z,i[6]=Pe.z,i[10]=ha.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,o=this.elements,n=r[0],a=r[4],s=r[8],$=r[12],d=r[1],p=r[5],c=r[9],l=r[13],h=r[2],u=r[6],f=r[10],m=r[14],v=r[3],x=r[7],R=r[11],g=r[15],q=i[0],y=i[4],K=i[8],_=i[12],b=i[1],M=i[5],w=i[9],S=i[13],T=i[2],E=i[6],A=i[10],L=i[14],C=i[3],P=i[7],B=i[11],G=i[15];return o[0]=n*q+a*b+s*T+$*C,o[4]=n*y+a*M+s*E+$*P,o[8]=n*K+a*w+s*A+$*B,o[12]=n*_+a*S+s*L+$*G,o[1]=d*q+p*b+c*T+l*C,o[5]=d*y+p*M+c*E+l*P,o[9]=d*K+p*w+c*A+l*B,o[13]=d*_+p*S+c*L+l*G,o[2]=h*q+u*b+f*T+m*C,o[6]=h*y+u*M+f*E+m*P,o[10]=h*K+u*w+f*A+m*B,o[14]=h*_+u*S+f*L+m*G,o[3]=v*q+x*b+R*T+g*C,o[7]=v*y+x*M+R*E+g*P,o[11]=v*K+x*w+R*A+g*B,o[15]=v*_+x*S+R*L+g*G,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(e){for(var t=0,r=e.count;t<r;t++)_.x=e.getX(t),_.y=e.getY(t),_.z=e.getZ(t),_.applyMatrix4(this),e.setXYZ(t,_.x,_.y,_.z);return e},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],o=e[12],n=e[1],a=e[5],s=e[9],$=e[13],d=e[2],p=e[6],c=e[10],l=e[14];return e[3]*(+o*s*p-i*$*p-o*a*c+r*$*c+i*a*l-r*s*l)+e[7]*(+t*s*l-t*$*c+o*n*c-i*n*l+i*$*d-o*s*d)+e[11]*(+t*$*p-t*a*l-o*n*p+r*n*l+o*a*d-r*$*d)+e[15]*(-i*a*d-t*s*p+t*a*c+i*n*p-r*n*c+r*s*d)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,r){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this},getInverse:function(e,t){var r=this.elements,i=e.elements,o=i[0],n=i[1],a=i[2],s=i[3],$=i[4],d=i[5],p=i[6],c=i[7],l=i[8],h=i[9],u=i[10],f=i[11],m=i[12],v=i[13],x=i[14],R=i[15],g=h*x*c-v*u*c+v*p*f-d*x*f-h*p*R+d*u*R,q=m*u*c-l*x*c-m*p*f+$*x*f+l*p*R-$*u*R,y=l*v*c-m*h*c+m*d*f-$*v*f-l*d*R+$*h*R,K=m*h*p-l*v*p-m*d*u+$*v*u+l*d*x-$*h*x,_=o*g+n*q+a*y+s*K;if(0===_){var b="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(b);return console.warn(b),this.identity()}var M=1/_;return r[0]=g*M,r[1]=(v*u*s-h*x*s-v*a*f+n*x*f+h*a*R-n*u*R)*M,r[2]=(d*x*s-v*p*s+v*a*c-n*x*c-d*a*R+n*p*R)*M,r[3]=(h*p*s-d*u*s-h*a*c+n*u*c+d*a*f-n*p*f)*M,r[4]=q*M,r[5]=(l*x*s-m*u*s+m*a*f-o*x*f-l*a*R+o*u*R)*M,r[6]=(m*p*s-$*x*s-m*a*c+o*x*c+$*a*R-o*p*R)*M,r[7]=($*u*s-l*p*s+l*a*c-o*u*c-$*a*f+o*p*f)*M,r[8]=y*M,r[9]=(m*h*s-l*v*s-m*n*f+o*v*f+l*n*R-o*h*R)*M,r[10]=($*v*s-m*d*s+m*n*c-o*v*c-$*n*R+o*d*R)*M,r[11]=(l*d*s-$*h*s-l*n*c+o*h*c+$*n*f-o*d*f)*M,r[12]=K*M,r[13]=(l*v*a-m*h*a+m*n*u-o*v*u-l*n*x+o*h*x)*M,r[14]=(m*d*a-$*v*a-m*n*p+o*v*p+$*n*x-o*d*x)*M,r[15]=($*h*a-l*d*a+l*n*p-o*h*p-$*n*u+o*d*u)*M,this},scale:function(e){var t=this.elements,r=e.x,i=e.y,o=e.z;return t[0]*=r,t[4]*=i,t[8]*=o,t[1]*=r,t[5]*=i,t[9]*=o,t[2]*=r,t[6]*=i,t[10]*=o,t[3]*=r,t[7]*=i,t[11]*=o,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),o=1-r,n=e.x,a=e.y,s=e.z,$=o*n,d=o*a;return this.set($*n+r,$*a-i*s,$*s+i*a,0,$*a+i*s,d*a+r,d*s-i*n,0,$*s-i*a,d*s+i*n,o*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var i=this.elements,o=t._x,n=t._y,a=t._z,s=t._w,$=o+o,d=n+n,p=a+a,c=o*$,l=o*d,h=o*p,u=n*d,f=n*p,m=a*p,v=s*$,x=s*d,R=s*p,g=r.x,q=r.y,y=r.z;return i[0]=(1-(u+m))*g,i[1]=(l+R)*g,i[2]=(h-x)*g,i[3]=0,i[4]=(l-R)*q,i[5]=(1-(c+m))*q,i[6]=(f+v)*q,i[7]=0,i[8]=(h+x)*y,i[9]=(f-v)*y,i[10]=(1-(c+u))*y,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(e,t,r){var i=this.elements,o=_.set(i[0],i[1],i[2]).length(),n=_.set(i[4],i[5],i[6]).length(),a=_.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],ua.copy(this);var s=1/o,$=1/n,d=1/a;return ua.elements[0]*=s,ua.elements[1]*=s,ua.elements[2]*=s,ua.elements[4]*=$,ua.elements[5]*=$,ua.elements[6]*=$,ua.elements[8]*=d,ua.elements[9]*=d,ua.elements[10]*=d,t.setFromRotationMatrix(ua),r.x=o,r.y=n,r.z=a,this},makePerspective:function(e,t,r,i,o,n){void 0===n&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*o/(t-e),$=2*o/(r-i),d=(t+e)/(t-e),p=(r+i)/(r-i),c=-(n+o)/(n-o),l=-2*n*o/(n-o);return a[0]=s,a[4]=0,a[8]=d,a[12]=0,a[1]=0,a[5]=$,a[9]=p,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=l,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,r,i,o,n){var a=this.elements,s=1/(t-e),$=1/(r-i),d=1/(n-o),p=(t+e)*s,c=(r+i)*$,l=(n+o)*d;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-p,a[1]=0,a[5]=2*$,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*d,a[14]=-l,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}});var kk=new da,lk=new S;function hc(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||hc.DefaultOrder}function mk(){this.mask=1}hc.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],hc.DefaultOrder="XYZ",Object.defineProperties(hc.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(hc.prototype,{isEuler:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var i=ea.clamp,o=e.elements,n=o[0],a=o[4],s=o[8],$=o[1],d=o[5],p=o[9],c=o[2],l=o[6],h=o[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-p,h),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(l,d),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(s,h),this._z=Math.atan2($,d)):(this._y=Math.atan2(-c,n),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(-c,h),this._z=Math.atan2(-a,d)):(this._y=0,this._z=Math.atan2($,n))):"ZYX"===t?(this._y=Math.asin(-i(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(l,h),this._z=Math.atan2($,n)):(this._x=0,this._z=Math.atan2(-a,d))):"YZX"===t?(this._z=Math.asin(i($,-1,1)),Math.abs($)<.9999999?(this._x=Math.atan2(-p,d),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(s,h))):"XZY"===t?(this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(l,d),this._y=Math.atan2(s,n)):(this._x=Math.atan2(-p,h),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,r){return kk.makeRotationFromQuaternion(e),this.setFromRotationMatrix(kk,t,r)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return lk.setFromEuler(this),this.setFromQuaternion(lk,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new aa(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(mk.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var Bp=0,nk=new aa,ic=new S,Ra=new da,Qe=new aa,id=new aa,Cp=new aa,Dp=new S,ok=new aa(1,0,0),pk=new aa(0,1,0),qk=new aa(0,0,1),Ep={type:"added"},Fp={type:"removed"};function b(){Object.defineProperty(this,"id",{value:Bp++}),this.uuid=ea.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=b.DefaultUp.clone();var e=new aa,t=new hc,r=new S,i=new aa(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new da},normalMatrix:{value:new L}}),this.matrix=new da,this.matrixWorld=new da,this.matrixAutoUpdate=b.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new mk,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function jd(){b.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}b.DefaultUp=new aa(0,1,0),b.DefaultMatrixAutoUpdate=!0,b.prototype=Object.assign(Object.create(Aa.prototype),{constructor:b,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return ic.setFromAxisAngle(e,t),this.quaternion.multiply(ic),this},rotateOnWorldAxis:function(e,t){return ic.setFromAxisAngle(e,t),this.quaternion.premultiply(ic),this},rotateX:function(e){return this.rotateOnAxis(ok,e)},rotateY:function(e){return this.rotateOnAxis(pk,e)},rotateZ:function(e){return this.rotateOnAxis(qk,e)},translateOnAxis:function(e,t){return nk.copy(e).applyQuaternion(this.quaternion),this.position.add(nk.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(ok,e)},translateY:function(e){return this.translateOnAxis(pk,e)},translateZ:function(e){return this.translateOnAxis(qk,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(Ra.getInverse(this.matrixWorld))},lookAt:function(e,t,r){e.isVector3?Qe.copy(e):Qe.set(e,t,r);var i=this.parent;this.updateWorldMatrix(!0,!1),id.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ra.lookAt(id,Qe,this.up):Ra.lookAt(Qe,id,this.up),this.quaternion.setFromRotationMatrix(Ra),i&&(Ra.extractRotation(i.matrixWorld),ic.setFromRotationMatrix(Ra),this.quaternion.premultiply(ic.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Ep)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,this.children.splice(r,1),e.dispatchEvent(Fp)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),Ra.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Ra.multiply(e.parent.matrixWorld)),e.applyMatrix(Ra),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;r<i;r++){var o=this.children[r].getObjectByProperty(e,t);if(void 0!==o)return o}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new aa),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new S),this.updateMatrixWorld(!0),this.matrixWorld.decompose(id,e,Cp),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new aa),this.updateMatrixWorld(!0),this.matrixWorld.decompose(id,Dp,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new aa),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,o=0,n=i.length;o<n;o++)i[o].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function o(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==Me&&(i.drawMode=this.drawMode),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);var n=this.geometry.parameters;if(void 0!==n&&void 0!==n.shapes){var a=n.shapes;if(Array.isArray(a))for(var s=0,$=a.length;s<$;s++){var d=a[s];o(e.shapes,d)}else o(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var p=[];for(s=0,$=this.material.length;s<$;s++)p.push(o(e.materials,this.material[s]));i.material=p}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(s=0;s<this.children.length;s++)i.children.push(this.children[s].toJSON(e).object)}if(t){var c=f(e.geometries),l=f(e.materials),h=f(e.textures),u=f(e.images);a=f(e.shapes);c.length>0&&(r.geometries=c),l.length>0&&(r.materials=l),h.length>0&&(r.textures=h),u.length>0&&(r.images=u),a.length>0&&(r.shapes=a)}return r.object=i,r;function f(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var i=e.children[r];this.add(i.clone())}return this}}),jd.prototype=Object.assign(Object.create(b.prototype),{constructor:jd,isScene:!0,copy:function(e,t){return b.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=b.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Sa=[new aa,new aa,new aa,new aa,new aa,new aa,new aa,new aa],kd=new aa,Re=new Ba,jc=new aa,kc=new aa,lc=new aa,gb=new aa,hb=new aa,Cb=new aa,ld=new aa,Se=new aa,Te=new aa,Db=new aa;function Ba(e,t){this.min=void 0!==e?e:new aa(1/0,1/0,1/0),this.max=void 0!==t?t:new aa(-1/0,-1/0,-1/0)}function fh(e,t,r,i,o){var n,a;for(n=0,a=e.length-3;n<=a;n+=3){Db.fromArray(e,n);var s=o.x*Math.abs(Db.x)+o.y*Math.abs(Db.y)+o.z*Math.abs(Db.z),$=t.dot(Db),d=r.dot(Db),p=i.dot(Db);if(Math.max(-Math.max($,d,p),Math.min($,d,p))>s)return!1}return!0}Object.assign(Ba.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,i=1/0,o=-1/0,n=-1/0,a=-1/0,s=0,$=e.length;s<$;s+=3){var d=e[s],p=e[s+1],c=e[s+2];d<t&&(t=d),p<r&&(r=p),c<i&&(i=c),d>o&&(o=d),p>n&&(n=p),c>a&&(a=c)}return this.min.set(t,r,i),this.max.set(o,n,a),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,i=1/0,o=-1/0,n=-1/0,a=-1/0,s=0,$=e.count;s<$;s++){var d=e.getX(s),p=e.getY(s),c=e.getZ(s);d<t&&(t=d),p<r&&(r=p),c<i&&(i=c),d>o&&(o=d),p>n&&(n=p),c>a&&(a=c)}return this.min.set(t,r,i),this.max.set(o,n,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=kd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new aa),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new aa),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Re.copy(t.boundingBox),Re.applyMatrix4(e.matrixWorld),this.expandByPoint(Re.min),this.expandByPoint(Re.max));for(var r=e.children,i=0,o=r.length;i<o;i++)this.expandByObject(r[i]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new aa),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,kd),kd.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(ld),Se.subVectors(this.max,ld),jc.subVectors(e.a,ld),kc.subVectors(e.b,ld),lc.subVectors(e.c,ld),gb.subVectors(kc,jc),hb.subVectors(lc,kc),Cb.subVectors(jc,lc);var t=[0,-gb.z,gb.y,0,-hb.z,hb.y,0,-Cb.z,Cb.y,gb.z,0,-gb.x,hb.z,0,-hb.x,Cb.z,0,-Cb.x,-gb.y,gb.x,0,-hb.y,hb.x,0,-Cb.y,Cb.x,0];return!!fh(t,jc,kc,lc,Se)&&!!fh(t=[1,0,0,0,1,0,0,0,1],jc,kc,lc,Se)&&(Te.crossVectors(gb,hb),fh(t=[Te.x,Te.y,Te.z],jc,kc,lc,Se))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new aa),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return kd.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(kd).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()?this:(Sa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Sa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Sa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Sa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Sa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Sa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Sa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Sa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Sa),this)},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Gp=new Ba;function ib(e,t){this.center=void 0!==e?e:new aa,this.radius=void 0!==t?t:0}Object.assign(ib.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var r=this.center;void 0!==t?r.copy(t):Gp.setFromPoints(e).getCenter(r);for(var i=0,o=0,n=e.length;o<n;o++)i=Math.max(i,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new aa),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Ba),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Ta=new aa,gh=new aa,Ue=new aa,jb=new aa,hh=new aa,Ve=new aa,ih=new aa;function mc(e,t){this.origin=void 0!==e?e:new aa,this.direction=void 0!==t?t:new aa(0,0,-1)}Object.assign(mc.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new aa),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Ta)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new aa),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=Ta.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ta.copy(this.direction).multiplyScalar(t).add(this.origin),Ta.distanceToSquared(e))},distanceSqToSegment:function(e,t,r,i){gh.copy(e).add(t).multiplyScalar(.5),Ue.copy(t).sub(e).normalize(),jb.copy(this.origin).sub(gh);var o,n,a,s,$=.5*e.distanceTo(t),d=-this.direction.dot(Ue),p=jb.dot(this.direction),c=-jb.dot(Ue),l=jb.lengthSq(),h=Math.abs(1-d*d);if(h>0){if(n=d*p-c,s=$*h,(o=d*c-p)>=0){if(n>=-s){if(n<=s){var u=1/h;a=(o*=u)*(o+d*(n*=u)+2*p)+n*(d*o+n+2*c)+l}else n=$,a=-(o=Math.max(0,-(d*n+p)))*o+n*(n+2*c)+l;}else n=-$,a=-(o=Math.max(0,-(d*n+p)))*o+n*(n+2*c)+l;}else n<=-s?a=-(o=Math.max(0,-(-d*$+p)))*o+(n=o>0?-$:Math.min(Math.max(-$,-c),$))*(n+2*c)+l:n<=s?(o=0,a=(n=Math.min(Math.max(-$,-c),$))*(n+2*c)+l):a=-(o=Math.max(0,-(d*$+p)))*o+(n=o>0?$:Math.min(Math.max(-$,-c),$))*(n+2*c)+l;}else n=d>0?-$:$,a=-(o=Math.max(0,-(d*n+p)))*o+n*(n+2*c)+l;return r&&r.copy(this.direction).multiplyScalar(o).add(this.origin),i&&i.copy(Ue).multiplyScalar(n).add(gh),a},intersectSphere:function(e,t){Ta.subVectors(e.center,this.origin);var r=Ta.dot(this.direction),i=Ta.dot(Ta)-r*r,o=e.radius*e.radius;if(i>o)return null;var n=Math.sqrt(o-i),a=r-n,s=r+n;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,i,o,n,a,s,$=1/this.direction.x,d=1/this.direction.y,p=1/this.direction.z,c=this.origin;return $>=0?(r=(e.min.x-c.x)*$,i=(e.max.x-c.x)*$):(r=(e.max.x-c.x)*$,i=(e.min.x-c.x)*$),d>=0?(o=(e.min.y-c.y)*d,n=(e.max.y-c.y)*d):(o=(e.max.y-c.y)*d,n=(e.min.y-c.y)*d),r>n||o>i?null:((o>r||r!=r)&&(r=o),(n<i||i!=i)&&(i=n),p>=0?(a=(e.min.z-c.z)*p,s=(e.max.z-c.z)*p):(a=(e.max.z-c.z)*p,s=(e.min.z-c.z)*p),r>s||a>i?null:((a>r||r!=r)&&(r=a),(s<i||i!=i)&&(i=s),i<0?null:this.at(r>=0?r:i,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,Ta)},intersectTriangle:function(e,t,r,i,o){hh.subVectors(t,e),Ve.subVectors(r,e),ih.crossVectors(hh,Ve);var n,a=this.direction.dot(ih);if(a>0){if(i)return null;n=1}else{if(!(a<0))return null;n=-1,a=-a}jb.subVectors(this.origin,e);var s=n*this.direction.dot(Ve.crossVectors(jb,Ve));if(s<0)return null;var $=n*this.direction.dot(hh.cross(jb));if($<0)return null;if(s+$>a)return null;var d=-n*jb.dot(ih);return d<0?null:this.at(d/a,o)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var jh=new aa,Hp=new aa,Ip=new L;function Ca(e,t){this.normal=void 0!==e?e:new aa(1,0,0),this.constant=void 0!==t?t:0}Object.assign(Ca.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,r){var i=jh.subVectors(r,t).cross(Hp.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new aa),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new aa);var r=e.delta(jh),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:t.copy(r).multiplyScalar(o).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new aa),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var r=t||Ip.getNormalMatrix(e),i=this.coplanarPoint(jh).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(o),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var va=new aa,Ua=new aa,kh=new aa,Va=new aa,nc=new aa,oc=new aa,rk=new aa,lh=new aa,mh=new aa,nh=new aa;function O(e,t,r){this.a=void 0!==e?e:new aa,this.b=void 0!==t?t:new aa,this.c=void 0!==r?r:new aa}Object.assign(O,{getNormal:function(e,t,r,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new aa),i.subVectors(r,t),va.subVectors(e,t),i.cross(va);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)},getBarycoord:function(e,t,r,i,o){va.subVectors(i,t),Ua.subVectors(r,t),kh.subVectors(e,t);var n=va.dot(va),a=va.dot(Ua),s=va.dot(kh),$=Ua.dot(Ua),d=Ua.dot(kh),p=n*$-a*a;if(void 0===o&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),o=new aa),0===p)return o.set(-2,-1,-1);var c=1/p,l=($*s-a*d)*c,h=(n*d-a*s)*c;return o.set(1-l-h,h,l)},containsPoint:function(e,t,r,i){return O.getBarycoord(e,t,r,i,Va),Va.x>=0&&Va.y>=0&&Va.x+Va.y<=1},getUV:function(e,t,r,i,o,n,a,s){return this.getBarycoord(e,t,r,i,Va),s.set(0,0),s.addScaledVector(o,Va.x),s.addScaledVector(n,Va.y),s.addScaledVector(a,Va.z),s},isFrontFacing:function(e,t,r,i){return va.subVectors(r,t),Ua.subVectors(e,t),va.cross(Ua).dot(i)<0}}),Object.assign(O.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return va.subVectors(this.c,this.b),Ua.subVectors(this.a,this.b),.5*va.cross(Ua).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new aa),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return O.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Ca),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return O.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,r,i,o){return O.getUV(e,this.a,this.b,this.c,t,r,i,o)},containsPoint:function(e){return O.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return O.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new aa);var r,i,o=this.a,n=this.b,a=this.c;nc.subVectors(n,o),oc.subVectors(a,o),lh.subVectors(e,o);var s=nc.dot(lh),$=oc.dot(lh);if(s<=0&&$<=0)return t.copy(o);mh.subVectors(e,n);var d=nc.dot(mh),p=oc.dot(mh);if(d>=0&&p<=d)return t.copy(n);var c=s*p-d*$;if(c<=0&&s>=0&&d<=0)return r=s/(s-d),t.copy(o).addScaledVector(nc,r);nh.subVectors(e,a);var l=nc.dot(nh),h=oc.dot(nh);if(h>=0&&l<=h)return t.copy(a);var u=l*$-s*h;if(u<=0&&$>=0&&h<=0)return i=$/($-h),t.copy(o).addScaledVector(oc,i);var f=d*h-l*p;if(f<=0&&p-d>=0&&l-h>=0)return rk.subVectors(a,n),i=(p-d)/(p-d+(l-h)),t.copy(n).addScaledVector(rk,i);var m=1/(f+u+c);return r=u*m,i=c*m,t.copy(o).addScaledVector(nc,r).addScaledVector(oc,i)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var sk={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},wa={h:0,s:0,l:0},We={h:0,s:0,l:0};function g(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function oh(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function ph(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function qh(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function Xe(e,t,r,i,o,n){this.a=e,this.b=t,this.c=r,this.normal=i&&i.isVector3?i:new aa,this.vertexNormals=Array.isArray(i)?i:[],this.color=o&&o.isColor?o:new g,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=void 0!==n?n:0}Object.assign(g.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(e=ea.euclideanModulo(e,1),t=ea.clamp(t,0,1),r=ea.clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{var i=r<=.5?r*(1+t):r+t-r*t,o=2*r-i;this.r=oh(o,i,e+1/3),this.g=oh(o,i,e),this.b=oh(o,i,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,o=r[1],n=r[2];switch(o){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n)){var a=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,$=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(a,s,$)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var d=r[1],p=d.length;if(3===p)return this.r=parseInt(d.charAt(0)+d.charAt(0),16)/255,this.g=parseInt(d.charAt(1)+d.charAt(1),16)/255,this.b=parseInt(d.charAt(2)+d.charAt(2),16)/255,this;if(6===p)return this.r=parseInt(d.charAt(0)+d.charAt(1),16)/255,this.g=parseInt(d.charAt(2)+d.charAt(3),16)/255,this.b=parseInt(d.charAt(4)+d.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=sk[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=ph(e.r),this.g=ph(e.g),this.b=ph(e.b),this},copyLinearToSRGB:function(e){return this.r=qh(e.r),this.g=qh(e.g),this.b=qh(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,i=this.r,o=this.g,n=this.b,a=Math.max(i,o,n),s=Math.min(i,o,n),$=(s+a)/2;if(s===a)t=0,r=0;else{var d=a-s;switch(r=$<=.5?d/(a+s):d/(2-a-s),a){case i:t=(o-n)/d+(o<n?6:0);break;case o:t=(n-i)/d+2;break;case n:t=(i-o)/d+4;}t/=6}return e.h=t,e.s=r,e.l=$,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){return this.getHSL(wa),wa.h+=e,wa.s+=t,wa.l+=r,this.setHSL(wa.h,wa.s,wa.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(wa),e.getHSL(We);var r=ea.lerp(wa.h,We.h,t),i=ea.lerp(wa.s,We.s,t),o=ea.lerp(wa.l,We.l,t);return this.setHSL(r,i,o),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),g.NAMES=sk,Object.assign(Xe.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Jp=0;function f(){Object.defineProperty(this,"id",{value:Jp++}),this.uuid=ea.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=bd,this.side=_c,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=Qj,this.opacity=1,this.transparent=!1,this.blendSrc=Uj,this.blendDst=Vj,this.blendEquation=dc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Tg,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=xp,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=dh,this.stencilZFail=dh,this.stencilZPass=dh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function oa(e){f.call(this),this.type="MeshBasicMaterial",this.color=new g(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ce,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}function q(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.usage=Oe,this.updateRange={offset:0,count:-1},this.version=0}function rh(e,t,r){q.call(this,new Int8Array(e),t,r)}function sh(e,t,r){q.call(this,new Uint8Array(e),t,r)}function th(e,t,r){q.call(this,new Uint8ClampedArray(e),t,r)}function uh(e,t,r){q.call(this,new Int16Array(e),t,r)}function md(e,t,r){q.call(this,new Uint16Array(e),t,r)}function vh(e,t,r){q.call(this,new Int32Array(e),t,r)}function nd(e,t,r){q.call(this,new Uint32Array(e),t,r)}function j(e,t,r){q.call(this,new Float32Array(e),t,r)}function wh(e,t,r){q.call(this,new Float64Array(e),t,r)}function tk(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function uk(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,i=e.length;r<i;++r)e[r]>t&&(t=e[r]);return t}f.prototype=Object.assign(Object.create(Aa.prototype),{constructor:f,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===Pj;}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==bd&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==_c&&(r.side=this.side),this.vertexColors!==Qj&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var o=i(e.textures),n=i(e.images);o.length>0&&(r.textures=o),n.length>0&&(r.images=n)}return r},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,r=null;if(null!==t){var i=t.length;r=new Array(i);for(var o=0;o!==i;++o)r[o]=t[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(f.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),oa.prototype=Object.create(f.prototype),oa.prototype.constructor=oa,oa.prototype.isMeshBasicMaterial=!0,oa.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.defineProperty(q.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(q.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[r+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,o=e.length;i<o;i++){var n=e[i];void 0===n&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),n=new g),t[r++]=n.r,t[r++]=n.g,t[r++]=n.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,i=0,o=e.length;i<o;i++){var n=e[i];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),n=new ba),t[r++]=n.x,t[r++]=n.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,o=e.length;i<o;i++){var n=e[i];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),n=new aa),t[r++]=n.x,t[r++]=n.y,t[r++]=n.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,o=e.length;i<o;i++){var n=e[i];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),n=new fa),t[r++]=n.x,t[r++]=n.y,t[r++]=n.z,t[r++]=n.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=o,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),rh.prototype=Object.create(q.prototype),rh.prototype.constructor=rh,sh.prototype=Object.create(q.prototype),sh.prototype.constructor=sh,th.prototype=Object.create(q.prototype),th.prototype.constructor=th,uh.prototype=Object.create(q.prototype),uh.prototype.constructor=uh,md.prototype=Object.create(q.prototype),md.prototype.constructor=md,vh.prototype=Object.create(q.prototype),vh.prototype.constructor=vh,nd.prototype=Object.create(q.prototype),nd.prototype.constructor=nd,j.prototype=Object.create(q.prototype),j.prototype.constructor=j,wh.prototype=Object.create(q.prototype),wh.prototype.constructor=wh,Object.assign(tk.prototype,{computeGroups:function(e){for(var t,r=[],i=void 0,o=e.faces,n=0;n<o.length;n++){var a=o[n];a.materialIndex!==i&&(i=a.materialIndex,void 0!==t&&(t.count=3*n-t.start,r.push(t)),t={start:3*n,materialIndex:i})}void 0!==t&&(t.count=3*n-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,i=e.vertices,o=e.faceVertexUvs,n=o[0]&&o[0].length>0,a=o[1]&&o[1].length>0,s=e.morphTargets,$=s.length;if($>0){t=[];for(var d=0;d<$;d++)t[d]={name:s[d].name,data:[]};this.morphTargets.position=t}var p,c=e.morphNormals,l=c.length;if(l>0){p=[];for(d=0;d<l;d++)p[d]={name:c[d].name,data:[]};this.morphTargets.normal=p}var h=e.skinIndices,u=e.skinWeights,f=h.length===i.length,m=u.length===i.length;i.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(d=0;d<r.length;d++){var v=r[d];this.vertices.push(i[v.a],i[v.b],i[v.c]);var x=v.vertexNormals;if(3===x.length)this.normals.push(x[0],x[1],x[2]);else{var R=v.normal;this.normals.push(R,R,R)}var g,q=v.vertexColors;if(3===q.length)this.colors.push(q[0],q[1],q[2]);else{var y=v.color;this.colors.push(y,y,y)}if(!0===n)void 0!==(g=o[0][d])?this.uvs.push(g[0],g[1],g[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",d),this.uvs.push(new ba,new ba,new ba));if(!0===a)void 0!==(g=o[1][d])?this.uvs2.push(g[0],g[1],g[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",d),this.uvs2.push(new ba,new ba,new ba));for(var K=0;K<$;K++){var _=s[K].vertices;t[K].data.push(_[v.a],_[v.b],_[v.c])}for(K=0;K<l;K++){var b=c[K].vertexNormals[d];p[K].data.push(b.a,b.b,b.c)}f&&this.skinIndices.push(h[v.a],h[v.b],h[v.c]),m&&this.skinWeights.push(u[v.a],u[v.b],u[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var Da=new da,xh=new b,pc=new aa,ia=new Ba,od=new Ba,I=new aa;function k(){Object.defineProperty(this,"id",{value:2}),this.uuid=ea.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}k.prototype=Object.assign(Object.create(Aa.prototype),{constructor:k,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(uk(e)>65535?nd:md)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&(new L().getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0);var i=this.attributes.tangent;void 0!==i&&(new L().getNormalMatrix(e).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Da.makeRotationX(e),this.applyMatrix(Da),this},rotateY:function(e){return Da.makeRotationY(e),this.applyMatrix(Da),this},rotateZ:function(e){return Da.makeRotationZ(e),this.applyMatrix(Da),this},translate:function(e,t,r){return Da.makeTranslation(e,t,r),this.applyMatrix(Da),this},scale:function(e,t,r){return Da.makeScale(e,t,r),this.applyMatrix(Da),this},lookAt:function(e){return xh.lookAt(e),xh.updateMatrix(),this.applyMatrix(xh.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(pc).negate(),this.translate(pc.x,pc.y,pc.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new j(3*t.vertices.length,3),i=new j(3*t.colors.length,3);if(this.setAttribute("position",r.copyVector3sArray(t.vertices)),this.setAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var o=new j(t.lineDistances.length,1);this.setAttribute("lineDistance",o.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,i=e.length;r<i;r++){var o=e[r];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new j(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var i=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(i=void 0,r.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(r);i.verticesNeedUpdate=r.verticesNeedUpdate,i.normalsNeedUpdate=r.normalsNeedUpdate,i.colorsNeedUpdate=r.colorsNeedUpdate,i.uvsNeedUpdate=r.uvsNeedUpdate,i.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=i}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new tk().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new q(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.setAttribute("normal",new q(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.setAttribute("color",new q(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var o=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new q(o,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var n=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new q(n,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],$=e.morphTargets[a],d=0,p=$.length;d<p;d++){var c=$[d],l=new j(3*c.data.length,3);l.name=c.name,s.push(l.copyVector3sArray(c.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var h=new j(4*e.skinIndices.length,4);this.setAttribute("skinIndex",h.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var u=new j(4*e.skinWeights.length,4);this.setAttribute("skinWeight",u.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ba);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var o=t[r];ia.setFromBufferAttribute(o),this.morphTargetsRelative?(I.addVectors(this.boundingBox.min,ia.min),this.boundingBox.expandByPoint(I),I.addVectors(this.boundingBox.max,ia.max),this.boundingBox.expandByPoint(I)):(this.boundingBox.expandByPoint(ia.min),this.boundingBox.expandByPoint(ia.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error("THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ib);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var r=this.boundingSphere.center;if(ia.setFromBufferAttribute(e),t)for(var i=0,o=t.length;i<o;i++){var n=t[i];od.setFromBufferAttribute(n),this.morphTargetsRelative?(I.addVectors(ia.min,od.min),ia.expandByPoint(I),I.addVectors(ia.max,od.max),ia.expandByPoint(I)):(ia.expandByPoint(od.min),ia.expandByPoint(od.max))}ia.getCenter(r);var a=0;for(i=0,o=e.count;i<o;i++)I.fromBufferAttribute(e,i),a=Math.max(a,r.distanceToSquared(I));if(t)for(i=0,o=t.length;i<o;i++){n=t[i];for(var s=this.morphTargetsRelative,$=0,d=n.count;$<d;$++)I.fromBufferAttribute(n,$),s&&(pc.fromBufferAttribute(e,$),I.add(pc)),a=Math.max(a,r.distanceToSquared(I))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new q(new Float32Array(r.length),3));else for(var i=t.normal.array,o=0,n=i.length;o<n;o++)i[o]=0;var a,s,$,d=t.normal.array,p=new aa,c=new aa,l=new aa,h=new aa,u=new aa;if(e){var f=e.array;for(o=0,n=e.count;o<n;o+=3)a=3*f[o+0],s=3*f[o+1],$=3*f[o+2],p.fromArray(r,a),c.fromArray(r,s),l.fromArray(r,$),h.subVectors(l,c),u.subVectors(p,c),h.cross(u),d[a]+=h.x,d[a+1]+=h.y,d[a+2]+=h.z,d[s]+=h.x,d[s+1]+=h.y,d[s+2]+=h.z,d[$]+=h.x,d[$+1]+=h.y,d[$+2]+=h.z}else for(o=0,n=r.length;o<n;o+=9)p.fromArray(r,o),c.fromArray(r,o+3),l.fromArray(r,o+6),h.subVectors(l,c),u.subVectors(p,c),h.cross(u),d[o]=h.x,d[o+1]=h.y,d[o+2]=h.z,d[o+3]=h.x,d[o+4]=h.y,d[o+5]=h.z,d[o+6]=h.x,d[o+7]=h.y,d[o+8]=h.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var i in r)if(void 0!==e.attributes[i])for(var o=r[i].array,n=e.attributes[i],a=n.array,s=n.itemSize*t,$=Math.min(a.length,o.length-s),d=0,p=s;d<$;d++,p++)o[p]=a[d];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,r=e.count;t<r;t++)I.x=e.getX(t),I.y=e.getY(t),I.z=e.getZ(t),I.normalize(),e.setXYZ(t,I.x,I.y,I.z)},toNonIndexed:function(){function e(e,t){for(var r=e.array,i=e.itemSize,o=new r.constructor(t.length*i),n=0,a=0,s=0,$=t.length;s<$;s++){n=t[s]*i;for(var d=0;d<i;d++)o[a++]=r[n++]}return new q(o,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new k,r=this.index.array,i=this.attributes;for(var o in i){var n=e(i[o],r);t.setAttribute(o,n)}var a=this.morphAttributes;for(o in a){for(var s=[],$=a[o],d=0,p=$.length;d<p;d++){n=e($[d],r);s.push(n)}t.morphAttributes[o]=s}t.morphTargetsRelative=this.morphTargetsRelative;for(var c=this.groups,l=(d=0,c.length);d<l;d++){var h=c[d];t.addGroup(h.start,h.count,h.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var o=this.attributes;for(var r in o){var n=(l=o[r]).toJSON();""!==l.name&&(n.name=l.name),e.data.attributes[r]=n}var a={},s=!1;for(var r in this.morphAttributes){for(var $=this.morphAttributes[r],d=[],p=0,c=$.length;p<c;p++){var l;n=(l=$[p]).toJSON();""!==l.name&&(n.name=l.name),d.push(n)}d.length>0&&(a[r]=d,s=!0)}s&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);var h=this.groups;h.length>0&&(e.data.groups=JSON.parse(JSON.stringify(h)));var u=this.boundingSphere;return null!==u&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e},clone:function(){return new k().copy(this)},copy:function(e){var t,r,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var o=e.index;null!==o&&this.setIndex(o.clone());var n=e.attributes;for(t in n){var a=n[t];this.setAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var $=[],d=s[t];for(r=0,i=d.length;r<i;r++)$.push(d[r].clone());this.morphAttributes[t]=$}this.morphTargetsRelative=e.morphTargetsRelative;var p=e.groups;for(r=0,i=p.length;r<i;r++){var c=p[r];this.addGroup(c.start,c.count,c.materialIndex)}var l=e.boundingBox;null!==l&&(this.boundingBox=l.clone());var h=e.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var vk=new da,Eb=new mc,yh=new ib,Fb=new aa,Gb=new aa,Hb=new aa,zh=new aa,Ah=new aa,Bh=new aa,Ye=new aa,Ze=new aa,$e=new aa,qc=new ba,rc=new ba,sc=new ba,pd=new aa,_e=new aa;function F(e,t){b.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new k,this.material=void 0!==t?t:new oa({color:16777215*Math.random()}),this.drawMode=Me,this.updateMorphTargets()}function wk(e,t,r,i,o,n,a,s){if(null===(t.side===ga?i.intersectTriangle(a,n,o,!0,s):i.intersectTriangle(o,n,a,t.side!==Be,s)))return null;_e.copy(s),_e.applyMatrix4(e.matrixWorld);var $=r.ray.origin.distanceTo(_e);return $<r.near||$>r.far?null:{distance:$,point:_e.clone(),object:e}}function af(e,t,r,i,o,n,a,s,$,d,p,c){Fb.fromBufferAttribute(o,d),Gb.fromBufferAttribute(o,p),Hb.fromBufferAttribute(o,c);var l=e.morphTargetInfluences;if(t.morphTargets&&n&&l){Ye.set(0,0,0),Ze.set(0,0,0),$e.set(0,0,0);for(var h=0,u=n.length;h<u;h++){var f=l[h],m=n[h];0!==f&&(zh.fromBufferAttribute(m,d),Ah.fromBufferAttribute(m,p),Bh.fromBufferAttribute(m,c),a?(Ye.addScaledVector(zh,f),Ze.addScaledVector(Ah,f),$e.addScaledVector(Bh,f)):(Ye.addScaledVector(zh.sub(Fb),f),Ze.addScaledVector(Ah.sub(Gb),f),$e.addScaledVector(Bh.sub(Hb),f)))}Fb.add(Ye),Gb.add(Ze),Hb.add($e)}var v=wk(e,t,r,i,Fb,Gb,Hb,pd);if(v){s&&(qc.fromBufferAttribute(s,d),rc.fromBufferAttribute(s,p),sc.fromBufferAttribute(s,c),v.uv=O.getUV(pd,Fb,Gb,Hb,qc,rc,sc,new ba)),$&&(qc.fromBufferAttribute($,d),rc.fromBufferAttribute($,p),sc.fromBufferAttribute($,c),v.uv2=O.getUV(pd,Fb,Gb,Hb,qc,rc,sc,new ba));var x=new Xe(d,p,c);O.getNormal(Fb,Gb,Hb,x.normal),v.face=x}return v}F.prototype=Object.assign(Object.create(b.prototype),{constructor:F,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return b.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,i=this.geometry;if(i.isBufferGeometry){var o=i.morphAttributes,n=Object.keys(o);if(n.length>0){var a=o[n[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)r=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var r,i=this.geometry,o=this.material,n=this.matrixWorld;if(void 0!==o&&(null===i.boundingSphere&&i.computeBoundingSphere(),yh.copy(i.boundingSphere),yh.applyMatrix4(n),!1!==e.ray.intersectsSphere(yh)&&(vk.getInverse(n),Eb.copy(e.ray).applyMatrix4(vk),null===i.boundingBox||!1!==Eb.intersectsBox(i.boundingBox))))if(this.drawMode===Me){if(i.isBufferGeometry){var a,s,$,d,p,c,l,h,u,f=i.index,m=i.attributes.position,v=i.morphAttributes.position,x=i.morphTargetsRelative,R=i.attributes.uv,g=i.attributes.uv2,q=i.groups,y=i.drawRange;if(null!==f){if(Array.isArray(o))for(d=0,c=q.length;d<c;d++)for(u=o[(h=q[d]).materialIndex],p=Math.max(h.start,y.start),l=Math.min(h.start+h.count,y.start+y.count);p<l;p+=3)a=f.getX(p),s=f.getX(p+1),$=f.getX(p+2),(r=af(this,u,e,Eb,m,v,x,R,g,a,s,$))&&(r.faceIndex=Math.floor(p/3),r.face.materialIndex=h.materialIndex,t.push(r));else for(d=Math.max(0,y.start),c=Math.min(f.count,y.start+y.count);d<c;d+=3)a=f.getX(d),s=f.getX(d+1),$=f.getX(d+2),(r=af(this,o,e,Eb,m,v,x,R,g,a,s,$))&&(r.faceIndex=Math.floor(d/3),t.push(r));}else if(void 0!==m)if(Array.isArray(o))for(d=0,c=q.length;d<c;d++)for(u=o[(h=q[d]).materialIndex],p=Math.max(h.start,y.start),l=Math.min(h.start+h.count,y.start+y.count);p<l;p+=3)(r=af(this,u,e,Eb,m,v,x,R,g,a=p,s=p+1,$=p+2))&&(r.faceIndex=Math.floor(p/3),r.face.materialIndex=h.materialIndex,t.push(r));else for(d=Math.max(0,y.start),c=Math.min(m.count,y.start+y.count);d<c;d+=3)(r=af(this,o,e,Eb,m,v,x,R,g,a=d,s=d+1,$=d+2))&&(r.faceIndex=Math.floor(d/3),t.push(r))}else if(i.isGeometry){var K,_,b,M,w=Array.isArray(o),S=i.vertices,T=i.faces,E=i.faceVertexUvs[0];E.length>0&&(M=E);for(var A=0,L=T.length;A<L;A++){var C=T[A],P=w?o[C.materialIndex]:o;if(void 0!==P&&(K=S[C.a],_=S[C.b],b=S[C.c],r=wk(this,P,e,Eb,K,_,b,pd))){if(M&&M[A]){var B=M[A];qc.copy(B[0]),rc.copy(B[1]),sc.copy(B[2]),r.uv=O.getUV(pd,K,_,b,qc,rc,sc,new ba)}r.face=C,r.faceIndex=A,t.push(r)}}}}else console.warn("THREE.Mesh: TriangleStripDrawMode and TriangleFanDrawMode are not supported by .raycast().")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ea=new da,Ch=new b,bf=new aa;function w(){Object.defineProperty(this,"id",{value:2}),this.uuid=ea.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}w.prototype=Object.assign(Object.create(Aa.prototype),{constructor:w,isGeometry:!0,applyMatrix:function(e){for(var t=new L().getNormalMatrix(e),r=0,i=this.vertices.length;r<i;r++){this.vertices[r].applyMatrix4(e)}for(r=0,i=this.faces.length;r<i;r++){var o=this.faces[r];o.normal.applyMatrix3(t).normalize();for(var n=0,a=o.vertexNormals.length;n<a;n++)o.vertexNormals[n].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Ea.makeRotationX(e),this.applyMatrix(Ea),this},rotateY:function(e){return Ea.makeRotationY(e),this.applyMatrix(Ea),this},rotateZ:function(e){return Ea.makeRotationZ(e),this.applyMatrix(Ea),this},translate:function(e,t,r){return Ea.makeTranslation(e,t,r),this.applyMatrix(Ea),this},scale:function(e,t,r){return Ea.makeScale(e,t,r),this.applyMatrix(Ea),this},lookAt:function(e){return Ch.lookAt(e),Ch.updateMatrix(),this.applyMatrix(Ch.matrix),this},fromBufferGeometry:function(e){var t=this,r=null!==e.index?e.index.array:void 0,i=e.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var o=i.position.array,n=void 0!==i.normal?i.normal.array:void 0,a=void 0!==i.color?i.color.array:void 0,s=void 0!==i.uv?i.uv.array:void 0,$=void 0!==i.uv2?i.uv2.array:void 0;void 0!==$&&(this.faceVertexUvs[1]=[]);for(var d=0;d<o.length;d+=3)t.vertices.push(new aa().fromArray(o,d)),void 0!==a&&t.colors.push(new g().fromArray(a,d));function p(e,r,i,o){var d=void 0===a?[]:[t.colors[e].clone(),t.colors[r].clone(),t.colors[i].clone()],p=new Xe(e,r,i,void 0===n?[]:[new aa().fromArray(n,3*e),new aa().fromArray(n,3*r),new aa().fromArray(n,3*i)],d,o);t.faces.push(p),void 0!==s&&t.faceVertexUvs[0].push([new ba().fromArray(s,2*e),new ba().fromArray(s,2*r),new ba().fromArray(s,2*i)]),void 0!==$&&t.faceVertexUvs[1].push([new ba().fromArray($,2*e),new ba().fromArray($,2*r),new ba().fromArray($,2*i)])}var c=e.groups;if(c.length>0)for(d=0;d<c.length;d++)for(var l=c[d],h=l.start,u=h,f=h+l.count;u<f;u+=3)void 0!==r?p(r[u],r[u+1],r[u+2],l.materialIndex):p(u,u+1,u+2,l.materialIndex);else if(void 0!==r)for(d=0;d<r.length;d+=3)p(r[d],r[d+1],r[d+2]);else for(d=0;d<o.length/3;d+=3)p(d,d+1,d+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(bf).negate(),this.translate(bf.x,bf.y,bf.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,i=new da;return i.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new aa,t=new aa,r=0,i=this.faces.length;r<i;r++){var o=this.faces[r],n=this.vertices[o.a],a=this.vertices[o.b],s=this.vertices[o.c];e.subVectors(s,a),t.subVectors(n,a),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,o,n,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)a[t]=new aa;if(e){var s,$,d,p=new aa,c=new aa;for(i=0,o=this.faces.length;i<o;i++)n=this.faces[i],s=this.vertices[n.a],$=this.vertices[n.b],d=this.vertices[n.c],p.subVectors(d,$),c.subVectors(s,$),p.cross(c),a[n.a].add(p),a[n.b].add(p),a[n.c].add(p)}else for(this.computeFaceNormals(),i=0,o=this.faces.length;i<o;i++)a[(n=this.faces[i]).a].add(n.normal),a[n.b].add(n.normal),a[n.c].add(n.normal);for(t=0,r=this.vertices.length;t<r;t++)a[t].normalize();for(i=0,o=this.faces.length;i<o;i++){var l=(n=this.faces[i]).vertexNormals;3===l.length?(l[0].copy(a[n.a]),l[1].copy(a[n.b]),l[2].copy(a[n.c])):(l[0]=a[n.a].clone(),l[1]=a[n.b].clone(),l[2]=a[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(r=this.faces[e]).vertexNormals;3===i.length?(i[0].copy(r.normal),i[1].copy(r.normal),i[2].copy(r.normal)):(i[0]=r.normal.clone(),i[1]=r.normal.clone(),i[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,i,o;for(r=0,i=this.faces.length;r<i;r++)for((o=this.faces[r]).__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,t=o.vertexNormals.length;e<t;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var n=new w;for(n.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)$=new aa,d={a:new aa,b:new aa,c:new aa},a.push($),s.push(d)}var $,d,p=this.morphNormals[e];for(n.vertices=this.morphTargets[e].vertices,n.computeFaceNormals(),n.computeVertexNormals(),r=0,i=this.faces.length;r<i;r++)o=this.faces[r],$=p.faceNormals[r],d=p.vertexNormals[r],$.copy(o.normal),d.a.copy(o.vertexNormals[0]),d.b.copy(o.vertexNormals[1]),d.c.copy(o.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)(o=this.faces[r]).normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ba),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ib),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var i,o=this.vertices.length,n=this.vertices,a=e.vertices,s=this.faces,$=e.faces,d=this.colors,p=e.colors;void 0===r&&(r=0),void 0!==t&&(i=new L().getNormalMatrix(t));for(var c=0,l=a.length;c<l;c++){var h=a[c].clone();void 0!==t&&h.applyMatrix4(t),n.push(h)}for(c=0,l=p.length;c<l;c++)d.push(p[c].clone());for(c=0,l=$.length;c<l;c++){var u,f,m,v=$[c],x=v.vertexNormals,R=v.vertexColors;(u=new Xe(v.a+o,v.b+o,v.c+o)).normal.copy(v.normal),void 0!==i&&u.normal.applyMatrix3(i).normalize();for(var g=0,q=x.length;g<q;g++)f=x[g].clone(),void 0!==i&&f.applyMatrix3(i).normalize(),u.vertexNormals.push(f);u.color.copy(v.color);for(g=0,q=R.length;g<q;g++)m=R[g],u.vertexColors.push(m.clone());u.materialIndex=v.materialIndex+r,s.push(u)}for(c=0,l=e.faceVertexUvs.length;c<l;c++){var y=e.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(g=0,q=y.length;g<q;g++){for(var K=y[g],_=[],b=0,M=K.length;b<M;b++)_.push(K[b].clone());this.faceVertexUvs[c].push(_)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,i,o,n,a,s,$={},d=[],p=[],c=Math.pow(10,4);for(r=0,i=this.vertices.length;r<i;r++)e=this.vertices[r],void 0===$[t=Math.round(e.x*c)+"_"+Math.round(e.y*c)+"_"+Math.round(e.z*c)]?($[t]=r,d.push(this.vertices[r]),p[r]=d.length-1):p[r]=p[$[t]];var l=[];for(r=0,i=this.faces.length;r<i;r++){(o=this.faces[r]).a=p[o.a],o.b=p[o.b],o.c=p[o.c],n=[o.a,o.b,o.c];for(var h=0;h<3;h++)if(n[h]===n[(h+1)%3]){l.push(r);break}}for(r=l.length-1;r>=0;r--){var u=l[r];for(this.faces.splice(u,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(u,1)}var f=this.vertices.length-d.length;return this.vertices=d,f},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var i=e[t];this.vertices.push(new aa(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var i,o,n=this.faceVertexUvs[0],a=this.faceVertexUvs[1];n&&n.length===t&&(i=[]),a&&a.length===t&&(o=[]);for(r=0;r<t;r++){var s=e[r]._id;i&&i.push(n[s]),o&&o.push(a[s])}i&&(this.faceVertexUvs[0]=i),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var i=[],o=0;o<this.vertices.length;o++){var n=this.vertices[o];i.push(n.x,n.y,n.z)}var a=[],s=[],$={},d=[],p={},c=[],l={};for(o=0;o<this.faces.length;o++){var h=this.faces[o],u=void 0!==this.faceVertexUvs[0][o],f=h.normal.length()>0,m=h.vertexNormals.length>0,v=1!==h.color.r||1!==h.color.g||1!==h.color.b,x=h.vertexColors.length>0,R=0;if(R=K(R,0,0),R=K(R,1,!0),R=K(R,2,!1),R=K(R,3,u),R=K(R,4,f),R=K(R,5,m),R=K(R,6,v),R=K(R,7,x),a.push(R),a.push(h.a,h.b,h.c),a.push(h.materialIndex),u){var g=this.faceVertexUvs[0][o];a.push(M(g[0]),M(g[1]),M(g[2]))}if(f&&a.push(_(h.normal)),m){var q=h.vertexNormals;a.push(_(q[0]),_(q[1]),_(q[2]))}if(v&&a.push(b(h.color)),x){var y=h.vertexColors;a.push(b(y[0]),b(y[1]),b(y[2]))}}function K(e,t,r){return r?e|1<<t:e&~(1<<t)}function _(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==$[t]?$[t]:($[t]=s.length/3,s.push(e.x,e.y,e.z),$[t])}function b(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==p[t]?p[t]:(p[t]=d.length,d.push(e.getHex()),p[t])}function M(e){var t=e.x.toString()+e.y.toString();return void 0!==l[t]?l[t]:(l[t]=c.length/2,c.push(e.x,e.y),l[t])}return e.data={},e.data.vertices=i,e.data.normals=s,d.length>0&&(e.data.colors=d),c.length>0&&(e.data.uvs=[c]),e.data.faces=a,e},clone:function(){return new w().copy(this)},copy:function(e){var t,r,i,o,n,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());var $=e.colors;for(t=0,r=$.length;t<r;t++)this.colors.push($[t].clone());var d=e.faces;for(t=0,r=d.length;t<r;t++)this.faces.push(d[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var p=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),i=0,o=p.length;i<o;i++){var c=p[i],l=[];for(n=0,a=c.length;n<a;n++){var h=c[n];l.push(h.clone())}this.faceVertexUvs[t].push(l)}}var u=e.morphTargets;for(t=0,r=u.length;t<r;t++){var f={};if(f.name=u[t].name,void 0!==u[t].vertices)for(f.vertices=[],i=0,o=u[t].vertices.length;i<o;i++)f.vertices.push(u[t].vertices[i].clone());if(void 0!==u[t].normals)for(f.normals=[],i=0,o=u[t].normals.length;i<o;i++)f.normals.push(u[t].normals[i].clone());this.morphTargets.push(f)}var m=e.morphNormals;for(t=0,r=m.length;t<r;t++){var v={};if(void 0!==m[t].vertexNormals)for(v.vertexNormals=[],i=0,o=m[t].vertexNormals.length;i<o;i++){var x=m[t].vertexNormals[i],R={};R.a=x.a.clone(),R.b=x.b.clone(),R.c=x.c.clone(),v.vertexNormals.push(R)}if(void 0!==m[t].faceNormals)for(v.faceNormals=[],i=0,o=m[t].faceNormals.length;i<o;i++)v.faceNormals.push(m[t].faceNormals[i].clone());this.morphNormals.push(v)}var g=e.skinWeights;for(t=0,r=g.length;t<r;t++)this.skinWeights.push(g[t].clone());var q=e.skinIndices;for(t=0,r=q.length;t<r;t++)this.skinIndices.push(q[t].clone());var y=e.lineDistances;for(t=0,r=y.length;t<r;t++)this.lineDistances.push(y[t]);var K=e.boundingBox;null!==K&&(this.boundingBox=K.clone());var _=e.boundingSphere;return null!==_&&(this.boundingSphere=_.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class Kp extends w{constructor(e,t,r,i,o,n){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:o,depthSegments:n},this.fromBufferGeometry(new cf(e,t,r,i,o,n)),this.mergeVertices()}}class cf extends k{constructor(e,t,r,i,o,n){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:o,depthSegments:n};var a=this;e=e||1,t=t||1,r=r||1,i=Math.floor(i)||1,o=Math.floor(o)||1,n=Math.floor(n)||1;var s=[],$=[],d=[],p=[],c=0,l=0;function h(e,t,r,i,o,n,h,u,f,m,v){var x,R,g=n/f,q=h/m,y=n/2,K=h/2,_=u/2,b=f+1,M=m+1,w=0,S=0,T=new aa;for(R=0;R<M;R++){var E=R*q-K;for(x=0;x<b;x++){var A=x*g-y;T[e]=A*i,T[t]=E*o,T[r]=_,$.push(T.x,T.y,T.z),T[e]=0,T[t]=0,T[r]=u>0?1:-1,d.push(T.x,T.y,T.z),p.push(x/f),p.push(1-R/m),w+=1}}for(R=0;R<m;R++)for(x=0;x<f;x++){var L=c+x+b*R,C=c+x+b*(R+1),P=c+(x+1)+b*(R+1),B=c+(x+1)+b*R;s.push(L,C,B),s.push(C,P,B),S+=6}a.addGroup(l,S,v),l+=S,c+=w}h("z","y","x",-1,-1,r,t,e,n,o,0),h("z","y","x",1,-1,r,t,-e,n,o,1),h("x","z","y",1,1,e,r,t,i,n,2),h("x","z","y",1,-1,e,r,-t,i,n,3),h("x","y","z",1,-1,e,t,r,i,o,4),h("x","y","z",-1,-1,e,t,-r,i,o,5),this.setIndex(s),this.setAttribute("position",new j($,3)),this.setAttribute("normal",new j(d,3)),this.setAttribute("uv",new j(p,2))}}function tc(e){var t={};for(var r in e)for(var i in t[r]={},e[r]){var o=e[r][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture)?t[r][i]=o.clone():Array.isArray(o)?t[r][i]=o.slice():t[r][i]=o}return t}function ja(e){for(var t={},r=0;r<e.length;r++){var i=tc(e[r]);for(var o in i)t[o]=i[o]}return t}var Lp="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",Mp="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function T(e){f.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Lp,this.fragmentShader=Mp,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Wa(){b.call(this),this.type="Camera",this.matrixWorldInverse=new da,this.projectionMatrix=new da,this.projectionMatrixInverse=new da}function D(e,t,r,i){Wa.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}T.prototype=Object.create(f.prototype),T.prototype.constructor=T,T.prototype.isShaderMaterial=!0,T.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=tc(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},T.prototype.toJSON=function(e){var t=f.prototype.toJSON.call(this,e);for(var r in t.uniforms={},this.uniforms){var i=this.uniforms[r].value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var o={};for(var n in this.extensions)!0===this.extensions[n]&&(o[n]=!0);return Object.keys(o).length>0&&(t.extensions=o),t},Wa.prototype=Object.assign(Object.create(b.prototype),{constructor:Wa,isCamera:!0,copy:function(e,t){return b.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new aa),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){b.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}}),D.prototype=Object.assign(Object.create(Wa.prototype),{constructor:D,isPerspectiveCamera:!0,copy:function(e,t){return Wa.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*ea.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*ea.DEG2RAD*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*ea.RAD2DEG*Math.atan(Math.tan(.5*ea.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,i,o,n){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=n,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*ea.DEG2RAD*this.fov)/this.zoom,r=2*t,i=this.aspect*r,o=-.5*i,n=this.view;if(null!==this.view&&this.view.enabled){var a=n.fullWidth,s=n.fullHeight;o+=n.offsetX*i/a,t-=n.offsetY*r/s,i*=n.width/a,r*=n.height/s}var $=this.filmOffset;0!==$&&(o+=e*$/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=b.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var uc=90,vc=1;function qd(e,t,r,i){b.call(this),this.type="CubeCamera";var o=new D(uc,vc,e,t);o.up.set(0,-1,0),o.lookAt(new aa(1,0,0)),this.add(o);var n=new D(uc,vc,e,t);n.up.set(0,-1,0),n.lookAt(new aa(-1,0,0)),this.add(n);var a=new D(uc,vc,e,t);a.up.set(0,0,1),a.lookAt(new aa(0,1,0)),this.add(a);var s=new D(uc,vc,e,t);s.up.set(0,0,-1),s.lookAt(new aa(0,-1,0)),this.add(s);var $=new D(uc,vc,e,t);$.up.set(0,-1,0),$.lookAt(new aa(0,0,1)),this.add($);var d=new D(uc,vc,e,t);d.up.set(0,-1,0),d.lookAt(new aa(0,0,-1)),this.add(d),i=i||{format:zb,magFilter:N,minFilter:N},this.renderTarget=new Ib(r,r,i),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=e.getRenderTarget(),i=this.renderTarget,p=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,o),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,a),e.setRenderTarget(i,3),e.render(t,s),e.setRenderTarget(i,4),e.render(t,$),i.texture.generateMipmaps=p,e.setRenderTarget(i,5),e.render(t,d),e.setRenderTarget(r)},this.clear=function(e,t,r,i){for(var o=e.getRenderTarget(),n=this.renderTarget,a=0;a<6;a++)e.setRenderTarget(n,a),e.clear(t,r,i);e.setRenderTarget(o)}}function Ib(e,t,r){Z.call(this,e,t,r)}function wc(e,t,r,i,o,n,a,s,$,d,p,c){m.call(this,null,n,a,s,$,d,i,o,p,c),this.image={data:e||null,width:t||1,height:r||1},this.magFilter=void 0!==$?$:Q,this.minFilter=void 0!==d?d:Q,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}qd.prototype=Object.create(b.prototype),qd.prototype.constructor=qd,Ib.prototype=Object.create(Z.prototype),Ib.prototype.constructor=Ib,Ib.prototype.isWebGLRenderTargetCube=!0,Ib.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var r=new jd,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},o=new T({type:"CubemapFromEquirect",uniforms:tc(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:ga,blending:ad});o.uniforms.tEquirect.value=t;var n=new F(new cf(5,5,5),o);r.add(n);var a=new qd(1,10,1);return a.renderTarget=this,a.renderTarget.texture.name="CubeCameraTexture",a.update(e,r),n.geometry.dispose(),n.material.dispose(),this},wc.prototype=Object.create(m.prototype),wc.prototype.constructor=wc,wc.prototype.isDataTexture=!0;var xc=new ib,df=new aa;function ef(e,t,r,i,o,n){this.planes=[void 0!==e?e:new Ca,void 0!==t?t:new Ca,void 0!==r?r:new Ca,void 0!==i?i:new Ca,void 0!==o?o:new Ca,void 0!==n?n:new Ca]}Object.assign(ef.prototype,{set:function(e,t,r,i,o,n){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(o),a[5].copy(n),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],o=r[1],n=r[2],a=r[3],s=r[4],$=r[5],d=r[6],p=r[7],c=r[8],l=r[9],h=r[10],u=r[11],f=r[12],m=r[13],v=r[14],x=r[15];return t[0].setComponents(a-i,p-s,u-c,x-f).normalize(),t[1].setComponents(a+i,p+s,u+c,x+f).normalize(),t[2].setComponents(a+o,p+$,u+l,x+m).normalize(),t[3].setComponents(a-o,p-$,u-l,x-m).normalize(),t[4].setComponents(a-n,p-d,u-h,x-v).normalize(),t[5].setComponents(a+n,p+d,u+h,x+v).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),xc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(xc)},intersectsSprite:function(e){return xc.center.set(0,0,0),xc.radius=.7071067811865476,xc.applyMatrix4(e.matrixWorld),this.intersectsSphere(xc)},intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,o=0;o<6;o++){if(t[o].distanceToPoint(r)<i)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,r=0;r<6;r++){var i=t[r];if(df.x=i.normal.x>0?e.max.x:e.min.x,df.y=i.normal.y>0?e.max.y:e.min.y,df.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(df)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var Np="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",Op="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Pp="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",Qp="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",Rp="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",Sp="vec3 transformed = vec3( position );",Tp="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",Up="vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",Vp="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",Wp="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",Xp="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",Yp="#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",Zp="#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",$p="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",_p="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",aq="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",bq="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",cq="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",dq="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",eq="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",fq="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",gq="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",hq="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",iq="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",jq="gl_FragColor = linearToOutputTexel( gl_FragColor );",kq="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",lq="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",mq="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",nq="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",oq="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",pq="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",qq="#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",rq="#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",sq="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",tq="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",uq="#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",vq="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",wq="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",xq="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",yq="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",zq="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",Aq="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",Bq="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",Cq="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = clamp( clearcoatRoughness, 0.04, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",Dq="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",Eq="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",Fq="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",Gq="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",Hq="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",Iq="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",Jq="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",Kq="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",Lq="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",Mq="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",Nq="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",Oq="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Pq="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",Qq="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",Rq="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",Sq="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",Tq="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",Uq="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",Vq="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",Wq="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",Xq="#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",Yq="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",Zq="#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",$q="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpack2HalfToRGBA( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",_q="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",ar="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",br="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",cr="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",dr="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",er="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",fr="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpack2HalfToRGBA( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",gr="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",hr="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",ir="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",jr="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",kr="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",lr="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",mr="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",nr="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",or="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",pr="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",qr="#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",rr="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",sr="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",tr="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",ur="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",vr="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",wr="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",xr="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",yr="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",zr="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",Ar="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Br="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",Cr="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",Dr="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",Er="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",Fr="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",Gr="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",Hr="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",Ir="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Jr="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Kr="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Lr="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",Mr="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Nr="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Or="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Pr="#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",Qr="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Rr="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Sr="#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Tr="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Ur="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",Vr="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",Wr="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",Xr="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",Yr="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",Zr="#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",$r="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",_r="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",z={alphamap_fragment:Np,alphamap_pars_fragment:Op,alphatest_fragment:Pp,aomap_fragment:Qp,aomap_pars_fragment:Rp,begin_vertex:Sp,beginnormal_vertex:Tp,bsdfs:Up,bumpmap_pars_fragment:Vp,clipping_planes_fragment:Wp,clipping_planes_pars_fragment:Xp,clipping_planes_pars_vertex:Yp,clipping_planes_vertex:Zp,color_fragment:$p,color_pars_fragment:_p,color_pars_vertex:aq,color_vertex:bq,common:cq,cube_uv_reflection_fragment:dq,defaultnormal_vertex:eq,displacementmap_pars_vertex:fq,displacementmap_vertex:gq,emissivemap_fragment:hq,emissivemap_pars_fragment:iq,encodings_fragment:jq,encodings_pars_fragment:kq,envmap_fragment:lq,envmap_common_pars_fragment:mq,envmap_pars_fragment:nq,envmap_pars_vertex:oq,envmap_physical_pars_fragment:zq,envmap_vertex:pq,fog_vertex:qq,fog_pars_vertex:rq,fog_fragment:sq,fog_pars_fragment:tq,gradientmap_pars_fragment:uq,lightmap_fragment:vq,lightmap_pars_fragment:wq,lights_lambert_vertex:xq,lights_pars_begin:yq,lights_phong_fragment:Aq,lights_phong_pars_fragment:Bq,lights_physical_fragment:Cq,lights_physical_pars_fragment:Dq,lights_fragment_begin:Eq,lights_fragment_maps:Fq,lights_fragment_end:Gq,logdepthbuf_fragment:Hq,logdepthbuf_pars_fragment:Iq,logdepthbuf_pars_vertex:Jq,logdepthbuf_vertex:Kq,map_fragment:Lq,map_pars_fragment:Mq,map_particle_fragment:Nq,map_particle_pars_fragment:Oq,metalnessmap_fragment:Pq,metalnessmap_pars_fragment:Qq,morphnormal_vertex:Rq,morphtarget_pars_vertex:Sq,morphtarget_vertex:Tq,normal_fragment_begin:Uq,normal_fragment_maps:Vq,normalmap_pars_fragment:Wq,clearcoat_normal_fragment_begin:Xq,clearcoat_normal_fragment_maps:Yq,clearcoat_normalmap_pars_fragment:Zq,packing:$q,premultiplied_alpha_fragment:_q,project_vertex:ar,dithering_fragment:br,dithering_pars_fragment:cr,roughnessmap_fragment:dr,roughnessmap_pars_fragment:er,shadowmap_pars_fragment:fr,shadowmap_pars_vertex:gr,shadowmap_vertex:hr,shadowmask_pars_fragment:ir,skinbase_vertex:jr,skinning_pars_vertex:kr,skinning_vertex:lr,skinnormal_vertex:mr,specularmap_fragment:nr,specularmap_pars_fragment:or,tonemapping_fragment:pr,tonemapping_pars_fragment:qr,uv_pars_fragment:rr,uv_pars_vertex:sr,uv_vertex:tr,uv2_pars_fragment:ur,uv2_pars_vertex:vr,uv2_vertex:wr,worldpos_vertex:xr,background_frag:yr,background_vert:zr,cube_frag:Ar,cube_vert:Br,depth_frag:Cr,depth_vert:Dr,distanceRGBA_frag:Er,distanceRGBA_vert:Fr,equirect_frag:Gr,equirect_vert:Hr,linedashed_frag:Ir,linedashed_vert:Jr,meshbasic_frag:Kr,meshbasic_vert:Lr,meshlambert_frag:Mr,meshlambert_vert:Nr,meshmatcap_frag:Or,meshmatcap_vert:Pr,meshphong_frag:Qr,meshphong_vert:Rr,meshphysical_frag:Sr,meshphysical_vert:Tr,normal_frag:Ur,normal_vert:Vr,points_frag:Wr,points_vert:Xr,shadow_frag:Yr,shadow_vert:Zr,sprite_frag:$r,sprite_vert:_r},ca={common:{diffuse:{value:new g(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new L},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ba(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new g(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new g(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new L}},sprite:{diffuse:{value:new g(15658734)},opacity:{value:1},center:{value:new ba(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new L}}},Xa={basic:{uniforms:ja([ca.common,ca.specularmap,ca.envmap,ca.aomap,ca.lightmap,ca.fog]),vertexShader:z.meshbasic_vert,fragmentShader:z.meshbasic_frag},lambert:{uniforms:ja([ca.common,ca.specularmap,ca.envmap,ca.aomap,ca.lightmap,ca.emissivemap,ca.fog,ca.lights,{emissive:{value:new g(0)}}]),vertexShader:z.meshlambert_vert,fragmentShader:z.meshlambert_frag},phong:{uniforms:ja([ca.common,ca.specularmap,ca.envmap,ca.aomap,ca.lightmap,ca.emissivemap,ca.bumpmap,ca.normalmap,ca.displacementmap,ca.gradientmap,ca.fog,ca.lights,{emissive:{value:new g(0)},specular:{value:new g(1118481)},shininess:{value:30}}]),vertexShader:z.meshphong_vert,fragmentShader:z.meshphong_frag},standard:{uniforms:ja([ca.common,ca.envmap,ca.aomap,ca.lightmap,ca.emissivemap,ca.bumpmap,ca.normalmap,ca.displacementmap,ca.roughnessmap,ca.metalnessmap,ca.fog,ca.lights,{emissive:{value:new g(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:z.meshphysical_vert,fragmentShader:z.meshphysical_frag},matcap:{uniforms:ja([ca.common,ca.bumpmap,ca.normalmap,ca.displacementmap,ca.fog,{matcap:{value:null}}]),vertexShader:z.meshmatcap_vert,fragmentShader:z.meshmatcap_frag},points:{uniforms:ja([ca.points,ca.fog]),vertexShader:z.points_vert,fragmentShader:z.points_frag},dashed:{uniforms:ja([ca.common,ca.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:z.linedashed_vert,fragmentShader:z.linedashed_frag},depth:{uniforms:ja([ca.common,ca.displacementmap]),vertexShader:z.depth_vert,fragmentShader:z.depth_frag},normal:{uniforms:ja([ca.common,ca.bumpmap,ca.normalmap,ca.displacementmap,{opacity:{value:1}}]),vertexShader:z.normal_vert,fragmentShader:z.normal_frag},sprite:{uniforms:ja([ca.sprite,ca.fog]),vertexShader:z.sprite_vert,fragmentShader:z.sprite_frag},background:{uniforms:{uvTransform:{value:new L},t2D:{value:null}},vertexShader:z.background_vert,fragmentShader:z.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:z.cube_vert,fragmentShader:z.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:z.equirect_vert,fragmentShader:z.equirect_frag},distanceRGBA:{uniforms:ja([ca.common,ca.displacementmap,{referencePosition:{value:new aa},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:z.distanceRGBA_vert,fragmentShader:z.distanceRGBA_frag},shadow:{uniforms:ja([ca.lights,ca.fog,{color:{value:new g(0)},opacity:{value:1}}]),vertexShader:z.shadow_vert,fragmentShader:z.shadow_frag}};function Dh(){var e=null,t=!1,r=null;function i(o,n){!1!==t&&(r(o,n),e.requestAnimationFrame(i))}return{start:function(){!0!==t&&null!==r&&(e.requestAnimationFrame(i),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function as(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var i=t.get(r);i&&(e.deleteBuffer(i.buffer),t.delete(r))},update:function(r,i){r.isInterleavedBufferAttribute&&(r=r.data);var o=t.get(r);void 0===o?t.set(r,function(t,r){var i=t.array,o=t.usage,n=e.createBuffer();e.bindBuffer(r,n),e.bufferData(r,i,o),t.onUploadCallback();var a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:n,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(r,i)):o.version<r.version&&(function(t,r,i){var o=r.array,n=r.updateRange;e.bindBuffer(i,t),-1===n.count?e.bufferSubData(i,0,o):(e.bufferSubData(i,n.offset*o.BYTES_PER_ELEMENT,o.subarray(n.offset,n.offset+n.count)),n.count=-1)}(o.buffer,r,i),o.version=r.version)}}}function ff(e,t,r,i){w.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new yc(e,t,r,i)),this.mergeVertices()}function yc(e,t,r,i){k.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};var o,n,a=(e=e||1)/2,s=(t=t||1)/2,$=Math.floor(r)||1,d=Math.floor(i)||1,p=$+1,c=d+1,l=e/$,h=t/d,u=[],f=[],m=[],v=[];for(n=0;n<c;n++){var x=n*h-s;for(o=0;o<p;o++){var R=o*l-a;f.push(R,-x,0),m.push(0,0,1),v.push(o/$),v.push(1-n/d)}}for(n=0;n<d;n++)for(o=0;o<$;o++){var g=o+p*n,q=o+p*(n+1),y=o+1+p*(n+1),K=o+1+p*n;u.push(g,q,K),u.push(q,y,K)}this.setIndex(u),this.setAttribute("position",new j(f,3)),this.setAttribute("normal",new j(m,3)),this.setAttribute("uv",new j(v,2))}function bs(e,t,r,i){var o,n,a=new g(0),s=0,$=null,d=0;function p(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,i)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),p(a,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){p(a,s=e)},render:function(t,i,c,l){var h=i.background,u=e.vr,f=u.getSession&&u.getSession();if(f&&"additive"===f.environmentBlendMode&&(h=null),null===h?(p(a,s),$=null,d=0):h&&h.isColor&&(p(h,1),l=!0,$=null,d=0),(e.autoClear||l)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),h&&(h.isCubeTexture||h.isWebGLRenderTargetCube)){void 0===n&&((n=new F(new cf(1,1,1),new T({type:"BackgroundCubeMaterial",uniforms:tc(Xa.cube.uniforms),vertexShader:Xa.cube.vertexShader,fragmentShader:Xa.cube.fragmentShader,side:ga,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),n.geometry.deleteAttribute("uv"),n.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(n.material,"map",{get:function(){return this.uniforms.tCube.value}}),r.update(n));var m=h.isWebGLRenderTargetCube?h.texture:h;n.material.uniforms.tCube.value=m,n.material.uniforms.tFlip.value=h.isWebGLRenderTargetCube?1:-1,$===h&&d===m.version||(n.material.needsUpdate=!0,$=h,d=m.version),t.unshift(n,n.geometry,n.material,0,0,null)}else h&&h.isTexture&&(void 0===o&&((o=new F(new yc(2,2),new T({type:"BackgroundMaterial",uniforms:tc(Xa.background.uniforms),vertexShader:Xa.background.vertexShader,fragmentShader:Xa.background.fragmentShader,side:_c,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=h,!0===h.matrixAutoUpdate&&h.updateMatrix(),o.material.uniforms.uvTransform.value.copy(h.matrix),$===h&&d===h.version||(o.material.needsUpdate=!0,$=h,d=h.version),t.unshift(o,o.geometry,o.material,0,0,null))}}}function cs(e,t,r,i){var o,n=i.isWebGL2;this.setMode=function(e){o=e},this.render=function(t,i){e.drawArrays(o,t,i),r.update(i,o)},this.renderInstances=function(i,a,s,$){if(0!==$){var d,p;if(n)d=e,p="drawArraysInstanced";else if(p="drawArraysInstancedANGLE",null===(d=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[p](o,a,s,$),r.update(s,o,$)}}}function ds(e,t,r){var i;function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var n="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,a=void 0!==r.precision?r.precision:"highp",s=o(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var $=!0===r.logarithmicDepthBuffer,d=e.getParameter(34930),p=e.getParameter(35660),c=e.getParameter(3379),l=e.getParameter(34076),h=e.getParameter(34921),u=e.getParameter(36347),f=e.getParameter(36348),m=e.getParameter(36349),v=p>0,x=n||!!t.get("OES_texture_float");return{isWebGL2:n,getMaxAnisotropy:function(){if(void 0!==i)return i;var r=t.get("EXT_texture_filter_anisotropic");return i=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:o,precision:a,logarithmicDepthBuffer:$,maxTextures:d,maxVertexTextures:p,maxTextureSize:c,maxCubemapSize:l,maxAttributes:h,maxVertexUniforms:u,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:v,floatFragmentTextures:x,floatVertexTextures:v&&x,maxSamples:n?e.getParameter(36183):0}}function es(){var e=this,t=null,r=0,i=!1,o=!1,n=new Ca,a=new L,s={value:null,needsUpdate:!1};function $(){s.value!==t&&(s.value=t,s.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function d(t,r,i,o){var $=null!==t?t.length:0,d=null;if(0!==$){if(d=s.value,!0!==o||null===d){var p=i+4*$,c=r.matrixWorldInverse;a.getNormalMatrix(c),(null===d||d.length<p)&&(d=new Float32Array(p));for(var l=0,h=i;l!==$;++l,h+=4)n.copy(t[l]).applyMatrix4(c,a),n.normal.toArray(d,h),d[h+3]=n.constant}s.value=d,s.needsUpdate=!0}return e.numPlanes=$,d}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,o,n){var a=0!==e.length||o||0!==r||i;return i=o,t=d(e,n,0),r=e.length,a},this.beginShadows=function(){o=!0,d(null)},this.endShadows=function(){o=!1,$()},this.setState=function(e,n,a,p,c,l){if(!i||null===e||0===e.length||o&&!a)o?d(null):$();else{var h=o?0:r,u=4*h,f=c.clippingState||null;s.value=f,f=d(e,p,u,l);for(var m=0;m!==u;++m)f[m]=t[m];c.clippingState=f,this.numIntersection=n?this.numPlanes:0,this.numPlanes+=h}}}function fs(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var i;switch(r){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r);}return null===i&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=i,i}}}function gs(e,t,r){var i=new WeakMap,o=new WeakMap;function n(e){var a=e.target,s=i.get(a);for(var $ in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[$]);a.removeEventListener("dispose",n),i.delete(a);var d=o.get(s);d&&(t.remove(d),o.delete(s)),r.memory.geometries--}function a(e){var r=[],i=e.index,n=e.attributes.position,a=0;if(null!==i){var s=i.array;a=i.version;for(var $=0,d=s.length;$<d;$+=3){var p=s[$+0],c=s[$+1],l=s[$+2];r.push(p,c,c,l,l,p)}}else{s=n.array;a=n.version;for($=0,d=s.length/3-1;$<d;$+=3){p=$+0,c=$+1,l=$+2;r.push(p,c,c,l,l,p)}}var h=new(uk(r)>65535?nd:md)(r,1);h.version=a,t.update(h,34963);var u=o.get(e);u&&t.remove(u),o.set(e,h)}return{get:function(e,t){var o=i.get(t);return o||(t.addEventListener("dispose",n),t.isBufferGeometry?o=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=new k().setFromObject(e)),o=t._bufferGeometry),i.set(t,o),r.memory.geometries++,o)},update:function(e){var r=e.index,i=e.attributes;for(var o in null!==r&&t.update(r,34963),i)t.update(i[o],34962);var n=e.morphAttributes;for(var o in n)for(var a=n[o],s=0,$=a.length;s<$;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var t=o.get(e);if(t){var r=e.index;null!==r&&t.version<r.version&&a(e)}else a(e);return o.get(e)}}}function hs(e,t,r,i){var o,n,a,s=i.isWebGL2;this.setMode=function(e){o=e},this.setIndex=function(e){n=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(o,i,n,t*a),r.update(i,o)},this.renderInstances=function(i,$,d,p){if(0!==p){var c,l;if(s)c=e,l="drawElementsInstanced";else if(l="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[l](o,d,n,$*a,p),r.update(d,o,p)}}}function is(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,r,i){switch(i=i||1,t.calls++,r){case 4:t.triangles+=i*(e/3);break;case 5:case 6:t.triangles+=i*(e-2);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r);}}}}function js(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ks(e){var t={},r=new Float32Array(8);return{update:function(i,o,n,a){var s=i.morphTargetInfluences,$=s.length,d=t[o.id];if(void 0===d){d=[];for(var p=0;p<$;p++)d[p]=[p,0];t[o.id]=d}var c=n.morphTargets&&o.morphAttributes.position,l=n.morphNormals&&o.morphAttributes.normal;for(p=0;p<$;p++)0!==(u=d[p])[1]&&(c&&o.deleteAttribute("morphTarget"+p),l&&o.deleteAttribute("morphNormal"+p));for(p=0;p<$;p++)(u=d[p])[0]=p,u[1]=s[p];d.sort(js);var h=0;for(p=0;p<8;p++){var u;if(u=d[p]){var f=u[0],m=u[1];if(m){c&&o.setAttribute("morphTarget"+p,c[f]),l&&o.setAttribute("morphNormal"+p,l[f]),r[p]=m,h+=m;continue}}r[p]=0}var v=o.morphTargetsRelative?1:1-h;a.getUniforms().setValue(e,"morphTargetBaseInfluence",v),a.getUniforms().setValue(e,"morphTargetInfluences",r)}}}function ls(e,t,r,i){var o={};return{update:function(e){var n=i.render.frame,a=e.geometry,s=t.get(e,a);return o[s.id]!==n&&(a.isGeometry&&s.updateFromObject(e),t.update(s),o[s.id]=n),e.isInstancedMesh&&r.update(e.instanceMatrix,34962),s},dispose:function(){o={}}}}function kb(e,t,r,i,o,n,a,s,$,d){e=void 0!==e?e:[],t=void 0!==t?t:Vg,a=void 0!==a?a:zb,m.call(this,e,t,r,i,o,n,a,s,$,d),this.flipY=!1}function rd(e,t,r,i){m.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:i||1},this.magFilter=Q,this.minFilter=Q,this.wrapR=Y,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function sd(e,t,r,i){m.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:i||1},this.magFilter=Q,this.minFilter=Q,this.wrapR=Y,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Xa.physical={uniforms:ja([Xa.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new g(0)},clearcoatNormalScale:{value:new ba(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:z.meshphysical_vert,fragmentShader:z.meshphysical_frag},ff.prototype=Object.create(w.prototype),ff.prototype.constructor=ff,yc.prototype=Object.create(k.prototype),yc.prototype.constructor=yc,kb.prototype=Object.create(m.prototype),kb.prototype.constructor=kb,kb.prototype.isCubeTexture=!0,Object.defineProperty(kb.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),rd.prototype=Object.create(m.prototype),rd.prototype.constructor=rd,rd.prototype.isDataTexture2DArray=!0,sd.prototype=Object.create(m.prototype),sd.prototype.constructor=sd,sd.prototype.isDataTexture3D=!0;var xk=new m,ms=new rd,ns=new sd,yk=new kb,zk=[],Ak=[],Bk=new Float32Array(16),Ck=new Float32Array(9),Dk=new Float32Array(4);function zc(e,t,r){var i=e[0];if(i<=0||i>0)return e;var o=t*r,n=zk[o];if(void 0===n&&(n=new Float32Array(o),zk[o]=n),0!==t){i.toArray(n,0);for(var a=1,s=0;a!==t;++a)s+=r,e[a].toArray(n,s)}return n}function pa(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function ka(e,t){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]}function Ek(e,t){var r=Ak[t];void 0===r&&(r=new Int32Array(t),Ak[t]=r);for(var i=0;i!==t;++i)r[i]=e.allocateTextureUnit();return r}function os(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function ps(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(pa(r,t))return;e.uniform2fv(this.addr,t),ka(r,t)}}function qs(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(pa(r,t))return;e.uniform3fv(this.addr,t),ka(r,t)}}function rs(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(pa(r,t))return;e.uniform4fv(this.addr,t),ka(r,t)}}function ss(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(pa(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),ka(r,t)}else{if(pa(r,i))return;Dk.set(i),e.uniformMatrix2fv(this.addr,!1,Dk),ka(r,i)}}function ts(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(pa(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),ka(r,t)}else{if(pa(r,i))return;Ck.set(i),e.uniformMatrix3fv(this.addr,!1,Ck),ka(r,i)}}function us(e,t){var r=this.cache,i=t.elements;if(void 0===i){if(pa(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),ka(r,t)}else{if(pa(r,i))return;Bk.set(i),e.uniformMatrix4fv(this.addr,!1,Bk),ka(r,i)}}function vs(e,t,r){var i=this.cache,o=r.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),r.safeSetTexture2D(t||xk,o)}function ws(e,t,r){var i=this.cache,o=r.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),r.setTexture2DArray(t||ms,o)}function xs(e,t,r){var i=this.cache,o=r.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),r.setTexture3D(t||ns,o)}function ys(e,t,r){var i=this.cache,o=r.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),r.safeSetTextureCube(t||yk,o)}function zs(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function As(e,t){var r=this.cache;pa(r,t)||(e.uniform2iv(this.addr,t),ka(r,t))}function Bs(e,t){var r=this.cache;pa(r,t)||(e.uniform3iv(this.addr,t),ka(r,t))}function Cs(e,t){var r=this.cache;pa(r,t)||(e.uniform4iv(this.addr,t),ka(r,t))}function Ds(e){switch(e){case 5126:return os;case 35664:return ps;case 35665:return qs;case 35666:return rs;case 35674:return ss;case 35675:return ts;case 35676:return us;case 35678:case 36198:return vs;case 35679:return xs;case 35680:return ys;case 36289:return ws;case 5124:case 35670:return zs;case 35667:case 35671:return As;case 35668:case 35672:return Bs;case 35669:case 35673:return Cs;}}function Es(e,t){e.uniform1fv(this.addr,t)}function Fs(e,t){e.uniform1iv(this.addr,t)}function Gs(e,t){e.uniform2iv(this.addr,t)}function Hs(e,t){e.uniform3iv(this.addr,t)}function Is(e,t){e.uniform4iv(this.addr,t)}function Js(e,t){var r=zc(t,this.size,2);e.uniform2fv(this.addr,r)}function Ks(e,t){var r=zc(t,this.size,3);e.uniform3fv(this.addr,r)}function Ls(e,t){var r=zc(t,this.size,4);e.uniform4fv(this.addr,r)}function Ms(e,t){var r=zc(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function Ns(e,t){var r=zc(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function Os(e,t){var r=zc(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function Ps(e,t,r){var i=t.length,o=Ek(r,i);e.uniform1iv(this.addr,o);for(var n=0;n!==i;++n)r.safeSetTexture2D(t[n]||xk,o[n])}function Qs(e,t,r){var i=t.length,o=Ek(r,i);e.uniform1iv(this.addr,o);for(var n=0;n!==i;++n)r.safeSetTextureCube(t[n]||yk,o[n])}function Rs(e){switch(e){case 5126:return Es;case 35664:return Js;case 35665:return Ks;case 35666:return Ls;case 35674:return Ms;case 35675:return Ns;case 35676:return Os;case 35678:return Ps;case 35680:return Qs;case 5124:case 35670:return Fs;case 35667:case 35671:return Gs;case 35668:case 35672:return Hs;case 35669:case 35673:return Is;}}function Ss(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=Ds(t.type)}function Fk(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=Rs(t.type)}function Gk(e){this.id=e,this.seq=[],this.map={}}Fk.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),ka(t,e)},Gk.prototype.setValue=function(e,t,r){for(var i=this.seq,o=0,n=i.length;o!==n;++o){var a=i[o];a.setValue(e,t[a.id],r)}};var Eh=/([\w\d_]+)(\])?(\[|\.)?/g;function Hk(e,t){e.seq.push(t),e.map[t.id]=t}function Ts(e,t,r){var i=e.name,o=i.length;for(Eh.lastIndex=0;;){var n=Eh.exec(i),a=Eh.lastIndex,s=n[1],$="]"===n[2],d=n[3];if($&&(s|=0),void 0===d||"["===d&&a+2===o){Hk(r,void 0===d?new Ss(s,e,t):new Fk(s,e,t));break}var p=r.map[s];void 0===p&&Hk(r,p=new Gk(s)),r=p}}function lb(e,t){this.seq=[],this.map={};for(var r=e.getProgramParameter(t,35718),i=0;i<r;++i){var o=e.getActiveUniform(t,i);Ts(o,e.getUniformLocation(t,o.name),this)}}function Ik(e,t,r){var i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}lb.prototype.setValue=function(e,t,r,i){var o=this.map[t];void 0!==o&&o.setValue(e,r,i)},lb.prototype.setOptional=function(e,t,r){var i=t[r];void 0!==i&&this.setValue(e,r,i)},lb.upload=function(e,t,r,i){for(var o=0,n=t.length;o!==n;++o){var a=t[o],s=r[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,i)}},lb.seqWithValue=function(e,t){for(var r=[],i=0,o=e.length;i!==o;++i){var n=e[i];n.id in t&&r.push(n)}return r};var Us=0;function Vs(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}function Jk(e){switch(e){case Ne:return["Linear","( value )"];case op:return["sRGB","( value )"];case pp:return["RGBE","( value )"];case rp:return["RGBM","( value, 7.0 )"];case sp:return["RGBM","( value, 16.0 )"];case tp:return["RGBD","( value, 256.0 )"];case hk:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case qp:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e);}}function Kk(e,t,r){var i=e.getShaderParameter(t,35713),o=e.getShaderInfoLog(t).trim();return i&&""===o?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+o+Vs(e.getShaderSource(t))}function gf(e,t){var r=Jk(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Ws(e,t){var r=Jk(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function Xs(e,t){var r;switch(t){case Wj:r="Linear";break;case Io:r="Reinhard";break;case Jo:r="Uncharted2";break;case Ko:r="OptimizedCineon";break;case Lo:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t);}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function Ys(e,t,r){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(td).join("\n")}function Zs(e){var t=[];for(var r in e){var i=e[r];!1!==i&&t.push("#define "+r+" "+i)}return t.join("\n")}function $s(e,t){for(var r={},i=e.getProgramParameter(t,35721),o=0;o<i;o++){var n=e.getActiveAttrib(t,o).name;r[n]=e.getAttribLocation(t,n)}return r}function td(e){return""!==e}function Lk(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Mk(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var _s=/^[ \t]*#include +<([\w\d./]+)>/gm;function Fh(e){return e.replace(_s,at)}function at(e,t){var r=z[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return Fh(r)}var bt=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function Nk(e){return e.replace(bt,ct)}function ct(e,t,r,i){for(var o="",n=parseInt(t);n<parseInt(r);n++)o+=i.replace(/\[ i \]/g,"[ "+n+" ]").replace(/UNROLLED_LOOP_INDEX/g,n);return o}function Ok(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function dt(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===Oj?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===lo?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===$c&&(t="SHADOWMAP_TYPE_VSM"),t}function et(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Vg:case Wg:t="ENVMAP_TYPE_CUBE";break;case Yg:case Zg:t="ENVMAP_TYPE_CUBE_UV";break;case Xj:case Xg:t="ENVMAP_TYPE_EQUIREC";break;case Yj:t="ENVMAP_TYPE_SPHERE";}return t}function ft(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Wg:case Xg:t="ENVMAP_MODE_REFRACTION";}return t}function gt(e){var t="ENVMAP_BLENDING_MULTIPLY";if(e.envMap)switch(e.combine){case Ce:t="ENVMAP_BLENDING_MULTIPLY";break;case Go:t="ENVMAP_BLENDING_MIX";break;case Ho:t="ENVMAP_BLENDING_ADD";}return t}function ht(e,t,r,i,o,n){var a,s,$=e.getContext(),d=i.defines,p=o.vertexShader,c=o.fragmentShader,l=dt(n),h=et(n),u=ft(n),f=gt(n),m=e.gammaFactor>0?e.gammaFactor:1,v=n.isWebGL2?"":Ys(i.extensions,n,t),x=Zs(d),R=$.createProgram(),g=n.numMultiviewViews;if(i.isRawShaderMaterial?((a=[x].filter(td).join("\n")).length>0&&(a+="\n"),(s=[v,x].filter(td).join("\n")).length>0&&(s+="\n")):(a=[Ok(n),"#define SHADER_NAME "+o.name,x,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&(n.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(td).join("\n"),s=[v,Ok(n),"#define SHADER_NAME "+o.name,x,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+u:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&(n.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensions&&i.extensions.shaderTextureLOD||n.envMap)&&(n.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==De?"#define TONE_MAPPING":"",n.toneMapping!==De?z.tonemapping_pars_fragment:"",n.toneMapping!==De?Xs("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.matcapEncoding||n.envMapEncoding||n.emissiveMapEncoding?z.encodings_pars_fragment:"",n.mapEncoding?gf("mapTexelToLinear",n.mapEncoding):"",n.matcapEncoding?gf("matcapTexelToLinear",n.matcapEncoding):"",n.envMapEncoding?gf("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?gf("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.outputEncoding?Ws("linearToOutputTexel",n.outputEncoding):"",n.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(td).join("\n")),p=Mk(p=Lk(p=Fh(p),n),n),c=Mk(c=Lk(c=Fh(c),n),n),p=Nk(p),c=Nk(c),n.isWebGL2&&!i.isRawShaderMaterial){var q=!1,y=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&null!==p.match(y)&&null!==c.match(y)&&(q=!0,p=p.replace(y,""),c=c.replace(y,"")),a=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+a,s=["#version 300 es\n","#define varying in",q?"":"out highp vec4 pc_fragColor;",q?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s,g>0&&(a=(a=a.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+g+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+g+"];","uniform mat4 projectionMatrices["+g+"];","uniform mat4 viewMatrices["+g+"];","uniform mat3 normalMatrices["+g+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),s=(s=s.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+g+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var K,_,b=s+c,M=Ik($,35633,a+p),w=Ik($,35632,b);if($.attachShader(R,M),$.attachShader(R,w),void 0!==i.index0AttributeName?$.bindAttribLocation(R,0,i.index0AttributeName):!0===n.morphTargets&&$.bindAttribLocation(R,0,"position"),$.linkProgram(R),e.debug.checkShaderErrors){var S=$.getProgramInfoLog(R).trim(),T=$.getShaderInfoLog(M).trim(),E=$.getShaderInfoLog(w).trim(),A=!0,L=!0;if(!1===$.getProgramParameter(R,35714)){A=!1;var C=Kk($,M,"vertex"),P=Kk($,w,"fragment");console.error("THREE.WebGLProgram: shader error: ",$.getError(),"35715",$.getProgramParameter(R,35715),"gl.getProgramInfoLog",S,C,P)}else""!==S?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",S):""!==T&&""!==E||(L=!1);L&&(this.diagnostics={runnable:A,material:i,programLog:S,vertexShader:{log:T,prefix:a},fragmentShader:{log:E,prefix:s}})}return $.deleteShader(M),$.deleteShader(w),this.getUniforms=function(){return void 0===K&&(K=new lb($,R)),K},this.getAttributes=function(){return void 0===_&&(_=$s($,R)),_},this.destroy=function(){$.deleteProgram(R),this.program=void 0},this.name=o.name,this.id=Us++,this.cacheKey=r,this.usedTimes=1,this.program=R,this.vertexShader=M,this.fragmentShader=w,this.numMultiviewViews=g,this}function it(e,t,r){var i=[],o=r.isWebGL2,n=r.logarithmicDepthBuffer,a=r.floatVertexTextures,s=r.precision,$=r.maxVertexUniforms,d=r.vertexTextures,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},c=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function l(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=Ne,r===Ne&&t&&(r=hk),r}this.getParameters=function(t,i,c,h,u,f,m){var v=p[t.type],x=m.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(a)return 1024;var r=$,i=Math.floor((r-20)/4),o=Math.min(i,t.length);return o<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+o+"."),0):o}(m):0;null!==t.precision&&(s=r.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",s,"instead.");var R=e.getRenderTarget(),g=R&&R.isWebGLMultiviewRenderTarget?R.numViews:0;return{isWebGL2:o,shaderID:v,precision:s,instancing:!0===m.isInstancedMesh,supportsVertexTextures:d,numMultiviewViews:g,outputEncoding:l(R?R.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:l(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:l(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:l(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===Yg||t.envMap.mapping===Zg),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:l(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===wp,tangentSpaceNormalMap:t.normalMapType===ed,clearcoatNormalMap:!!t.clearcoatNormalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,sheen:!!t.sheen,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,vertexUvs:!!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||t.displacementMap),uvsVertexOnly:!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||!t.displacementMap),fog:!!h,useFog:t.fog,fogExp2:h&&h.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:n,skinning:t.skinning&&x>0,maxBones:x,useVertexTexture:a,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:i.directional.length,numPointLights:i.point.length,numSpotLights:i.spot.length,numRectAreaLights:i.rectArea.length,numHemiLights:i.hemi.length,numDirLightShadows:i.directionalShadowMap.length,numPointLightShadows:i.pointShadowMap.length,numSpotLightShadows:i.spotShadowMap.length,numClippingPlanes:u,numClipIntersection:f,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:t.toneMapped?e.toneMapping:De,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===Be,flipSided:t.side===ga,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCacheKey=function(t,r){var i=[];if(r.shaderID?i.push(r.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var o in t.defines)i.push(o),i.push(t.defines[o]);for(var n=0;n<c.length;n++)i.push(r[c[n]]);return i.push(t.onBeforeCompile.toString()),i.push(e.gammaOutput),i.push(e.gammaFactor),i.join()},this.acquireProgram=function(r,o,n,a){for(var s,$=0,d=i.length;$<d;$++){var p=i[$];if(p.cacheKey===a){++(s=p).usedTimes;break}}return void 0===s&&(s=new ht(e,t,a,r,o,n),i.push(s)),s},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=i.indexOf(e);i[t]=i[i.length-1],i.pop(),e.destroy()}},this.programs=i}function jt(){var e=new WeakMap;return{get:function(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,i){e.get(t)[r]=i},dispose:function(){e=new WeakMap}}}function kt(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function lt(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Pk(){var e=[],t=0,r=[],i=[],o={id:-1};function n(r,i,n,a,s,$){var d=e[t];return void 0===d?(d={id:r.id,object:r,geometry:i,material:n,program:n.program||o,groupOrder:a,renderOrder:r.renderOrder,z:s,group:$},e[t]=d):(d.id=r.id,d.object=r,d.geometry=i,d.material=n,d.program=n.program||o,d.groupOrder=a,d.renderOrder=r.renderOrder,d.z=s,d.group=$),t++,d}return{opaque:r,transparent:i,init:function(){t=0,r.length=0,i.length=0},push:function(e,t,o,a,s,$){var d=n(e,t,o,a,s,$);(!0===o.transparent?i:r).push(d)},unshift:function(e,t,o,a,s,$){var d=n(e,t,o,a,s,$);(!0===o.transparent?i:r).unshift(d)},sort:function(){r.length>1&&r.sort(kt),i.length>1&&i.sort(lt)}}}function mt(){var e=new WeakMap;function t(r){var i=r.target;i.removeEventListener("dispose",t),e.delete(i)}return{get:function(r,i){var o,n=e.get(r);return void 0===n?(o=new Pk,e.set(r,new WeakMap),e.get(r).set(i,o),r.addEventListener("dispose",t)):void 0===(o=n.get(i))&&(o=new Pk,n.set(i,o)),o},dispose:function(){e=new WeakMap}}}function nt(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new aa,color:new g,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ba};break;case"SpotLight":r={position:new aa,direction:new aa,color:new g,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ba};break;case"PointLight":r={position:new aa,color:new g,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ba,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new aa,skyColor:new g,groundColor:new g};break;case"RectAreaLight":r={color:new g,position:new aa,halfWidth:new aa,halfHeight:new aa};}return e[t.id]=r,r}}}var ot=0;function pt(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function qt(){for(var e=new nt,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},r=0;r<9;r++)t.probe.push(new aa);var i=new aa,o=new da,n=new da;return{setup:function(r,a,s){for(var $=0,d=0,p=0,c=0;c<9;c++)t.probe[c].set(0,0,0);var l=0,h=0,u=0,f=0,m=0,v=0,x=0,R=0,g=s.matrixWorldInverse;r.sort(pt),c=0;for(var q=r.length;c<q;c++){var y=r[c],K=y.color,_=y.intensity,b=y.distance,M=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)$+=K.r*_,d+=K.g*_,p+=K.b*_;else if(y.isLightProbe)for(var w=0;w<9;w++)t.probe[w].addScaledVector(y.sh.coefficients[w],_);else if(y.isDirectionalLight){if((T=e.get(y)).color.copy(y.color).multiplyScalar(y.intensity),T.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(g),T.shadow=y.castShadow,y.castShadow){var S=y.shadow;T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize,t.directionalShadowMap[l]=M,t.directionalShadowMatrix[l]=y.shadow.matrix,v++}t.directional[l]=T,l++}else if(y.isSpotLight)(T=e.get(y)).position.setFromMatrixPosition(y.matrixWorld),T.position.applyMatrix4(g),T.color.copy(K).multiplyScalar(_),T.distance=b,T.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(g),T.coneCos=Math.cos(y.angle),T.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),T.decay=y.decay,T.shadow=y.castShadow,y.castShadow&&(S=y.shadow,T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize,t.spotShadowMap[u]=M,t.spotShadowMatrix[u]=y.shadow.matrix,R++),t.spot[u]=T,u++;else if(y.isRectAreaLight)(T=e.get(y)).color.copy(K).multiplyScalar(_),T.position.setFromMatrixPosition(y.matrixWorld),T.position.applyMatrix4(g),n.identity(),o.copy(y.matrixWorld),o.premultiply(g),n.extractRotation(o),T.halfWidth.set(.5*y.width,0,0),T.halfHeight.set(0,.5*y.height,0),T.halfWidth.applyMatrix4(n),T.halfHeight.applyMatrix4(n),t.rectArea[f]=T,f++;else if(y.isPointLight)(T=e.get(y)).position.setFromMatrixPosition(y.matrixWorld),T.position.applyMatrix4(g),T.color.copy(y.color).multiplyScalar(y.intensity),T.distance=y.distance,T.decay=y.decay,T.shadow=y.castShadow,y.castShadow&&(S=y.shadow,T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize,T.shadowCameraNear=S.camera.near,T.shadowCameraFar=S.camera.far,t.pointShadowMap[h]=M,t.pointShadowMatrix[h]=y.shadow.matrix,x++),t.point[h]=T,h++;else if(y.isHemisphereLight){var T;(T=e.get(y)).direction.setFromMatrixPosition(y.matrixWorld),T.direction.transformDirection(g),T.direction.normalize(),T.skyColor.copy(y.color).multiplyScalar(_),T.groundColor.copy(y.groundColor).multiplyScalar(_),t.hemi[m]=T,m++}}t.ambient[0]=$,t.ambient[1]=d,t.ambient[2]=p;var E=t.hash;E.directionalLength===l&&E.pointLength===h&&E.spotLength===u&&E.rectAreaLength===f&&E.hemiLength===m&&E.numDirectionalShadows===v&&E.numPointShadows===x&&E.numSpotShadows===R||(t.directional.length=l,t.spot.length=u,t.rectArea.length=f,t.point.length=h,t.hemi.length=m,t.directionalShadowMap.length=v,t.pointShadowMap.length=x,t.spotShadowMap.length=R,t.directionalShadowMatrix.length=v,t.pointShadowMatrix.length=x,t.spotShadowMatrix.length=R,E.directionalLength=l,E.pointLength=h,E.spotLength=u,E.rectAreaLength=f,E.hemiLength=m,E.numDirectionalShadows=v,E.numPointShadows=x,E.numSpotShadows=R,t.version=ot++)},state:t}}function Qk(){var e=new qt,t=[],r=[];return{init:function(){t.length=0,r.length=0},state:{lightsArray:t,shadowsArray:r,lights:e},setupLights:function(i){e.setup(t,r,i)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)}}}function rt(){var e=new WeakMap;function t(r){var i=r.target;i.removeEventListener("dispose",t),e.delete(i)}return{get:function(r,i){var o;return!1===e.has(r)?(o=new Qk,e.set(r,new WeakMap),e.get(r).set(i,o),r.addEventListener("dispose",t)):!1===e.get(r).has(i)?(o=new Qk,e.get(r).set(i,o)):o=e.get(r).get(i),o},dispose:function(){e=new WeakMap}}}function Jb(e){f.call(this),this.type="MeshDepthMaterial",this.depthPacking=up,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function Kb(e){f.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new aa,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}Jb.prototype=Object.create(f.prototype),Jb.prototype.constructor=Jb,Jb.prototype.isMeshDepthMaterial=!0,Jb.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Kb.prototype=Object.create(f.prototype),Kb.prototype.constructor=Kb,Kb.prototype.isMeshDistanceMaterial=!0,Kb.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var st="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpack2HalfToRGBA ( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",tt="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function Rk(e,t,r){var i=new ef,o=new ba,n=new ba,a=new fa,s=[],$=[],d={},p={0:ga,1:_c,2:Be},c=new T({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new ba},radius:{value:4}},vertexShader:tt,fragmentShader:st}),l=c.clone();l.defines.HORIZONAL_PASS=1;var h=new k;h.setAttribute("position",new q(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var u=new F(h,c),f=this;function m(r,i){var o=t.update(u);c.uniforms.shadow_pass.value=r.map.texture,c.uniforms.resolution.value=r.mapSize,c.uniforms.radius.value=r.radius,e.setRenderTarget(r.mapPass),e.clear(),e.renderBufferDirect(i,null,o,c,u,null),l.uniforms.shadow_pass.value=r.mapPass.texture,l.uniforms.resolution.value=r.mapSize,l.uniforms.radius.value=r.radius,e.setRenderTarget(r.map),e.clear(),e.renderBufferDirect(i,null,o,l,u,null)}function v(e,t,r){var i=e<<0|t<<1|r<<2,o=s[i];return void 0===o&&(o=new Jb({depthPacking:vp,morphTargets:e,skinning:t}),s[i]=o),o}function x(e,t,r){var i=e<<0|t<<1|r<<2,o=$[i];return void 0===o&&(o=new Kb({morphTargets:e,skinning:t}),$[i]=o),o}function R(t,r,i,o,n,a){var s=t.geometry,$=null,c=v,l=t.customDepthMaterial;if(!0===i.isPointLight&&(c=x,l=t.customDistanceMaterial),void 0===l){var h=!1;!0===r.morphTargets&&(!0===s.isBufferGeometry?h=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:!0===s.isGeometry&&(h=s.morphTargets&&s.morphTargets.length>0));var u=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?u=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),$=c(h,u,!0===t.isInstancedMesh)}else $=l;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var f=$.uuid,m=r.uuid,R=d[f];void 0===R&&(R={},d[f]=R);var g=R[m];void 0===g&&(g=$.clone(),R[m]=g),$=g}return $.visible=r.visible,$.wireframe=r.wireframe,$.side=a===$c?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:p[r.side],$.clipShadows=r.clipShadows,$.clippingPlanes=r.clippingPlanes,$.clipIntersection=r.clipIntersection,$.wireframeLinewidth=r.wireframeLinewidth,$.linewidth=r.linewidth,!0===i.isPointLight&&!0===$.isMeshDistanceMaterial&&($.referencePosition.setFromMatrixPosition(i.matrixWorld),$.nearDistance=o,$.farDistance=n),$}function g(r,o,n,a,s){if(!1!==r.visible){if(r.layers.test(o.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&s===$c)&&(!r.frustumCulled||i.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,r.matrixWorld);var $=t.update(r),d=r.material;if(Array.isArray(d))for(var p=$.groups,c=0,l=p.length;c<l;c++){var h=p[c],u=d[h.materialIndex];if(u&&u.visible){var f=R(r,u,a,n.near,n.far,s);e.renderBufferDirect(n,null,$,f,r,h)}}else if(d.visible){f=R(r,d,a,n.near,n.far,s);e.renderBufferDirect(n,null,$,f,r,null)}}for(var m=r.children,v=0,x=m.length;v<x;v++)g(m[v],o,n,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Oj,this.render=function(t,s,$){if(!1!==f.enabled&&(!1!==f.autoUpdate||!1!==f.needsUpdate)&&0!==t.length){var d=e.getRenderTarget(),p=e.getActiveCubeFace(),c=e.getActiveMipmapLevel(),l=e.state;l.setBlending(ad),l.buffers.color.setClear(1,1,1,1),l.buffers.depth.setTest(!0),l.setScissorTest(!1);for(var h=0,u=t.length;h<u;h++){var v=t[h],x=v.shadow;if(void 0!==x){o.copy(x.mapSize);var R=x.getFrameExtents();if(o.multiply(R),n.copy(x.mapSize),(o.x>r||o.y>r)&&(console.warn("THREE.WebGLShadowMap:",v,"has shadow exceeding max texture size, reducing"),o.x>r&&(n.x=Math.floor(r/R.x),o.x=n.x*R.x,x.mapSize.x=n.x),o.y>r&&(n.y=Math.floor(r/R.y),o.y=n.y*R.y,x.mapSize.y=n.y)),null===x.map&&!x.isPointLightShadow&&this.type===$c){var q={minFilter:N,magFilter:N,format:Qa};x.map=new Z(o.x,o.y,q),x.map.texture.name=v.name+".shadowMap",x.mapPass=new Z(o.x,o.y,q),x.camera.updateProjectionMatrix()}if(null===x.map){q={minFilter:Q,magFilter:Q,format:Qa};x.map=new Z(o.x,o.y,q),x.map.texture.name=v.name+".shadowMap",x.camera.updateProjectionMatrix()}e.setRenderTarget(x.map),e.clear();for(var y=x.getViewportCount(),K=0;K<y;K++){var _=x.getViewport(K);a.set(n.x*_.x,n.y*_.y,n.x*_.z,n.y*_.w),l.viewport(a),x.updateMatrices(v,K),i=x.getFrustum(),g(s,$,x.camera,v,this.type)}x.isPointLightShadow||this.type!==$c||m(x,$)}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}f.needsUpdate=!1,e.setRenderTarget(d,p,c)}}}function ut(e,t,r){var i=r.isWebGL2;var o=new function(){var t=!1,r=new fa,i=null,o=new fa(0,0,0,0);return{setMask:function(r){i===r||t||(e.colorMask(r,r,r,r),i=r)},setLocked:function(e){t=e},setClear:function(t,i,n,a,s){!0===s&&(t*=a,i*=a,n*=a),r.set(t,i,n,a),!1===o.equals(r)&&(e.clearColor(t,i,n,a),o.copy(r))},reset:function(){t=!1,i=null,o.set(-1,0,0,0)}}},n=new function(){var t=!1,r=null,i=null,o=null;return{setTest:function(e){e?O(2929):I(2929)},setMask:function(i){r===i||t||(e.depthMask(i),r=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case zo:e.depthFunc(512);break;case Ao:e.depthFunc(519);break;case Bo:e.depthFunc(513);break;case Tg:e.depthFunc(515);break;case Co:e.depthFunc(514);break;case Do:e.depthFunc(518);break;case Eo:e.depthFunc(516);break;case Fo:e.depthFunc(517);break;default:e.depthFunc(515);}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){o!==t&&(e.clearDepth(t),o=t)},reset:function(){t=!1,r=null,i=null,o=null}}},a=new function(){var t=!1,r=null,i=null,o=null,n=null,a=null,s=null,$=null,d=null;return{setTest:function(e){t||(e?O(2960):I(2960))},setMask:function(i){r===i||t||(e.stencilMask(i),r=i)},setFunc:function(t,r,a){i===t&&o===r&&n===a||(e.stencilFunc(t,r,a),i=t,o=r,n=a)},setOp:function(t,r,i){a===t&&s===r&&$===i||(e.stencilOp(t,r,i),a=t,s=r,$=i)},setLocked:function(e){t=e},setClear:function(t){d!==t&&(e.clearStencil(t),d=t)},reset:function(){t=!1,r=null,i=null,o=null,n=null,a=null,s=null,$=null,d=null}}},s=e.getParameter(34921),$=new Uint8Array(s),d=new Uint8Array(s),p=new Uint8Array(s),c={},l=null,h=null,u=null,f=null,m=null,v=null,x=null,R=null,g=null,q=!1,y=null,K=null,_=null,b=null,M=null,w=e.getParameter(35661),S=!1,T=0,E=e.getParameter(7938);-1!==E.indexOf("WebGL")?(T=parseFloat(/^WebGL\ ([0-9])/.exec(E)[1]),S=T>=1):-1!==E.indexOf("OpenGL ES")&&(T=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(E)[1]),S=T>=2);var A=null,L={},C=new fa,P=new fa;function B(t,r,i){var o=new Uint8Array(4),n=e.createTexture();e.bindTexture(t,n),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<i;a++)e.texImage2D(r+a,0,6408,1,1,0,6408,5121,o);return n}var G={};function D(r,o){($[r]=1,0===d[r]&&(e.enableVertexAttribArray(r),d[r]=1),p[r]!==o)&&((i?e:t.get("ANGLE_instanced_arrays"))[i?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,o),p[r]=o)}function O(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function I(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}G[3553]=B(3553,3553,1),G[34067]=B(34067,34069,6),o.setClear(0,0,0,1),n.setClear(1),a.setClear(0),O(2929),n.setFunc(Tg),z(!1),H(Nj),O(2884),U(ad);var F={[dc]:32774,[oo]:32778,[po]:32779};if(i){}else{var V=t.get("EXT_blend_minmax");null!==V&&V.MAX_EXT}var N={[qo]:0,[ro]:1,[so]:768,[Uj]:770,[yo]:776,[wo]:774,[uo]:772,[to]:769,[Vj]:771,[xo]:775,[vo]:773};function U(t,r,i,o,n,a,s,$){if(t!==ad){if(h||(O(3042),h=!0),t===no)n=n||r,a=a||i,s=s||o,r===f&&n===x||(e.blendEquationSeparate(F[r],F[n]),f=r,x=n),i===m&&o===v&&a===R&&s===g||(e.blendFuncSeparate(N[i],N[o],N[a],N[s]),m=i,v=o,R=a,g=s),u=t,q=null;else if(t!==u||$!==q){if(f===dc&&x===dc||(e.blendEquation(32774),f=dc,x=dc),$)switch(t){case bd:e.blendFuncSeparate(1,771,1,771);break;case Rj:e.blendFunc(1,1);break;case Sj:e.blendFuncSeparate(0,0,769,771);break;case Tj:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);}else switch(t){case bd:e.blendFuncSeparate(770,771,1,771);break;case Rj:e.blendFunc(770,1);break;case Sj:e.blendFunc(0,769);break;case Tj:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);}m=null,v=null,R=null,g=null,u=t,q=$}}else h&&(I(3042),h=!1)}function z(t){y!==t&&(t?e.frontFace(2304):e.frontFace(2305),y=t)}function H(t){t!==jo?(O(2884),t!==K&&(t===Nj?e.cullFace(1029):t===ko?e.cullFace(1028):e.cullFace(1032))):I(2884),K=t}function k(t,r,i){t?(O(32823),b===r&&M===i||(e.polygonOffset(r,i),b=r,M=i)):I(32823)}function j(t){void 0===t&&(t=33984+w-1),A!==t&&(e.activeTexture(t),A=t)}return{buffers:{color:o,depth:n,stencil:a},initAttributes:function(){for(var e=0,t=$.length;e<t;e++)$[e]=0},enableAttribute:function(e){D(e,0)},enableAttributeAndDivisor:D,disableUnusedAttributes:function(){for(var t=0,r=d.length;t!==r;++t)d[t]!==$[t]&&(e.disableVertexAttribArray(t),d[t]=0)},enable:O,disable:I,useProgram:function(t){return l!==t&&(e.useProgram(t),l=t,!0)},setBlending:U,setMaterial:function(e,t){e.side===Be?I(2884):O(2884);var r=e.side===ga;t&&(r=!r),z(r),e.blending===bd&&!1===e.transparent?U(ad):U(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),n.setFunc(e.depthFunc),n.setTest(e.depthTest),n.setMask(e.depthWrite),o.setMask(e.colorWrite);var i=e.stencilWrite;a.setTest(i),i&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),k(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:z,setCullFace:H,setLineWidth:function(t){t!==_&&(S&&e.lineWidth(t),_=t)},setPolygonOffset:k,setScissorTest:function(e){e?O(3089):I(3089)},activeTexture:j,bindTexture:function(t,r){null===A&&j();var i=L[A];void 0===i&&(i={type:void 0,texture:void 0},L[A]=i),i.type===t&&i.texture===r||(e.bindTexture(t,r||G[t]),i.type=t,i.texture=r)},unbindTexture:function(){var t=L[A];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===C.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),C.copy(t))},viewport:function(t){!1===P.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),P.copy(t))},reset:function(){for(var t=0;t<d.length;t++)1===d[t]&&(e.disableVertexAttribArray(t),d[t]=0);c={},A=null,L={},l=null,u=null,y=null,K=null,o.reset(),n.reset(),a.reset()}}}function vt(e,t,r,i,o,n,a){var s,$=o.isWebGL2,d=o.maxTextures,p=o.maxCubemapSize,c=o.maxTextureSize,l=o.maxSamples,h=new WeakMap,u="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d");function f(e,t){return u?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function m(e,t,r,i){var o=1;if((e.width>i||e.height>i)&&(o=i/Math.max(e.width,e.height)),o<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var n=t?ea.floorPowerOfTwo:Math.floor,a=n(o*e.width),$=n(o*e.height);void 0===s&&(s=f(a,$));var d=r?f(a,$):s;return d.width=a,d.height=$,d.getContext("2d").drawImage(e,0,0,a,$),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+$+")."),d}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return ea.isPowerOfTwo(e.width)&&ea.isPowerOfTwo(e.height)}function x(e,t){return e.generateMipmaps&&t&&e.minFilter!==Q&&e.minFilter!==N}function R(t,r,o,n){e.generateMipmap(t),i.get(r).__maxMipLevel=Math.log(Math.max(o,n))*Math.LOG2E}function g(e,r){if(!1===$)return e;var i=e;return 6403===e&&(5126===r&&(i=33326),5131===r&&(i=33325),5121===r&&(i=33321)),6407===e&&(5126===r&&(i=34837),5131===r&&(i=34843),5121===r&&(i=32849)),6408===e&&(5126===r&&(i=34836),5131===r&&(i=34842),5121===r&&(i=32856)),33325===i||33326===i||34842===i||34836===i?t.get("EXT_color_buffer_float"):34843!==i&&34837!==i||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),i}function q(e){return e===Q||e===$g||e===_g?9728:9729}function y(t){var r=t.target;r.removeEventListener("dispose",y),function(t){var r=i.get(t);if(void 0===r.__webglInit)return;e.deleteTexture(r.__webglTexture),i.remove(t)}(r),r.isVideoTexture&&h.delete(r),a.memory.textures--}function K(t){var r=t.target;r.removeEventListener("dispose",K),function(t){var r=i.get(t),o=i.get(t.texture);if(!t)return;void 0!==o.__webglTexture&&e.deleteTexture(o.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var n=0;n<6;n++)e.deleteFramebuffer(r.__webglFramebuffer[n]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[n]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);if(t.isWebGLMultiviewRenderTarget){e.deleteTexture(r.__webglColorTexture),e.deleteTexture(r.__webglDepthStencilTexture),a.memory.textures-=2;for(var n=0,s=r.__webglViewFramebuffers.length;n<s;n++)e.deleteFramebuffer(r.__webglViewFramebuffers[n])}i.remove(t.texture),i.remove(t)}(r),a.memory.textures--}var _=0;function b(e,t){var o=i.get(e);if(e.isVideoTexture&&function(e){var t=a.render.frame;h.get(e)!==t&&(h.set(e,t),e.update())}(e),e.version>0&&o.__version!==e.version){var n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void L(o,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+t),r.bindTexture(3553,o.__webglTexture)}function M(t,o){if(6===t.image.length){var a=i.get(t);if(t.version>0&&a.__version!==t.version){A(a,t),r.activeTexture(33984+o),r.bindTexture(34067,a.__webglTexture),e.pixelStorei(37440,t.flipY);for(var s=t&&t.isCompressedTexture,d=t.image[0]&&t.image[0].isDataTexture,c=[],l=0;l<6;l++)c[l]=s||d?d?t.image[l].image:t.image[l]:m(t.image[l],!1,!0,p);var h,u=c[0],f=v(u)||$,q=n.convert(t.format),y=n.convert(t.type),K=g(q,y);if(E(34067,t,f),s){for(l=0;l<6;l++){h=c[l].mipmaps;for(var _=0;_<h.length;_++){var b=h[_];t.format!==Qa&&t.format!==zb?null!==q?r.compressedTexImage2D(34069+l,_,K,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+l,_,K,b.width,b.height,0,q,y,b.data)}}a.__maxMipLevel=h.length-1}else{h=t.mipmaps;for(l=0;l<6;l++)if(d){r.texImage2D(34069+l,0,K,c[l].width,c[l].height,0,q,y,c[l].data);for(_=0;_<h.length;_++){var M=(b=h[_]).image[l].image;r.texImage2D(34069+l,_+1,K,M.width,M.height,0,q,y,M.data)}}else{r.texImage2D(34069+l,0,K,q,y,c[l]);for(_=0;_<h.length;_++){b=h[_];r.texImage2D(34069+l,_+1,K,q,y,b.image[l])}}a.__maxMipLevel=h.length}x(t,f)&&R(34067,t,u.width,u.height),a.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(33984+o),r.bindTexture(34067,a.__webglTexture)}}function w(e,t){r.activeTexture(33984+t),r.bindTexture(34067,i.get(e).__webglTexture)}var S={[Ee]:10497,[Y]:33071,[Fe]:33648},T={[Q]:9728,[$g]:9984,[_g]:9986,[N]:9729,[Zj]:9985,[Ge]:9987};function E(r,n,a){a?(e.texParameteri(r,10242,S[n.wrapS]),e.texParameteri(r,10243,S[n.wrapT]),32879!==r&&35866!==r||e.texParameteri(r,32882,S[n.wrapR]),e.texParameteri(r,10240,T[n.magFilter]),e.texParameteri(r,10241,T[n.minFilter])):(e.texParameteri(r,10242,33071),e.texParameteri(r,10243,33071),32879!==r&&35866!==r||e.texParameteri(r,32882,33071),n.wrapS===Y&&n.wrapT===Y||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,10240,q(n.magFilter)),e.texParameteri(r,10241,q(n.minFilter)),n.minFilter!==Q&&n.minFilter!==N&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(n.type===cd&&null===t.get("OES_texture_float_linear"))return;if(n.type===bh&&null===($||t.get("OES_texture_half_float_linear")))return;(n.anisotropy>1||i.get(n).__currentAnisotropy)&&(e.texParameterf(r,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n.anisotropy,o.getMaxAnisotropy())),i.get(n).__currentAnisotropy=n.anisotropy)}}function A(t,r){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",y),t.__webglTexture=e.createTexture(),a.memory.textures++)}function L(t,i,o){var a=3553;i.isDataTexture2DArray&&(a=35866),i.isDataTexture3D&&(a=32879),A(t,i),r.activeTexture(33984+o),r.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment);var s=function(e){return!$&&(e.wrapS!==Y||e.wrapT!==Y||e.minFilter!==Q&&e.minFilter!==N)}(i)&&!1===v(i.image),d=m(i.image,s,!1,c),p=v(d)||$,l=n.convert(i.format),h=n.convert(i.type),u=g(l,h);E(a,i,p);var f,q=i.mipmaps;if(i.isDepthTexture){if(u=6402,i.type===cd){if(!1===$)throw new Error("Float Depth Texture only supported in WebGL2.0");u=36012}else $&&(u=33189);i.format===ec&&6402===u&&i.type!==He&&i.type!==$j&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=He,h=n.convert(i.type)),i.format===dd&&(u=34041,i.type!==Ie&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Ie,h=n.convert(i.type))),r.texImage2D(3553,0,u,d.width,d.height,0,l,h,null)}else if(i.isDataTexture){if(q.length>0&&p){for(var y=0,K=q.length;y<K;y++)f=q[y],r.texImage2D(3553,y,u,f.width,f.height,0,l,h,f.data);i.generateMipmaps=!1,t.__maxMipLevel=q.length-1}else r.texImage2D(3553,0,u,d.width,d.height,0,l,h,d.data),t.__maxMipLevel=0;}else if(i.isCompressedTexture){for(y=0,K=q.length;y<K;y++)f=q[y],i.format!==Qa&&i.format!==zb?null!==l?r.compressedTexImage2D(3553,y,u,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,y,u,f.width,f.height,0,l,h,f.data);t.__maxMipLevel=q.length-1}else if(i.isDataTexture2DArray)r.texImage3D(35866,0,u,d.width,d.height,d.depth,0,l,h,d.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)r.texImage3D(32879,0,u,d.width,d.height,d.depth,0,l,h,d.data),t.__maxMipLevel=0;else if(q.length>0&&p){for(y=0,K=q.length;y<K;y++)f=q[y],r.texImage2D(3553,y,u,l,h,f);i.generateMipmaps=!1,t.__maxMipLevel=q.length-1}else r.texImage2D(3553,0,u,l,h,d),t.__maxMipLevel=0;x(i,p)&&R(3553,i,d.width,d.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function C(t,o,a,s){var $=n.convert(o.texture.format),d=n.convert(o.texture.type),p=g($,d);r.texImage2D(s,0,p,o.width,o.height,0,$,d,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,i.get(o.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function P(t,r,i){if(e.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer){if(i){var o=G(r);e.renderbufferStorageMultisample(36161,o,33189,r.width,r.height)}else e.renderbufferStorage(36161,33189,r.width,r.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(r.depthBuffer&&r.stencilBuffer){if(i){o=G(r);e.renderbufferStorageMultisample(36161,o,35056,r.width,r.height)}else e.renderbufferStorage(36161,34041,r.width,r.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var a=g(n.convert(r.texture.format),n.convert(r.texture.type));if(i){o=G(r);e.renderbufferStorageMultisample(36161,o,a,r.width,r.height)}else e.renderbufferStorage(36161,a,r.width,r.height)}e.bindRenderbuffer(36161,null)}function B(t){var r=i.get(t),o=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),b(r.depthTexture,0);var o=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===ec)e.framebufferTexture2D(36160,36096,3553,o,0);else{if(r.depthTexture.format!==dd)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,o,0)}}(r.__webglFramebuffer,t)}else if(o){r.__webglDepthbuffer=[];for(var n=0;n<6;n++)e.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=e.createRenderbuffer(),P(r.__webglDepthbuffer[n],t)}else e.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),P(r.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function G(e){return $&&e.isWebGLMultisampleRenderTarget?Math.min(l,e.samples):0}var D=!1,O=!1;this.allocateTextureUnit=function(){var e=_;return e>=d&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+d),_+=1,e},this.resetTextureUnits=function(){_=0},this.setTexture2D=b,this.setTexture2DArray=function(e,t){var o=i.get(e);e.version>0&&o.__version!==e.version?L(o,e,t):(r.activeTexture(33984+t),r.bindTexture(35866,o.__webglTexture))},this.setTexture3D=function(e,t){var o=i.get(e);e.version>0&&o.__version!==e.version?L(o,e,t):(r.activeTexture(33984+t),r.bindTexture(32879,o.__webglTexture))},this.setTextureCube=M,this.setTextureCubeDynamic=w,this.setupRenderTarget=function(o){var s=i.get(o),d=i.get(o.texture);o.addEventListener("dispose",K),d.__webglTexture=e.createTexture(),a.memory.textures++;var p=!0===o.isWebGLRenderTargetCube,c=!0===o.isWebGLMultisampleRenderTarget,l=!0===o.isWebGLMultiviewRenderTarget,h=v(o)||$;if(p){s.__webglFramebuffer=[];for(var u=0;u<6;u++)s.__webglFramebuffer[u]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),c){if($){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var f=g(n.convert(o.texture.format),n.convert(o.texture.type)),m=G(o);e.renderbufferStorageMultisample(36161,m,f,o.width,o.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),o.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),P(s.__webglDepthRenderbuffer,o,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");}else if(l){var q=o.width,y=o.height,_=o.numViews;e.bindFramebuffer(36160,s.__webglFramebuffer);var b=t.get("OVR_multiview2");a.memory.textures+=2;var M=e.createTexture();e.bindTexture(35866,M),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,q,y,_,0,6408,5121,null),b.framebufferTextureMultiviewOVR(36160,36064,M,0,0,_);var w=e.createTexture();e.bindTexture(35866,w),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,q,y,_,0,34041,34042,null),b.framebufferTextureMultiviewOVR(36160,33306,w,0,0,_);var S=new Array(_);for(u=0;u<_;++u)S[u]=e.createFramebuffer(),e.bindFramebuffer(36160,S[u]),e.framebufferTextureLayer(36160,36064,M,0,u);s.__webglColorTexture=M,s.__webglDepthStencilTexture=w,s.__webglViewFramebuffers=S,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(p){for(r.bindTexture(34067,d.__webglTexture),E(34067,o.texture,h),u=0;u<6;u++)C(s.__webglFramebuffer[u],o,36064,34069+u);x(o.texture,h)&&R(34067,o.texture,o.width,o.height),r.bindTexture(34067,null)}else l||(r.bindTexture(3553,d.__webglTexture),E(3553,o.texture,h),C(s.__webglFramebuffer,o,36064,3553),x(o.texture,h)&&R(3553,o.texture,o.width,o.height),r.bindTexture(3553,null));o.depthBuffer&&B(o)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(x(t,v(e)||$)){var o=e.isWebGLRenderTargetCube?34067:3553,n=i.get(t).__webglTexture;r.bindTexture(o,n),R(o,t,e.width,e.height),r.bindTexture(o,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if($){var r=i.get(t);e.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,r.__webglFramebuffer);var o=t.width,n=t.height,a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,o,n,0,0,o,n,a,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),D=!0),e=e.texture),b(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),O=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?M(e,t):w(e,t)}}function wt(e,t,r){var i=r.isWebGL2;return{convert:function(e){var r;if(e===ah)return 5121;if(e===Po)return 32819;if(e===Qo)return 32820;if(e===Ro)return 33635;if(e===Mo)return 5120;if(e===No)return 5122;if(e===He)return 5123;if(e===Oo)return 5124;if(e===$j)return 5125;if(e===cd)return 5126;if(e===bh)return i?5131:null!==(r=t.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(e===So)return 6406;if(e===zb)return 6407;if(e===Qa)return 6408;if(e===To)return 6409;if(e===Uo)return 6410;if(e===ec)return 6402;if(e===dd)return 34041;if(e===Vo)return 6403;if(e===_j||e===ak||e===bk||e===ck){if(null===(r=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===_j)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===ak)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===bk)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===ck)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===dk||e===ek||e===fk||e===gk){if(null===(r=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===dk)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===ek)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===fk)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===gk)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return e===Wo?null!==(r=t.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null:e===Xo||e===Yo||e===Zo||e===$o||e===_o||e===ap||e===bp||e===cp||e===dp||e===ep||e===fp||e===gp||e===hp||e===ip?null!==(r=t.get("WEBGL_compressed_texture_astc"))?e:null:e===Ie?i?34042:null!==(r=t.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Gh(e,t,r,i){Z.call(this,e,t,i),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=r}function xt(e,t){var r,i,o,n,a,s,$,d=2,p=e.extensions,c=e.properties,l=0;function h(e){return e.isArrayCamera?e.cameras:(a[0]=e,a)}this.isAvailable=function(){if(void 0===$){var e=p.get("OVR_multiview2");if($=null!==e&&!1===t.getContextAttributes().antialias){l=t.getParameter(e.MAX_VIEWS_OVR),r=new Gh(0,0,d),s=new ba,n=[],o=[],a=[];for(var i=0;i<l;i++)n[i]=new da,o[i]=new L}}return $},this.attachCamera=function(t){!1!==function(e){if(void 0===e.isArrayCamera)return!0;var t=e.cameras;if(t.length>l)return!1;for(var r=1,i=t.length;r<i;r++)if(t[0].viewport.z!==t[r].viewport.z||t[0].viewport.w!==t[r].viewport.w)return!1;return!0}(t)&&(i=e.getRenderTarget(),function(t){if(i?s.set(i.width,i.height):e.getDrawingBufferSize(s),t.isArrayCamera){var o=t.cameras[0].viewport;r.setSize(o.z,o.w),r.setNumViews(t.cameras.length)}else r.setSize(s.x,s.y),r.setNumViews(d)}(t),e.setRenderTarget(r))},this.detachCamera=function(o){r===e.getRenderTarget()&&(e.setRenderTarget(i),function(e){var i=r,o=i.numViews,n=c.get(i).__webglViewFramebuffers,a=i.width,$=i.height;if(e.isArrayCamera)for(var d=0;d<o;d++){var p=e.cameras[d].viewport,l=p.x,h=p.y,u=l+p.z,f=h+p.w;t.bindFramebuffer(36008,n[d]),t.blitFramebuffer(0,0,a,$,l,h,u,f,16384,9728)}else t.bindFramebuffer(36008,n[0]),t.blitFramebuffer(0,0,a,$,0,0,s.x,s.y,16384,9728)}(o))},this.updateCameraProjectionMatricesUniform=function(e,r){for(var i=h(e),o=0;o<i.length;o++)n[o].copy(i[o].projectionMatrix);r.setValue(t,"projectionMatrices",n)},this.updateCameraViewMatricesUniform=function(e,r){for(var i=h(e),o=0;o<i.length;o++)n[o].copy(i[o].matrixWorldInverse);r.setValue(t,"viewMatrices",n)},this.updateObjectMatricesUniforms=function(e,r,i){for(var a=h(r),s=0;s<a.length;s++)n[s].multiplyMatrices(a[s].matrixWorldInverse,e.matrixWorld),o[s].getNormalMatrix(n[s]);i.setValue(t,"modelViewMatrices",n),i.setValue(t,"normalMatrices",o)}}function ud(){b.call(this),this.type="Group"}function hf(e){D.call(this),this.cameras=e||[]}Gh.prototype=Object.assign(Object.create(Z.prototype),{constructor:Gh,isWebGLMultiviewRenderTarget:!0,copy:function(e){return Z.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),ud.prototype=Object.assign(Object.create(b.prototype),{constructor:ud,isGroup:!0}),hf.prototype=Object.assign(Object.create(D.prototype),{constructor:hf,isArrayCamera:!0});var vd,Sk=new aa,Tk=new aa;function Uk(e,t,r){Sk.setFromMatrixPosition(t.matrixWorld),Tk.setFromMatrixPosition(r.matrixWorld);var i=Sk.distanceTo(Tk),o=t.projectionMatrix.elements,n=r.projectionMatrix.elements,a=o[14]/(o[10]-1),s=o[14]/(o[10]+1),$=(o[9]+1)/o[5],d=(o[9]-1)/o[5],p=(o[8]-1)/o[0],c=(n[8]+1)/n[0],l=a*p,h=a*c,u=i/(-p+c),f=u*-p;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(u),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var m=a+u,v=s+u,x=l-f,R=h+(i-f),g=$*s/v*m,q=d*s/v*m;e.projectionMatrix.makePerspective(x,R,g,q,m,v)}function Hh(e){var t,r,i=this,o=null,n=null,a=[],s=new da,$=new da,d=1,p="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(n=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",q,!1));var c=new da,l=new S,h=new aa,u=new D,f=new D;f.viewport=new fa,f.layers.enable(1);var m=new D;m.viewport=new fa,m.layers.enable(2);var v=new hf([f,m]);function x(){return null!==o&&!0===o.isPresenting}v.layers.enable(1),v.layers.enable(2);var R,g=new ba;function q(){if(x()){var n=o.getEyeParameters("left");t=2*n.renderWidth*d,r=n.renderHeight*d,R=e.getPixelRatio(),e.getSize(g),e.setDrawingBufferSize(t,r,1),f.viewport.set(0,0,t/2,r),m.viewport.set(t/2,0,t/2,r),M.start(),i.dispatchEvent({type:"sessionstart"})}else i.enabled&&e.setDrawingBufferSize(g.width,g.height,R),M.stop(),i.dispatchEvent({type:"sessionend"})}var y=[],K=[];function _(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),r=0,i=t.length;r<i;r++){var o=t[r];if(o&&("Daydream Controller"===o.id||"Gear VR Controller"===o.id||"Oculus Go Controller"===o.id||"OpenVR Gamepad"===o.id||o.id.startsWith("Oculus Touch")||o.id.startsWith("HTC Vive Focus")||o.id.startsWith("Spatial Controller"))){var n=o.hand;if(0===e&&(""===n||"right"===n))return o;if(1===e&&"left"===n)return o}}}function b(e,i){null!==i&&4===i.length&&e.set(i[0]*t,i[1]*r,i[2]*t,i[3]*r)}this.enabled=!1,this.getController=function(e){var t=a[e];return void 0===t&&((t=new ud).matrixAutoUpdate=!1,t.visible=!1,a[e]=t),t},this.getDevice=function(){return o},this.setDevice=function(e){void 0!==e&&(o=e),M.setContext(e)},this.setFramebufferScaleFactor=function(e){d=e},this.setReferenceSpaceType=function(e){p=e},this.getCamera=function(e){var t="local-floor"===p?1.6:0;if(o.depthNear=e.near,o.depthFar=e.far,o.getFrameData(n),"local-floor"===p){var r=o.stageParameters;r?s.fromArray(r.sittingToStandingTransform):s.makeTranslation(0,t,0)}var i=n.pose;u.matrix.copy(s),u.matrix.decompose(u.position,u.quaternion,u.scale),null!==i.orientation&&(l.fromArray(i.orientation),u.quaternion.multiply(l)),null!==i.position&&(l.setFromRotationMatrix(s),h.fromArray(i.position),h.applyQuaternion(l),u.position.add(h)),u.updateMatrixWorld(),e.matrixWorld.copy(u.matrixWorld);for(var d=e.children,x=0,R=d.length;x<R;x++)d[x].updateMatrixWorld(!0);f.near=e.near,m.near=e.near,f.far=e.far,m.far=e.far,f.matrixWorldInverse.fromArray(n.leftViewMatrix),m.matrixWorldInverse.fromArray(n.rightViewMatrix),$.getInverse(s),"local-floor"===p&&(f.matrixWorldInverse.multiply($),m.matrixWorldInverse.multiply($));var g=e.parent;null!==g&&(c.getInverse(g.matrixWorld),f.matrixWorldInverse.multiply(c),m.matrixWorldInverse.multiply(c)),f.matrixWorld.getInverse(f.matrixWorldInverse),m.matrixWorld.getInverse(m.matrixWorldInverse),f.projectionMatrix.fromArray(n.leftProjectionMatrix),m.projectionMatrix.fromArray(n.rightProjectionMatrix),Uk(v,f,m);var q=o.getLayers();if(q.length){var M=q[0];b(f.viewport,M.leftBounds),b(m.viewport,M.rightBounds)}return function(){for(var e=0;e<a.length;e++){var t=a[e],r=_(e);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;var i=r.pose;!1===i.hasPosition&&t.position.set(.2,-.6,-.05),null!==i.position&&t.position.fromArray(i.position),null!==i.orientation&&t.quaternion.fromArray(i.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(s),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var o="Daydream Controller"===r.id?0:1;void 0===y[e]&&(y[e]=!1),y[e]!==r.buttons[o].pressed&&(y[e]=r.buttons[o].pressed,!0===y[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"}))),o=2,void 0===K[e]&&(K[e]=!1),void 0!==r.buttons[o]&&K[e]!==r.buttons[o].pressed&&(K[e]=r.buttons[o].pressed,!0===K[e]?t.dispatchEvent({type:"squeezestart"}):(t.dispatchEvent({type:"squeezeend"}),t.dispatchEvent({type:"squeeze"})))}else t.visible=!1}}(),v},this.getStandingMatrix=function(){return s},this.isPresenting=x;var M=new Dh;this.setAnimationLoop=function(e){M.setAnimationLoop(e),x()&&M.start()},this.submitFrame=function(){x()&&o.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",q)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function Vk(e,t){var r=this,i=null,o=null,n="local-floor",a=null,s=[],$=[];var d=new D;d.layers.enable(1),d.viewport=new fa;var p=new D;p.layers.enable(2),p.viewport=new fa;var c=new hf([d,p]);function l(e){for(var t=0;t<s.length;t++)$[t]===e.inputSource&&s[t].dispatchEvent({type:e.type})}function h(){e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),R.stop(),r.dispatchEvent({type:"sessionend"})}function u(e){o=e,R.setContext(i),R.start(),r.dispatchEvent({type:"sessionstart"})}function f(){for(var e=0;e<s.length;e++)$[e]=m(e)}function m(e){for(var t=i.inputSources,r=0;r<t.length;r++){var o=t[r],n=o.handedness;if(0===e&&("none"===n||"right"===n))return o;if(1===e&&"left"===n)return o}}function v(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}c.layers.enable(1),c.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new ud).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){n=e},this.getSession=function(){return i},this.setSession=function(e){null!==(i=e)&&(i.addEventListener("select",l),i.addEventListener("selectstart",l),i.addEventListener("selectend",l),i.addEventListener("squeeze",l),i.addEventListener("squeezestart",l),i.addEventListener("squeezeend",l),i.addEventListener("end",h),i.updateRenderState({baseLayer:new XRWebGLLayer(i,t)}),i.requestReferenceSpace(n).then(u),i.addEventListener("inputsourceschange",f),f())},this.getCamera=function(e){var t=e.parent,r=c.cameras;v(c,t);for(var i=0;i<r.length;i++)v(r[i],t);e.matrixWorld.copy(c.matrixWorld);for(var o=e.children,n=(i=0,o.length);i<n;i++)o[i].updateMatrixWorld(!0);return Uk(c,d,p),c},this.isPresenting=function(){return null!==i&&null!==o};var x=null;var R=new Dh;R.setAnimationLoop(function(t,r){if(null!==(a=r.getViewerPose(o))){var n=a.views,d=i.renderState.baseLayer;e.setFramebuffer(d.framebuffer);for(var p=0;p<n.length;p++){var l=n[p],h=d.getViewport(l),u=l.transform.inverse.matrix,f=c.cameras[p];f.matrix.fromArray(u).getInverse(f.matrix),f.projectionMatrix.fromArray(l.projectionMatrix),f.viewport.set(h.x,h.y,h.width,h.height),0===p&&c.matrix.copy(f.matrix)}}for(p=0;p<s.length;p++){var m=s[p],v=$[p];if(v){var R=r.getPose(v.targetRaySpace,o);if(null!==R){m.matrix.fromArray(R.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.visible=!0;continue}}m.visible=!1}x&&x(t)}),this.setAnimationLoop=function(e){x=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new da},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function Ih(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,o=void 0===e.depth||e.depth,n=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,$=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,d=void 0!==e.powerPreference?e.powerPreference:"default",p=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,c=null,l=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=Wj,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var h,u,f,m,v,x,R,g,q,y,K,_,b,M,w,S,T,E,A=this,L=!1,C=null,P=0,B=0,G=null,D=null,O=-1,I={geometry:null,program:null,wireframe:!1},F=null,V=null,N=new fa,U=new fa,z=null,H=t.width,k=t.height,j=1,W=new fa(0,0,H,k),X=new fa(0,0,H,k),Y=!1,Z=new ef,J=new es,Q=!1,ee=!1,te=new da,re=new aa;function ie(){return null===G?j:1}try{var oe={alpha:i,depth:o,stencil:n,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:$,powerPreference:d,failIfMajorPerformanceCaveat:p,xrCompatible:!0};if(t.addEventListener("webglcontextlost",de,!1),t.addEventListener("webglcontextrestored",pe,!1),null===(h=r||t.getContext("webgl",oe)||t.getContext("experimental-webgl",oe)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===h.getShaderPrecisionFormat&&(h.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ye){throw console.error("THREE.WebGLRenderer: "+ye.message),ye}function ne(){u=new fs(h),!1===(f=new ds(h,u,e)).isWebGL2&&(u.get("WEBGL_depth_texture"),u.get("OES_texture_float"),u.get("OES_texture_half_float"),u.get("OES_texture_half_float_linear"),u.get("OES_standard_derivatives"),u.get("OES_element_index_uint"),u.get("ANGLE_instanced_arrays")),u.get("OES_texture_float_linear"),E=new wt(h,u,f),(m=new ut(h,u,f)).scissor(U.copy(X).multiplyScalar(j).floor()),m.viewport(N.copy(W).multiplyScalar(j).floor()),v=new is(h),x=new jt,R=new vt(h,u,m,x,f,E,v),g=new as(h),q=new gs(h,g,v),y=new ls(h,q,g,v),w=new ks(h),K=new it(A,u,f),_=new mt,b=new rt,M=new bs(A,m,y,s),S=new cs(h,u,v,f),T=new hs(h,u,v,f),v.programs=K.programs,A.capabilities=f,A.extensions=u,A.properties=x,A.renderLists=_,A.state=m,A.info=v}ne();var ae="undefined"!=typeof navigator&&"xr"in navigator?new Vk(A,h):new Hh(A);this.vr=ae;var se=new xt(A,h),$e=new Rk(A,y,f.maxTextureSize);function de(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),L=!0}function pe(){console.log("THREE.WebGLRenderer: Context Restored."),L=!1,ne()}function ce(e){var t=e.target;t.removeEventListener("dispose",ce),function(e){le(e),x.remove(e)}(t)}function le(e){var t=x.get(e).program;e.program=void 0,void 0!==t&&K.releaseProgram(t)}this.shadowMap=$e,this.getContext=function(){return h},this.getContextAttributes=function(){return h.getContextAttributes()},this.forceContextLoss=function(){var e=u.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=u.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return j},this.setPixelRatio=function(e){void 0!==e&&(j=e,this.setSize(H,k,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new ba),e.set(H,k)},this.setSize=function(e,r,i){ae.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(H=e,k=r,t.width=Math.floor(e*j),t.height=Math.floor(r*j),!1!==i&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new ba),e.set(H*j,k*j).floor()},this.setDrawingBufferSize=function(e,r,i){H=e,k=r,j=i,t.width=Math.floor(e*i),t.height=Math.floor(r*i),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new fa),e.copy(N)},this.getViewport=function(e){return e.copy(W)},this.setViewport=function(e,t,r,i){e.isVector4?W.set(e.x,e.y,e.z,e.w):W.set(e,t,r,i),m.viewport(N.copy(W).multiplyScalar(j).floor())},this.getScissor=function(e){return e.copy(X)},this.setScissor=function(e,t,r,i){e.isVector4?X.set(e.x,e.y,e.z,e.w):X.set(e,t,r,i),m.scissor(U.copy(X).multiplyScalar(j).floor())},this.getScissorTest=function(){return Y},this.setScissorTest=function(e){m.setScissorTest(Y=e)},this.getClearColor=function(){return M.getClearColor()},this.setClearColor=function(){M.setClearColor.apply(M,arguments)},this.getClearAlpha=function(){return M.getClearAlpha()},this.setClearAlpha=function(){M.setClearAlpha.apply(M,arguments)},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===r||r)&&(i|=1024),h.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",de,!1),t.removeEventListener("webglcontextrestored",pe,!1),_.dispose(),b.dispose(),x.dispose(),y.dispose(),ae.dispose(),ue.stop()},this.renderBufferImmediate=function(e,t){m.initAttributes();var r=x.get(e);e.hasPositions&&!r.position&&(r.position=h.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=h.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=h.createBuffer()),e.hasColors&&!r.color&&(r.color=h.createBuffer());var i=t.getAttributes();e.hasPositions&&(h.bindBuffer(34962,r.position),h.bufferData(34962,e.positionArray,35048),m.enableAttribute(i.position),h.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(h.bindBuffer(34962,r.normal),h.bufferData(34962,e.normalArray,35048),m.enableAttribute(i.normal),h.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(h.bindBuffer(34962,r.uv),h.bufferData(34962,e.uvArray,35048),m.enableAttribute(i.uv),h.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(h.bindBuffer(34962,r.color),h.bufferData(34962,e.colorArray,35048),m.enableAttribute(i.color),h.vertexAttribPointer(i.color,3,5126,!1,0,0)),m.disableUnusedAttributes(),h.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,o,n){var a=o.isMesh&&o.matrixWorld.determinant()<0;m.setMaterial(i,a);var s=xe(e,t,i,o),$=!1;I.geometry===r.id&&I.program===s.id&&I.wireframe===(!0===i.wireframe)||(I.geometry=r.id,I.program=s.id,I.wireframe=!0===i.wireframe,$=!0),o.morphTargetInfluences&&(w.update(o,r,i,s),$=!0);var d=r.index,p=r.attributes.position;if((null===d||0!==d.count)&&void 0!==p&&0!==p.count){var c,l=1;!0===i.wireframe&&(d=q.getWireframeAttribute(r),l=2);var v=S;null!==d&&(c=g.get(d),(v=T).setIndex(c)),$&&(!function(e,t,r,i){if(!1===f.isWebGL2&&(e.isInstancedMesh||t.isInstancedBufferGeometry)&&null===u.get("ANGLE_instanced_arrays"))return;m.initAttributes();var o=t.attributes,n=i.getAttributes(),a=r.defaultAttributeValues;for(var s in n){var $=n[s];if($>=0){var d=o[s];if(void 0!==d){var p=d.normalized,c=d.itemSize,l=g.get(d);if(void 0===l)continue;var v=l.buffer,x=l.type,R=l.bytesPerElement;if(d.isInterleavedBufferAttribute){var q=d.data,y=q.stride,K=d.offset;q&&q.isInstancedInterleavedBuffer?(m.enableAttributeAndDivisor($,q.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=q.meshPerAttribute*q.count)):m.enableAttribute($),h.bindBuffer(34962,v),h.vertexAttribPointer($,c,x,p,y*R,K*R)}else d.isInstancedBufferAttribute?(m.enableAttributeAndDivisor($,d.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=d.meshPerAttribute*d.count)):m.enableAttribute($),h.bindBuffer(34962,v),h.vertexAttribPointer($,c,x,p,0,0)}else if("instanceMatrix"===s){var l=g.get(e.instanceMatrix);if(void 0===l)continue;var v=l.buffer,x=l.type;m.enableAttributeAndDivisor($+0,1),m.enableAttributeAndDivisor($+1,1),m.enableAttributeAndDivisor($+2,1),m.enableAttributeAndDivisor($+3,1),h.bindBuffer(34962,v),h.vertexAttribPointer($+0,4,x,!1,64,0),h.vertexAttribPointer($+1,4,x,!1,64,16),h.vertexAttribPointer($+2,4,x,!1,64,32),h.vertexAttribPointer($+3,4,x,!1,64,48)}else if(void 0!==a){var _=a[s];if(void 0!==_)switch(_.length){case 2:h.vertexAttrib2fv($,_);break;case 3:h.vertexAttrib3fv($,_);break;case 4:h.vertexAttrib4fv($,_);break;default:h.vertexAttrib1fv($,_);}}}}m.disableUnusedAttributes()}(o,r,i,s),null!==d&&h.bindBuffer(34963,c.buffer));var x=1/0;null!==d?x=d.count:void 0!==p&&(x=p.count);var R=r.drawRange.start*l,y=r.drawRange.count*l,K=null!==n?n.start*l:0,_=null!==n?n.count*l:1/0,b=Math.max(R,K),M=Math.min(x,R+y,K+_)-1,E=Math.max(0,M-b+1);if(0!==E){if(o.isMesh){if(!0===i.wireframe)m.setLineWidth(i.wireframeLinewidth*ie()),v.setMode(1);else switch(o.drawMode){case Me:v.setMode(4);break;case mp:v.setMode(5);break;case np:v.setMode(6);}}else if(o.isLine){var A=i.linewidth;void 0===A&&(A=1),m.setLineWidth(A*ie()),o.isLineSegments?v.setMode(1):o.isLineLoop?v.setMode(2):v.setMode(3)}else o.isPoints?v.setMode(0):o.isSprite&&v.setMode(4);o.isInstancedMesh?v.renderInstances(r,b,E,o.count):r.isInstancedBufferGeometry?v.renderInstances(r,b,E,r.maxInstancedCount):v.render(b,E)}}},this.compile=function(e,t){(l=b.get(e,t)).init(),e.traverse(function(e){e.isLight&&(l.pushLight(e),e.castShadow&&l.pushShadow(e))}),l.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)ve(t.material[r],e.fog,t);else ve(t.material,e.fog,t)})};var he=null;var ue=new Dh;function fe(e,t,r,i){for(var o=0,n=e.length;o<n;o++){var a=e[o],s=a.object,$=a.geometry,d=void 0===i?a.material:i,p=a.group;if(r.isArrayCamera){if(V=r,ae.enabled&&se.isAvailable())me(s,t,r,$,d,p);else for(var c=r.cameras,h=0,u=c.length;h<u;h++){var f=c[h];s.layers.test(f.layers)&&(m.viewport(N.copy(f.viewport)),l.setupLights(f),me(s,t,f,$,d,p))}}else V=null,me(s,t,r,$,d,p)}}function me(e,t,r,i,o,n){if(e.onBeforeRender(A,t,r,i,o,n),l=b.get(t,V||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){m.setMaterial(o);var a=xe(r,t.fog,o,e);I.geometry=null,I.program=null,I.wireframe=!1,function(e,t){e.render(function(e){A.renderBufferImmediate(e,t)})}(e,a)}else A.renderBufferDirect(r,t.fog,i,o,e,n);e.onAfterRender(A,t,r,i,o,n),l=b.get(t,V||r)}function ve(e,t,r){var i=x.get(e),o=l.state.lights,n=l.state.shadowsArray,a=o.state.version,s=K.getParameters(e,o.state,n,t,J.numPlanes,J.numIntersection,r),$=K.getProgramCacheKey(e,s),d=i.program,p=!0;if(void 0===d)e.addEventListener("dispose",ce);else if(d.cacheKey!==$)le(e);else if(i.lightsStateVersion!==a)i.lightsStateVersion=a,p=!1;else{if(void 0!==s.shaderID)return;p=!1}if(p){if(s.shaderID){var c=Xa[s.shaderID];i.shader={name:e.type,uniforms:tc(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else i.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(i.shader,A),$=K.getProgramCacheKey(e,s),d=K.acquireProgram(e,i.shader,s,$),i.program=d,e.program=d}var h=d.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var u=0;u<A.maxMorphTargets;u++)h["morphTarget"+u]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(u=0;u<A.maxMorphNormals;u++)h["morphNormal"+u]>=0&&e.numSupportedMorphNormals++}var f=i.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(i.numClippingPlanes=J.numPlanes,i.numIntersection=J.numIntersection,f.clippingPlanes=J.uniform),i.fog=t,i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(f.ambientLightColor.value=o.state.ambient,f.lightProbe.value=o.state.probe,f.directionalLights.value=o.state.directional,f.spotLights.value=o.state.spot,f.rectAreaLights.value=o.state.rectArea,f.pointLights.value=o.state.point,f.hemisphereLights.value=o.state.hemi,f.directionalShadowMap.value=o.state.directionalShadowMap,f.directionalShadowMatrix.value=o.state.directionalShadowMatrix,f.spotShadowMap.value=o.state.spotShadowMap,f.spotShadowMatrix.value=o.state.spotShadowMatrix,f.pointShadowMap.value=o.state.pointShadowMap,f.pointShadowMatrix.value=o.state.pointShadowMatrix);var m=i.program.getUniforms(),v=lb.seqWithValue(m.seq,f);i.uniformsList=v}function xe(e,t,r,i){R.resetTextureUnits();var o=x.get(r),n=l.state.lights;if(Q&&(ee||e!==F)){var a=e===F&&r.id===O;J.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,o,a)}r.version===o.__version&&(void 0===o.program?r.needsUpdate=!0:r.fog&&o.fog!==t?r.needsUpdate=!0:o.needsLights&&o.lightsStateVersion!==n.state.version?r.needsUpdate=!0:void 0===o.numClippingPlanes||o.numClippingPlanes===J.numPlanes&&o.numIntersection===J.numIntersection||(r.needsUpdate=!0)),r.version!==o.__version&&(ve(r,t,i),o.__version=r.version);var s,$,d=!1,p=!1,c=!1,u=o.program,v=u.getUniforms(),g=o.shader.uniforms;if(m.useProgram(u.program)&&(d=!0,p=!0,c=!0),r.id!==O&&(O=r.id,p=!0),d||F!==e){if(u.numMultiviewViews>0?se.updateCameraProjectionMatricesUniform(e,v):v.setValue(h,"projectionMatrix",e.projectionMatrix),f.logarithmicDepthBuffer&&v.setValue(h,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),F!==e&&(F=e,p=!0,c=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var q=v.map.cameraPosition;void 0!==q&&q.setValue(h,re.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&v.setValue(h,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&(u.numMultiviewViews>0?se.updateCameraViewMatricesUniform(e,v):v.setValue(h,"viewMatrix",e.matrixWorldInverse))}if(r.skinning){v.setOptional(h,i,"bindMatrix"),v.setOptional(h,i,"bindMatrixInverse");var y=i.skeleton;if(y){var K=y.bones;if(f.floatVertexTextures){if(void 0===y.boneTexture){var _=Math.sqrt(4*K.length);_=ea.ceilPowerOfTwo(_),_=Math.max(_,4);var b=new Float32Array(_*_*4);b.set(y.boneMatrices);var M=new wc(b,_,_,Qa,cd);y.boneMatrices=b,y.boneTexture=M,y.boneTextureSize=_}v.setValue(h,"boneTexture",y.boneTexture,R),v.setValue(h,"boneTextureSize",y.boneTextureSize)}else v.setOptional(h,y,"boneMatrices")}}return(p||o.receiveShadow!==i.receiveShadow)&&(o.receiveShadow=i.receiveShadow,v.setValue(h,"receiveShadow",i.receiveShadow)),p&&(v.setValue(h,"toneMappingExposure",A.toneMappingExposure),v.setValue(h,"toneMappingWhitePoint",A.toneMappingWhitePoint),o.needsLights&&($=c,(s=g).ambientLightColor.needsUpdate=$,s.lightProbe.needsUpdate=$,s.directionalLights.needsUpdate=$,s.pointLights.needsUpdate=$,s.spotLights.needsUpdate=$,s.rectAreaLights.needsUpdate=$,s.hemisphereLights.needsUpdate=$),t&&r.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(g,t),r.isMeshBasicMaterial?Re(g,r):r.isMeshLambertMaterial?(Re(g,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(g,r)):r.isMeshPhongMaterial?(Re(g,r),r.isMeshToonMaterial?function(e,t){ge(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(g,r):ge(g,r)):r.isMeshStandardMaterial?(Re(g,r),r.isMeshPhysicalMaterial?function(e,t){qe(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===ga&&e.clearcoatNormalScale.value.negate());e.transparency.value=t.transparency}(g,r):qe(g,r)):r.isMeshMatcapMaterial?(Re(g,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===ga&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===ga&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(g,r)):r.isMeshDepthMaterial?(Re(g,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(g,r)):r.isMeshDistanceMaterial?(Re(g,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(g,r)):r.isMeshNormalMaterial?(Re(g,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===ga&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===ga&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(g,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(g,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(g,r)):r.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*j,e.scale.value=.5*k,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(g,r):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(g,r):r.isShadowMaterial&&(g.color.value.copy(r.color),g.opacity.value=r.opacity),void 0!==g.ltc_1&&(g.ltc_1.value=ca.LTC_1),void 0!==g.ltc_2&&(g.ltc_2.value=ca.LTC_2),lb.upload(h,o.uniformsList,g,R),r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(lb.upload(h,o.uniformsList,g,R),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&v.setValue(h,"center",i.center),u.numMultiviewViews>0?se.updateObjectMatricesUniforms(i,e,v):(v.setValue(h,"modelViewMatrix",i.modelViewMatrix),v.setValue(h,"normalMatrix",i.normalMatrix)),v.setValue(h,"modelMatrix",i.matrixWorld),u}function Re(e,t){var r;e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=x.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function ge(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===ga&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===ga&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function qe(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===ga&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===ga&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}ue.setAnimationLoop(function(e){ae.isPresenting()||he&&he(e)}),"undefined"!=typeof window&&ue.setContext(window),this.setAnimationLoop=function(e){he=e,ae.setAnimationLoop(e),ue.start()},this.render=function(e,t){var r,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),t&&t.isCamera){if(!L){I.geometry=null,I.program=null,I.wireframe=!1,O=-1,F=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ae.enabled&&ae.isPresenting()&&(t=ae.getCamera(t)),(l=b.get(e,t)).init(),e.onBeforeRender(A,e,t,r||G),te.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Z.setFromMatrix(te),ee=this.localClippingEnabled,Q=J.init(this.clippingPlanes,ee,t),(c=_.get(e,t)).init(),function e(t,r,i,o){if(!1===t.visible)return;var n=t.layers.test(r.layers);if(n)if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(r);else if(t.isLight)l.pushLight(t),t.castShadow&&l.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||Z.intersectsSprite(t)){o&&re.setFromMatrixPosition(t.matrixWorld).applyMatrix4(te);var a=y.update(t),s=t.material;s.visible&&c.push(t,a,s,i,re.z,null)}}else if(t.isImmediateRenderObject)o&&re.setFromMatrixPosition(t.matrixWorld).applyMatrix4(te),c.push(t,null,t.material,i,re.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==v.render.frame&&(t.skeleton.update(),t.skeleton.frame=v.render.frame),!t.frustumCulled||Z.intersectsObject(t))){o&&re.setFromMatrixPosition(t.matrixWorld).applyMatrix4(te);var a=y.update(t),s=t.material;if(Array.isArray(s))for(var $=a.groups,d=0,p=$.length;d<p;d++){var h=$[d],u=s[h.materialIndex];u&&u.visible&&c.push(t,a,u,i,re.z,h)}else s.visible&&c.push(t,a,s,i,re.z,null)}var f=t.children;for(var d=0,p=f.length;d<p;d++)e(f[d],r,i,o)}(e,t,0,A.sortObjects),!0===A.sortObjects&&c.sort(),Q&&J.beginShadows();var o=l.state.shadowsArray;$e.render(o,e,t),l.setupLights(t),Q&&J.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),ae.enabled&&se.isAvailable()&&se.attachCamera(t),M.render(c,e,t,i);var n=c.opaque,a=c.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;n.length&&fe(n,e,t,s),a.length&&fe(a,e,t,s)}else n.length&&fe(n,e,t),a.length&&fe(a,e,t);e.onAfterRender(A,e,t),null!==G&&(R.updateRenderTargetMipmap(G),R.updateMultisampleRenderTarget(G)),m.buffers.depth.setTest(!0),m.buffers.depth.setMask(!0),m.buffers.color.setMask(!0),m.setPolygonOffset(!1),ae.enabled&&(se.isAvailable()&&se.detachCamera(t),ae.submitFrame()),c=null,l=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){C!==e&&null===G&&h.bindFramebuffer(36160,e),C=e},this.getActiveCubeFace=function(){return P},this.getActiveMipmapLevel=function(){return B},this.getRenderTarget=function(){return G},this.setRenderTarget=function(e,t,r){G=e,P=t,B=r,e&&void 0===x.get(e).__webglFramebuffer&&R.setupRenderTarget(e);var i=C,o=!1;if(e){var n=x.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(i=n[t||0],o=!0):i=e.isWebGLMultisampleRenderTarget?x.get(e).__webglMultisampledFramebuffer:n,N.copy(e.viewport),U.copy(e.scissor),z=e.scissorTest}else N.copy(W).multiplyScalar(j).floor(),U.copy(X).multiplyScalar(j).floor(),z=Y;if(D!==i&&(h.bindFramebuffer(36160,i),D=i),m.viewport(N),m.scissor(U),m.setScissorTest(z),o){var a=x.get(e.texture);h.framebufferTexture2D(36160,36064,34069+(t||0),a.__webglTexture,r||0)}},this.readRenderTargetPixels=function(e,t,r,i,o,n,a){if(e&&e.isWebGLRenderTarget){var s=x.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==a&&(s=s[a]),s){var $=!1;s!==D&&(h.bindFramebuffer(36160,s),$=!0);try{var d=e.texture,p=d.format,c=d.type;if(p!==Qa&&E.convert(p)!==h.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===ah||E.convert(c)===h.getParameter(35738)||c===cd&&(f.isWebGL2||u.get("OES_texture_float")||u.get("WEBGL_color_buffer_float"))||c===bh&&(f.isWebGL2?u.get("EXT_color_buffer_float"):u.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===h.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&r>=0&&r<=e.height-o&&h.readPixels(t,r,i,o,E.convert(p),E.convert(c),n):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{$&&h.bindFramebuffer(36160,D)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){void 0===r&&(r=0);var i=Math.pow(2,-r),o=Math.floor(t.image.width*i),n=Math.floor(t.image.height*i),a=E.convert(t.format);R.setTexture2D(t,0),h.copyTexImage2D(3553,r,a,e.x,e.y,o,n,0),m.unbindTexture()},this.copyTextureToTexture=function(e,t,r,i){var o=t.image.width,n=t.image.height,a=E.convert(r.format),s=E.convert(r.type);R.setTexture2D(r,0),t.isDataTexture?h.texSubImage2D(3553,i||0,e.x,e.y,o,n,a,s,t.image.data):h.texSubImage2D(3553,i||0,e.x,e.y,a,s,t.image),m.unbindTexture()},this.initTexture=function(e){R.setTexture2D(e,0),m.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Jh(e,t){this.name="",this.color=new g(e),this.density=void 0!==t?t:25e-5}function Kh(e,t,r){this.name="",this.color=new g(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function mb(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Oe,this.updateRange={offset:0,count:-1},this.version=0}function jf(e,t,r,i){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===i}function Lb(e){f.call(this),this.type="SpriteMaterial",this.color=new g(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.assign(Hh.prototype,Aa.prototype),Object.assign(Vk.prototype,Aa.prototype),Object.assign(Jh.prototype,{isFogExp2:!0,clone:function(){return new Jh(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Kh.prototype,{isFog:!0,clone:function(){return new Kh(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(mb.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(mb.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var i=0,o=this.stride;i<o;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(jf.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(jf.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this},setXYZW:function(e,t,r,i,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=o,this}}),Lb.prototype=Object.create(f.prototype),Lb.prototype.constructor=Lb,Lb.prototype.isSpriteMaterial=!0,Lb.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var wd=new aa,Ac=new aa,Bc=new aa,Cc=new ba,xd=new ba,Wk=new da,kf=new aa,yd=new aa,lf=new aa,Xk=new ba,Lh=new ba,Yk=new ba;function Mh(e){if(b.call(this),this.type="Sprite",void 0===vd){vd=new k;var t=new mb(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);vd.setIndex([0,1,2,0,2,3]),vd.setAttribute("position",new jf(t,3,0,!1)),vd.setAttribute("uv",new jf(t,2,3,!1))}this.geometry=vd,this.material=void 0!==e?e:new Lb,this.center=new ba(.5,.5)}function mf(e,t,r,i,o,n){Cc.subVectors(e,r).addScalar(.5).multiply(i),void 0!==o?(xd.x=n*Cc.x-o*Cc.y,xd.y=o*Cc.x+n*Cc.y):xd.copy(Cc),e.copy(t),e.x+=xd.x,e.y+=xd.y,e.applyMatrix4(Wk)}Mh.prototype=Object.assign(Object.create(b.prototype),{constructor:Mh,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error("THREE.Sprite: \"Raycaster.camera\" needs to be set in order to raycast against sprites."),Ac.setFromMatrixScale(this.matrixWorld),Wk.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Bc.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ac.multiplyScalar(-Bc.z);var r,i,o=this.material.rotation;0!==o&&(i=Math.cos(o),r=Math.sin(o));var n=this.center;mf(kf.set(-.5,-.5,0),Bc,n,Ac,r,i),mf(yd.set(.5,-.5,0),Bc,n,Ac,r,i),mf(lf.set(.5,.5,0),Bc,n,Ac,r,i),Xk.set(0,0),Lh.set(1,0),Yk.set(1,1);var a=e.ray.intersectTriangle(kf,yd,lf,!1,wd);if(null!==a||(mf(yd.set(-.5,.5,0),Bc,n,Ac,r,i),Lh.set(0,1),null!==(a=e.ray.intersectTriangle(kf,lf,yd,!1,wd)))){var s=e.ray.origin.distanceTo(wd);s<e.near||s>e.far||t.push({distance:s,point:wd.clone(),uv:O.getUV(wd,kf,yd,lf,Xk,Lh,Yk,new ba),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return b.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var nf=new aa,Zk=new aa;function of(){b.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function pf(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),F.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new da,this.bindMatrixInverse=new da}of.prototype=Object.assign(Object.create(b.prototype),{constructor:of,isLOD:!0,copy:function(e){b.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,i=t.length;r<i;r++){var o=t[r];this.addLevel(o.object.clone(),o.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var r=1,i=t.length;r<i&&!(e<t[r].distance);r++);return t[r-1].object}return null},raycast:function(e,t){if(this.levels.length>0){nf.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(nf);this.getObjectForDistance(r).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){nf.setFromMatrixPosition(e.matrixWorld),Zk.setFromMatrixPosition(this.matrixWorld);var r=nf.distanceTo(Zk);t[0].object.visible=!0;for(var i=1,o=t.length;i<o&&r>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(;i<o;i++)t[i].object.visible=!1}},toJSON:function(e){var t=b.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var r=this.levels,i=0,o=r.length;i<o;i++){var n=r[i];t.object.levels.push({object:n.object.uuid,distance:n.distance})}return t}}),pf.prototype=Object.assign(Object.create(F.prototype),{constructor:pf,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new fa,t=this.geometry.attributes.skinWeight,r=0,i=t.count;r<i;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){F.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var $k=new da,yt=new da;function Nh(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new da)}}function _k(){b.call(this),this.type="Bone"}Object.assign(Nh.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new da;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,i=this.boneTexture,o=0,n=e.length;o<n;o++){var a=e[o]?e[o].matrixWorld:yt;$k.multiplyMatrices(a,t[o]),$k.toArray(r,16*o)}void 0!==i&&(i.needsUpdate=!0)},clone:function(){return new Nh(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var i=this.bones[t];if(i.name===e)return i}}}),_k.prototype=Object.assign(Object.create(b.prototype),{constructor:_k,isBone:!0});var al=new da,bl=new da,Dc=[],zd=new F;function Oh(e,t,r){F.call(this,e,t),this.instanceMatrix=new q(new Float32Array(16*r),16),this.count=r}function y(e){f.call(this),this.type="LineBasicMaterial",this.color=new g(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}Oh.prototype=Object.assign(Object.create(F.prototype),{constructor:Oh,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var r=this.matrixWorld,i=this.count;if(zd.geometry=this.geometry,zd.material=this.material,void 0!==zd.material)for(var o=0;o<i;o++)this.getMatrixAt(o,al),bl.multiplyMatrices(r,al),zd.matrixWorld=bl,zd.raycast(e,Dc),Dc.length>0&&(Dc[0].instanceId=o,Dc[0].object=this,t.push(Dc[0]),Dc.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),y.prototype=Object.create(f.prototype),y.prototype.constructor=y,y.prototype.isLineBasicMaterial=!0,y.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var cl=new aa,dl=new aa,el=new da,qf=new mc,rf=new ib;function P(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),b.call(this),this.type="Line",this.geometry=void 0!==e?e:new k,this.material=void 0!==t?t:new y({color:16777215*Math.random()})}P.prototype=Object.assign(Object.create(b.prototype),{constructor:P,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry){if(null===e.index){for(var t=e.attributes.position,r=[0],i=1,o=t.count;i<o;i++)cl.fromBufferAttribute(t,i-1),dl.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=cl.distanceTo(dl);e.setAttribute("lineDistance",new j(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");}else if(e.isGeometry){var n=e.vertices;(r=e.lineDistances)[0]=0;for(i=1,o=n.length;i<o;i++)r[i]=r[i-1],r[i]+=n[i-1].distanceTo(n[i])}return this},raycast:function(e,t){var r=e.linePrecision,i=this.geometry,o=this.matrixWorld;if(null===i.boundingSphere&&i.computeBoundingSphere(),rf.copy(i.boundingSphere),rf.applyMatrix4(o),rf.radius+=r,!1!==e.ray.intersectsSphere(rf)){el.getInverse(o),qf.copy(e.ray).applyMatrix4(el);var n=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=n*n,s=new aa,$=new aa,d=new aa,p=new aa,c=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var l=i.index,h=i.attributes.position.array;if(null!==l)for(var u=l.array,f=0,m=u.length-1;f<m;f+=c){var v=u[f],x=u[f+1];if(s.fromArray(h,3*v),$.fromArray(h,3*x),!(qf.distanceSqToSegment(s,$,p,d)>a))p.applyMatrix4(this.matrixWorld),(q=e.ray.origin.distanceTo(p))<e.near||q>e.far||t.push({distance:q,point:d.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this})}else for(f=0,m=h.length/3-1;f<m;f+=c){if(s.fromArray(h,3*f),$.fromArray(h,3*f+3),!(qf.distanceSqToSegment(s,$,p,d)>a))p.applyMatrix4(this.matrixWorld),(q=e.ray.origin.distanceTo(p))<e.near||q>e.far||t.push({distance:q,point:d.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this})}}else if(i.isGeometry){var R=i.vertices,g=R.length;for(f=0;f<g-1;f+=c){var q;if(!(qf.distanceSqToSegment(R[f],R[f+1],p,d)>a))p.applyMatrix4(this.matrixWorld),(q=e.ray.origin.distanceTo(p))<e.near||q>e.far||t.push({distance:q,point:d.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var sf=new aa,tf=new aa;function A(e,t){P.call(this,e,t),this.type="LineSegments"}function Ph(e,t){P.call(this,e,t),this.type="LineLoop"}function nb(e){f.call(this),this.type="PointsMaterial",this.color=new g(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}A.prototype=Object.assign(Object.create(P.prototype),{constructor:A,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry){if(null===e.index){for(var t=e.attributes.position,r=[],i=0,o=t.count;i<o;i+=2)sf.fromBufferAttribute(t,i),tf.fromBufferAttribute(t,i+1),r[i]=0===i?0:r[i-1],r[i+1]=r[i]+sf.distanceTo(tf);e.setAttribute("lineDistance",new j(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");}else if(e.isGeometry){var n=e.vertices;for(r=e.lineDistances,i=0,o=n.length;i<o;i+=2)sf.copy(n[i]),tf.copy(n[i+1]),r[i]=0===i?0:r[i-1],r[i+1]=r[i]+sf.distanceTo(tf)}return this}}),Ph.prototype=Object.assign(Object.create(P.prototype),{constructor:Ph,isLineLoop:!0}),nb.prototype=Object.create(f.prototype),nb.prototype.constructor=nb,nb.prototype.isPointsMaterial=!0,nb.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var fl=new da,Qh=new mc,uf=new ib,vf=new aa;function wf(e,t){b.call(this),this.type="Points",this.geometry=void 0!==e?e:new k,this.material=void 0!==t?t:new nb({color:16777215*Math.random()}),this.updateMorphTargets()}function Rh(e,t,r,i,o,n,a){var s=Qh.distanceSqToPoint(e);if(s<r){var $=new aa;Qh.closestPointToPoint(e,$),$.applyMatrix4(i);var d=o.ray.origin.distanceTo($);if(d<o.near||d>o.far)return;n.push({distance:d,distanceToRay:Math.sqrt(s),point:$,index:t,face:null,object:a})}}function gl(e,t,r,i,o,n,a,s,$){m.call(this,e,t,r,i,o,n,a,s,$),this.format=void 0!==a?a:zb,this.minFilter=void 0!==n?n:N,this.magFilter=void 0!==o?o:N,this.generateMipmaps=!1}function Ad(e,t,r,i,o,n,a,s,$,d,p,c){m.call(this,null,n,a,s,$,d,i,o,p,c),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function xf(e,t,r,i,o,n,a,s,$){m.call(this,e,t,r,i,o,n,a,s,$),this.needsUpdate=!0}function yf(e,t,r,i,o,n,a,s,$,d){if((d=void 0!==d?d:ec)!==ec&&d!==dd)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&d===ec&&(r=He),void 0===r&&d===dd&&(r=Ie),m.call(this,null,i,o,n,a,s,d,r,$),this.image={width:e,height:t},this.magFilter=void 0!==a?a:Q,this.minFilter=void 0!==s?s:Q,this.flipY=!1,this.generateMipmaps=!1}function zf(e){k.call(this),this.type="WireframeGeometry";var t,r,i,o,n,a,s,$,d,p,c=[],l=[0,0],h={},u=["a","b","c"];if(e&&e.isGeometry){var f=e.faces;for(t=0,i=f.length;t<i;t++){var m=f[t];for(r=0;r<3;r++)s=m[u[r]],$=m[u[(r+1)%3]],l[0]=Math.min(s,$),l[1]=Math.max(s,$),void 0===h[d=l[0]+","+l[1]]&&(h[d]={index1:l[0],index2:l[1]})}for(d in h)a=h[d],p=e.vertices[a.index1],c.push(p.x,p.y,p.z),p=e.vertices[a.index2],c.push(p.x,p.y,p.z)}else if(e&&e.isBufferGeometry){var v,x,R,g,q,y,K;if(p=new aa,null!==e.index){for(v=e.attributes.position,x=e.index,0===(R=e.groups).length&&(R=[{start:0,count:x.count,materialIndex:0}]),o=0,n=R.length;o<n;++o)for(t=q=(g=R[o]).start,i=q+g.count;t<i;t+=3)for(r=0;r<3;r++)s=x.getX(t+r),$=x.getX(t+(r+1)%3),l[0]=Math.min(s,$),l[1]=Math.max(s,$),void 0===h[d=l[0]+","+l[1]]&&(h[d]={index1:l[0],index2:l[1]});for(d in h)a=h[d],p.fromBufferAttribute(v,a.index1),c.push(p.x,p.y,p.z),p.fromBufferAttribute(v,a.index2),c.push(p.x,p.y,p.z)}else for(t=0,i=(v=e.attributes.position).count/3;t<i;t++)for(r=0;r<3;r++)y=3*t+r,p.fromBufferAttribute(v,y),c.push(p.x,p.y,p.z),K=3*t+(r+1)%3,p.fromBufferAttribute(v,K),c.push(p.x,p.y,p.z)}this.setAttribute("position",new j(c,3))}function Af(e,t,r){w.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new Bd(e,t,r)),this.mergeVertices()}function Bd(e,t,r){k.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var i,o,n=[],a=[],s=[],$=[],d=new aa,p=new aa,c=new aa,l=new aa,h=new aa;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var u=t+1;for(i=0;i<=r;i++){var f=i/r;for(o=0;o<=t;o++){var m=o/t;e(m,f,p),a.push(p.x,p.y,p.z),m-1e-5>=0?(e(m-1e-5,f,c),l.subVectors(p,c)):(e(m+1e-5,f,c),l.subVectors(c,p)),f-1e-5>=0?(e(m,f-1e-5,c),h.subVectors(p,c)):(e(m,f+1e-5,c),h.subVectors(c,p)),d.crossVectors(l,h).normalize(),s.push(d.x,d.y,d.z),$.push(m,f)}}for(i=0;i<r;i++)for(o=0;o<t;o++){var v=i*u+o,x=i*u+o+1,R=(i+1)*u+o+1,g=(i+1)*u+o;n.push(v,x,g),n.push(x,R,g)}this.setIndex(n),this.setAttribute("position",new j(a,3)),this.setAttribute("normal",new j(s,3)),this.setAttribute("uv",new j($,2))}function Bf(e,t,r,i){w.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},this.fromBufferGeometry(new la(e,t,r,i)),this.mergeVertices()}function la(e,t,r,i){k.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},r=r||1;var o=[],n=[];function a(e,t,r,i){var o,n,a=Math.pow(2,i),$=[];for(o=0;o<=a;o++){$[o]=[];var d=e.clone().lerp(r,o/a),p=t.clone().lerp(r,o/a),c=a-o;for(n=0;n<=c;n++)$[o][n]=0===n&&o===a?d:d.clone().lerp(p,n/c)}for(o=0;o<a;o++)for(n=0;n<2*(a-o)-1;n++){var l=Math.floor(n/2);n%2==0?(s($[o][l+1]),s($[o+1][l]),s($[o][l])):(s($[o][l+1]),s($[o+1][l+1]),s($[o+1][l]))}}function s(e){o.push(e.x,e.y,e.z)}function $(t,r){var i=3*t;r.x=e[i+0],r.y=e[i+1],r.z=e[i+2]}function d(e,t,r,i){i<0&&1===e.x&&(n[t]=e.x-1),0===r.x&&0===r.z&&(n[t]=i/2/Math.PI+.5)}function p(e){return Math.atan2(e.z,-e.x)}!function(e){for(var r=new aa,i=new aa,o=new aa,n=0;n<t.length;n+=3)$(t[n+0],r),$(t[n+1],i),$(t[n+2],o),a(r,i,o,e)}(i=i||0),function(e){for(var t=new aa,r=0;r<o.length;r+=3)t.x=o[r+0],t.y=o[r+1],t.z=o[r+2],t.normalize().multiplyScalar(e),o[r+0]=t.x,o[r+1]=t.y,o[r+2]=t.z}(r),function(){for(var e=new aa,t=0;t<o.length;t+=3){e.x=o[t+0],e.y=o[t+1],e.z=o[t+2];var r=p(e)/2/Math.PI+.5,i=(a=e,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);n.push(r,1-i)}var a;(function(){for(var e=new aa,t=new aa,r=new aa,i=new aa,a=new ba,s=new ba,$=new ba,c=0,l=0;c<o.length;c+=9,l+=6){e.set(o[c+0],o[c+1],o[c+2]),t.set(o[c+3],o[c+4],o[c+5]),r.set(o[c+6],o[c+7],o[c+8]),a.set(n[l+0],n[l+1]),s.set(n[l+2],n[l+3]),$.set(n[l+4],n[l+5]),i.copy(e).add(t).add(r).divideScalar(3);var h=p(i);d(a,l+0,e,h),d(s,l+2,t,h),d($,l+4,r,h)}})(),function(){for(var e=0;e<n.length;e+=6){var t=n[e+0],r=n[e+2],i=n[e+4],o=Math.max(t,r,i),a=Math.min(t,r,i);o>.9&&a<.1&&(t<.2&&(n[e+0]+=1),r<.2&&(n[e+2]+=1),i<.2&&(n[e+4]+=1))}}()}(),this.setAttribute("position",new j(o,3)),this.setAttribute("normal",new j(o.slice(),3)),this.setAttribute("uv",new j(n,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function Cf(e,t){w.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Cd(e,t)),this.mergeVertices()}function Cd(e,t){la.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Df(e,t){w.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ec(e,t)),this.mergeVertices()}function Ec(e,t){la.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ef(e,t){w.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Dd(e,t)),this.mergeVertices()}function Dd(e,t){var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];la.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ff(e,t){w.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ed(e,t)),this.mergeVertices()}function Ed(e,t){var r=(1+Math.sqrt(5))/2,i=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i];la.call(this,o,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Gf(e,t,r,i,o,n){w.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:o},void 0!==n&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new Fc(e,t,r,i,o);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function Fc(e,t,r,i,o){k.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:o},t=t||64,r=r||1,i=i||8,o=o||!1;var n=e.computeFrenetFrames(t,o);this.tangents=n.tangents,this.normals=n.normals,this.binormals=n.binormals;var a,s,$=new aa,d=new aa,p=new ba,c=new aa,l=[],h=[],u=[],f=[];function m(o){c=e.getPointAt(o/t,c);var a=n.normals[o],p=n.binormals[o];for(s=0;s<=i;s++){var u=s/i*Math.PI*2,f=Math.sin(u),m=-Math.cos(u);d.x=m*a.x+f*p.x,d.y=m*a.y+f*p.y,d.z=m*a.z+f*p.z,d.normalize(),h.push(d.x,d.y,d.z),$.x=c.x+r*d.x,$.y=c.y+r*d.y,$.z=c.z+r*d.z,l.push($.x,$.y,$.z)}}!function(){for(a=0;a<t;a++)m(a);m(!1===o?t:0),function(){for(a=0;a<=t;a++)for(s=0;s<=i;s++)p.x=a/t,p.y=s/i,u.push(p.x,p.y)}(),function(){for(s=1;s<=t;s++)for(a=1;a<=i;a++){var e=(i+1)*(s-1)+(a-1),r=(i+1)*s+(a-1),o=(i+1)*s+a,n=(i+1)*(s-1)+a;f.push(e,r,n),f.push(r,o,n)}}()}(),this.setIndex(f),this.setAttribute("position",new j(l,3)),this.setAttribute("normal",new j(h,3)),this.setAttribute("uv",new j(u,2))}function Hf(e,t,r,i,o,n,a){w.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:o,q:n},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Fd(e,t,r,i,o,n)),this.mergeVertices()}function Fd(e,t,r,i,o,n){k.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:o,q:n},e=e||1,t=t||.4,r=Math.floor(r)||64,i=Math.floor(i)||8,o=o||2,n=n||3;var a,s,$=[],d=[],p=[],c=[],l=new aa,h=new aa,u=new aa,f=new aa,m=new aa,v=new aa,x=new aa;for(a=0;a<=r;++a){var R=a/r*o*Math.PI*2;for(w(R,o,n,e,u),w(R+.01,o,n,e,f),v.subVectors(f,u),x.addVectors(f,u),m.crossVectors(v,x),x.crossVectors(m,v),m.normalize(),x.normalize(),s=0;s<=i;++s){var g=s/i*Math.PI*2,q=-t*Math.cos(g),y=t*Math.sin(g);l.x=u.x+(q*x.x+y*m.x),l.y=u.y+(q*x.y+y*m.y),l.z=u.z+(q*x.z+y*m.z),d.push(l.x,l.y,l.z),h.subVectors(l,u).normalize(),p.push(h.x,h.y,h.z),c.push(a/r),c.push(s/i)}}for(s=1;s<=r;s++)for(a=1;a<=i;a++){var K=(i+1)*(s-1)+(a-1),_=(i+1)*s+(a-1),b=(i+1)*s+a,M=(i+1)*(s-1)+a;$.push(K,_,M),$.push(_,b,M)}function w(e,t,r,i,o){var n=Math.cos(e),a=Math.sin(e),s=r/t*e,$=Math.cos(s);o.x=i*(2+$)*.5*n,o.y=i*(2+$)*a*.5,o.z=i*Math.sin(s)*.5}this.setIndex($),this.setAttribute("position",new j(d,3)),this.setAttribute("normal",new j(p,3)),this.setAttribute("uv",new j(c,2))}function If(e,t,r,i,o){w.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:o},this.fromBufferGeometry(new Gd(e,t,r,i,o)),this.mergeVertices()}function Gd(e,t,r,i,o){k.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:o},e=e||1,t=t||.4,r=Math.floor(r)||8,i=Math.floor(i)||6,o=o||2*Math.PI;var n,a,s=[],$=[],d=[],p=[],c=new aa,l=new aa,h=new aa;for(n=0;n<=r;n++)for(a=0;a<=i;a++){var u=a/i*o,f=n/r*Math.PI*2;l.x=(e+t*Math.cos(f))*Math.cos(u),l.y=(e+t*Math.cos(f))*Math.sin(u),l.z=t*Math.sin(f),$.push(l.x,l.y,l.z),c.x=e*Math.cos(u),c.y=e*Math.sin(u),h.subVectors(l,c).normalize(),d.push(h.x,h.y,h.z),p.push(a/i),p.push(n/r)}for(n=1;n<=r;n++)for(a=1;a<=i;a++){var m=(i+1)*n+a-1,v=(i+1)*(n-1)+a-1,x=(i+1)*(n-1)+a,R=(i+1)*n+a;s.push(m,v,R),s.push(v,x,R)}this.setIndex(s),this.setAttribute("position",new j($,3)),this.setAttribute("normal",new j(d,3)),this.setAttribute("uv",new j(p,2))}wf.prototype=Object.assign(Object.create(b.prototype),{constructor:wf,isPoints:!0,raycast:function(e,t){var r=this.geometry,i=this.matrixWorld,o=e.params.Points.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),uf.copy(r.boundingSphere),uf.applyMatrix4(i),uf.radius+=o,!1!==e.ray.intersectsSphere(uf)){fl.getInverse(i),Qh.copy(e.ray).applyMatrix4(fl);var n=o/((this.scale.x+this.scale.y+this.scale.z)/3),a=n*n;if(r.isBufferGeometry){var s=r.index,$=r.attributes.position.array;if(null!==s)for(var d=s.array,p=0,c=d.length;p<c;p++){var l=d[p];vf.fromArray($,3*l),Rh(vf,l,a,i,e,t,this)}else{p=0;for(var h=$.length/3;p<h;p++)vf.fromArray($,3*p),Rh(vf,p,a,i,e,t,this)}}else{var u=r.vertices;for(p=0,h=u.length;p<h;p++)Rh(u[p],p,a,i,e,t,this)}}},updateMorphTargets:function(){var e,t,r,i=this.geometry;if(i.isBufferGeometry){var o=i.morphAttributes,n=Object.keys(o);if(n.length>0){var a=o[n[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)r=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=i.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),gl.prototype=Object.assign(Object.create(m.prototype),{constructor:gl,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Ad.prototype=Object.create(m.prototype),Ad.prototype.constructor=Ad,Ad.prototype.isCompressedTexture=!0,xf.prototype=Object.create(m.prototype),xf.prototype.constructor=xf,xf.prototype.isCanvasTexture=!0,yf.prototype=Object.create(m.prototype),yf.prototype.constructor=yf,yf.prototype.isDepthTexture=!0,zf.prototype=Object.create(k.prototype),zf.prototype.constructor=zf,Af.prototype=Object.create(w.prototype),Af.prototype.constructor=Af,Bd.prototype=Object.create(k.prototype),Bd.prototype.constructor=Bd,Bf.prototype=Object.create(w.prototype),Bf.prototype.constructor=Bf,la.prototype=Object.create(k.prototype),la.prototype.constructor=la,Cf.prototype=Object.create(w.prototype),Cf.prototype.constructor=Cf,Cd.prototype=Object.create(la.prototype),Cd.prototype.constructor=Cd,Df.prototype=Object.create(w.prototype),Df.prototype.constructor=Df,Ec.prototype=Object.create(la.prototype),Ec.prototype.constructor=Ec,Ef.prototype=Object.create(w.prototype),Ef.prototype.constructor=Ef,Dd.prototype=Object.create(la.prototype),Dd.prototype.constructor=Dd,Ff.prototype=Object.create(w.prototype),Ff.prototype.constructor=Ff,Ed.prototype=Object.create(la.prototype),Ed.prototype.constructor=Ed,Gf.prototype=Object.create(w.prototype),Gf.prototype.constructor=Gf,Fc.prototype=Object.create(k.prototype),Fc.prototype.constructor=Fc,Fc.prototype.toJSON=function(){var e=k.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},Hf.prototype=Object.create(w.prototype),Hf.prototype.constructor=Hf,Fd.prototype=Object.create(k.prototype),Fd.prototype.constructor=Fd,If.prototype=Object.create(w.prototype),If.prototype.constructor=If,Gd.prototype=Object.create(k.prototype),Gd.prototype.constructor=Gd;var zt={triangulate:function(e,t,r){r=r||2;var i,o,n,a,s,$,d,p=t&&t.length,c=p?t[0]*r:e.length,l=hl(e,0,c,r,!0),h=[];if(!l||l.next===l.prev)return h;if(p&&(l=Et(e,t,l,r)),e.length>80*r){i=n=e[0],o=a=e[1];for(var u=r;u<c;u+=r)(s=e[u])<i&&(i=s),($=e[u+1])<o&&(o=$),s>n&&(n=s),$>a&&(a=$);d=0!==(d=Math.max(n-i,a-o))?1/d:0}return Id(l,h,r,i,o,d),h}};function hl(e,t,r,i,o){var n,a;if(o===Ot(e,t,r,i)>0)for(n=t;n<r;n+=i)a=kl(n,e[n],e[n+1],a);else for(n=r-i;n>=t;n-=i)a=kl(n,e[n],e[n+1],a);return a&&Mb(a,a.next)&&(Kd(a),a=a.next),a}function Hd(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!Mb(i,i.next)&&0!==M(i.prev,i,i.next))i=i.next;else{if(Kd(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function Id(e,t,r,i,o,n,a){if(e){!a&&n&&It(e,i,o,n);for(var s,$,d=e;e.prev!==e.next;)if(s=e.prev,$=e.next,n?Bt(e,i,o,n):At(e))t.push(s.i/r),t.push(e.i/r),t.push($.i/r),Kd(e),e=$.next,d=$.next;else if((e=$)===d){a?1===a?Id(e=Ct(e,t,r),t,r,i,o,n,2):2===a&&Dt(e,t,r,i,o,n):Id(Hd(e),t,r,i,o,n,1);break}}}function At(e){var t=e.prev,r=e,i=e.next;if(M(t,r,i)>=0)return!1;for(var o=e.next.next;o!==e.prev;){if(Gc(t.x,t.y,r.x,r.y,i.x,i.y,o.x,o.y)&&M(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function Bt(e,t,r,i){var o=e.prev,n=e,a=e.next;if(M(o,n,a)>=0)return!1;for(var s=o.x<n.x?o.x<a.x?o.x:a.x:n.x<a.x?n.x:a.x,$=o.y<n.y?o.y<a.y?o.y:a.y:n.y<a.y?n.y:a.y,d=o.x>n.x?o.x>a.x?o.x:a.x:n.x>a.x?n.x:a.x,p=o.y>n.y?o.y>a.y?o.y:a.y:n.y>a.y?n.y:a.y,c=Sh(s,$,t,r,i),l=Sh(d,p,t,r,i),h=e.prevZ,u=e.nextZ;h&&h.z>=c&&u&&u.z<=l;){if(h!==e.prev&&h!==e.next&&Gc(o.x,o.y,n.x,n.y,a.x,a.y,h.x,h.y)&&M(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,u!==e.prev&&u!==e.next&&Gc(o.x,o.y,n.x,n.y,a.x,a.y,u.x,u.y)&&M(u.prev,u,u.next)>=0)return!1;u=u.nextZ}for(;h&&h.z>=c;){if(h!==e.prev&&h!==e.next&&Gc(o.x,o.y,n.x,n.y,a.x,a.y,h.x,h.y)&&M(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;u&&u.z<=l;){if(u!==e.prev&&u!==e.next&&Gc(o.x,o.y,n.x,n.y,a.x,a.y,u.x,u.y)&&M(u.prev,u,u.next)>=0)return!1;u=u.nextZ}return!0}function Ct(e,t,r){var i=e;do{var o=i.prev,n=i.next.next;!Mb(o,n)&&il(o,i,i.next,n)&&Jd(o,n)&&Jd(n,o)&&(t.push(o.i/r),t.push(i.i/r),t.push(n.i/r),Kd(i),Kd(i.next),i=e=n),i=i.next}while(i!==e);return i}function Dt(e,t,r,i,o,n){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Lt(a,s)){var $=jl(a,s);return a=Hd(a,a.next),$=Hd($,$.next),Id(a,t,r,i,o,n),void Id($,t,r,i,o,n)}s=s.next}a=a.next}while(a!==e)}function Et(e,t,r,i){var o,n,a,s=[];for(o=0,n=t.length;o<n;o++)(a=hl(e,t[o]*i,o<n-1?t[o+1]*i:e.length,i,!1))===a.next&&(a.steiner=!0),s.push(Kt(a));for(s.sort(Ft),o=0;o<s.length;o++)Gt(s[o],r),r=Hd(r,r.next);return r}function Ft(e,t){return e.x-t.x}function Gt(e,t){if(t=Ht(e,t)){var r=jl(t,e);Hd(r,r.next)}}function Ht(e,t){var r,i=t,o=e.x,n=e.y,a=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var s=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=o&&s>a){if(a=s,s===o){if(n===i.y)return i;if(n===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(o===a)return r.prev;var $,d=r,p=r.x,c=r.y,l=1/0;for(i=r.next;i!==d;)o>=i.x&&i.x>=p&&o!==i.x&&Gc(n<c?o:a,n,p,c,n<c?a:o,n,i.x,i.y)&&(($=Math.abs(n-i.y)/(o-i.x))<l||$===l&&i.x>r.x)&&Jd(i,e)&&(r=i,l=$),i=i.next;return r}function It(e,t,r,i){var o=e;do{null===o.z&&(o.z=Sh(o.x,o.y,t,r,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,Jt(o)}function Jt(e){var t,r,i,o,n,a,s,$,d=1;do{for(r=e,e=null,n=null,a=0;r;){for(a++,i=r,s=0,t=0;t<d&&(s++,i=i.nextZ);t++);for($=d;s>0||$>0&&i;)0!==s&&(0===$||!i||r.z<=i.z)?(o=r,r=r.nextZ,s--):(o=i,i=i.nextZ,$--),n?n.nextZ=o:e=o,o.prevZ=n,n=o;r=i}n.nextZ=null,d*=2}while(a>1);return e}function Sh(e,t,r,i,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Kt(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function Gc(e,t,r,i,o,n,a,s){return(o-a)*(t-s)-(e-a)*(n-s)>=0&&(e-a)*(i-s)-(r-a)*(t-s)>=0&&(r-a)*(n-s)-(o-a)*(i-s)>=0}function Lt(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Mt(e,t)&&Jd(e,t)&&Jd(t,e)&&Nt(e,t)}function M(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Mb(e,t){return e.x===t.x&&e.y===t.y}function il(e,t,r,i){return!!(Mb(e,r)&&Mb(t,i)||Mb(e,i)&&Mb(r,t))||M(e,t,r)>0!=M(e,t,i)>0&&M(r,i,e)>0!=M(r,i,t)>0}function Mt(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&il(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Jd(e,t){return M(e.prev,e,e.next)<0?M(e,t,e.next)>=0&&M(e,e.prev,t)>=0:M(e,t,e.prev)<0||M(e,e.next,t)<0}function Nt(e,t){var r=e,i=!1,o=(e.x+t.x)/2,n=(e.y+t.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&o<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}function jl(e,t){var r=new Th(e.i,e.x,e.y),i=new Th(t.i,t.x,t.y),o=e.next,n=t.prev;return e.next=t,t.prev=e,r.next=o,o.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function kl(e,t,r,i){var o=new Th(e,t,r);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function Kd(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Th(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ot(e,t,r,i){for(var o=0,n=t,a=r-i;n<r;n+=i)o+=(e[a]-e[n])*(e[n+1]+e[a+1]),a=n;return o}var ob={area:function(e){for(var t=e.length,r=0,i=t-1,o=0;o<t;i=o++)r+=e[i].x*e[o].y-e[o].x*e[i].y;return .5*r},isClockWise:function(e){return ob.area(e)<0},triangulateShape:function(e,t){var r=[],i=[],o=[];ll(e),ml(r,e);var n=e.length;t.forEach(ll);for(var a=0;a<t.length;a++)i.push(n),n+=t[a].length,ml(r,t[a]);var s=zt.triangulate(r,i);for(a=0;a<s.length;a+=3)o.push(s.slice(a,a+3));return o}};function ll(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function ml(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function Hc(e,t){w.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Ya(e,t)),this.mergeVertices()}function Ya(e,t){k.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var r=this,i=[],o=[],n=0,a=e.length;n<a;n++){s(e[n])}function s(e){var n=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,$=void 0!==t.depth?t.depth:100,d=void 0===t.bevelEnabled||t.bevelEnabled,p=void 0!==t.bevelThickness?t.bevelThickness:6,c=void 0!==t.bevelSize?t.bevelSize:p-2,l=void 0!==t.bevelOffset?t.bevelOffset:0,h=void 0!==t.bevelSegments?t.bevelSegments:3,u=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:Pt;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),$=t.amount);var m,v,x,R,g,q,y,K,_=!1;u&&(m=u.getSpacedPoints(s),_=!0,d=!1,v=u.computeFrenetFrames(s,!1),x=new aa,R=new aa,g=new aa),d||(h=0,p=0,c=0,l=0);var b=e.extractPoints(a),M=b.shape,w=b.holes;if(!ob.isClockWise(M))for(M=M.reverse(),y=0,K=w.length;y<K;y++)q=w[y],ob.isClockWise(q)&&(w[y]=q.reverse());var S=ob.triangulateShape(M,w),T=M;for(y=0,K=w.length;y<K;y++)q=w[y],M=M.concat(q);function E(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var A,L,C,P,B,G,D=M.length,O=S.length;function I(e,t,r){var i,o,n,a=e.x-t.x,s=e.y-t.y,$=r.x-e.x,d=r.y-e.y,p=a*a+s*s,c=a*d-s*$;if(Math.abs(c)>Number.EPSILON){var l=Math.sqrt(p),h=Math.sqrt($*$+d*d),u=t.x-s/l,f=t.y+a/l,m=((r.x-d/h-u)*d-(r.y+$/h-f)*$)/(a*d-s*$),v=(i=u+a*m-e.x)*i+(o=f+s*m-e.y)*o;if(v<=2)return new ba(i,o);n=Math.sqrt(v/2)}else{var x=!1;a>Number.EPSILON?$>Number.EPSILON&&(x=!0):a<-Number.EPSILON?$<-Number.EPSILON&&(x=!0):Math.sign(s)===Math.sign(d)&&(x=!0),x?(i=-s,o=a,n=Math.sqrt(p)):(i=a,o=s,n=Math.sqrt(p/2))}return new ba(i/n,o/n)}for(var F=[],V=0,N=T.length,U=N-1,z=V+1;V<N;V++,U++,z++)U===N&&(U=0),z===N&&(z=0),F[V]=I(T[V],T[U],T[z]);var H,k,j=[],W=F.concat();for(y=0,K=w.length;y<K;y++){for(q=w[y],H=[],V=0,U=(N=q.length)-1,z=V+1;V<N;V++,U++,z++)U===N&&(U=0),z===N&&(z=0),H[V]=I(q[V],q[U],q[z]);j.push(H),W=W.concat(H)}for(A=0;A<h;A++){for(C=A/h,P=p*Math.cos(C*Math.PI/2),L=c*Math.sin(C*Math.PI/2)+l,V=0,N=T.length;V<N;V++)Y((B=E(T[V],F[V],L)).x,B.y,-P);for(y=0,K=w.length;y<K;y++)for(q=w[y],H=j[y],V=0,N=q.length;V<N;V++)Y((B=E(q[V],H[V],L)).x,B.y,-P)}for(L=c+l,V=0;V<D;V++)B=d?E(M[V],W[V],L):M[V],_?(R.copy(v.normals[0]).multiplyScalar(B.x),x.copy(v.binormals[0]).multiplyScalar(B.y),g.copy(m[0]).add(R).add(x),Y(g.x,g.y,g.z)):Y(B.x,B.y,0);for(k=1;k<=s;k++)for(V=0;V<D;V++)B=d?E(M[V],W[V],L):M[V],_?(R.copy(v.normals[k]).multiplyScalar(B.x),x.copy(v.binormals[k]).multiplyScalar(B.y),g.copy(m[k]).add(R).add(x),Y(g.x,g.y,g.z)):Y(B.x,B.y,$/s*k);for(A=h-1;A>=0;A--){for(C=A/h,P=p*Math.cos(C*Math.PI/2),L=c*Math.sin(C*Math.PI/2)+l,V=0,N=T.length;V<N;V++)Y((B=E(T[V],F[V],L)).x,B.y,$+P);for(y=0,K=w.length;y<K;y++)for(q=w[y],H=j[y],V=0,N=q.length;V<N;V++)B=E(q[V],H[V],L),_?Y(B.x,B.y+m[s-1].y,m[s-1].x+P):Y(B.x,B.y,$+P)}function X(e,t){var r,i;for(V=e.length;--V>=0;){r=V,(i=V-1)<0&&(i=e.length-1);var o=0,n=s+2*h;for(o=0;o<n;o++){var a=D*o,$=D*(o+1);J(t+r+a,t+i+a,t+i+$,t+r+$)}}}function Y(e,t,r){n.push(e),n.push(t),n.push(r)}function Z(e,t,o){Q(e),Q(t),Q(o);var n=i.length/3,a=f.generateTopUV(r,i,n-3,n-2,n-1);ee(a[0]),ee(a[1]),ee(a[2])}function J(e,t,o,n){Q(e),Q(t),Q(n),Q(t),Q(o),Q(n);var a=i.length/3,s=f.generateSideWallUV(r,i,a-6,a-3,a-2,a-1);ee(s[0]),ee(s[1]),ee(s[3]),ee(s[1]),ee(s[2]),ee(s[3])}function Q(e){i.push(n[3*e+0]),i.push(n[3*e+1]),i.push(n[3*e+2])}function ee(e){o.push(e.x),o.push(e.y)}!function(){var e=i.length/3;if(d){var t=0,o=D*t;for(V=0;V<O;V++)Z((G=S[V])[2]+o,G[1]+o,G[0]+o);for(o=D*(t=s+2*h),V=0;V<O;V++)Z((G=S[V])[0]+o,G[1]+o,G[2]+o)}else{for(V=0;V<O;V++)Z((G=S[V])[2],G[1],G[0]);for(V=0;V<O;V++)Z((G=S[V])[0]+D*s,G[1]+D*s,G[2]+D*s)}r.addGroup(e,i.length/3-e,0)}(),function(){var e=i.length/3,t=0;for(X(T,t),t+=T.length,y=0,K=w.length;y<K;y++)X(q=w[y],t),t+=q.length;r.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new j(i,3)),this.setAttribute("uv",new j(o,2)),this.computeVertexNormals()}Hc.prototype=Object.create(w.prototype),Hc.prototype.constructor=Hc,Hc.prototype.toJSON=function(){var e=w.prototype.toJSON.call(this);return nl(this.parameters.shapes,this.parameters.options,e)},Ya.prototype=Object.create(k.prototype),Ya.prototype.constructor=Ya,Ya.prototype.toJSON=function(){var e=k.prototype.toJSON.call(this);return nl(this.parameters.shapes,this.parameters.options,e)};var Pt={generateTopUV:function(e,t,r,i,o){var n=t[3*r],a=t[3*r+1],s=t[3*i],$=t[3*i+1],d=t[3*o],p=t[3*o+1];return[new ba(n,a),new ba(s,$),new ba(d,p)]},generateSideWallUV:function(e,t,r,i,o,n){var a=t[3*r],s=t[3*r+1],$=t[3*r+2],d=t[3*i],p=t[3*i+1],c=t[3*i+2],l=t[3*o],h=t[3*o+1],u=t[3*o+2],f=t[3*n],m=t[3*n+1],v=t[3*n+2];return Math.abs(s-p)<.01?[new ba(a,1-$),new ba(d,1-c),new ba(l,1-u),new ba(f,1-v)]:[new ba(s,1-$),new ba(p,1-c),new ba(h,1-u),new ba(m,1-v)]}};function nl(e,t,r){if(r.shapes=[],Array.isArray(e))for(var i=0,o=e.length;i<o;i++){var n=e[i];r.shapes.push(n.uuid)}else r.shapes.push(e.uuid);return void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function Jf(e,t){w.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Ld(e,t)),this.mergeVertices()}function Ld(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new w;var i=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Ya.call(this,i,t),this.type="TextBufferGeometry"}function Kf(e,t,r,i,o,n,a){w.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:o,thetaStart:n,thetaLength:a},this.fromBufferGeometry(new Nb(e,t,r,i,o,n,a)),this.mergeVertices()}function Nb(e,t,r,i,o,n,a){k.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:o,thetaStart:n,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?n:0,a=void 0!==a?a:Math.PI;var s,$,d=Math.min(n+a,Math.PI),p=0,c=[],l=new aa,h=new aa,u=[],f=[],m=[],v=[];for($=0;$<=r;$++){var x=[],R=$/r,g=0;for(0==$&&0==n?g=.5/t:$==r&&d==Math.PI&&(g=-.5/t),s=0;s<=t;s++){var q=s/t;l.x=-e*Math.cos(i+q*o)*Math.sin(n+R*a),l.y=e*Math.cos(n+R*a),l.z=e*Math.sin(i+q*o)*Math.sin(n+R*a),f.push(l.x,l.y,l.z),h.copy(l).normalize(),m.push(h.x,h.y,h.z),v.push(q+g,1-R),x.push(p++)}c.push(x)}for($=0;$<r;$++)for(s=0;s<t;s++){var y=c[$][s+1],K=c[$][s],_=c[$+1][s],b=c[$+1][s+1];(0!==$||n>0)&&u.push(y,K,b),($!==r-1||d<Math.PI)&&u.push(K,_,b)}this.setIndex(u),this.setAttribute("position",new j(f,3)),this.setAttribute("normal",new j(m,3)),this.setAttribute("uv",new j(v,2))}function Lf(e,t,r,i,o,n){w.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:o,thetaLength:n},this.fromBufferGeometry(new Md(e,t,r,i,o,n)),this.mergeVertices()}function Md(e,t,r,i,o,n){k.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:o,thetaLength:n},e=e||.5,t=t||1,o=void 0!==o?o:0,n=void 0!==n?n:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,$,d=[],p=[],c=[],l=[],h=e,u=(t-e)/(i=void 0!==i?Math.max(1,i):1),f=new aa,m=new ba;for(s=0;s<=i;s++){for($=0;$<=r;$++)a=o+$/r*n,f.x=h*Math.cos(a),f.y=h*Math.sin(a),p.push(f.x,f.y,f.z),c.push(0,0,1),m.x=(f.x/t+1)/2,m.y=(f.y/t+1)/2,l.push(m.x,m.y);h+=u}for(s=0;s<i;s++){var v=s*(r+1);for($=0;$<r;$++){var x=a=$+v,R=a+r+1,g=a+r+2,q=a+1;d.push(x,R,q),d.push(R,g,q)}}this.setIndex(d),this.setAttribute("position",new j(p,3)),this.setAttribute("normal",new j(c,3)),this.setAttribute("uv",new j(l,2))}function Mf(e,t,r,i){w.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},this.fromBufferGeometry(new Nd(e,t,r,i)),this.mergeVertices()}function Nd(e,t,r,i){k.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t)||12,r=r||0,i=i||2*Math.PI,i=ea.clamp(i,0,2*Math.PI);var o,n,a,s=[],$=[],d=[],p=1/t,c=new aa,l=new ba;for(n=0;n<=t;n++){var h=r+n*p*i,u=Math.sin(h),f=Math.cos(h);for(a=0;a<=e.length-1;a++)c.x=e[a].x*u,c.y=e[a].y,c.z=e[a].x*f,$.push(c.x,c.y,c.z),l.x=n/t,l.y=a/(e.length-1),d.push(l.x,l.y)}for(n=0;n<t;n++)for(a=0;a<e.length-1;a++){var m=o=a+n*e.length,v=o+e.length,x=o+e.length+1,R=o+1;s.push(m,v,R),s.push(v,x,R)}if(this.setIndex(s),this.setAttribute("position",new j($,3)),this.setAttribute("uv",new j(d,2)),this.computeVertexNormals(),i===2*Math.PI){var g=this.attributes.normal.array,q=new aa,y=new aa,K=new aa;for(o=t*e.length*3,n=0,a=0;n<e.length;n++,a+=3)q.x=g[a+0],q.y=g[a+1],q.z=g[a+2],y.x=g[o+a+0],y.y=g[o+a+1],y.z=g[o+a+2],K.addVectors(q,y).normalize(),g[a+0]=g[o+a+0]=K.x,g[a+1]=g[o+a+1]=K.y,g[a+2]=g[o+a+2]=K.z}}function Ic(e,t){w.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Jc(e,t)),this.mergeVertices()}function Jc(e,t){k.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],i=[],o=[],n=[],a=0,s=0;if(!1===Array.isArray(e))d(e);else for(var $=0;$<e.length;$++)d(e[$]),this.addGroup(a,s,$),a+=s,s=0;function d(e){var a,$,d,p=i.length/3,c=e.extractPoints(t),l=c.shape,h=c.holes;for(!1===ob.isClockWise(l)&&(l=l.reverse()),a=0,$=h.length;a<$;a++)d=h[a],!0===ob.isClockWise(d)&&(h[a]=d.reverse());var u=ob.triangulateShape(l,h);for(a=0,$=h.length;a<$;a++)d=h[a],l=l.concat(d);for(a=0,$=l.length;a<$;a++){var f=l[a];i.push(f.x,f.y,0),o.push(0,0,1),n.push(f.x,f.y)}for(a=0,$=u.length;a<$;a++){var m=u[a],v=m[0]+p,x=m[1]+p,R=m[2]+p;r.push(v,x,R),s+=3}}this.setIndex(r),this.setAttribute("position",new j(i,3)),this.setAttribute("normal",new j(o,3)),this.setAttribute("uv",new j(n,2))}function ol(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var o=e[r];t.shapes.push(o.uuid)}else t.shapes.push(e.uuid);return t}function Nf(e,t){k.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,i,o,n,a=[],s=Math.cos(ea.DEG2RAD*t),$=[0,0],d={},p=["a","b","c"];e.isBufferGeometry?(n=new w).fromBufferGeometry(e):n=e.clone(),n.mergeVertices(),n.computeFaceNormals();for(var c=n.vertices,l=n.faces,h=0,u=l.length;h<u;h++)for(var f=l[h],m=0;m<3;m++)r=f[p[m]],i=f[p[(m+1)%3]],$[0]=Math.min(r,i),$[1]=Math.max(r,i),void 0===d[o=$[0]+","+$[1]]?d[o]={index1:$[0],index2:$[1],face1:h,face2:void 0}:d[o].face2=h;for(o in d){var v=d[o];if(void 0===v.face2||l[v.face1].normal.dot(l[v.face2].normal)<=s){var x=c[v.index1];a.push(x.x,x.y,x.z),x=c[v.index2],a.push(x.x,x.y,x.z)}}this.setAttribute("position",new j(a,3))}function Kc(e,t,r,i,o,n,a,s){w.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:o,openEnded:n,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new pb(e,t,r,i,o,n,a,s)),this.mergeVertices()}function pb(e,t,r,i,o,n,a,s){k.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:o,openEnded:n,thetaStart:a,thetaLength:s};var $=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,i=Math.floor(i)||8,o=Math.floor(o)||1,n=void 0!==n&&n,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var d=[],p=[],c=[],l=[],h=0,u=[],f=r/2,m=0;function v(r){var o,n,u,v=new ba,x=new aa,R=0,g=!0===r?e:t,q=!0===r?1:-1;for(n=h,o=1;o<=i;o++)p.push(0,f*q,0),c.push(0,q,0),l.push(.5,.5),h++;for(u=h,o=0;o<=i;o++){var y=o/i*s+a,K=Math.cos(y),_=Math.sin(y);x.x=g*_,x.y=f*q,x.z=g*K,p.push(x.x,x.y,x.z),c.push(0,q,0),v.x=.5*K+.5,v.y=.5*_*q+.5,l.push(v.x,v.y),h++}for(o=0;o<i;o++){var b=n+o,M=u+o;!0===r?d.push(M,M+1,b):d.push(M+1,M,b),R+=3}$.addGroup(m,R,!0===r?1:2),m+=R}!function(){var n,v,x=new aa,R=new aa,g=0,q=(t-e)/r;for(v=0;v<=o;v++){var y=[],K=v/o,_=K*(t-e)+e;for(n=0;n<=i;n++){var b=n/i,M=b*s+a,w=Math.sin(M),S=Math.cos(M);R.x=_*w,R.y=-K*r+f,R.z=_*S,p.push(R.x,R.y,R.z),x.set(w,q,S).normalize(),c.push(x.x,x.y,x.z),l.push(b,1-K),y.push(h++)}u.push(y)}for(n=0;n<i;n++)for(v=0;v<o;v++){var T=u[v][n],E=u[v+1][n],A=u[v+1][n+1],L=u[v][n+1];d.push(T,E,L),d.push(E,A,L),g+=6}$.addGroup(m,g,0),m+=g}(),!1===n&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(d),this.setAttribute("position",new j(p,3)),this.setAttribute("normal",new j(c,3)),this.setAttribute("uv",new j(l,2))}function Of(e,t,r,i,o,n,a){Kc.call(this,0,e,t,r,i,o,n,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:n,thetaLength:a}}function Pf(e,t,r,i,o,n,a){pb.call(this,0,e,t,r,i,o,n,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:n,thetaLength:a}}function Qf(e,t,r,i){w.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new Od(e,t,r,i)),this.mergeVertices()}function Od(e,t,r,i){k.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var o,n,a=[],s=[],$=[],d=[],p=new aa,c=new ba;for(s.push(0,0,0),$.push(0,0,1),d.push(.5,.5),n=0,o=3;n<=t;n++,o+=3){var l=r+n/t*i;p.x=e*Math.cos(l),p.y=e*Math.sin(l),s.push(p.x,p.y,p.z),$.push(0,0,1),c.x=(s[o]/e+1)/2,c.y=(s[o+1]/e+1)/2,d.push(c.x,c.y)}for(o=1;o<=t;o++)a.push(o,o+1,0);this.setIndex(a),this.setAttribute("position",new j(s,3)),this.setAttribute("normal",new j($,3)),this.setAttribute("uv",new j(d,2))}Jf.prototype=Object.create(w.prototype),Jf.prototype.constructor=Jf,Ld.prototype=Object.create(Ya.prototype),Ld.prototype.constructor=Ld,Kf.prototype=Object.create(w.prototype),Kf.prototype.constructor=Kf,Nb.prototype=Object.create(k.prototype),Nb.prototype.constructor=Nb,Lf.prototype=Object.create(w.prototype),Lf.prototype.constructor=Lf,Md.prototype=Object.create(k.prototype),Md.prototype.constructor=Md,Mf.prototype=Object.create(w.prototype),Mf.prototype.constructor=Mf,Nd.prototype=Object.create(k.prototype),Nd.prototype.constructor=Nd,Ic.prototype=Object.create(w.prototype),Ic.prototype.constructor=Ic,Ic.prototype.toJSON=function(){var e=w.prototype.toJSON.call(this);return ol(this.parameters.shapes,e)},Jc.prototype=Object.create(k.prototype),Jc.prototype.constructor=Jc,Jc.prototype.toJSON=function(){var e=k.prototype.toJSON.call(this);return ol(this.parameters.shapes,e)},Nf.prototype=Object.create(k.prototype),Nf.prototype.constructor=Nf,Kc.prototype=Object.create(w.prototype),Kc.prototype.constructor=Kc,pb.prototype=Object.create(k.prototype),pb.prototype.constructor=pb,Of.prototype=Object.create(Kc.prototype),Of.prototype.constructor=Of,Pf.prototype=Object.create(pb.prototype),Pf.prototype.constructor=Pf,Qf.prototype=Object.create(w.prototype),Qf.prototype.constructor=Qf,Od.prototype=Object.create(k.prototype),Od.prototype.constructor=Od;var U=Object.freeze({__proto__:null,WireframeGeometry:zf,ParametricGeometry:Af,ParametricBufferGeometry:Bd,TetrahedronGeometry:Cf,TetrahedronBufferGeometry:Cd,OctahedronGeometry:Df,OctahedronBufferGeometry:Ec,IcosahedronGeometry:Ef,IcosahedronBufferGeometry:Dd,DodecahedronGeometry:Ff,DodecahedronBufferGeometry:Ed,PolyhedronGeometry:Bf,PolyhedronBufferGeometry:la,TubeGeometry:Gf,TubeBufferGeometry:Fc,TorusKnotGeometry:Hf,TorusKnotBufferGeometry:Fd,TorusGeometry:If,TorusBufferGeometry:Gd,TextGeometry:Jf,TextBufferGeometry:Ld,SphereGeometry:Kf,SphereBufferGeometry:Nb,RingGeometry:Lf,RingBufferGeometry:Md,PlaneGeometry:ff,PlaneBufferGeometry:yc,LatheGeometry:Mf,LatheBufferGeometry:Nd,ShapeGeometry:Ic,ShapeBufferGeometry:Jc,ExtrudeGeometry:Hc,ExtrudeBufferGeometry:Ya,EdgesGeometry:Nf,ConeGeometry:Of,ConeBufferGeometry:Pf,CylinderGeometry:Kc,CylinderBufferGeometry:pb,CircleGeometry:Qf,CircleBufferGeometry:Od,BoxGeometry:Kp,BoxBufferGeometry:cf});function Lc(e){f.call(this),this.type="ShadowMaterial",this.color=new g(0),this.transparent=!0,this.setValues(e)}function Pd(e){T.call(this,e),this.type="RawShaderMaterial"}function Za(e){f.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new g(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new g(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ed,this.normalScale=new ba(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Mc(e){Za.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new ba(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function Fa(e){f.call(this),this.type="MeshPhongMaterial",this.color=new g(16777215),this.specular=new g(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new g(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ed,this.normalScale=new ba(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ce,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Nc(e){Fa.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Oc(e){f.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ed,this.normalScale=new ba(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Pc(e){f.call(this),this.type="MeshLambertMaterial",this.color=new g(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new g(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ce,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Qc(e){f.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new g(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ed,this.normalScale=new ba(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Rc(e){y.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Lc.prototype=Object.create(f.prototype),Lc.prototype.constructor=Lc,Lc.prototype.isShadowMaterial=!0,Lc.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.color.copy(e.color),this},Pd.prototype=Object.create(T.prototype),Pd.prototype.constructor=Pd,Pd.prototype.isRawShaderMaterial=!0,Za.prototype=Object.create(f.prototype),Za.prototype.constructor=Za,Za.prototype.isMeshStandardMaterial=!0,Za.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Mc.prototype=Object.create(Za.prototype),Mc.prototype.constructor=Mc,Mc.prototype.isMeshPhysicalMaterial=!0,Mc.prototype.copy=function(e){return Za.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new g).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},Fa.prototype=Object.create(f.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isMeshPhongMaterial=!0,Fa.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Nc.prototype=Object.create(Fa.prototype),Nc.prototype.constructor=Nc,Nc.prototype.isMeshToonMaterial=!0,Nc.prototype.copy=function(e){return Fa.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},Oc.prototype=Object.create(f.prototype),Oc.prototype.constructor=Oc,Oc.prototype.isMeshNormalMaterial=!0,Oc.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Pc.prototype=Object.create(f.prototype),Pc.prototype.constructor=Pc,Pc.prototype.isMeshLambertMaterial=!0,Pc.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Qc.prototype=Object.create(f.prototype),Qc.prototype.constructor=Qc,Qc.prototype.isMeshMatcapMaterial=!0,Qc.prototype.copy=function(e){return f.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Rc.prototype=Object.create(y.prototype),Rc.prototype.constructor=Rc,Rc.prototype.isLineDashedMaterial=!0,Rc.prototype.copy=function(e){return y.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Qt=Object.freeze({__proto__:null,ShadowMaterial:Lc,SpriteMaterial:Lb,RawShaderMaterial:Pd,ShaderMaterial:T,PointsMaterial:nb,MeshPhysicalMaterial:Mc,MeshStandardMaterial:Za,MeshPhongMaterial:Fa,MeshToonMaterial:Nc,MeshNormalMaterial:Oc,MeshLambertMaterial:Pc,MeshDepthMaterial:Jb,MeshDistanceMaterial:Kb,MeshBasicMaterial:oa,MeshMatcapMaterial:Qc,LineDashedMaterial:Rc,LineBasicMaterial:y,Material:f}),J={arraySlice:function(e,t,r){return J.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),i=0;i!==t;++i)r[i]=i;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(e,t,r){for(var i=e.length,o=new e.constructor(i),n=0,a=0;a!==i;++n)for(var s=r[n]*t,$=0;$!==t;++$)o[a++]=e[s+$];return o},flattenJSON:function(e,t,r,i){for(var o=1,n=e[0];void 0!==n&&void 0===n[i];)n=e[o++];if(void 0!==n){var a=n[i];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=n[i])&&(t.push(n.time),r.push.apply(r,a)),n=e[o++]}while(void 0!==n);else if(void 0!==a.toArray)do{void 0!==(a=n[i])&&(t.push(n.time),a.toArray(r,r.length)),n=e[o++]}while(void 0!==n);else do{void 0!==(a=n[i])&&(t.push(n.time),r.push(a)),n=e[o++]}while(void 0!==n)}},subclip:function(e,t,r,i,o){o=o||30;var n=e.clone();n.name=t;for(var a=[],s=0;s<n.tracks.length;++s){for(var $=n.tracks[s],d=$.getValueSize(),p=[],c=[],l=0;l<$.times.length;++l){var h=$.times[l]*o;if(!(h<r||h>=i)){p.push($.times[l]);for(var u=0;u<d;++u)c.push($.values[l*d+u])}}0!==p.length&&($.times=J.convertArray(p,$.times.constructor),$.values=J.convertArray(c,$.values.constructor),a.push($))}n.tracks=a;var f=1/0;for(s=0;s<n.tracks.length;++s)f>n.tracks[s].times[0]&&(f=n.tracks[s].times[0]);for(s=0;s<n.tracks.length;++s)n.tracks[s].shift(-1*f);return n.resetDuration(),n}};function qa(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function Uh(e,t,r,i){qa.call(this,e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Rf(e,t,r,i){qa.call(this,e,t,r,i)}function Vh(e,t,r,i){qa.call(this,e,t,r,i)}function R(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=J.convertArray(t,this.TimeBufferType),this.values=J.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function Wh(e,t,r){R.call(this,e,t,r)}function Xh(e,t,r,i){R.call(this,e,t,r,i)}function Qd(e,t,r,i){R.call(this,e,t,r,i)}function Yh(e,t,r,i){qa.call(this,e,t,r,i)}function Sf(e,t,r,i){R.call(this,e,t,r,i)}function Zh(e,t,r,i){R.call(this,e,t,r,i)}function Rd(e,t,r,i){R.call(this,e,t,r,i)}function xa(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=ea.generateUUID(),this.duration<0&&this.resetDuration()}function Rt(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Qd;case"vector":case"vector2":case"vector3":case"vector4":return Rd;case"color":return Xh;case"quaternion":return Sf;case"bool":case"boolean":return Wh;case"string":return Zh;}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function St(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=Rt(e.type);if(void 0===e.times){var r=[],i=[];J.flattenJSON(e.keys,r,i,"value"),e.times=r,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(qa.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,i=t[r],o=t[r-1];e:{t:{var n;r:{i:if(!(e<i)){for(var a=r+2;;){if(void 0===i){if(e<o)break i;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,o)}if(r===a)break;if(o=i,e<(i=t[++r]))break t}n=t.length;break r}if(e>=o)break e;var s=t[1];e<s&&(r=2,o=s);for(a=r-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(r===a)break;if(i=o,e>=(o=t[--r-1]))break t}n=r,r=0}for(;r<n;){var $=r+n>>>1;e<t[$]?n=$:r=$+1}if(i=t[r],void 0===(o=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,o,e)}this._cachedIndex=r,this.intervalChanged_(r,o,i)}return this.interpolate_(r,o,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,o=e*i,n=0;n!==i;++n)t[n]=r[o+n];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(qa.prototype,{beforeStart_:qa.prototype.copySampleValue_,afterEnd_:qa.prototype.copySampleValue_}),Uh.prototype=Object.assign(Object.create(qa.prototype),{constructor:Uh,DefaultSettings_:{endingStart:fc,endingEnd:fc},intervalChanged_:function(e,t,r){var i=this.parameterPositions,o=e-2,n=e+1,a=i[o],s=i[n];if(void 0===a)switch(this.getSettings_().endingStart){case gc:o=e,a=2*t-r;break;case Le:a=t+i[o=i.length-2]-i[o+1];break;default:o=e,a=r;}if(void 0===s)switch(this.getSettings_().endingEnd){case gc:n=e,s=2*r-t;break;case Le:n=1,s=r+i[1]-i[0];break;default:n=e-1,s=t;}var $=.5*(r-t),d=this.valueSize;this._weightPrev=$/(t-a),this._weightNext=$/(s-r),this._offsetPrev=o*d,this._offsetNext=n*d},interpolate_:function(e,t,r,i){for(var o=this.resultBuffer,n=this.sampleValues,a=this.valueSize,s=e*a,$=s-a,d=this._offsetPrev,p=this._offsetNext,c=this._weightPrev,l=this._weightNext,h=(r-t)/(i-t),u=h*h,f=u*h,m=-c*f+2*c*u-c*h,v=(1+c)*f+(-1.5-2*c)*u+(-.5+c)*h+1,x=(-1-l)*f+(1.5+l)*u+.5*h,R=l*f-l*u,g=0;g!==a;++g)o[g]=m*n[d+g]+v*n[$+g]+x*n[s+g]+R*n[p+g];return o}}),Rf.prototype=Object.assign(Object.create(qa.prototype),{constructor:Rf,interpolate_:function(e,t,r,i){for(var o=this.resultBuffer,n=this.sampleValues,a=this.valueSize,s=e*a,$=s-a,d=(r-t)/(i-t),p=1-d,c=0;c!==a;++c)o[c]=n[$+c]*p+n[s+c]*d;return o}}),Vh.prototype=Object.assign(Object.create(qa.prototype),{constructor:Vh,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(R,{toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:J.convertArray(e.times,Array),values:J.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(R.prototype,{constructor:R,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Ke,InterpolantFactoryMethodDiscrete:function(e){return new Vh(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Rf(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Uh(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case Je:t=this.InterpolantFactoryMethodDiscrete;break;case Ke:t=this.InterpolantFactoryMethodLinear;break;case ch:t=this.InterpolantFactoryMethodSmooth;}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Je;case this.InterpolantFactoryMethodLinear:return Ke;case this.InterpolantFactoryMethodSmooth:return ch;}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,i=r.length,o=0,n=i-1;o!==i&&r[o]<e;)++o;for(;-1!==n&&r[n]>t;)--n;if(++n,0!==o||n!==i){o>=n&&(o=(n=Math.max(n,1))-1);var a=this.getValueSize();this.times=J.arraySlice(r,o,n),this.values=J.arraySlice(this.values,o*a,n*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,i=this.values,o=r.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var n=null,a=0;a!==o;a++){var s=r[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==n&&n>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,n),e=!1;break}n=s}if(void 0!==i&&J.isTypedArray(i)){a=0;for(var $=i.length;a!==$;++a){var d=i[a];if(isNaN(d)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,d),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),i=this.getInterpolation()===ch,o=1,n=e.length-1,a=1;a<n;++a){var s=!1,$=e[a];if($!==e[a+1]&&(1!==a||$!==$[0]))if(i)s=!0;else for(var d=a*r,p=d-r,c=d+r,l=0;l!==r;++l){var h=t[d+l];if(h!==t[p+l]||h!==t[c+l]){s=!0;break}}if(s){if(a!==o){e[o]=e[a];var u=a*r,f=o*r;for(l=0;l!==r;++l)t[f+l]=t[u+l]}++o}}if(n>0){e[o]=e[n];for(u=n*r,f=o*r,l=0;l!==r;++l)t[f+l]=t[u+l];++o}return o!==e.length&&(this.times=J.arraySlice(e,0,o),this.values=J.arraySlice(t,0,o*r)),this},clone:function(){var e=J.arraySlice(this.times,0),t=J.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}),Wh.prototype=Object.assign(Object.create(R.prototype),{constructor:Wh,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Je,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Xh.prototype=Object.assign(Object.create(R.prototype),{constructor:Xh,ValueTypeName:"color"}),Qd.prototype=Object.assign(Object.create(R.prototype),{constructor:Qd,ValueTypeName:"number"}),Yh.prototype=Object.assign(Object.create(qa.prototype),{constructor:Yh,interpolate_:function(e,t,r,i){for(var o=this.resultBuffer,n=this.sampleValues,a=this.valueSize,s=e*a,$=(r-t)/(i-t),d=s+a;s!==d;s+=4)S.slerpFlat(o,0,n,s-a,n,s,$);return o}}),Sf.prototype=Object.assign(Object.create(R.prototype),{constructor:Sf,ValueTypeName:"quaternion",DefaultInterpolation:Ke,InterpolantFactoryMethodLinear:function(e){return new Yh(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Zh.prototype=Object.assign(Object.create(R.prototype),{constructor:Zh,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Je,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Rd.prototype=Object.assign(Object.create(R.prototype),{constructor:Rd,ValueTypeName:"vector"}),Object.assign(xa,{parse:function(e){for(var t=[],r=e.tracks,i=1/(e.fps||1),o=0,n=r.length;o!==n;++o)t.push(St(r[o]).scale(i));return new xa(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},o=0,n=r.length;o!==n;++o)t.push(R.toJSON(r[o]));return i},CreateFromMorphTargetSequence:function(e,t,r,i){for(var o=t.length,n=[],a=0;a<o;a++){var s=[],$=[];s.push((a+o-1)%o,a,(a+1)%o),$.push(0,1,0);var d=J.getKeyframeOrder(s);s=J.sortedArray(s,1,d),$=J.sortedArray($,1,d),i||0!==s[0]||(s.push(o),$.push($[0])),n.push(new Qd(".morphTargetInfluences["+t[a].name+"]",s,$).scale(1/r))}return new xa(e,-1,n)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var i=e;r=i.geometry&&i.geometry.animations||i.animations}for(var o=0;o<r.length;o++)if(r[o].name===t)return r[o];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var i={},o=/^([\w-]*?)([\d]+)$/,n=0,a=e.length;n<a;n++){var s=e[n],$=s.name.match(o);if($&&$.length>1){var d=i[c=$[1]];d||(i[c]=d=[]),d.push(s)}}var p=[];for(var c in i)p.push(xa.CreateFromMorphTargetSequence(c,i[c],t,r));return p},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,i,o){if(0!==r.length){var n=[],a=[];J.flattenJSON(r,n,a,i),0!==n.length&&o.push(new e(t,n,a))}},i=[],o=e.name||"default",n=e.length||-1,a=e.fps||30,s=e.hierarchy||[],$=0;$<s.length;$++){var d=s[$].keys;if(d&&0!==d.length)if(d[0].morphTargets){for(var p={},c=0;c<d.length;c++)if(d[c].morphTargets)for(var l=0;l<d[c].morphTargets.length;l++)p[d[c].morphTargets[l]]=-1;for(var h in p){var u=[],f=[];for(l=0;l!==d[c].morphTargets.length;++l){var m=d[c];u.push(m.time),f.push(m.morphTarget===h?1:0)}i.push(new Qd(".morphTargetInfluence["+h+"]",u,f))}n=p.length*(a||1)}else{var v=".bones["+t[$].name+"]";r(Rd,v+".position",d,"pos",i),r(Sf,v+".quaternion",d,"rot",i),r(Rd,v+".scale",d,"scl",i)}}return 0===i.length?null:new xa(o,n,i)}}),Object.assign(xa.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new xa(this.name,this.duration,e)}});var Sc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function pl(e,t,r){var i=this,o=!1,n=0,a=0,s=void 0,$=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){a++,!1===o&&void 0!==i.onStart&&i.onStart(e,n,a),o=!0},this.itemEnd=function(e){n++,void 0!==i.onProgress&&i.onProgress(e,n,a),n===a&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return $.push(e,t),this},this.removeHandler=function(e){var t=$.indexOf(e);return-1!==t&&$.splice(t,2),this},this.getHandler=function(e){for(var t=0,r=$.length;t<r;t+=2){var i=$[t],o=$[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return o}return null}}var Tt=new pl;function i(e){this.manager=void 0!==e?e:Tt,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(i.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var ya={};function Ga(e){i.call(this,e)}function ql(e){i.call(this,e)}function rl(e){i.call(this,e)}function sl(e){i.call(this,e)}function Sd(e){i.call(this,e)}function $h(e){i.call(this,e)}function _h(e){i.call(this,e)}function c(){this.type="Curve",this.arcLengthDivisions=200}function ra(e,t,r,i,o,n,a,s){c.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=i||1,this.aStartAngle=o||0,this.aEndAngle=n||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Td(e,t,r,i,o,n){ra.call(this,e,t,r,r,i,o,n),this.type="ArcCurve"}function ai(){var e=0,t=0,r=0,i=0;function o(o,n,a,s){e=o,t=a,r=-3*o+3*n-2*a-s,i=2*o-2*n+a+s}return{initCatmullRom:function(e,t,r,i,n){o(t,r,n*(r-e),n*(i-t))},initNonuniformCatmullRom:function(e,t,r,i,n,a,s){var $=(t-e)/n-(r-e)/(n+a)+(r-t)/a,d=(r-t)/a-(i-t)/(a+s)+(i-r)/s;o(t,r,$*=a,d*=a)},calc:function(o){var n=o*o;return e+t*o+r*n+i*(n*o)}}}Ga.prototype=Object.assign(Object.create(i.prototype),{constructor:Ga,load:function(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,n=Sc.get(e);if(void 0!==n)return o.manager.itemStart(e),setTimeout(function(){t&&t(n),o.manager.itemEnd(e)},0),n;if(void 0===ya[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],$=!!a[2],d=a[3];d=decodeURIComponent(d),$&&(d=atob(d));try{var p,c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":for(var l=new Uint8Array(d.length),h=0;h<d.length;h++)l[h]=d.charCodeAt(h);p="blob"===c?new Blob([l.buffer],{type:s}):l.buffer;break;case"document":var u=new DOMParser;p=u.parseFromString(d,s);break;case"json":p=JSON.parse(d);break;default:p=d;}setTimeout(function(){t&&t(p),o.manager.itemEnd(e)},0)}catch(v){setTimeout(function(){i&&i(v),o.manager.itemError(e),o.manager.itemEnd(e)},0)}}else{ya[e]=[],ya[e].push({onLoad:t,onProgress:r,onError:i});var f=new XMLHttpRequest;for(var m in f.open("GET",e,!0),f.addEventListener("load",function(t){var r=this.response,i=ya[e];if(delete ya[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Sc.add(e,r);for(var n=0,a=i.length;n<a;n++){(s=i[n]).onLoad&&s.onLoad(r)}o.manager.itemEnd(e)}else{for(n=0,a=i.length;n<a;n++){var s;(s=i[n]).onError&&s.onError(t)}o.manager.itemError(e),o.manager.itemEnd(e)}},!1),f.addEventListener("progress",function(t){for(var r=ya[e],i=0,o=r.length;i<o;i++){var n=r[i];n.onProgress&&n.onProgress(t)}},!1),f.addEventListener("error",function(t){var r=ya[e];delete ya[e];for(var i=0,n=r.length;i<n;i++){var a=r[i];a.onError&&a.onError(t)}o.manager.itemError(e),o.manager.itemEnd(e)},!1),f.addEventListener("abort",function(t){var r=ya[e];delete ya[e];for(var i=0,n=r.length;i<n;i++){var a=r[i];a.onError&&a.onError(t)}o.manager.itemError(e),o.manager.itemEnd(e)},!1),void 0!==this.responseType&&(f.responseType=this.responseType),void 0!==this.withCredentials&&(f.withCredentials=this.withCredentials),f.overrideMimeType&&f.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)f.setRequestHeader(m,this.requestHeader[m]);f.send(null)}return o.manager.itemStart(e),f}ya[e].push({onLoad:t,onProgress:r,onError:i})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),ql.prototype=Object.assign(Object.create(i.prototype),{constructor:ql,load:function(e,t,r,i){var o=this,n=new Ga(o.manager);n.setPath(o.path),n.load(e,function(e){t(o.parse(JSON.parse(e)))},r,i)},parse:function(e){for(var t=[],r=0;r<e.length;r++){var i=xa.parse(e[r]);t.push(i)}return t}}),rl.prototype=Object.assign(Object.create(i.prototype),{constructor:rl,load:function(e,t,r,i){var o=this,n=[],a=new Ad;a.image=n;var s=new Ga(this.manager);function $($){s.load(e[$],function(e){var r=o.parse(e,!0);n[$]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(d+=1)&&(1===r.mipmapCount&&(a.minFilter=N),a.format=r.format,a.needsUpdate=!0,t&&t(a))},r,i)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var d=0,p=0,c=e.length;p<c;++p)$(p);else s.load(e,function(e){var r=o.parse(e,!0);if(r.isCubemap)for(var i=r.mipmaps.length/r.mipmapCount,s=0;s<i;s++){n[s]={mipmaps:[]};for(var $=0;$<r.mipmapCount;$++)n[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+$]),n[s].format=r.format,n[s].width=r.width,n[s].height=r.height}else a.image.width=r.width,a.image.height=r.height,a.mipmaps=r.mipmaps;1===r.mipmapCount&&(a.minFilter=N),a.format=r.format,a.needsUpdate=!0,t&&t(a)},r,i);return a}}),sl.prototype=Object.assign(Object.create(i.prototype),{constructor:sl,load:function(e,t,r,i){var o=this,n=new wc,a=new Ga(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,function(e){var r=o.parse(e);r&&(void 0!==r.image?n.image=r.image:void 0!==r.data&&(n.image.width=r.width,n.image.height=r.height,n.image.data=r.data),n.wrapS=void 0!==r.wrapS?r.wrapS:Y,n.wrapT=void 0!==r.wrapT?r.wrapT:Y,n.magFilter=void 0!==r.magFilter?r.magFilter:N,n.minFilter=void 0!==r.minFilter?r.minFilter:N,n.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(n.format=r.format),void 0!==r.type&&(n.type=r.type),void 0!==r.mipmaps&&(n.mipmaps=r.mipmaps,n.minFilter=Ge),1===r.mipmapCount&&(n.minFilter=N),n.needsUpdate=!0,t&&t(n,r))},r,i),n}}),Sd.prototype=Object.assign(Object.create(i.prototype),{constructor:Sd,load:function(e,t,r,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,n=Sc.get(e);if(void 0!==n)return o.manager.itemStart(e),setTimeout(function(){t&&t(n),o.manager.itemEnd(e)},0),n;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",$,!1),Sc.add(e,this),t&&t(this),o.manager.itemEnd(e)}function $(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",$,!1),i&&i(t),o.manager.itemError(e),o.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",$,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),o.manager.itemStart(e),a.src=e,a}}),$h.prototype=Object.assign(Object.create(i.prototype),{constructor:$h,load:function(e,t,r,i){var o=new kb,n=new Sd(this.manager);n.setCrossOrigin(this.crossOrigin),n.setPath(this.path);var a=0;function s(r){n.load(e[r],function(e){o.images[r]=e,6===++a&&(o.needsUpdate=!0,t&&t(o))},void 0,i)}for(var $=0;$<e.length;++$)s($);return o}}),_h.prototype=Object.assign(Object.create(i.prototype),{constructor:_h,load:function(e,t,r,i){var o=new m,n=new Sd(this.manager);return n.setCrossOrigin(this.crossOrigin),n.setPath(this.path),n.load(e,function(r){o.image=r;var i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);o.format=i?zb:Qa,o.needsUpdate=!0,void 0!==t&&t(o)},r,i),o}}),Object.assign(c.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],o=this.getPoint(0),n=0;for(i.push(0),r=1;r<=e;r++)n+=(t=this.getPoint(r/e)).distanceTo(o),i.push(n),o=t;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,i=this.getLengths(),o=0,n=i.length;r=t||e*i[n-1];for(var a,s=0,$=n-1;s<=$;)if((a=i[o=Math.floor(s+($-s)/2)]-r)<0)s=o+1;else{if(!(a>0)){$=o;break}$=o-1}if(i[o=$]===r)return o/(n-1);var d=i[o];return(o+(r-d)/(i[o+1]-d))/(n-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var i=this.getPoint(t);return this.getPoint(r).clone().sub(i).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,i,o,n=new aa,a=[],s=[],$=[],d=new aa,p=new da;for(r=0;r<=e;r++)i=r/e,a[r]=this.getTangentAt(i),a[r].normalize();s[0]=new aa,$[0]=new aa;var c=Number.MAX_VALUE,l=Math.abs(a[0].x),h=Math.abs(a[0].y),u=Math.abs(a[0].z);for(l<=c&&(c=l,n.set(1,0,0)),h<=c&&(c=h,n.set(0,1,0)),u<=c&&n.set(0,0,1),d.crossVectors(a[0],n).normalize(),s[0].crossVectors(a[0],d),$[0].crossVectors(a[0],s[0]),r=1;r<=e;r++)s[r]=s[r-1].clone(),$[r]=$[r-1].clone(),d.crossVectors(a[r-1],a[r]),d.length()>Number.EPSILON&&(d.normalize(),o=Math.acos(ea.clamp(a[r-1].dot(a[r]),-1,1)),s[r].applyMatrix4(p.makeRotationAxis(d,o))),$[r].crossVectors(a[r],s[r]);if(!0===t)for(o=Math.acos(ea.clamp(s[0].dot(s[e]),-1,1)),o/=e,a[0].dot(d.crossVectors(s[0],s[e]))>0&&(o=-o),r=1;r<=e;r++)s[r].applyMatrix4(p.makeRotationAxis(a[r],o*r)),$[r].crossVectors(a[r],s[r]);return{tangents:a,normals:s,binormals:$}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),ra.prototype=Object.create(c.prototype),ra.prototype.constructor=ra,ra.prototype.isEllipseCurve=!0,ra.prototype.getPoint=function(e,t){for(var r=t||new ba,i=2*Math.PI,o=this.aEndAngle-this.aStartAngle,n=Math.abs(o)<Number.EPSILON;o<0;)o+=i;for(;o>i;)o-=i;o<Number.EPSILON&&(o=n?0:i),!0!==this.aClockwise||n||(o===i?o=-i:o-=i);var a=this.aStartAngle+e*o,s=this.aX+this.xRadius*Math.cos(a),$=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var d=Math.cos(this.aRotation),p=Math.sin(this.aRotation),c=s-this.aX,l=$-this.aY;s=c*d-l*p+this.aX,$=c*p+l*d+this.aY}return r.set(s,$)},ra.prototype.copy=function(e){return c.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ra.prototype.toJSON=function(){var e=c.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},ra.prototype.fromJSON=function(e){return c.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Td.prototype=Object.create(ra.prototype),Td.prototype.constructor=Td,Td.prototype.isArcCurve=!0;var Tf=new aa,bi=new ai,ci=new ai,di=new ai;function za(e,t,r,i){c.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=i||.5}function tl(e,t,r,i,o){var n=.5*(i-t),a=.5*(o-r),s=e*e;return(2*r-2*i+n+a)*(e*s)+(-3*r+3*i-2*n-a)*s+n*e+r}function Ut(e,t){var r=1-e;return r*r*t}function Vt(e,t){return 2*(1-e)*e*t}function Wt(e,t){return e*e*t}function Ud(e,t,r,i){return Ut(e,t)+Vt(e,r)+Wt(e,i)}function Xt(e,t){var r=1-e;return r*r*r*t}function Yt(e,t){var r=1-e;return 3*r*r*e*t}function Zt(e,t){return 3*(1-e)*e*e*t}function $t(e,t){return e*e*e*t}function Vd(e,t,r,i,o){return Xt(e,t)+Yt(e,r)+Zt(e,i)+$t(e,o)}function Ha(e,t,r,i){c.call(this),this.type="CubicBezierCurve",this.v0=e||new ba,this.v1=t||new ba,this.v2=r||new ba,this.v3=i||new ba}function $a(e,t,r,i){c.call(this),this.type="CubicBezierCurve3",this.v0=e||new aa,this.v1=t||new aa,this.v2=r||new aa,this.v3=i||new aa}function ma(e,t){c.call(this),this.type="LineCurve",this.v1=e||new ba,this.v2=t||new ba}function Ia(e,t){c.call(this),this.type="LineCurve3",this.v1=e||new aa,this.v2=t||new aa}function Ja(e,t,r){c.call(this),this.type="QuadraticBezierCurve",this.v0=e||new ba,this.v1=t||new ba,this.v2=r||new ba}function _a(e,t,r){c.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new aa,this.v1=t||new aa,this.v2=r||new aa}function Ka(e){c.call(this),this.type="SplineCurve",this.points=e||[]}za.prototype=Object.create(c.prototype),za.prototype.constructor=za,za.prototype.isCatmullRomCurve3=!0,za.prototype.getPoint=function(e,t){var r,i,o,n,a=t||new aa,s=this.points,$=s.length,d=($-(this.closed?0:1))*e,p=Math.floor(d),c=d-p;if(this.closed?p+=p>0?0:(Math.floor(Math.abs(p)/$)+1)*$:0===c&&p===$-1&&(p=$-2,c=1),this.closed||p>0?r=s[(p-1)%$]:(Tf.subVectors(s[0],s[1]).add(s[0]),r=Tf),i=s[p%$],o=s[(p+1)%$],this.closed||p+2<$?n=s[(p+2)%$]:(Tf.subVectors(s[$-1],s[$-2]).add(s[$-1]),n=Tf),"centripetal"===this.curveType||"chordal"===this.curveType){var l="chordal"===this.curveType?.5:.25,h=Math.pow(r.distanceToSquared(i),l),u=Math.pow(i.distanceToSquared(o),l),f=Math.pow(o.distanceToSquared(n),l);u<1e-4&&(u=1),h<1e-4&&(h=u),f<1e-4&&(f=u),bi.initNonuniformCatmullRom(r.x,i.x,o.x,n.x,h,u,f),ci.initNonuniformCatmullRom(r.y,i.y,o.y,n.y,h,u,f),di.initNonuniformCatmullRom(r.z,i.z,o.z,n.z,h,u,f)}else"catmullrom"===this.curveType&&(bi.initCatmullRom(r.x,i.x,o.x,n.x,this.tension),ci.initCatmullRom(r.y,i.y,o.y,n.y,this.tension),di.initCatmullRom(r.z,i.z,o.z,n.z,this.tension));return a.set(bi.calc(c),ci.calc(c),di.calc(c)),a},za.prototype.copy=function(e){c.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},za.prototype.toJSON=function(){var e=c.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},za.prototype.fromJSON=function(e){c.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(new aa().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ha.prototype=Object.create(c.prototype),Ha.prototype.constructor=Ha,Ha.prototype.isCubicBezierCurve=!0,Ha.prototype.getPoint=function(e,t){var r=t||new ba,i=this.v0,o=this.v1,n=this.v2,a=this.v3;return r.set(Vd(e,i.x,o.x,n.x,a.x),Vd(e,i.y,o.y,n.y,a.y)),r},Ha.prototype.copy=function(e){return c.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ha.prototype.toJSON=function(){var e=c.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ha.prototype.fromJSON=function(e){return c.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},$a.prototype=Object.create(c.prototype),$a.prototype.constructor=$a,$a.prototype.isCubicBezierCurve3=!0,$a.prototype.getPoint=function(e,t){var r=t||new aa,i=this.v0,o=this.v1,n=this.v2,a=this.v3;return r.set(Vd(e,i.x,o.x,n.x,a.x),Vd(e,i.y,o.y,n.y,a.y),Vd(e,i.z,o.z,n.z,a.z)),r},$a.prototype.copy=function(e){return c.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},$a.prototype.toJSON=function(){var e=c.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},$a.prototype.fromJSON=function(e){return c.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},ma.prototype=Object.create(c.prototype),ma.prototype.constructor=ma,ma.prototype.isLineCurve=!0,ma.prototype.getPoint=function(e,t){var r=t||new ba;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},ma.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},ma.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},ma.prototype.copy=function(e){return c.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ma.prototype.toJSON=function(){var e=c.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ma.prototype.fromJSON=function(e){return c.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ia.prototype=Object.create(c.prototype),Ia.prototype.constructor=Ia,Ia.prototype.isLineCurve3=!0,Ia.prototype.getPoint=function(e,t){var r=t||new aa;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},Ia.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ia.prototype.copy=function(e){return c.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ia.prototype.toJSON=function(){var e=c.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ia.prototype.fromJSON=function(e){return c.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ja.prototype=Object.create(c.prototype),Ja.prototype.constructor=Ja,Ja.prototype.isQuadraticBezierCurve=!0,Ja.prototype.getPoint=function(e,t){var r=t||new ba,i=this.v0,o=this.v1,n=this.v2;return r.set(Ud(e,i.x,o.x,n.x),Ud(e,i.y,o.y,n.y)),r},Ja.prototype.copy=function(e){return c.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ja.prototype.toJSON=function(){var e=c.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ja.prototype.fromJSON=function(e){return c.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},_a.prototype=Object.create(c.prototype),_a.prototype.constructor=_a,_a.prototype.isQuadraticBezierCurve3=!0,_a.prototype.getPoint=function(e,t){var r=t||new aa,i=this.v0,o=this.v1,n=this.v2;return r.set(Ud(e,i.x,o.x,n.x),Ud(e,i.y,o.y,n.y),Ud(e,i.z,o.z,n.z)),r},_a.prototype.copy=function(e){return c.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},_a.prototype.toJSON=function(){var e=c.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},_a.prototype.fromJSON=function(e){return c.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ka.prototype=Object.create(c.prototype),Ka.prototype.constructor=Ka,Ka.prototype.isSplineCurve=!0,Ka.prototype.getPoint=function(e,t){var r=t||new ba,i=this.points,o=(i.length-1)*e,n=Math.floor(o),a=o-n,s=i[0===n?n:n-1],$=i[n],d=i[n>i.length-2?i.length-1:n+1],p=i[n>i.length-3?i.length-1:n+2];return r.set(tl(a,s.x,$.x,d.x,p.x),tl(a,s.y,$.y,d.y,p.y)),r},Ka.prototype.copy=function(e){c.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this},Ka.prototype.toJSON=function(){var e=c.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e},Ka.prototype.fromJSON=function(e){c.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(new ba().fromArray(i))}return this};var ei=Object.freeze({__proto__:null,ArcCurve:Td,CatmullRomCurve3:za,CubicBezierCurve:Ha,CubicBezierCurve3:$a,EllipseCurve:ra,LineCurve:ma,LineCurve3:Ia,QuadraticBezierCurve:Ja,QuadraticBezierCurve3:_a,SplineCurve:Ka});function qb(){c.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function La(e){qb.call(this),this.type="Path",this.currentPoint=new ba,e&&this.setFromPoints(e)}function Ob(e){La.call(this,e),this.uuid=ea.generateUUID(),this.type="Shape",this.holes=[]}function u(e,t){b.call(this),this.type="Light",this.color=new g(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function fi(e,t,r){u.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(b.DefaultUp),this.updateMatrix(),this.groundColor=new g(t)}function ab(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new ba(512,512),this.map=null,this.mapPass=null,this.matrix=new da,this._frustum=new ef,this._frameExtents=new ba(1,1),this._viewportCount=1,this._viewports=[new fa(0,0,1,1)]}function gi(){ab.call(this,new D(50,1,.5,500))}function hi(e,t,r,i,o,n){u.call(this,e,t),this.type="SpotLight",this.position.copy(b.DefaultUp),this.updateMatrix(),this.target=new b,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==o?o:0,this.decay=void 0!==n?n:1,this.shadow=new gi}function ii(){ab.call(this,new D(90,1,.5,500)),this._frameExtents=new ba(4,2),this._viewportCount=6,this._viewports=[new fa(2,1,1,1),new fa(0,1,1,1),new fa(3,1,1,1),new fa(1,1,1,1),new fa(3,0,1,1),new fa(1,0,1,1)],this._cubeDirections=[new aa(1,0,0),new aa(-1,0,0),new aa(0,0,1),new aa(0,0,-1),new aa(0,1,0),new aa(0,-1,0)],this._cubeUps=[new aa(0,1,0),new aa(0,1,0),new aa(0,1,0),new aa(0,1,0),new aa(0,0,1),new aa(0,0,-1)]}function ji(e,t,r,i){u.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==i?i:1,this.shadow=new ii}function Uf(e,t,r,i,o,n){Wa.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==r?r:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==o?o:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()}function ki(){ab.call(this,new Uf(-5,5,5,-5,.5,500))}function li(e,t){u.call(this,e,t),this.type="DirectionalLight",this.position.copy(b.DefaultUp),this.updateMatrix(),this.target=new b,this.shadow=new ki}function mi(e,t){u.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function ni(e,t,r,i){u.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==i?i:10}function oi(e){i.call(this,e),this.textures={}}qb.prototype=Object.assign(Object.create(c.prototype),{constructor:qb,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new ma(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=t){var o=r[i]-t,n=this.curves[i],a=n.getLength(),s=0===a?0:1-o/a;return n.getPointAt(s)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],i=0,o=this.curves;i<o.length;i++)for(var n=o[i],a=n&&n.isEllipseCurve?2*e:n&&(n.isLineCurve||n.isLineCurve3)?1:n&&n.isSplineCurve?e*n.points.length:e,s=n.getPoints(a),$=0;$<s.length;$++){var d=s[$];t&&t.equals(d)||(r.push(d),t=d)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){c.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=c.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){c.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push(new ei[i.type]().fromJSON(i))}return this}}),La.prototype=Object.assign(Object.create(qb.prototype),{constructor:La,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var r=new ma(this.currentPoint.clone(),new ba(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,r,i){var o=new Ja(this.currentPoint.clone(),new ba(e,t),new ba(r,i));return this.curves.push(o),this.currentPoint.set(r,i),this},bezierCurveTo:function(e,t,r,i,o,n){var a=new Ha(this.currentPoint.clone(),new ba(e,t),new ba(r,i),new ba(o,n));return this.curves.push(a),this.currentPoint.set(o,n),this},splineThru:function(e){var t=new Ka([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,r,i,o,n){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,r,i,o,n),this},absarc:function(e,t,r,i,o,n){return this.absellipse(e,t,r,r,i,o,n),this},ellipse:function(e,t,r,i,o,n,a,s){var $=this.currentPoint.x,d=this.currentPoint.y;return this.absellipse(e+$,t+d,r,i,o,n,a,s),this},absellipse:function(e,t,r,i,o,n,a,s){var $=new ra(e,t,r,i,o,n,a,s);if(this.curves.length>0){var d=$.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push($);var p=$.getPoint(1);return this.currentPoint.copy(p),this},copy:function(e){return qb.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=qb.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return qb.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Ob.prototype=Object.assign(Object.create(La.prototype),{constructor:Ob,getPointsHoles:function(e){for(var t=[],r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){La.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=La.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){La.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push(new La().fromJSON(i))}return this}}),u.prototype=Object.assign(Object.create(b.prototype),{constructor:u,isLight:!0,copy:function(e){return b.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=b.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),fi.prototype=Object.assign(Object.create(u.prototype),{constructor:fi,isHemisphereLight:!0,copy:function(e){return u.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(ab.prototype,{_projScreenMatrix:new da,_lightPositionWorld:new aa,_lookTarget:new aa,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,r=this.matrix,i=this._projScreenMatrix,o=this._lookTarget,n=this._lightPositionWorld;n.setFromMatrixPosition(e.matrixWorld),t.position.copy(n),o.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(o),t.updateMatrixWorld(),i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromMatrix(i),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),gi.prototype=Object.assign(Object.create(ab.prototype),{constructor:gi,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,r=2*ea.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;r===t.fov&&i===t.aspect&&o===t.far||(t.fov=r,t.aspect=i,t.far=o,t.updateProjectionMatrix()),ab.prototype.updateMatrices.call(this,e)}}),hi.prototype=Object.assign(Object.create(u.prototype),{constructor:hi,isSpotLight:!0,copy:function(e){return u.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),ii.prototype=Object.assign(Object.create(ab.prototype),{constructor:ii,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var r=this.camera,i=this.matrix,o=this._lightPositionWorld,n=this._lookTarget,a=this._projScreenMatrix;o.setFromMatrixPosition(e.matrixWorld),r.position.copy(o),n.copy(r.position),n.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(n),r.updateMatrixWorld(),i.makeTranslation(-o.x,-o.y,-o.z),a.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromMatrix(a)}}),ji.prototype=Object.assign(Object.create(u.prototype),{constructor:ji,isPointLight:!0,copy:function(e){return u.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Uf.prototype=Object.assign(Object.create(Wa.prototype),{constructor:Uf,isOrthographicCamera:!0,copy:function(e,t){return Wa.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,i,o,n){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=n,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,o=r-e,n=r+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var $=this.zoom/(this.view.width/this.view.fullWidth),d=this.zoom/(this.view.height/this.view.fullHeight),p=(this.right-this.left)/this.view.width,c=(this.top-this.bottom)/this.view.height;n=(o+=p*(this.view.offsetX/$))+p*(this.view.width/$),s=(a-=c*(this.view.offsetY/d))-c*(this.view.height/d)}this.projectionMatrix.makeOrthographic(o,n,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=b.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),ki.prototype=Object.assign(Object.create(ab.prototype),{constructor:ki,isDirectionalLightShadow:!0,updateMatrices:function(e){ab.prototype.updateMatrices.call(this,e)}}),li.prototype=Object.assign(Object.create(u.prototype),{constructor:li,isDirectionalLight:!0,copy:function(e){return u.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),mi.prototype=Object.assign(Object.create(u.prototype),{constructor:mi,isAmbientLight:!0}),ni.prototype=Object.assign(Object.create(u.prototype),{constructor:ni,isRectAreaLight:!0,copy:function(e){return u.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=u.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),oi.prototype=Object.assign(Object.create(i.prototype),{constructor:oi,load:function(e,t,r,i){var o=this,n=new Ga(o.manager);n.setPath(o.path),n.load(e,function(e){t(o.parse(JSON.parse(e)))},r,i)},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var i=new Qt[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=new g().setHex(e.sheen)),void 0!==e.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&i.specular.setHex(e.specular),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(i.vertexColors=e.vertexColors),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(i.skinning=e.skinning),void 0!==e.morphTargets&&(i.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(i.morphNormals=e.morphNormals),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.uniforms)for(var o in e.uniforms){var n=e.uniforms[o];switch(i.uniforms[o]={},n.type){case"t":i.uniforms[o].value=r(n.value);break;case"c":i.uniforms[o].value=new g().setHex(n.value);break;case"v2":i.uniforms[o].value=new ba().fromArray(n.value);break;case"v3":i.uniforms[o].value=new aa().fromArray(n.value);break;case"v4":i.uniforms[o].value=new fa().fromArray(n.value);break;case"m3":i.uniforms[o].value=new L().fromArray(n.value);case"m4":i.uniforms[o].value=new da().fromArray(n.value);break;default:i.uniforms[o].value=n.value;}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)i.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=r(e.map)),void 0!==e.matcap&&(i.matcap=r(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=r(e.alphaMap),i.transparent=!0),void 0!==e.bumpMap&&(i.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),i.normalScale=new ba().fromArray(s)}return void 0!==e.displacementMap&&(i.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=r(e.specularMap)),void 0!==e.envMap&&(i.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=new ba().fromArray(e.clearcoatNormalScale)),i},setTextures:function(e){return this.textures=e,this}});var ul={decodeText:function(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);for(var t="",r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(o){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function pi(){k.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function qi(e,t,r,i){"number"==typeof r&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),q.call(this,e,t,r),this.meshPerAttribute=i||1}function ri(e){i.call(this,e)}pi.prototype=Object.assign(Object.create(k.prototype),{constructor:pi,isInstancedBufferGeometry:!0,copy:function(e){return k.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e=k.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),qi.prototype=Object.assign(Object.create(q.prototype),{constructor:qi,isInstancedBufferAttribute:!0,copy:function(e){return q.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=q.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),ri.prototype=Object.assign(Object.create(i.prototype),{constructor:ri,load:function(e,t,r,i){var o=this,n=new Ga(o.manager);n.setPath(o.path),n.load(e,function(e){t(o.parse(JSON.parse(e)))},r,i)},parse:function(e){var t=e.isInstancedBufferGeometry?new pi:new k,r=e.data.index;if(void 0!==r){var i=new si[r.type](r.array);t.setIndex(new q(i,1))}var o=e.data.attributes;for(var n in o){var a=o[n],s=(i=new si[a.type](a.array),new(a.isInstancedBufferAttribute?qi:q)(i,a.itemSize,a.normalized));void 0!==a.name&&(s.name=a.name),t.setAttribute(n,s)}var $=e.data.morphAttributes;if($)for(var n in $){for(var d=$[n],p=[],c=0,l=d.length;c<l;c++){a=d[c],s=new q(i=new si[a.type](a.array),a.itemSize,a.normalized);void 0!==a.name&&(s.name=a.name),p.push(s)}t.morphAttributes[n]=p}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var h=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==h){c=0;for(var u=h.length;c!==u;++c){var f=h[c];t.addGroup(f.start,f.count,f.materialIndex)}}var m=e.data.boundingSphere;if(void 0!==m){var v=new aa;void 0!==m.center&&v.fromArray(m.center),t.boundingSphere=new ib(v,m.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var si={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ti(e){i.call(this,e)}ti.prototype=Object.assign(Object.create(i.prototype),{constructor:ti,load:function(e,t,r,i){var o=this,n=""===this.path?ul.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;var a=new Ga(o.manager);a.setPath(this.path),a.load(e,function(r){var n=null;try{n=JSON.parse(r)}catch(s){return void 0!==i&&i(s),void console.error("THREE:ObjectLoader: Can't parse "+e+".",s.message)}var a=n.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?o.parse(n,t):console.error("THREE.ObjectLoader: Can't load "+e)},r,i)},parse:function(e,t){var r=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){void 0!==t&&t(s)}),n=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,n),s=this.parseObject(e.object,i,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,i=e.length;r<i;r++){var o=new Ob().fromJSON(e[r]);t[o.uuid]=o}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var i=new ri,o=0,n=e.length;o<n;o++){var a,s=e[o];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new U[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new U[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new U[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new U[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new U[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new U[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new U[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new U[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new U[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new U[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new U[s.type](new ei[s.path.type]().fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new U[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new U[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var $=[],d=0,p=s.shapes.length;d<p;d++){var c=t[s.shapes[d]];$.push(c)}a=new U[s.type]($,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for($=[],d=0,p=s.shapes.length;d<p;d++){c=t[s.shapes[d]];$.push(c)}var l=s.options.extrudePath;void 0!==l&&(s.options.extrudePath=new ei[l.type]().fromJSON(l)),a=new U[s.type]($,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)a=new THREE.LegacyJSONLoader().parse(s,this.resourcePath).geometry;else console.error("THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type \"Geometry\".");break;default:console.warn("THREE.ObjectLoader: Unsupported geometry type \""+s.type+"\"");continue;}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),r[s.uuid]=a}return r},parseMaterials:function(e,t){var r={},i={};if(void 0!==e){var o=new oi;o.setTextures(t);for(var n=0,a=e.length;n<a;n++){var s=e[n];if("MultiMaterial"===s.type){for(var $=[],d=0;d<s.materials.length;d++){var p=s.materials[d];void 0===r[p.uuid]&&(r[p.uuid]=o.parse(p)),$.push(r[p.uuid])}i[s.uuid]=$}else void 0===r[s.uuid]&&(r[s.uuid]=o.parse(s)),i[s.uuid]=r[s.uuid]}}return i},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],o=xa.parse(i);void 0!==i.uuid&&(o.uuid=i.uuid),t.push(o)}return t},parseImages:function(e,t){var r=this,i={};function o(e){return r.manager.itemStart(e),n.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemError(e),r.manager.itemEnd(e)})}if(void 0!==e&&e.length>0){var n=new Sd(new pl(t));n.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var $=e[a],d=$.url;if(Array.isArray(d)){i[$.uuid]=[];for(var p=0,c=d.length;p<c;p++){var l=d[p],h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:r.resourcePath+l;i[$.uuid].push(o(h))}}else{h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test($.url)?$.url:r.resourcePath+$.url;i[$.uuid]=o(h)}}}return i},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var o=0,n=e.length;o<n;o++){var a,s=e[o];void 0===s.image&&console.warn("THREE.ObjectLoader: No \"image\" specified for",s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(t[s.image])?new kb(t[s.image]):new m(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=r(s.mapping,_t)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=r(s.wrap[0],wl),a.wrapT=r(s.wrap[1],wl)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=r(s.minFilter,xl)),void 0!==s.magFilter&&(a.magFilter=r(s.magFilter,xl)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),i[s.uuid]=a}return i},parseObject:function(e,t,r){var i;function o(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function n(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,o=e.length;i<o;i++){var n=e[i];void 0===r[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),t.push(r[n])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}switch(e.type){case"Scene":i=new jd,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new g(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new Kh(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new Jh(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new D(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Uf(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new mi(e.color,e.intensity);break;case"DirectionalLight":i=new li(e.color,e.intensity);break;case"PointLight":i=new ji(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new ni(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new hi(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new fi(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=o(e.geometry),s=n(e.material);i=a.bones&&a.bones.length>0?new pf(a,s):new F(a,s);break;case"InstancedMesh":a=o(e.geometry),s=n(e.material);var $=e.count,d=e.instanceMatrix;(i=new Oh(a,s,$)).instanceMatrix=new q(new Float32Array(d.array),16);break;case"LOD":i=new of;break;case"Line":i=new P(o(e.geometry),n(e.material),e.mode);break;case"LineLoop":i=new Ph(o(e.geometry),n(e.material));break;case"LineSegments":i=new A(o(e.geometry),n(e.material));break;case"PointCloud":case"Points":i=new wf(o(e.geometry),n(e.material));break;case"Sprite":i=new Mh(n(e.material));break;case"Group":i=new ud;break;default:i=new b;}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.drawMode&&i.setDrawMode(e.drawMode),void 0!==e.children)for(var p=e.children,c=0;c<p.length;c++)i.add(this.parseObject(p[c],t,r));if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);for(var l=e.levels,h=0;h<l.length;h++){var u=l[h],f=i.getObjectByProperty("uuid",u.object);void 0!==f&&i.addLevel(f,u.distance)}}return i}});var vl,_t={UVMapping:Ug,CubeReflectionMapping:Vg,CubeRefractionMapping:Wg,EquirectangularReflectionMapping:Xj,EquirectangularRefractionMapping:Xg,SphericalReflectionMapping:Yj,CubeUVReflectionMapping:Yg,CubeUVRefractionMapping:Zg},wl={RepeatWrapping:Ee,ClampToEdgeWrapping:Y,MirroredRepeatWrapping:Fe},xl={NearestFilter:Q,NearestMipmapNearestFilter:$g,NearestMipmapLinearFilter:_g,LinearFilter:N,LinearMipmapNearestFilter:Zj,LinearMipmapLinearFilter:Ge};function yl(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),i.call(this,e),this.options=void 0}function zl(){this.type="ShapePath",this.color=new g,this.subPaths=[],this.currentPath=null}function Al(e){this.type="Font",this.data=e}function au(e,t,r){for(var i=Array.from?Array.from(e):String(e).split(""),o=t/r.resolution,n=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*o,a=[],s=0,$=0,d=0;d<i.length;d++){var p=i[d];if("\n"===p)s=0,$-=n;else{var c=bu(p,o,s,$,r);s+=c.offsetX,a.push(c.path)}}return a}function bu(e,t,r,i,o){var n=o.glyphs[e]||o.glyphs["?"];if(n){var a,s,$,d,p,c,l,h,u=new zl;if(n.o)for(var f=n._cachedOutline||(n._cachedOutline=n.o.split(" ")),m=0,v=f.length;m<v;){switch(f[m++]){case"m":a=f[m++]*t+r,s=f[m++]*t+i,u.moveTo(a,s);break;case"l":a=f[m++]*t+r,s=f[m++]*t+i,u.lineTo(a,s);break;case"q":$=f[m++]*t+r,d=f[m++]*t+i,p=f[m++]*t+r,c=f[m++]*t+i,u.quadraticCurveTo(p,c,$,d);break;case"b":$=f[m++]*t+r,d=f[m++]*t+i,p=f[m++]*t+r,c=f[m++]*t+i,l=f[m++]*t+r,h=f[m++]*t+i,u.bezierCurveTo(p,c,l,h,$,d);}}return{offsetX:n.ha*t,path:u}}console.error("THREE.Font: character \""+e+"\" does not exists in font family "+o.familyName+".")}function Bl(e){i.call(this,e)}yl.prototype=Object.assign(Object.create(i.prototype),{constructor:yl,setOptions:function(e){return this.options=e,this},load:function(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,n=Sc.get(e);if(void 0!==n)return o.manager.itemStart(e),setTimeout(function(){t&&t(n),o.manager.itemEnd(e)},0),n;fetch(e).then(function(e){return e.blob()}).then(function(e){return void 0===o.options?createImageBitmap(e):createImageBitmap(e,o.options)}).then(function(r){Sc.add(e,r),t&&t(r),o.manager.itemEnd(e)}).catch(function(t){i&&i(t),o.manager.itemError(e),o.manager.itemEnd(e)}),o.manager.itemStart(e)}}),Object.assign(zl.prototype,{moveTo:function(e,t){return this.currentPath=new La,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this},bezierCurveTo:function(e,t,r,i,o,n){return this.currentPath.bezierCurveTo(e,t,r,i,o,n),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function r(e){for(var t=[],r=0,i=e.length;r<i;r++){var o=e[r],n=new Ob;n.curves=o.curves,t.push(n)}return t}function i(e,t){for(var r=t.length,i=!1,o=r-1,n=0;n<r;o=n++){var a=t[o],s=t[n],$=s.x-a.x,d=s.y-a.y;if(Math.abs(d)>Number.EPSILON){if(d<0&&(a=t[n],$=-$,s=t[o],d=-d),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var p=d*(e.x-a.x)-$*(e.y-a.y);if(0===p)return!0;if(p<0)continue;i=!i}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return i}var o=ob.isClockWise,n=this.subPaths;if(0===n.length)return[];if(!0===t)return r(n);var a,s,$,d=[];if(1===n.length)return s=n[0],($=new Ob).curves=s.curves,d.push($),d;var p=!o(n[0].getPoints());p=e?!p:p;var c,l,h=[],u=[],f=[],m=0;u[m]=void 0,f[m]=[];for(var v=0,x=n.length;v<x;v++)a=o(c=(s=n[v]).getPoints()),(a=e?!a:a)?(!p&&u[m]&&m++,u[m]={s:new Ob,p:c},u[m].s.curves=s.curves,p&&m++,f[m]=[]):f[m].push({h:s,p:c[0]});if(!u[0])return r(n);if(u.length>1){for(var R=!1,g=[],q=0,y=u.length;q<y;q++)h[q]=[];for(q=0,y=u.length;q<y;q++)for(var K=f[q],_=0;_<K.length;_++){for(var b=K[_],M=!0,w=0;w<u.length;w++)i(b.p,u[w].p)&&(q!==w&&g.push({froms:q,tos:w,hole:_}),M?(M=!1,h[w].push(b)):R=!0);M&&h[q].push(b)}g.length>0&&(R||(f=h))}v=0;for(var S=u.length;v<S;v++){$=u[v].s,d.push($);for(var T=0,E=(l=f[v]).length;T<E;T++)$.holes.push(l[T].h)}return d}}),Object.assign(Al.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var r=[],i=au(e,t,this.data),o=0,n=i.length;o<n;o++)Array.prototype.push.apply(r,i[o].toShapes());return r}}),Bl.prototype=Object.assign(Object.create(i.prototype),{constructor:Bl,load:function(e,t,r,i){var o=this,n=new Ga(this.manager);n.setPath(this.path),n.load(e,function(e){var r;try{r=JSON.parse(e)}catch(n){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var i=o.parse(r);t&&t(i)},r,i)},parse:function(e){return new Al(e)}});var Cl={getContext:function(){return void 0===vl&&(vl=new(window.AudioContext||window.webkitAudioContext)),vl},setContext:function(e){vl=e}};function ui(e){i.call(this,e)}function vi(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new aa)}function Ma(e,t){u.call(this,void 0,t),this.sh=void 0!==e?e:new vi}function Dl(e,t,r){Ma.call(this,void 0,r);var i=new g().set(e),o=new g().set(t),n=new aa(i.r,i.g,i.b),a=new aa(o.r,o.g,o.b),s=Math.sqrt(Math.PI),$=s*Math.sqrt(.75);this.sh.coefficients[0].copy(n).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(n).sub(a).multiplyScalar($)}function El(e,t){Ma.call(this,void 0,t);var r=new g().set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}ui.prototype=Object.assign(Object.create(i.prototype),{constructor:ui,load:function(e,t,r,i){var o=new Ga(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,function(e){var r=e.slice(0);Cl.getContext().decodeAudioData(r,function(e){t(e)})},r,i)}}),Object.assign(vi.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var r=e.x,i=e.y,o=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.282095),t.addScale(n[1],.488603*i),t.addScale(n[2],.488603*o),t.addScale(n[3],.488603*r),t.addScale(n[4],r*i*1.092548),t.addScale(n[5],i*o*1.092548),t.addScale(n[6],.315392*(3*o*o-1)),t.addScale(n[7],r*o*1.092548),t.addScale(n[8],.546274*(r*r-i*i)),t},getIrradianceAt:function(e,t){var r=e.x,i=e.y,o=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.886227),t.addScale(n[1],1.023328*i),t.addScale(n[2],1.023328*o),t.addScale(n[3],1.023328*r),t.addScale(n[4],.858086*r*i),t.addScale(n[5],.858086*i*o),t.addScale(n[6],.743125*o*o-.247708),t.addScale(n[7],.858086*r*o),t.addScale(n[8],.429043*(r*r-i*i)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var r=this.coefficients,i=0;i<9;i++)r[i].fromArray(e,t+3*i);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var r=this.coefficients,i=0;i<9;i++)r[i].toArray(e,t+3*i);return e}}),Object.assign(vi,{getBasisAt:function(e,t){var r=e.x,i=e.y,o=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*o,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*r*o,t[8]=.546274*(r*r-i*i)}}),Ma.prototype=Object.assign(Object.create(u.prototype),{constructor:Ma,isLightProbe:!0,copy:function(e){return u.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return u.prototype.toJSON.call(this,e)}}),Dl.prototype=Object.assign(Object.create(Ma.prototype),{constructor:Dl,isHemisphereLightProbe:!0,copy:function(e){return Ma.prototype.copy.call(this,e),this},toJSON:function(e){return Ma.prototype.toJSON.call(this,e)}}),El.prototype=Object.assign(Object.create(Ma.prototype),{constructor:El,isAmbientLightProbe:!0,copy:function(e){return Ma.prototype.copy.call(this,e),this},toJSON:function(e){return Ma.prototype.toJSON.call(this,e)}});var Fl=new da,Gl=new da;function cu(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new D,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new D,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Hl(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(cu.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var r,i,o=e.projectionMatrix.clone(),n=t.eyeSep/2,a=n*t.near/t.focus,s=t.near*Math.tan(ea.DEG2RAD*t.fov*.5)/t.zoom;Gl.elements[12]=-n,Fl.elements[12]=n,r=-s*t.aspect+a,i=s*t.aspect+a,o.elements[0]=2*t.near/(i-r),o.elements[8]=(i+r)/(i-r),this.cameraL.projectionMatrix.copy(o),r=-s*t.aspect-a,i=s*t.aspect-a,o.elements[0]=2*t.near/(i-r),o.elements[8]=(i+r)/(i-r),this.cameraR.projectionMatrix.copy(o)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Gl),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Fl)}}),Object.assign(Hl.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var Pb=new aa,Il=new S,du=new aa,Qb=new aa;function Jl(){b.call(this),this.type="AudioListener",this.context=Cl.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Hl}function Wd(e){b.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Jl.prototype=Object.assign(Object.create(b.prototype),{constructor:Jl,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){b.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Pb,Il,du),Qb.set(0,0,-1).applyQuaternion(Il),t.positionX){var i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Pb.x,i),t.positionY.linearRampToValueAtTime(Pb.y,i),t.positionZ.linearRampToValueAtTime(Pb.z,i),t.forwardX.linearRampToValueAtTime(Qb.x,i),t.forwardY.linearRampToValueAtTime(Qb.y,i),t.forwardZ.linearRampToValueAtTime(Qb.z,i),t.upX.linearRampToValueAtTime(r.x,i),t.upY.linearRampToValueAtTime(r.y,i),t.upZ.linearRampToValueAtTime(r.z,i)}else t.setPosition(Pb.x,Pb.y,Pb.z),t.setOrientation(Qb.x,Qb.y,Qb.z,r.x,r.y,r.z)}}),Wd.prototype=Object.assign(Object.create(b.prototype),{constructor:Wd,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var Rb=new aa,Kl=new S,eu=new aa,Sb=new aa;function Ll(e){Wd.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Ml(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Nl(e,t,r){this.binding=e,this.valueSize=r;var i,o=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":o=Array,i=this._select;break;default:i=this._lerp;}this.buffer=new o(4*r),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Ll.prototype=Object.assign(Object.create(Wd.prototype),{constructor:Ll,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(e){if(b.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Rb,Kl,eu),Sb.set(0,0,1).applyQuaternion(Kl);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Rb.x,r),t.positionY.linearRampToValueAtTime(Rb.y,r),t.positionZ.linearRampToValueAtTime(Rb.z,r),t.orientationX.linearRampToValueAtTime(Sb.x,r),t.orientationY.linearRampToValueAtTime(Sb.y,r),t.orientationZ.linearRampToValueAtTime(Sb.z,r)}else t.setPosition(Rb.x,Rb.y,Rb.z),t.setOrientation(Sb.x,Sb.y,Sb.z)}}}),Object.assign(Ml.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(Nl.prototype,{accumulate:function(e,t){var r=this.buffer,i=this.valueSize,o=e*i+i,n=this.cumulativeWeight;if(0===n){for(var a=0;a!==i;++a)r[o+a]=r[a];n=t}else{var s=t/(n+=t);this._mixBufferRegion(r,o,0,s,i)}this.cumulativeWeight=n},apply:function(e){var t=this.valueSize,r=this.buffer,i=e*t+t,o=this.cumulativeWeight,n=this.binding;if(this.cumulativeWeight=0,o<1){var a=3*t;this._mixBufferRegion(r,i,a,1-o,t)}for(var s=t,$=t+t;s!==$;++s)if(r[s]!==r[s+t]){n.setValue(r,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,i=3*r;e.getValue(t,i);for(var o=r,n=i;o!==n;++o)t[o]=t[i+o%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,i,o){if(i>=.5)for(var n=0;n!==o;++n)e[t+n]=e[r+n]},_slerp:function(e,t,r,i){S.slerpFlat(e,t,e,t,e,r,i)},_lerp:function(e,t,r,i,o){for(var n=1-i,a=0;a!==o;++a){var s=t+a;e[s]=e[s]*n+e[r+a]*i}}});var wi="\\[\\]\\.:\\/",fu=new RegExp("["+wi+"]","g"),xi="[^"+wi+"]",gu="[^"+wi.replace("\\.","")+"]",hu=/((?:WC+[\/:])*)/.source.replace("WC",xi),iu=/(WCOD+)?/.source.replace("WCOD",gu),ju=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",xi),ku=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",xi),lu=new RegExp("^"+hu+iu+ju+ku+"$"),mu=["material","materials","bones"];function Ol(e,t,r){var i=r||V.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function V(e,t,r){this.path=t,this.parsedPath=r||V.parseTrackName(t),this.node=V.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function nu(){this.uuid=ea.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}function Pl(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var i=t.tracks,o=i.length,n=new Array(o),a={endingStart:fc,endingEnd:fc},s=0;s!==o;++s){var $=i[s].createInterpolant(null);n[s]=$,$.settings=a}this._interpolantSettings=a,this._interpolants=n,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=kp,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Ql(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function yi(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Rl(e,t,r){mb.call(this,e,t),this.meshPerAttribute=r||1}function ou(e,t,r,i){this.ray=new mc(e,t),this.near=r||0,this.far=i||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Sl(e,t){return e.distance-t.distance}function zi(e,t,r,i){if(!1!==e.visible&&(e.raycast(t,r),!0===i))for(var o=e.children,n=0,a=o.length;n<a;n++)zi(o[n],t,r,!0)}function pu(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function qu(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}Object.assign(Ol.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,o=r.length;i!==o;++i)r[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(V,{Composite:Ol,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new V.Composite(e,t,r):new V(e,t,r)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(fu,"")},parseTrackName:function(e){var t=lu.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var o=r.nodeName.substring(i+1);-1!==mu.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r},findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var i=function(e){for(var r=0;r<e.length;r++){var o=e[r];if(o.name===t||o.uuid===t)return o;var n=i(o.children);if(n)return n}return null},o=i(e.children);if(o)return o}return null}}),Object.assign(V.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,i=0,o=r.length;i!==o;++i)e[t++]=r[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,i=0,o=r.length;i!==o;++i)r[i]=e[t++]},function(e,t){for(var r=this.resolvedProperty,i=0,o=r.length;i!==o;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,i=0,o=r.length;i!==o;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,o=t.propertyIndex;if(e||(e=V.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var n=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===n){n=a;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r];}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}var s=e[i];if(void 0!==s){var $=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?$=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&($=this.Versioning.MatrixWorldNeedsUpdate);var d=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===o){o=a;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===o){o=a;break}}}d=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=o}else void 0!==s.fromArray&&void 0!==s.toArray?(d=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(d=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[d],this.setValue=this.SetterByBindingTypeAndVersioning[d][$]}else{var p=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+p+"."+i+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(V.prototype,{_getValue_unbound:V.prototype.getValue,_setValue_unbound:V.prototype.setValue}),Object.assign(nu.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,o=this._paths,n=this._parsedPaths,a=this._bindings,s=a.length,$=void 0,d=0,p=arguments.length;d!==p;++d){var c=arguments[d],l=c.uuid,h=i[l];if(void 0===h){h=t++,i[l]=h,e.push(c);for(var u=0,f=s;u!==f;++u)a[u].push(new V(c,o[u],n[u]))}else if(h<r){$=e[h];var m=--r,v=e[m];i[v.uuid]=h,e[h]=v,i[l]=m,e[m]=c;for(u=0,f=s;u!==f;++u){var x=a[u],R=x[m],g=x[h];x[h]=R,void 0===g&&(g=new V(c,o[u],n[u])),x[m]=g}}else e[h]!==$&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,o=i.length,n=0,a=arguments.length;n!==a;++n){var s=arguments[n],$=s.uuid,d=r[$];if(void 0!==d&&d>=t){var p=t++,c=e[p];r[c.uuid]=d,e[d]=c,r[$]=p,e[p]=s;for(var l=0,h=o;l!==h;++l){var u=i[l],f=u[p],m=u[d];u[d]=f,u[p]=m}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,o=this._bindings,n=o.length,a=0,s=arguments.length;a!==s;++a){var $=arguments[a].uuid,d=i[$];if(void 0!==d)if(delete i[$],d<r){var p=--r,c=e[p],l=e[v=--t];i[c.uuid]=d,e[d]=c,i[l.uuid]=p,e[p]=l,e.pop();for(var h=0,u=n;h!==u;++h){var f=(x=o[h])[p],m=x[v];x[d]=f,x[p]=m,x.pop()}}else{var v;i[(l=e[v=--t]).uuid]=d,e[d]=l,e.pop();for(h=0,u=n;h!==u;++h){var x;(x=o[h])[d]=x[v],x.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,i=r[e],o=this._bindings;if(void 0!==i)return o[i];var n=this._paths,a=this._parsedPaths,s=this._objects,$=s.length,d=this.nCachedObjects_,p=new Array($);i=o.length,r[e]=i,n.push(e),a.push(t),o.push(p);for(var c=d,l=s.length;c!==l;++c){var h=s[c];p[c]=new V(h,e,t)}return p},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var i=this._paths,o=this._parsedPaths,n=this._bindings,a=n.length-1,s=n[a];t[e[a]]=r,n[r]=s,n.pop(),o[r]=o[a],o.pop(),i[r]=i[a],i.pop()}}}),Object.assign(Pl.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var i=this._clip.duration,o=e._clip.duration,n=o/i,a=i/o;e.warp(1,n,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var i=this._mixer,o=i.time,n=this._timeScaleInterpolant,a=this.timeScale;null===n&&(n=i._lendControlInterpolant(),this._timeScaleInterpolant=n);var s=n.parameterPositions,$=n.sampleValues;return s[0]=o,s[1]=o+r,$[0]=e/a,$[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,i){if(this.enabled){var o=this._startTime;if(null!==o){var n=(e-o)*r;if(n<0||0===r)return;this._startTime=null,t=r*n}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var $=this._interpolants,d=this._propertyBindings,p=0,c=$.length;p!==c;++p)$[p].evaluate(a),d[p].accumulate(i,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,i=this.loop,o=this._loopCount,n=i===lp;if(0===e)return-1===o?t:n&&1==(1&o)?r-t:t;if(i===jp){-1===o&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===o&&(e>=0?(o=0,this._setEndings(!0,0===this.repetitions,n)):this._setEndings(0===this.repetitions,!0,n)),t>=r||t<0){var a=Math.floor(t/r);t-=r*a,o+=Math.abs(a);var s=this.repetitions-o;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var $=e<0;this._setEndings($,!$,n)}else this._setEndings(!1,!1,n);this._loopCount=o,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=t;if(n&&1==(1&o))return r-t}return t},_setEndings:function(e,t,r){var i=this._interpolantSettings;r?(i.endingStart=gc,i.endingEnd=gc):(i.endingStart=e?this.zeroSlopeAtStart?gc:fc:Le,i.endingEnd=t?this.zeroSlopeAtEnd?gc:fc:Le)},_scheduleFading:function(e,t,r){var i=this._mixer,o=i.time,n=this._weightInterpolant;null===n&&(n=i._lendControlInterpolant(),this._weightInterpolant=n);var a=n.parameterPositions,s=n.sampleValues;return a[0]=o,s[0]=t,a[1]=o+e,s[1]=r,this}}),Ql.prototype=Object.assign(Object.create(Aa.prototype),{constructor:Ql,_bindAction:function(e,t){var r=e._localRoot||this._root,i=e._clip.tracks,o=i.length,n=e._propertyBindings,a=e._interpolants,s=r.uuid,$=this._bindingsByRootAndName,d=$[s];void 0===d&&(d={},$[s]=d);for(var p=0;p!==o;++p){var c=i[p],l=c.name,h=d[l];if(void 0!==h)n[p]=h;else{if(void 0!==(h=n[p])){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,s,l));continue}var u=t&&t._propertyBindings[p].binding.parsedPath;++(h=new Nl(V.create(r,l,u),c.ValueTypeName,c.getValueSize())).referenceCount,this._addInactiveBinding(h,s,l),n[p]=h}a[p].resultBuffer=h.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t)}for(var o=e._propertyBindings,n=0,a=o.length;n!==a;++n){var s=o[n];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var o=t[r];0==--o.useCount&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var i=this._actions,o=this._actionsByClip,n=o[t];if(void 0===n)n={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=n;else{var a=n.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),n.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;var o=e._clip.uuid,n=this._actionsByClip,a=n[o],s=a.knownActions,$=s[s.length-1],d=e._byClipCacheIndex;$._byClipCacheIndex=d,s[d]=$,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete n[o],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var o=t[r];0==--o.referenceCount&&this._removeInactiveBinding(o)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=r,t[r]=o},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=r,t[r]=o},_addInactiveBinding:function(e,t,r){var i=this._bindingsByRootAndName,o=i[t],n=this._bindings;void 0===o&&(o={},i[t]=o),o[r]=e,e._cacheIndex=n.length,n.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,i=r.rootNode.uuid,o=r.path,n=this._bindingsByRootAndName,a=n[i],s=t[t.length-1],$=e._cacheIndex;s._cacheIndex=$,t[$]=s,t.pop(),delete a[o],0===Object.keys(a).length&&delete n[i]},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=r,t[r]=o},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=r,t[r]=o},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new Rf(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,o=t[i];e.__cacheIndex=i,t[i]=e,o.__cacheIndex=r,t[r]=o},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,i=r.uuid,o="string"==typeof e?xa.findByName(r,e):e,n=null!==o?o.uuid:e,a=this._actionsByClip[n],s=null;if(void 0!==a){var $=a.actionByRoot[i];if(void 0!==$)return $;s=a.knownActions[0],null===o&&(o=s._clip)}if(null===o)return null;var d=new Pl(this,o,t);return this._bindAction(d,s),this._addInactiveAction(d,n,i),d},existingAction:function(e,t){var r=t||this._root,i=r.uuid,o="string"==typeof e?xa.findByName(r,e):e,n=o?o.uuid:e,a=this._actionsByClip[n];return void 0!==a&&a.actionByRoot[i]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var o=0;o!==t;++o)e[o].reset();for(o=0;o!==i;++o)r[o].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,i=this.time+=e,o=Math.sign(e),n=this._accuIndex^=1,a=0;a!==r;++a){t[a]._update(i,e,o,n)}var s=this._bindings,$=this._nActiveBindings;for(a=0;a!==$;++a)s[a].apply(n);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,i=this._actionsByClip,o=i[r];if(void 0!==o){for(var n=o.knownActions,a=0,s=n.length;a!==s;++a){var $=n[a];this._deactivateAction($);var d=$._cacheIndex,p=t[t.length-1];$._cacheIndex=null,$._byClipCacheIndex=null,p._cacheIndex=d,t[d]=p,t.pop(),this._removeInactiveBindingsForAction($)}delete i[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var i in r){var o=r[i].actionByRoot[t];void 0!==o&&(this._deactivateAction(o),this._removeInactiveAction(o))}var n=this._bindingsByRootAndName[t];if(void 0!==n)for(var a in n){var s=n[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),yi.prototype.clone=function(){return new yi(void 0===this.value.clone?this.value:this.value.clone())},Rl.prototype=Object.assign(Object.create(mb.prototype),{constructor:Rl,isInstancedInterleavedBuffer:!0,copy:function(e){return mb.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(ou.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var i=r||[];return zi(e,this,i,t),i.sort(Sl),i},intersectObjects:function(e,t,r){var i=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var o=0,n=e.length;o<n;o++)zi(e[o],this,i,t);return i.sort(Sl),i}}),Object.assign(pu.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(ea.clamp(t/this.radius,-1,1))),this}}),Object.assign(qu.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}});var Tl=new ba;function Ul(e,t){this.min=void 0!==e?e:new ba(1/0,1/0),this.max=void 0!==t?t:new ba(-1/0,-1/0)}Object.assign(Ul.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=Tl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new ba),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new ba),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new ba),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new ba),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Tl.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Vl=new aa,Vf=new aa;function Wl(e,t){this.start=void 0!==e?e:new aa,this.end=void 0!==t?t:new aa}function Wf(e){b.call(this),this.material=e,this.render=function(){}}Object.assign(Wl.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new aa),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new aa),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new aa),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){Vl.subVectors(e,this.start),Vf.subVectors(this.end,this.start);var r=Vf.dot(Vf),i=Vf.dot(Vl)/r;return t&&(i=ea.clamp(i,0,1)),i},closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new aa),this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Wf.prototype=Object.create(b.prototype),Wf.prototype.constructor=Wf,Wf.prototype.isImmediateRenderObject=!0;var Na=new aa,bb=new aa,Ai=new L,ru=["a","b","c"];function Xf(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var o=void 0!==r?r:16711680,n=void 0!==i?i:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var $=new k,d=new j(2*a*3,3);$.setAttribute("position",d),A.call(this,$,new y({color:o,linewidth:n})),this.matrixAutoUpdate=!1,this.update()}Xf.prototype=Object.create(A.prototype),Xf.prototype.constructor=Xf,Xf.prototype.update=function(){this.object.updateMatrixWorld(!0),Ai.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry;if(r&&r.isGeometry)for(var i=r.vertices,o=r.faces,n=0,a=0,s=o.length;a<s;a++)for(var $=o[a],d=0,p=$.vertexNormals.length;d<p;d++){var c=i[$[ru[d]]],l=$.vertexNormals[d];Na.copy(c).applyMatrix4(e),bb.copy(l).applyMatrix3(Ai).normalize().multiplyScalar(this.size).add(Na),t.setXYZ(n,Na.x,Na.y,Na.z),n+=1,t.setXYZ(n,bb.x,bb.y,bb.z),n+=1}else if(r&&r.isBufferGeometry){var h=r.attributes.position,u=r.attributes.normal;for(n=0,d=0,p=h.count;d<p;d++)Na.set(h.getX(d),h.getY(d),h.getZ(d)).applyMatrix4(e),bb.set(u.getX(d),u.getY(d),u.getZ(d)),bb.applyMatrix3(Ai).normalize().multiplyScalar(this.size).add(Na),t.setXYZ(n,Na.x,Na.y,Na.z),n+=1,t.setXYZ(n,bb.x,bb.y,bb.z),n+=1}t.needsUpdate=!0};var Xl=new aa;function Xd(e,t){b.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new k,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],o=0,n=1;o<32;o++,n++){var a=o/32*Math.PI*2,s=n/32*Math.PI*2;i.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}r.setAttribute("position",new j(i,3));var $=new y({fog:!1});this.cone=new A(r,$),this.add(this.cone),this.update()}Xd.prototype=Object.create(b.prototype),Xd.prototype.constructor=Xd,Xd.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Xd.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Xl.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Xl),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var rb=new aa,Yf=new da,Bi=new da;function Yl(e){var t=[];e&&e.isBone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,Yl(e.children[r]));return t}function Yd(e){for(var t=Yl(e),r=new k,i=[],o=[],n=new g(0,0,1),a=new g(0,1,0),s=0;s<t.length;s++){var $=t[s];$.parent&&$.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),o.push(n.r,n.g,n.b),o.push(a.r,a.g,a.b))}r.setAttribute("position",new j(i,3)),r.setAttribute("color",new j(o,3));var d=new y({vertexColors:cc,depthTest:!1,depthWrite:!1,transparent:!0});A.call(this,r,d),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Zd(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var i=new Nb(t,4,2),o=new oa({wireframe:!0,fog:!1});F.call(this,i,o),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function $d(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var r=new k;r.setAttribute("position",new j([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere();var i=new y({fog:!1});P.call(this,r,i);var o=new k;o.setAttribute("position",new j([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),o.computeBoundingSphere(),this.add(new F(o,new oa({side:ga,fog:!1}))),this.update()}Yd.prototype=Object.create(A.prototype),Yd.prototype.constructor=Yd,Yd.prototype.updateMatrixWorld=function(e){var t=this.bones,r=this.geometry,i=r.getAttribute("position");Bi.getInverse(this.root.matrixWorld);for(var o=0,n=0;o<t.length;o++){var a=t[o];a.parent&&a.parent.isBone&&(Yf.multiplyMatrices(Bi,a.matrixWorld),rb.setFromMatrixPosition(Yf),i.setXYZ(n,rb.x,rb.y,rb.z),Yf.multiplyMatrices(Bi,a.parent.matrixWorld),rb.setFromMatrixPosition(Yf),i.setXYZ(n+1,rb.x,rb.y,rb.z),n+=2)}r.getAttribute("position").needsUpdate=!0,b.prototype.updateMatrixWorld.call(this,e)},Zd.prototype=Object.create(F.prototype),Zd.prototype.constructor=Zd,Zd.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Zd.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},$d.prototype=Object.create(P.prototype),$d.prototype.constructor=$d,$d.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},$d.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};var su=new aa,Zl=new g,$l=new g;function _d(e,t,r){b.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var i=new Ec(t);i.rotateY(.5*Math.PI),this.material=new oa({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=cc);var o=i.getAttribute("position"),n=new Float32Array(3*o.count);i.setAttribute("color",new q(n,3)),this.add(new F(i,this.material)),this.update()}function ae(e,t){this.lightProbe=e,this.size=t;var r={GAMMA_OUTPUT:""},i=new T({defines:r,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),o=new Nb(1,32,16);F.call(this,o,i),this.onBeforeRender()}function Ci(e,t,r,i){e=e||10,t=t||10,r=new g(void 0!==r?r:4473924),i=new g(void 0!==i?i:8947848);for(var o=t/2,n=e/t,a=e/2,s=[],$=[],d=0,p=0,c=-a;d<=t;d++,c+=n){s.push(-a,0,c,a,0,c),s.push(c,0,-a,c,0,a);var l=d===o?r:i;l.toArray($,p),p+=3,l.toArray($,p),p+=3,l.toArray($,p),p+=3,l.toArray($,p),p+=3}var h=new k;h.setAttribute("position",new j(s,3)),h.setAttribute("color",new j($,3));var u=new y({vertexColors:cc});A.call(this,h,u)}function Di(e,t,r,i,o,n){e=e||10,t=t||16,r=r||8,i=i||64,o=new g(void 0!==o?o:4473924),n=new g(void 0!==n?n:8947848);var a,s,$,d,p,c,l,h=[],u=[];for(d=0;d<=t;d++)$=d/t*(2*Math.PI),a=Math.sin($)*e,s=Math.cos($)*e,h.push(0,0,0),h.push(a,0,s),l=1&d?o:n,u.push(l.r,l.g,l.b),u.push(l.r,l.g,l.b);for(d=0;d<=r;d++)for(l=1&d?o:n,c=e-e/r*d,p=0;p<i;p++)$=p/i*(2*Math.PI),a=Math.sin($)*c,s=Math.cos($)*c,h.push(a,0,s),u.push(l.r,l.g,l.b),$=(p+1)/i*(2*Math.PI),a=Math.sin($)*c,s=Math.cos($)*c,h.push(a,0,s),u.push(l.r,l.g,l.b);var f=new k;f.setAttribute("position",new j(h,3)),f.setAttribute("color",new j(u,3));var m=new y({vertexColors:cc});A.call(this,f,m)}function be(e,t,r,i){this.audio=e,this.range=t||1,this.divisionsInnerAngle=r||16,this.divisionsOuterAngle=i||2;var o=new k,n=this.divisionsInnerAngle+2*this.divisionsOuterAngle,a=new Float32Array(3*(3*n+3));o.setAttribute("position",new q(a,3));var s=new y({color:65280}),$=new y({color:16776960});P.call(this,o,[$,s]),this.update()}_d.prototype=Object.create(b.prototype),_d.prototype.constructor=_d,_d.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},_d.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");Zl.copy(this.light.color),$l.copy(this.light.groundColor);for(var r=0,i=t.count;r<i;r++){var o=r<i/2?Zl:$l;t.setXYZ(r,o.r,o.g,o.b)}t.needsUpdate=!0}e.lookAt(su.setFromMatrixPosition(this.light.matrixWorld).negate())},ae.prototype=Object.create(F.prototype),ae.prototype.constructor=ae,ae.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},ae.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},Ci.prototype=Object.assign(Object.create(A.prototype),{constructor:Ci,copy:function(e){return A.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return new this.constructor().copy(this)}}),Di.prototype=Object.create(A.prototype),Di.prototype.constructor=Di,be.prototype=Object.create(P.prototype),be.prototype.constructor=be,be.prototype.update=function(){var e,t,r=this.audio,i=this.range,o=this.divisionsInnerAngle,n=this.divisionsOuterAngle,a=ea.degToRad(r.panner.coneInnerAngle),s=ea.degToRad(r.panner.coneOuterAngle),$=a/2,d=s/2,p=0,c=0,l=this.geometry,h=l.attributes.position;function u(r,o,n,a){var s=(o-r)/n;for(h.setXYZ(p,0,0,0),c++,e=r;e<o;e+=s)t=p+c,h.setXYZ(t,Math.sin(e)*i,0,Math.cos(e)*i),h.setXYZ(t+1,Math.sin(Math.min(e+s,o))*i,0,Math.cos(Math.min(e+s,o))*i),h.setXYZ(t+2,0,0,0),c+=3;l.addGroup(p,c,a),p+=c,c=0}l.clearGroups(),u(-d,-$,n,0),u(-$,$,o,1),u($,d,n,0),h.needsUpdate=!0,a===s&&(this.material[0].visible=!1)},be.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()};var ce=new aa,Zf=new aa,_l=new L;function $f(e,t,r,i){this.object=e,this.size=void 0!==t?t:1;var o=void 0!==r?r:16776960,n=void 0!==i?i:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var $=new k,d=new j(2*a*3,3);$.setAttribute("position",d),A.call(this,$,new y({color:o,linewidth:n})),this.matrixAutoUpdate=!1,this.update()}$f.prototype=Object.create(A.prototype),$f.prototype.constructor=$f,$f.prototype.update=function(){this.object.updateMatrixWorld(!0),_l.getNormalMatrix(this.object.matrixWorld);for(var e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry,i=r.vertices,o=r.faces,n=0,a=0,s=o.length;a<s;a++){var $=o[a],d=$.normal;ce.copy(i[$.a]).add(i[$.b]).add(i[$.c]).divideScalar(3).applyMatrix4(e),Zf.copy(d).applyMatrix3(_l).normalize().multiplyScalar(this.size).add(ce),t.setXYZ(n,ce.x,ce.y,ce.z),n+=1,t.setXYZ(n,Zf.x,Zf.y,Zf.z),n+=1}t.needsUpdate=!0};var am=new aa,_f=new aa,bm=new aa;function de(e,t,r){b.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var i=new k;i.setAttribute("position",new j([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var o=new y({fog:!1});this.lightPlane=new P(i,o),this.add(this.lightPlane),(i=new k).setAttribute("position",new j([0,0,0,0,0,1],3)),this.targetLine=new P(i,o),this.add(this.targetLine),this.update()}de.prototype=Object.create(b.prototype),de.prototype.constructor=de,de.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},de.prototype.update=function(){am.setFromMatrixPosition(this.light.matrixWorld),_f.setFromMatrixPosition(this.light.target.matrixWorld),bm.subVectors(_f,am),this.lightPlane.lookAt(_f),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_f),this.targetLine.scale.z=bm.length()};var ag=new aa,E=new Wa;function bg(e){var t=new k,r=new y({color:16777215,vertexColors:mo}),i=[],o=[],n={},a=new g(16755200),s=new g(16711680),$=new g(43775),d=new g(16777215),p=new g(3355443);function c(e,t,r){l(e,r),l(t,r)}function l(e,t){i.push(0,0,0),o.push(t.r,t.g,t.b),void 0===n[e]&&(n[e]=[]),n[e].push(i.length/3-1)}c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",s),c("p","n2",s),c("p","n3",s),c("p","n4",s),c("u1","u2",$),c("u2","u3",$),c("u3","u1",$),c("c","t",d),c("p","c",p),c("cn1","cn2",p),c("cn3","cn4",p),c("cf1","cf2",p),c("cf3","cf4",p),t.setAttribute("position",new j(i,3)),t.setAttribute("color",new j(o,3)),A.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update()}function G(e,t,r,i,o,n,a){ag.set(o,n,a).unproject(i);var s=t[e];if(void 0!==s)for(var $=r.getAttribute("position"),d=0,p=s.length;d<p;d++)$.setXYZ(s[d],ag.x,ag.y,ag.z)}bg.prototype=Object.create(A.prototype),bg.prototype.constructor=bg,bg.prototype.update=function(){var e=this.geometry,t=this.pointMap;E.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),G("c",t,e,E,0,0,-1),G("t",t,e,E,0,0,1),G("n1",t,e,E,-1,-1,-1),G("n2",t,e,E,1,-1,-1),G("n3",t,e,E,-1,1,-1),G("n4",t,e,E,1,1,-1),G("f1",t,e,E,-1,-1,1),G("f2",t,e,E,1,-1,1),G("f3",t,e,E,-1,1,1),G("f4",t,e,E,1,1,1),G("u1",t,e,E,.7,1.1,-1),G("u2",t,e,E,-.7,1.1,-1),G("u3",t,e,E,0,2,-1),G("cf1",t,e,E,-1,0,1),G("cf2",t,e,E,1,0,1),G("cf3",t,e,E,0,-1,1),G("cf4",t,e,E,0,1,1),G("cn1",t,e,E,-1,0,-1),G("cn2",t,e,E,1,0,-1),G("cn3",t,e,E,0,-1,-1),G("cn4",t,e,E,0,1,-1),e.getAttribute("position").needsUpdate=!0};var cg=new Ba;function Tb(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),o=new k;o.setIndex(new q(r,1)),o.setAttribute("position",new q(i,3)),A.call(this,o,new y({color:t})),this.matrixAutoUpdate=!1,this.update()}function dg(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new k;i.setIndex(new q(r,1)),i.setAttribute("position",new j([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),A.call(this,i,new y({color:t})),this.geometry.computeBoundingSphere()}function eg(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var i=void 0!==r?r:16776960,o=new k;o.setAttribute("position",new j([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),P.call(this,o,new y({color:i}));var n=new k;n.setAttribute("position",new j([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),n.computeBoundingSphere(),this.add(new F(n,new oa({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}Tb.prototype=Object.create(A.prototype),Tb.prototype.constructor=Tb,Tb.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&cg.setFromObject(this.object),!cg.isEmpty()){var t=cg.min,r=cg.max,i=this.geometry.attributes.position,o=i.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=t.x,o[4]=r.y,o[5]=r.z,o[6]=t.x,o[7]=t.y,o[8]=r.z,o[9]=r.x,o[10]=t.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=t.z,o[15]=t.x,o[16]=r.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=r.x,o[22]=t.y,o[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Tb.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Tb.prototype.copy=function(e){return A.prototype.copy.call(this,e),this.object=e.object,this},Tb.prototype.clone=function(){return new this.constructor().copy(this)},dg.prototype=Object.create(A.prototype),dg.prototype.constructor=dg,dg.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),b.prototype.updateMatrixWorld.call(this,e))},eg.prototype=Object.create(P.prototype),eg.prototype.constructor=eg,eg.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?ga:_c,this.lookAt(this.plane.normal),b.prototype.updateMatrixWorld.call(this,e)};var cm,tu,dm=new aa;function sb(e,t,r,i,o,n){b.call(this),void 0===e&&(e=new aa(0,0,1)),void 0===t&&(t=new aa(0,0,0)),void 0===r&&(r=1),void 0===i&&(i=16776960),void 0===o&&(o=.2*r),void 0===n&&(n=.2*o),void 0===cm&&((cm=new k).setAttribute("position",new j([0,0,0,0,1,0],3)),(tu=new pb(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new P(cm,new y({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new F(tu,new oa({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,o,n)}function Ei(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new k;r.setAttribute("position",new j(t,3)),r.setAttribute("color",new j([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new y({vertexColors:cc});A.call(this,r,i)}sb.prototype=Object.create(b.prototype),sb.prototype.constructor=sb,sb.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{dm.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(dm,t)}},sb.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},sb.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},sb.prototype.copy=function(e){return b.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},sb.prototype.clone=function(){return new this.constructor().copy(this)},Ei.prototype=Object.create(A.prototype),Ei.prototype.constructor=Ei;function em(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),za.call(this,e),this.type="catmullrom"}c.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(c.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(qb.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new w,r=0,i=e.length;r<i;r++){var o=e[r];t.vertices.push(new aa(o.x,o.y,o.z||0))}return t}}),Object.assign(La.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),em.prototype=Object.create(za.prototype),Object.assign(em.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Ci.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Yd.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(i.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ul.extractUrlBase(e)}}),i.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(ti.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Ul.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Ba.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Wl.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(ea,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),ea.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),ea.ceilPowerOfTwo(e)}}),Object.assign(L.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(da.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new aa().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,i,o,n){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,r,o,n)}}),Ca.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},S.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(mc.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(O.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(O,{barycoordFromPoint:function(e,t,r,i,o){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),O.getBarycoord(e,t,r,i,o)},normal:function(e,t,r,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),O.getNormal(e,t,r,i)}}),Object.assign(Ob.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Hc(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ic(this,e)}}),Object.assign(ba.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(aa.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(fa.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(w.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(b.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(b.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(of.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Nh.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),pf.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(c.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),D.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(u.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(q.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===fd},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(fd)}}}),Object.assign(q.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?fd:Oe),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(k.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new q(arguments[1],arguments[2])))},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)}}),Object.defineProperties(k.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(mb.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===fd},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(mb.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?fd:Oe),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Ya.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(yi.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(f.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new g}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===Pj}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Fa.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(T.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Ih.prototype,{clearTarget:function(e,t,r,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Ih.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}}}),Object.defineProperties(Rk.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ib.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(Z.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Hh.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),Object.defineProperties(Wd.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return new ui().load(e,function(e){t.setBuffer(e)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Ml.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},qd.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};Bb.crossOrigin=void 0,Bb.loadTexture=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var o=new _h;o.setCrossOrigin(this.crossOrigin);var n=o.load(e,r,void 0,i);return t&&(n.mapping=t),n},Bb.loadTextureCube=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var o=new $h;o.setCrossOrigin(this.crossOrigin);var n=o.load(e,r,void 0,i);return t&&(n.mapping=t),n},Bb.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Bb.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:io}}));class uu{constructor(e,r,t){this.canvas=e,this.setSize=(e,r)=>{const t=e/r;this.renderer.setSize(e,r,!1),this.camera=new D(100,t,.01,1e3),this.camera.position.z=this.z},this.render=()=>{this.renderer.render(this.scene,this.camera)},this.update=({d:e,position:r,color:t})=>{const{points:n}=this,$=n.geometry;var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d.equal(r.length%e,0),$VCAb$$interop$default.d.equal(t.length%3,0),$.setAttribute("position",new q(r,e)),$.setAttribute("color",new q(t,3)),e>2&&$.computeBoundingSphere(),this.camera.position.z=this.z,this.render()},this.renderer=new Ih({canvas:e}),this.points=new wf(new k(),new nb({vertexColors:cc,size:.001})),this.setSize(r,t),this.scene=new jd,this.scene.add(this.points)}get z(){const e=this.points.geometry.boundingSphere;return!e||isNaN(e.radius)?5:Math.min(5,e.center.z+e.radius+1)}get extent(){const e=Math.PI/180*this.camera.fov,r=this.camera.position.z/3,t=r*Math.tan(e/2);return[t*this.camera.aspect,t,r]}renderPng(){this.render();const e=this.canvas;return e instanceof HTMLCanvasElement?new Promise(r=>e.toBlob(r)):e.convertToBlob()}}let Ub;const ee={init:(e,r,t)=>(Ub=new uu(e,r,t)).extent,resize:(e,r)=>(Ub.setSize(e,r),Ub.render(),Ub.extent),render:()=>Ub.render(),renderPng:()=>Ub.renderPng(),update:e=>(Ub.update(e),Ub.extent)};var fe=yb&&yb.__awaiter||function(e,$,r,t){return new(r||(r=Promise))(function(n,i){function o(e){try{b(t.next(e))}catch($){i($)}}function a(e){try{b(t.throw(e))}catch($){i($)}}function b(e){var $;e.done?n(e.value):($=e.value,$ instanceof r?$:new r(function(e){e($)})).then(o,a)}b((t=t.apply(e,$||[])).next())})};const fg=new Wc,fm=fg.asObservable();yb.extentStream=fm;const gm=new URLSearchParams(window.location.search),hm=Number(gm.get("width")),im=Number(gm.get("height")),Fi=!!hm&&!!im,jm=e=>fe(void 0,void 0,void 0,function*(){const $=ee.init(e,Fi?hm:window.innerWidth,Fi?im:window.innerHeight);fg.next($)});yb.initRenderer=jm;const vu=()=>fe(void 0,void 0,void 0,function*(){return ee.render()});yb.render=vu;const km=()=>fe(void 0,void 0,void 0,function*(){return ee.renderPng()});yb.renderPng=km;const lm=e=>fe(void 0,void 0,void 0,function*(){const $=ee.update(e);fg.next($)});yb.updateRenderer=lm,Fi||(window.onresize=()=>fe(void 0,void 0,void 0,function*(){const e=ee.resize(window.innerWidth,window.innerHeight);fg.next(e)}));const wu=new URLSearchParams(window.location.search),xu="0"!=wu.get("p");const gg=(()=>{const s=window.location.hash.substr(1);return new URLSearchParams(s?atob(s):"")})();class hg{constructor(t,s,{persistent:e=!1,disabled:i=!1,parse:r=()=>{throw new Error("parse unsupported")},stringify:h=()=>{throw new Error("stringify unsupported")}}={}){this.id=t,this.newSubject=()=>new Ui({newValue:this._value}),this.setup=t=>{this.el=t,this.disabled&&this.el.classList.add("disabled"),this._setup()},this.updateHash=()=>{const t=this.stringify(this.value);gg.set(this.id,t),document.location.hash=btoa(gg.toString())},this.persistent=e,this.disabled=i,this.parse=r,this.stringify=h,xu||(this.persistent=!1);let a=s;this.persistent&&gg.has(this.id)&&(a=gg.get(this.id)),this.initialText=a,this._value=this.parse(a),this.subject=this.newSubject()}get stream(){return this.subject.asObservable()}get value(){return this._value}set value(t){const s=this.value;this._value=t,this.subject.next({newValue:t,oldValue:s,event:window.event}),this.persistent&&this.updateHash()}}class yu extends hg{constructor(t,i){super(t,"",{parse:()=>{}}),this.action=i,this._setup=()=>{this.disabled||(this.el.onclick=t=>this.action(t))}}}var zu={};!function(){var e=self.HTMLInputElement&&"valueLow"in HTMLInputElement.prototype,t=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),n=function(n){if(!e&&!n.classList.contains("multirange")){var i=n.getAttribute("value"),u=null===i?[]:i.split(","),l=+(n.min||0),a=+(n.max||100),o=n.cloneNode();n.classList.add("multirange","original"),o.classList.add("multirange","ghost"),n.value=u[0]||l+(a-l)/2,o.value=u[1]||l+(a-l)/2,n.parentNode.insertBefore(o,n.nextSibling),Object.defineProperty(n,"originalValue",t.get?t:{get:function(){return this.value},set:function(e){this.value=e}}),Object.defineProperties(n,{valueLow:{get:function(){return Math.min(this.originalValue,o.value)},set:function(e){this.originalValue=e},enumerable:!0},valueHigh:{get:function(){return Math.max(this.originalValue,o.value)},set:function(e){o.value=e},enumerable:!0}}),t.get&&Object.defineProperty(n,"value",{get:function(){return this.valueLow+","+this.valueHigh},set:function(e){var t=e.split(",");this.valueLow=t[0],this.valueHigh=t[1],r()},enumerable:!0}),"function"==typeof n.oninput&&(o.oninput=n.oninput.bind(n)),n.addEventListener("input",r),o.addEventListener("input",r),r()}function r(){o.style.setProperty("--low",(n.valueLow-l)/(a-l)*100+1+"%"),o.style.setProperty("--high",(n.valueHigh-l)/(a-l)*100-1+"%")}};n.init=function(){[].slice.call(document.querySelectorAll("input[type=range][multiple]:not(.multirange)")).forEach(n)},zu=n}();class Au extends hg{constructor(e,t,{disabled:i=!1,persistent:r=!0}={}){super(e,t,{disabled:i,persistent:r,parse:e=>{const[t,i]=e.split(/\s*,\s*/);return[parseInt(t),parseInt(i)]},stringify:([e,t])=>`${e},${t}`}),this.id=e,this._setup=()=>{const e=this.el.querySelector("input");var $LILo$$interop$default=C(zu);e.disabled=this.disabled,$LILo$$interop$default.d(e);const t=this.el.querySelector(".min"),i=this.el.querySelector(".max");e.onchange=()=>{this.value=[+e.valueLow,+e.valueHigh]},this.el.querySelector("input.ghost").oninput=e.oninput=()=>{t.innerText=e.valueLow.toString(),i.innerText=e.valueHigh.toString()},this.stream.subscribe(({newValue:r})=>{e.value=this.stringify(r),t.innerText=e.valueLow.toString(),i.innerText=e.valueHigh.toString()})}}}class Tc extends hg{constructor(t,e,{parse:i,persistent:s=!0,disabled:l=!1,stringify:a=t=>t.toString()}={}){super(t,e,{persistent:s,disabled:l,parse:i,stringify:a}),this.id=t,this._setup=()=>{this.el.disabled=this.disabled,this.el.value=this.initialText,this.setSize(),this.el.onchange=()=>{try{this.value=this.parse(this.el.value),this.el.setCustomValidity("")}catch(t){}},this.el.oninput=()=>{this.setSize();try{this.parse(this.el.value),this.el.setCustomValidity("")}catch(t){this.markInvalid(t)}}}}valid(){return this.el.checkValidity()}markInvalid(t,e=500){this.el.setCustomValidity(t.message),console.warn(t),setTimeout(()=>this.el.reportValidity(),e)}setSize(){if(this.el instanceof HTMLInputElement)this.el.size=this.el.value.length;else{const t=this.el.value.split("\n");this.el.rows=Math.min(10,t.length),this.el.cols=Math.min(50,t.reduce((t,e)=>Math.max(t,e.length),0))}}}class Gi extends hg{constructor(e,t,{disabled:s=!1,persistent:i=!1}={}){super(e,t,{persistent:i,disabled:s,parse:e=>{if(/1|true/i.test(e))return!0;if(/0|false/i.test(e))return!1;throw new Error(`invalid boolean value for input ${this.id}: ${e}`)},stringify:e=>e?"1":"0"}),this.id=e,this._setup=()=>{const e=this.el.querySelector(".on");this.disabled||(e.onclick=()=>this.value=!0);const t=this.el.querySelector(".off");this.disabled||(t.onclick=()=>this.value=!1),this.stream.subscribe(({newValue:s})=>{s?(e.style.display="none",t.style.display="inline"):(e.style.display="inline",t.style.display="none")})}}}var Bu=og&&og.__awaiter||function(e,o,$,r){return new($||($=Promise))(function(t,i){function n(e){try{p(r.next(e))}catch(o){i(o)}}function a(e){try{p(r.throw(e))}catch(o){i(o)}}function p(e){var o;e.done?t(e.value):(o=e.value,o instanceof $?o:new $(function(e){e(o)})).then(n,a)}p((r=r.apply(e,o||[])).next())})};const Cu=2e3*ze,Du=parseInt(document.querySelector("#allowed_db_range_input input").min),mm=window.AudioContext&&!!new AudioContext().audioWorklet,ge=new ln,B={pipe:new Tc("pipe",`${Cu}\n      =>3\n      =>spiral(10pi, 1, 1/2, 1/4)\n      =>R(theta, 0, 1, cos, tan)\n      =>R(theta, 0, 2, cos, tan)\n      =>R(theta, 1, 2, cos, tan)\n      =>stereo(3)`,{persistent:!0,parse:e=>ge.compile(e),stringify:W}),theta:new Tc("theta","pi * (t / 100 + audio.power + audio.onset)",{parse:e=>ge.compile(e,"scalar"),stringify:W}),h:new Tc("h","audio.hue * abs(p[0])",{parse:e=>ge.compile(e,"scalar"),stringify:W}),s:new Tc("s","1",{parse:e=>ge.compile(e,"scalar"),stringify:W}),v:new Tc("v","max(0.4, audio.power)",{parse:e=>ge.compile(e,"scalar"),stringify:W}),animate:new Gi("animate","1"),mic:new Gi("mic","0",{disabled:!mm}),fullscreen:new Gi("fullscreen","0",{disabled:!document.fullscreenEnabled}),allowedDbs:new Au("allowed_db_range",`${Du/2}, -30`,{disabled:!mm}),save:new yu("save",()=>Bu(void 0,void 0,void 0,function*(){const e=yield km(),o=URL.createObjectURL(e);try{const e=document.createElement("a");e.download=`stereo${document.location.hash}`,e.href=o,e.click()}finally{URL.revokeObjectURL(o)}}))};og.inputs=B,ng("inputs",B);var Hi={};var Ii={};var cb={};const he={hue:.5,onset:1,power:1,pitch:.5,tempo:.5};cb.AUDIO_PLACEHOLDER=he;const ie=12;cb.chromaCount=12;cb.octaveMin=0;cb.octaveMax=8;const Eu=8;cb.octaveCount=8;cb.quantumSize=128;const je=96;cb.binCount=96;var Ji={};var Ki={};class na{constructor($,t){this.dbMin=$,this.dbMax=t}}Ki.Spectrum=na,na.octave=$=>Math.floor($/ie),na.chroma=$=>$%ie,na.f=$=>{var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d(0<=$&&$<je,`Spectrum.f: expected 0 <= k = ${$} < ${je}`);const t=na.octave($),r=na.chroma($);return 16.35*Math.pow(2,t+r/ie)},na.hue=$=>{const t=1/ie,r=t/Eu;return t*na.chroma($)+r*na.octave($)},na.fmax=16.35*Math.pow(2,je),na.pitch=$=>na.chroma($)/(ie-1);var Fu=Ji&&Ji.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,i){function $(e){try{u(o.next(e))}catch(t){i(t)}}function a(e){try{u(o.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then($,a)}u((o=o.apply(e,t||[])).next())})};class ig{constructor(e,t,r){this.ctx=e,this.close=()=>this.ctx.close();const o=new AudioWorkletNode(e,"power",{numberOfInputs:je,channelCountMode:"explicit",channelCount:1});o.port.onmessage=e=>{B.mic.value?r.next(e.data):r.next(he)},o.onprocessorerror=e=>{Xc(e),B.mic.value=!1},o.connect(e.destination),B.allowedDbs.stream.subscribe(({newValue:[t,r]})=>{o.parameters.get("dbMin").setValueAtTime(t,e.currentTime),o.parameters.get("dbMax").setValueAtTime(r,e.currentTime)});for(let n=0;n<je;n++){const r=na.f(n),i=new BiquadFilterNode(e,{type:"bandpass",frequency:r,Q:r/2});t.connect(i).connect(o,0,n)}}}Ji.AudioGraph=ig,ig.create=(e,t)=>Fu(void 0,void 0,void 0,function*(){const r=new AudioContext;yield r.audioWorklet.addModule("audio/worklet.js");const o=new MediaStreamAudioSourceNode(r,{mediaStream:e});return new ig(r,o,t)});var Gu=Ii&&Ii.__awaiter||function($,e,r,a){return new(r||(r=Promise))(function(t,i){function o($){try{c(a.next($))}catch(e){i(e)}}function n($){try{c(a.throw($))}catch(e){i(e)}}function c($){var e;$.done?t($.value):(e=$.value,e instanceof r?e:new r(function($){$(e)})).then(o,n)}c((a=a.apply($,e||[])).next())})};const Li=new Ui(he),nm=Li.asObservable();let om;Ii.audioStream=nm,B.mic.stream.subscribe(({newValue:$,event:e})=>Gu(void 0,void 0,void 0,function*(){if($){const $=yield navigator.mediaDevices.getUserMedia({audio:!0});om=yield ig.create($,Li)}else om&&(yield om.close()),Li.next(he)}));class Hu{constructor(i){this.substitutions=i,this.simplify=i=>{const{n:s,d0:t,steps:e}=i;return{kind:i.kind,n:s,d0:t,steps:e.map(this.simplifyStepNode)}},this.simplifyScalar=i=>{switch(i.kind){case"number":return i;case"arith":return this.simplifyArithNode(i);case"fn":return this.simplifyFnNode(i);case"access":return this.simplifyAccessNode(i);case"id":return this.simplifyIdNode(i);case"paren":return{kind:i.kind,scalar:this.simplifyScalar(i.scalar)};}},this.simplifyStepNode=({kind:i,type:s,args:t})=>({kind:i,type:s,args:t.map(this.simplifyScalar)}),this.simplifyArithNode=({kind:i,op:s,operands:t})=>{const[e,r]=t.map(this.simplifyScalar);return{kind:i,op:s,operands:[e,r]}},this.simplifyFnNode=({kind:i,name:s,args:t})=>({kind:i,name:s,args:t.map(this.simplifyIdNode)}),this.simplifyAccessNode=({kind:i,id:s,index:t})=>({kind:i,id:s,index:this.simplifyScalar(t)}),this.simplifyIdNode=i=>{const{id:s}=i;return s in this.substitutions?this.simplifyScalar(this.substitutions[s]):i}}}var Mi=Hi&&Hi.__awaiter||function(r,e,$,t){return new($||($=Promise))(function(i,a){function o(r){try{n(t.next(r))}catch(e){a(e)}}function p(r){try{n(t.throw(r))}catch(e){a(e)}}function n(r){var e;r.done?i(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(o,p)}n((t=t.apply(r,e||[])).next())})};const pm=new Wc,qm=pm.asObservable();Hi.paramsStream=qm,(()=>Mi(void 0,void 0,void 0,function*(){let r=0;const e=(e,$)=>Mi(void 0,void 0,void 0,function*(){try{const i={pipe:new Hu({theta:B.theta.value}).simplify(B.pipe.value),scope:{t:r++/60,inf:Pg,extent:$,audio:e},hsv:{h:B.h.value,s:B.s.value,v:B.v.value}};pm.next(i)}catch(t){Xc(t)}});yield e(he,[0,0,0]);Xm(nm,fm,$m(1e3/60)).subscribe(([r,$])=>((r,$)=>Mi(void 0,void 0,void 0,function*(){B.animate.value&&(yield e(r,$))}))(r,$),Xc)}))();var Ni=jg&&jg.__awaiter||function(r,e,$,t){return new($||($=Promise))(function(a,i){function o(r){try{n(t.next(r))}catch(e){i(e)}}function m(r){try{n(t.throw(r))}catch(e){i(e)}}function n(r){var e;r.done?a(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(o,m)}n((t=t.apply(r,e||[])).next())})};const rm=new Wc,sm=rm.asObservable();jg.dataStream=sm;const Iu=()=>Ni(void 0,void 0,void 0,function*(){return yield Lj(),{getData:r=>Mj(r)}});(()=>Ni(void 0,void 0,void 0,function*(){const{getData:r}=yield Iu();let e;qm.subscribe($=>Ni(void 0,void 0,void 0,function*(){if(!e){for(const r of Object.values(B))if(r instanceof Tc&&!r.valid())return;ng("params",$),e=r($);try{const r=yield e;rm.next(r)}catch(t){["pipe","h","v"].includes(t.context)?B[t.context].markInvalid(t,0):Xc(t)}finally{e=null}}}),r=>Xc(r))}))();class Ju{constructor(){this.domElement=document.getElementById("overlay"),this.hasHover=!1,this.onmousemove=()=>{this.show(),this.inputs().reportValidity()},this.show=()=>{this.domElement.style.opacity="1"},this.maybeHide=()=>{this.hasAttention()||this.needsAttention()||(this.domElement.style.opacity="0")},this.hasAttention=()=>this.hasHover||this.contains(document.activeElement),this.needsAttention=()=>!this.inputs().reportValidity(),this.contains=e=>this.domElement.contains(e),this.setupInputs=()=>{for(const e of Object.values(B)){const t=this.querySelector(`#${e.id}`);var $VCAb$$interop$default=C(H);$VCAb$$interop$default.d(t,`Did not find element for input #${e.id}`),e.setup(t)}B.fullscreen.disabled||B.fullscreen.stream.subscribe(({newValue:e})=>{e?document.body.requestFullscreen():document.fullscreenElement&&document.exitFullscreen()})},this.querySelector=e=>this.domElement.querySelector(e),this.setupKeyboardShortcuts=()=>{document.onkeydown=e=>{if(!e.repeat&&!this.domElement.contains(e.target))switch(e.key){case" ":B.animate.value=!B.animate.value;break;case"m":case"M":B.mic.value=!B.mic.value;break;case"Enter":B.fullscreen.value=!B.fullscreen.value;}}},this.setupInputs(),this.setupKeyboardShortcuts(),this.domElement.querySelectorAll("input, textarea, label, i, h2, h1, #allowed_db_range").forEach(e=>{e.onmouseover=()=>this.hasHover=!0,e.onmouseout=()=>this.hasHover=!1}),this.inputs().querySelectorAll("input").forEach(e=>{e.oninvalid=this.show,e.onblur=()=>e.reportValidity()})}inputs(){return this.querySelector("#inputs")}}var tm=Vc&&Vc.__awaiter||function(e,a,r,t){return new(r||(r=Promise))(function(o,$){function n(e){try{c(t.next(e))}catch(a){$(a)}}function i(e){try{c(t.throw(e))}catch(a){$(a)}}function c(e){var a;e.done?o(e.value):(a=e.value,a instanceof r?a:new r(function(e){e(a)})).then(n,i)}c((t=t.apply(e,a||[])).next())})};const um=new Ju;let Ku=0;const vm=()=>{Date.now()<Ku+1e3||(document.body.classList.add("cursor-inactive"),um.maybeHide())};document.body.onmousemove=()=>{um.onmousemove(),document.body.classList.contains("cursor-inactive")&&document.body.classList.remove("cursor-inactive"),Ku=Date.now(),setTimeout(()=>vm(),1e3)},document.onreadystatechange=()=>tm(void 0,void 0,void 0,function*(){if("complete"!==document.readyState)return;const e=document.querySelector("canvas");yield jm(e),sm.subscribe(e=>tm(void 0,void 0,void 0,function*(){yield lm(e),ng("data",e),document.body.classList.add("data"),vm()}),e=>alert(`${e.message}\n${e.stack}`))});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=Vc}else if(typeof define==="function"&&define.amd){define(function(){return Vc})}ta.__esModule=true;xg.__esModule=true;cb.__esModule=true;Ki.__esModule=true;Og.__esModule=true;return{"QCba":Vc,"JZPE":ta,"Ek7W":xg,"VCAb":H,"yyW6":cb,"hUgL":Ki,"eKDL":Og};});