{"version":3,"sources":["webpack:///./src/web/renderer.ts"],"names":["renderer","constructor","width","window","innerWidth","height","innerHeight","aspect","this","setSize","camera","PerspectiveCamera","position","z","render","scene","d","color","points","geometry","assert","equal","length","forEach","p","i","isNaN","console","warn","setAttribute","BufferAttribute","computeBoundingSphere","s","boundingSphere","Math","min","center","radius","requestAnimationFrame","WebGLRenderer","onresize","Points","BufferGeometry","PointsMaterial","vertexColors","VertexColors","size","Scene","add","domElement"],"mappings":"yRAuFO,IAAMA,EAAW,IA1ExB,MAOEC,cAAc,4GAFF,GAEE,iBAoBI,KAChB,IACMC,EAAQC,OAAOC,WACfC,EAASF,OAAOG,YAChBC,EAASL,EAAQG,EAGvBG,KAAKR,SAASS,QAAQP,EAAOG,GAC7BG,KAAKE,OAAS,IAAIC,IAHN,IAG6BJ,EAP5B,IAAY,KAQzBC,KAAKE,OAAOE,SAASC,EAAIL,KAAKK,IA7BlB,gBAoCL,KACPL,KAAKR,SAASc,OAAON,KAAKO,MAAOP,KAAKE,UArC1B,gBAwCJ,IAAiC,IAAjC,EAAEM,EAAF,SAAKJ,EAAL,MAAeK,GAAkB,GACnC,OAAEC,GAAWV,KACbW,EAAWD,EAAOC,SACxBC,IAAOC,MAAMT,EAASU,OAASN,EAAG,GAClCI,IAAOC,MAAMJ,EAAMK,OAAS,EAAG,GAE/BV,EAASW,QAAQ,CAACC,EAAGC,KACfC,MAAMF,IACRG,QAAQC,KAAR,mCAAyCH,MAI7CN,EAASU,aAAa,WAAY,IAAIC,IAAgBlB,EAAUI,IAChEG,EAASU,aAAa,QAAS,IAAIC,IAAgBb,EAAO,IAE1D,IAAIJ,EAAI,EACR,GAAIG,EAAI,EAAG,CACTG,EAASY,wBACT,IAAMC,EAAIb,EAASc,eACnBpB,EAAIqB,KAAKC,IAAI,EAAGH,EAAEI,OAAOvB,EAAImB,EAAEK,OAAS,GAE1C7B,KAAKE,OAAOE,SAASC,EAAIL,KAAKK,EAAIA,EAElCyB,sBAAsB9B,KAAKM,UA9D3BN,KAAKR,SAAW,IAAIuC,IACpB/B,KAAKC,UACLN,OAAOqC,SAAW,KAChBhC,KAAKC,UACL6B,sBAAsB9B,KAAKM,SAG7BN,KAAKU,OAAS,IAAIuB,IAChB,IAAIC,IACJ,IAAIC,IAAe,CACjBC,aAAcC,IACdC,KAAM,QAIVtC,KAAKO,MAAQ,IAAIgC,IACjBvC,KAAKO,MAAMiC,IAAIxC,KAAKU,QAetB,iBACE,OAAOV,KAAKR,SAASiD","file":"6.addfb8dba4c6e5f9bac7.js","sourcesContent":["import {\n  PerspectiveCamera,\n  BufferGeometry,\n  BufferAttribute,\n  Points,\n  PointsMaterial,\n  WebGLRenderer,\n  VertexColors,\n  Scene,\n} from 'three';\nimport { Data } from '../core/data';\nimport assert from 'assert';\n\nclass Renderer {\n  private renderer: WebGLRenderer;\n  private scene: Scene;\n  private camera: PerspectiveCamera;\n  private points: Points;\n  private z = 5;\n\n  constructor() {\n    this.renderer = new WebGLRenderer();\n    this.setSize();\n    window.onresize = () => {\n      this.setSize();\n      requestAnimationFrame(this.render);\n    };\n\n    this.points = new Points(\n      new BufferGeometry(),\n      new PointsMaterial({\n        vertexColors: VertexColors,\n        size: 0.001,\n      })\n    );\n\n    this.scene = new Scene();\n    this.scene.add(this.points);\n  }\n\n  private setSize = () => {\n    const near = 0.01, far = 1000;\n    const width = window.innerWidth;\n    const height = window.innerHeight;\n    const aspect = width / height;\n    const fov = 100;\n\n    this.renderer.setSize(width, height);\n    this.camera = new PerspectiveCamera(fov, aspect, near, far);\n    this.camera.position.z = this.z;\n  };\n\n  get domElement() {\n    return this.renderer.domElement;\n  }\n\n  render = () => {\n    this.renderer.render(this.scene, this.camera);\n  };\n\n  update = ({ d, position, color }: Data) => {\n    const { points } = this;\n    const geometry = points.geometry as BufferGeometry;\n    assert.equal(position.length % d, 0);\n    assert.equal(color.length % 3, 0);\n\n    position.forEach((p, i) => {\n      if (isNaN(p)) {\n        console.warn(`found NaN value at index ${i}`);\n      }\n    });\n\n    geometry.setAttribute('position', new BufferAttribute(position, d));\n    geometry.setAttribute('color', new BufferAttribute(color, 3));\n\n    let z = 5;\n    if (d > 2) {\n      geometry.computeBoundingSphere();\n      const s = geometry.boundingSphere;\n      z = Math.min(5, s.center.z + s.radius + 1);\n    }\n    this.camera.position.z = this.z = z;\n\n    requestAnimationFrame(this.render);\n  };\n}\n\nexport const renderer = new Renderer();\n"],"sourceRoot":""}